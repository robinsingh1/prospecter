(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */
var TemplatesMenu = require('./templates_menu.js.min.js');
var EditTemplateView = require('./edit_template.js.min.js');
var FollowupTimeline = require('./followup_timeline.js.min.js');

module.exports = React.createClass({displayName: 'exports',
  // Campaign Detail
  getInitialState: function() {
    return {
      selectedTemplate: 0,
      templateDetailMode: false,
      editMode: false,
      followupDay: 0,
      templates:[],
      currentTemplate:'',
    }
  },

  componentDidMount: function() {
     thissss = this;
     company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
     qry = 'where={"company":'+company+'}'
    $.ajax({
      url:'https://api.parse.com/1/classes/Templates',
      headers: appConfig.headers,
      data: qry,
      success: function(res) {
        //console.log(res.results)
        thissss.setState({templates: res.results})
      },
      error: function(err) {
        console.log('error')
        //console.log(err)
      }
    });
    /*
    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      headers: appConfig.headers,
      data: qry,
      success: function(res) {
        //console.log(res.results)
        thissss.setState({templates: res.results})
      },
      error: function(err) {
        console.log('error')
        //console.log(err)
      }
    });
    */
  },

  returnToOverview: function() {
    this.props.toggleScreen('Campaigns')
  },

  render: function() {
    //console.log('campaign detail')
    //console.log(this.props.selectedCampaign)
    thiss = this;
    return (
      React.DOM.div({className: "container", 
           style: {width:'100%',height:'100%',paddingLeft:0,paddingRight:0}}, 
        React.DOM.div({style: {marginBottom:30}}, 
        React.DOM.h5({style: {marginTop:20,marginLeft:20}}, 
          React.DOM.a({href: "javascript:", onClick: this.returnToOverview}, "Campaigns "), 
          React.DOM.small(null, 
            React.DOM.i({style: {marginLeft:10, marginRight:10}, 
               className: "fa fa-chevron-right"})
          ), 
          this.props.selectedCampaign.name
        ), 
        React.DOM.h6({style: {marginLeft:20}}, 
          React.DOM.span({className: "text-muted"}, "Prospect List:"), "  ", 
          this.props.selectedCampaign.prospect_list.name
        ), 
        React.DOM.a({href: "javascript:", 
          style: {float: 'right', marginTop: -35, marginRight: 30, display:'none'}, 
           className: "btn btn-success btn-sm"}, 
          React.DOM.i({className: "fa fa-envelope"}), " Send!"
        )
        ), 
          React.DOM.div({className: "col-md-8 panel panel-default", 
               style: {height:'363px',paddingLeft:305,paddingTop:50,overflow:'auto',borderRight:0,borderRadius:0}}, 
               FollowupTimeline({
                  currentCampaign: this.props.selectedCampaign, 
                  followups: this.props.selectedCampaign.followups})
          ), 
          React.DOM.div({className: "col-md-4", 
               style: {paddingLeft:0,paddingRight:0,height:363}}, 
            TemplatesMenu({
              templates: this.state.templates, 
              toggleTemplateEditMenu: this.toggleTemplateEditMenu})
          ), 

          (this.state.templateDetailMode) ? EditTemplateView({
            editMode: this.state.editMode, 
            initialTemplateValues: this.state.currentTemplate, 
            toggleTemplateEditMenu: this.toggleTemplateEditMenu, 
            followupDay: this.state.followupDay}) : ""
      )
    );
  },

  toggleTemplateEditMenu: function(currentTemplate) {
    //console.log(this.getDOMNode())
    //console.log(currentTemplate)

    this.setState({
      currentTemplate: currentTemplate,
      templateDetailMode: !this.state.templateDetailMode,
    })
  }
});

},{"./edit_template.js.min.js":2,"./followup_timeline.js.min.js":3,"./templates_menu.js.min.js":4}],2:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    console.log(this.props.initialTemplateValues)
    return {
      templateBody: this.props.initialTemplateValues.body,
      templateSubject: this.props.initialTemplateValues.subject,
      editMode:false
    }
  },
  //EditTemplateView
  componentDidMount: function() {
    $('.template-body').html(this.state.templateBody)
  },

  clickedOverlay: function() {
    console.log('clicked overlay')
    this.props.toggleTemplateEditMenu()
  },

  changeMode: function() {
    // Update template html on toggle
    parse_headers = appConfig.parseHeaders
    if(this.state.editMode){
      $('.summer').destroy();
      this.setState({
        templateBody: $('.summer').code(),
        templateSubject: $('.subject').val(),
        editMode: !this.state.editMode,
      })

      $.ajax({
        url:'https://api.parse.com/1/classes/Templates/'+this.props.initialTemplateValues.objectId,
        type:'PUT',
        headers:parse_headers,
        data:JSON.stringify({body: $('.summer').code(),subject: $('.subject').val()}),
        success: function(res) {
          console.log(res)
        },
        error: function(err) {
          console.log(err)
        }
      });
    } else {
      this.setState({ editMode: !this.state.editMode })
    }
  },

  componentDidUpdate: function() {
    /*
    thiss = this;
    */

    if(this.state.editMode){
      // Replace Subject 
      $('.subject').val(this.state.templateSubject)

      $('.summer').summernote({
        height: 200,
        toolbar: [
          ['style', ['bold', 'italic', 'underline', 'clear']],
          ['font', ['strikethrough']],
          ['fontsize', ['fontsize']],
          ['color', ['color']],
          ['para', ['ul', 'ol', 'paragraph']],
          ['height', ['height']],
        ]
      })

      // Initialize Editor with html
      $('.summer').code(this.state.templateBody)
    }
  },

  render: function() {
    subjectPlace = (this.state.editMode) ? React.DOM.input({style: {display:'inline',width:480}, className: "form-control subject"}) : this.state.templateSubject

    if(this.state.editMode){
       toggleButton = React.DOM.a({href: "javascript:", 
             onClick: this.changeMode, 
             className: "btn btn-success btn-xs", 
             style: {display:'block',float:'right',marginTop:5}}, 
            React.DOM.i({className: "fa fa-save"}), "   Save Template")
    } else {
       toggleButton = React.DOM.a({href: "javascript:", 
             onClick: this.changeMode, 
             className: "btn btn-primary btn-xs", 
             style: {display:'block',float:'right',marginTop:5}}, 
            React.DOM.i({className: "fa fa-pencil-square"}), "   Edit Template")
    }

    return (
      React.DOM.div(null, 
      React.DOM.div({onClick: this.clickedOverlay, id: "editTemplateOverlay"}), 
      React.DOM.div({id: "editTemplateView", 
           className: "panel panel-info", 
           style: {display:'block'}}, 
           React.DOM.div({className: "panel-heading", style: {height:50}}, 
             React.DOM.h6({style: {float:'left'}}, 
               React.DOM.i({className: "fa fa-file-text-o"}), 
               "  " + this.props.initialTemplateValues.name
             ), 
          toggleButton
        ), 
        React.DOM.div({className: "panel-body"}, 
          React.DOM.div({className: "editTemplateTitle"}, 
            React.DOM.span(null, "Subject: "), 
            subjectPlace
          ), 
         React.DOM.br(null), 
         React.DOM.div({className: "templateDetails"}, 
           React.DOM.h6({style: {marginBottom:'0'}, className: "text-muted"}, 
             "Created by Mark on Jul. 21, 2014"
           ), 
           React.DOM.h6({style: {marginTop:'0'}, className: "text-muted"}, 
             "last updated 7 days ago"
           )
         ), 
        React.DOM.br(null), 
        React.DOM.div({className: "panel panel-default"}, 
          React.DOM.div({className: "panel-body summer template-body"}
          )
        )
    )
)
)
    );
  }
});

},{}],3:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // FollowupTimeline
  getInitialState: function() {
    return {
      loading: false,
    }
  },

  componentDidMount: function() {
    thiss = this;
    $('.day').tooltip()
    $('.day-popover').popover({
      html: true,
      content: '<h6 style="width:130px;display:inline-block;"><i class="fa fa-file-text-o" ></i>&nbsp;&nbsp;Example Template</h6><button class="win-btn btn btn-success btn-xs"><i class="fa fa-paper-plane"></i>&nbsp;Send</button>&nbsp;<button class="win-btn btn btn-default btn-xs"><i class="fa fa-pencil"></i></button>&nbsp;<button class="win-btn btn btn-default btn-xs"><i class="fa fa-trash-o"></i></button>'
    })

    $('.day-popover').popover('show')
    $('.win-btn').click(function() {
      //console.log('clicked win btn')
    });

    // Followups that belong to campaign
     company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
     currentCampaign = {
       '__type': 'Pointer',
       'className':'Campaign',
       'objectId':this.props.currentCampaign.objectId
     }
     currentCampaign = JSON.stringify(currentCampaign)
     //qry = 'where={"company":'+company+',"campaign":'+currentCampaign+'}&include=template'
     qry = 'where={"campaign":'+currentCampaign+'}&include=template'
     $.ajax({
       url:'https://api.parse.com/1/classes/Followup',
       type:'GET',
       headers: appConfig.headers,
       data: qry,
       success: function(res) {
         console.log(res.results)
       },
       error: function(err) {
         console.log('error')
         console.log(err)
       }
     })
  },
  
  render: function() {
    //console.log(this.props.followups)
    timelineElements = []
    for(i=0;i< 31;i++){
      for(ii=0;ii< this.props.followups.length; ii++){
        elementType = i == this.props.followups[ii].day
        if(elementType)
          break
      }
      timelineElements.push(TimelineDayElement({
                              dayCount: i, 
                              elementType: !elementType, 
                              toggleTemplateEditMenu: this.toggleTemplateEditMenu}))
    }
    return (
      React.DOM.div(null, 
          React.DOM.div({className: "timeline", 
               style: {height:'900px',backgroundColor:'rgb(90, 107, 119)',width:5}}, 
               timelineElements
          )
      )
    );
  }
});

var TimelineDayElement = React.createClass({displayName: 'TimelineDayElement',
  render: function() {
    timelineDay = "lol"
    if(this.props.elementType) {
      timelineDay = React.DOM.div({className: "day", 
                         onClick: this.props.toggleTemplateEditMenu, 
                         'data-toggle': "tooltip", 
                         'data-placement': "right", 
                         title: "+ Add a follow-up"}, "D"+this.props.dayCount)
    } else {
      timelineDay = React.DOM.div({className: "day day-popover", 
                         onClick: this.props.toggleTemplateEditMenu, 
                         'data-toggle': "popover", 
                         'data-trigger': "manual", 
                         'data-placement': "right"}, "D"+this.props.dayCount, " ")
    }
    return (
      React.DOM.div(null, 
      timelineDay
      )
    )
  }
});

},{}],4:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //TemplatesMenu

  toggleTemplateEditMenu: function(currentTemplate) {
    this.props.toggleTemplateEditMenu(currentTemplate)
  },

  render: function() {
    //console.log(this.props.templates)
    templates = []
    for(i=0;i< this.props.templates.length; i++) {
      templates.push(
        TemplateListItem({
          toggleTemplateEditMenu: this.toggleTemplateEditMenu, 
          template: this.props.templates[i]})
      )
    }

    return (
      React.DOM.div({className: "", style: {padding:'0', borderRight:'2px solid rgba(0,0,0,0)',height:'100%',textAlign:'center'}}, 
        React.DOM.div({className: "panel panel-default", 
             style: {borderRight:0,borderRadius:0,height:'100%'}}, 
          React.DOM.div({className: "panel-heading", style: {height:40}}, 
            React.DOM.span({style: {float:'left',fontSize:14,fontWeight:'bold'}}, 
              React.DOM.i({className: "fa fa-file-text-o"}), 
              React.DOM.span({style: {marginLeft:5}}, "Templates")
            ), 
            React.DOM.a({href: "javascript:", 
              className: "btn btn-success btn-xs", 
              onClick: this.props.toggleTemplateEditMenu, 
                style: {float:'right'}}, 
              React.DOM.i({className: "fa fa-plus"}), 
              React.DOM.span({style: {marginLeft:5}}, "Create Template")
            )
          ), 
          React.DOM.ul({className: "list-group", 
              style: {textAlign:'left', borderBottom:'1px solid #ddd'}}, 
            templates
          )
        )
      )
    )
  }
});

var TemplateListItem = React.createClass({displayName: 'TemplateListItem',
  toggleTemplateEditMenu: function() {
    console.log(this.props.template)
    this.props.toggleTemplateEditMenu(this.props.template)
  },
  render: function() {
    return (
      React.DOM.div(null, 
        React.DOM.a({href: "javascript:", 
           onClick: this.toggleTemplateEditMenu, 
           className: "list-group-item"}, 
           React.DOM.span({className: "label label-default"}, 
             this.props.template.name
           ), 
           React.DOM.h6(null, "Subject:", React.DOM.span({className: "text text-muted"}, 
             " " + this.props.template.subject
           ))
         )
      )
    );
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvY2FtcGFpZ25fZGV0YWlsLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvZWRpdF90ZW1wbGF0ZS5qcy5taW4uanMiLCIvVXNlcnMvcm9iaW4vUHJvamVjdHMvcHJvc3BlY3Rlci9wcm9zcGVjdGVyLXBhcnNlL2Rldi9idWlsZC9qcy9jb21wb25lbnRzL2ZvbGxvd3VwX3RpbWVsaW5lLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdGVtcGxhdGVzX21lbnUuanMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cbnZhciBUZW1wbGF0ZXNNZW51ID0gcmVxdWlyZSgnLi90ZW1wbGF0ZXNfbWVudS5qcy5taW4uanMnKTtcbnZhciBFZGl0VGVtcGxhdGVWaWV3ID0gcmVxdWlyZSgnLi9lZGl0X3RlbXBsYXRlLmpzLm1pbi5qcycpO1xudmFyIEZvbGxvd3VwVGltZWxpbmUgPSByZXF1aXJlKCcuL2ZvbGxvd3VwX3RpbWVsaW5lLmpzLm1pbi5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICAvLyBDYW1wYWlnbiBEZXRhaWxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2VsZWN0ZWRUZW1wbGF0ZTogMCxcbiAgICAgIHRlbXBsYXRlRGV0YWlsTW9kZTogZmFsc2UsXG4gICAgICBlZGl0TW9kZTogZmFsc2UsXG4gICAgICBmb2xsb3d1cERheTogMCxcbiAgICAgIHRlbXBsYXRlczpbXSxcbiAgICAgIGN1cnJlbnRUZW1wbGF0ZTonJyxcbiAgICB9XG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgICB0aGlzc3NzID0gdGhpcztcbiAgICAgY29tcGFueSA9IEpTT04uc3RyaW5naWZ5KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKS5jb21wYW55KVxuICAgICBxcnkgPSAnd2hlcmU9e1wiY29tcGFueVwiOicrY29tcGFueSsnfSdcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1RlbXBsYXRlcycsXG4gICAgICBoZWFkZXJzOiBhcHBDb25maWcuaGVhZGVycyxcbiAgICAgIGRhdGE6IHFyeSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAvL2NvbnNvbGUubG9nKHJlcy5yZXN1bHRzKVxuICAgICAgICB0aGlzc3NzLnNldFN0YXRlKHt0ZW1wbGF0ZXM6IHJlcy5yZXN1bHRzfSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICAgIC8vY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuICAgIC8qXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QnLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBkYXRhOiBxcnksXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXMucmVzdWx0cylcbiAgICAgICAgdGhpc3Nzcy5zZXRTdGF0ZSh7dGVtcGxhdGVzOiByZXMucmVzdWx0c30pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgICAgICAvL2NvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KTtcbiAgICAqL1xuICB9LFxuXG4gIHJldHVyblRvT3ZlcnZpZXc6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHJvcHMudG9nZ2xlU2NyZWVuKCdDYW1wYWlnbnMnKVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgLy9jb25zb2xlLmxvZygnY2FtcGFpZ24gZGV0YWlsJylcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbilcbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjb250YWluZXJcIiwgXG4gICAgICAgICAgIHN0eWxlOiB7d2lkdGg6JzEwMCUnLGhlaWdodDonMTAwJScscGFkZGluZ0xlZnQ6MCxwYWRkaW5nUmlnaHQ6MH19LCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7c3R5bGU6IHttYXJnaW5Cb3R0b206MzB9fSwgXG4gICAgICAgIFJlYWN0LkRPTS5oNSh7c3R5bGU6IHttYXJnaW5Ub3A6MjAsbWFyZ2luTGVmdDoyMH19LCBcbiAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBvbkNsaWNrOiB0aGlzLnJldHVyblRvT3ZlcnZpZXd9LCBcIkNhbXBhaWducyBcIiksIFxuICAgICAgICAgIFJlYWN0LkRPTS5zbWFsbChudWxsLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtzdHlsZToge21hcmdpbkxlZnQ6MTAsIG1hcmdpblJpZ2h0OjEwfSwgXG4gICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZmEgZmEtY2hldnJvbi1yaWdodFwifSlcbiAgICAgICAgICApLCBcbiAgICAgICAgICB0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ24ubmFtZVxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmg2KHtzdHlsZToge21hcmdpbkxlZnQ6MjB9fSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJ0ZXh0LW11dGVkXCJ9LCBcIlByb3NwZWN0IExpc3Q6XCIpLCBcIiDCoFwiLCBcbiAgICAgICAgICB0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ24ucHJvc3BlY3RfbGlzdC5uYW1lXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICBzdHlsZToge2Zsb2F0OiAncmlnaHQnLCBtYXJnaW5Ub3A6IC0zNSwgbWFyZ2luUmlnaHQ6IDMwLCBkaXNwbGF5Oidub25lJ30sIFxuICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1zdWNjZXNzIGJ0bi1zbVwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1lbnZlbG9wZVwifSksIFwiIFNlbmQhXCJcbiAgICAgICAgKVxuICAgICAgICApLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY29sLW1kLTggcGFuZWwgcGFuZWwtZGVmYXVsdFwiLCBcbiAgICAgICAgICAgICAgIHN0eWxlOiB7aGVpZ2h0OiczNjNweCcscGFkZGluZ0xlZnQ6MzA1LHBhZGRpbmdUb3A6NTAsb3ZlcmZsb3c6J2F1dG8nLGJvcmRlclJpZ2h0OjAsYm9yZGVyUmFkaXVzOjB9fSwgXG4gICAgICAgICAgICAgICBGb2xsb3d1cFRpbWVsaW5lKHtcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRDYW1wYWlnbjogdGhpcy5wcm9wcy5zZWxlY3RlZENhbXBhaWduLCBcbiAgICAgICAgICAgICAgICAgIGZvbGxvd3VwczogdGhpcy5wcm9wcy5zZWxlY3RlZENhbXBhaWduLmZvbGxvd3Vwc30pXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbC1tZC00XCIsIFxuICAgICAgICAgICAgICAgc3R5bGU6IHtwYWRkaW5nTGVmdDowLHBhZGRpbmdSaWdodDowLGhlaWdodDozNjN9fSwgXG4gICAgICAgICAgICBUZW1wbGF0ZXNNZW51KHtcbiAgICAgICAgICAgICAgdGVtcGxhdGVzOiB0aGlzLnN0YXRlLnRlbXBsYXRlcywgXG4gICAgICAgICAgICAgIHRvZ2dsZVRlbXBsYXRlRWRpdE1lbnU6IHRoaXMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudX0pXG4gICAgICAgICAgKSwgXG5cbiAgICAgICAgICAodGhpcy5zdGF0ZS50ZW1wbGF0ZURldGFpbE1vZGUpID8gRWRpdFRlbXBsYXRlVmlldyh7XG4gICAgICAgICAgICBlZGl0TW9kZTogdGhpcy5zdGF0ZS5lZGl0TW9kZSwgXG4gICAgICAgICAgICBpbml0aWFsVGVtcGxhdGVWYWx1ZXM6IHRoaXMuc3RhdGUuY3VycmVudFRlbXBsYXRlLCBcbiAgICAgICAgICAgIHRvZ2dsZVRlbXBsYXRlRWRpdE1lbnU6IHRoaXMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudSwgXG4gICAgICAgICAgICBmb2xsb3d1cERheTogdGhpcy5zdGF0ZS5mb2xsb3d1cERheX0pIDogXCJcIlxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgdG9nZ2xlVGVtcGxhdGVFZGl0TWVudTogZnVuY3Rpb24oY3VycmVudFRlbXBsYXRlKSB7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLmdldERPTU5vZGUoKSlcbiAgICAvL2NvbnNvbGUubG9nKGN1cnJlbnRUZW1wbGF0ZSlcblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgY3VycmVudFRlbXBsYXRlOiBjdXJyZW50VGVtcGxhdGUsXG4gICAgICB0ZW1wbGF0ZURldGFpbE1vZGU6ICF0aGlzLnN0YXRlLnRlbXBsYXRlRGV0YWlsTW9kZSxcbiAgICB9KVxuICB9XG59KTtcbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKHRoaXMucHJvcHMuaW5pdGlhbFRlbXBsYXRlVmFsdWVzKVxuICAgIHJldHVybiB7XG4gICAgICB0ZW1wbGF0ZUJvZHk6IHRoaXMucHJvcHMuaW5pdGlhbFRlbXBsYXRlVmFsdWVzLmJvZHksXG4gICAgICB0ZW1wbGF0ZVN1YmplY3Q6IHRoaXMucHJvcHMuaW5pdGlhbFRlbXBsYXRlVmFsdWVzLnN1YmplY3QsXG4gICAgICBlZGl0TW9kZTpmYWxzZVxuICAgIH1cbiAgfSxcbiAgLy9FZGl0VGVtcGxhdGVWaWV3XG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAkKCcudGVtcGxhdGUtYm9keScpLmh0bWwodGhpcy5zdGF0ZS50ZW1wbGF0ZUJvZHkpXG4gIH0sXG5cbiAgY2xpY2tlZE92ZXJsYXk6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKCdjbGlja2VkIG92ZXJsYXknKVxuICAgIHRoaXMucHJvcHMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudSgpXG4gIH0sXG5cbiAgY2hhbmdlTW9kZTogZnVuY3Rpb24oKSB7XG4gICAgLy8gVXBkYXRlIHRlbXBsYXRlIGh0bWwgb24gdG9nZ2xlXG4gICAgcGFyc2VfaGVhZGVycyA9IGFwcENvbmZpZy5wYXJzZUhlYWRlcnNcbiAgICBpZih0aGlzLnN0YXRlLmVkaXRNb2RlKXtcbiAgICAgICQoJy5zdW1tZXInKS5kZXN0cm95KCk7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgdGVtcGxhdGVCb2R5OiAkKCcuc3VtbWVyJykuY29kZSgpLFxuICAgICAgICB0ZW1wbGF0ZVN1YmplY3Q6ICQoJy5zdWJqZWN0JykudmFsKCksXG4gICAgICAgIGVkaXRNb2RlOiAhdGhpcy5zdGF0ZS5lZGl0TW9kZSxcbiAgICAgIH0pXG5cbiAgICAgICQuYWpheCh7XG4gICAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9UZW1wbGF0ZXMvJyt0aGlzLnByb3BzLmluaXRpYWxUZW1wbGF0ZVZhbHVlcy5vYmplY3RJZCxcbiAgICAgICAgdHlwZTonUFVUJyxcbiAgICAgICAgaGVhZGVyczpwYXJzZV9oZWFkZXJzLFxuICAgICAgICBkYXRhOkpTT04uc3RyaW5naWZ5KHtib2R5OiAkKCcuc3VtbWVyJykuY29kZSgpLHN1YmplY3Q6ICQoJy5zdWJqZWN0JykudmFsKCl9KSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVkaXRNb2RlOiAhdGhpcy5zdGF0ZS5lZGl0TW9kZSB9KVxuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIC8qXG4gICAgdGhpc3MgPSB0aGlzO1xuICAgICovXG5cbiAgICBpZih0aGlzLnN0YXRlLmVkaXRNb2RlKXtcbiAgICAgIC8vIFJlcGxhY2UgU3ViamVjdCBcbiAgICAgICQoJy5zdWJqZWN0JykudmFsKHRoaXMuc3RhdGUudGVtcGxhdGVTdWJqZWN0KVxuXG4gICAgICAkKCcuc3VtbWVyJykuc3VtbWVybm90ZSh7XG4gICAgICAgIGhlaWdodDogMjAwLFxuICAgICAgICB0b29sYmFyOiBbXG4gICAgICAgICAgWydzdHlsZScsIFsnYm9sZCcsICdpdGFsaWMnLCAndW5kZXJsaW5lJywgJ2NsZWFyJ11dLFxuICAgICAgICAgIFsnZm9udCcsIFsnc3RyaWtldGhyb3VnaCddXSxcbiAgICAgICAgICBbJ2ZvbnRzaXplJywgWydmb250c2l6ZSddXSxcbiAgICAgICAgICBbJ2NvbG9yJywgWydjb2xvciddXSxcbiAgICAgICAgICBbJ3BhcmEnLCBbJ3VsJywgJ29sJywgJ3BhcmFncmFwaCddXSxcbiAgICAgICAgICBbJ2hlaWdodCcsIFsnaGVpZ2h0J11dLFxuICAgICAgICBdXG4gICAgICB9KVxuXG4gICAgICAvLyBJbml0aWFsaXplIEVkaXRvciB3aXRoIGh0bWxcbiAgICAgICQoJy5zdW1tZXInKS5jb2RlKHRoaXMuc3RhdGUudGVtcGxhdGVCb2R5KVxuICAgIH1cbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHN1YmplY3RQbGFjZSA9ICh0aGlzLnN0YXRlLmVkaXRNb2RlKSA/IFJlYWN0LkRPTS5pbnB1dCh7c3R5bGU6IHtkaXNwbGF5OidpbmxpbmUnLHdpZHRoOjQ4MH0sIGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2wgc3ViamVjdFwifSkgOiB0aGlzLnN0YXRlLnRlbXBsYXRlU3ViamVjdFxuXG4gICAgaWYodGhpcy5zdGF0ZS5lZGl0TW9kZSl7XG4gICAgICAgdG9nZ2xlQnV0dG9uID0gUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VNb2RlLCBcbiAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1zdWNjZXNzIGJ0bi14c1wiLCBcbiAgICAgICAgICAgICBzdHlsZToge2Rpc3BsYXk6J2Jsb2NrJyxmbG9hdDoncmlnaHQnLG1hcmdpblRvcDo1fX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1zYXZlXCJ9KSwgXCIgwqAgU2F2ZSBUZW1wbGF0ZVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgdG9nZ2xlQnV0dG9uID0gUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VNb2RlLCBcbiAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14c1wiLCBcbiAgICAgICAgICAgICBzdHlsZToge2Rpc3BsYXk6J2Jsb2NrJyxmbG9hdDoncmlnaHQnLG1hcmdpblRvcDo1fX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1wZW5jaWwtc3F1YXJlXCJ9KSwgXCIgwqAgRWRpdCBUZW1wbGF0ZVwiKVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgUmVhY3QuRE9NLmRpdih7b25DbGljazogdGhpcy5jbGlja2VkT3ZlcmxheSwgaWQ6IFwiZWRpdFRlbXBsYXRlT3ZlcmxheVwifSksIFxuICAgICAgUmVhY3QuRE9NLmRpdih7aWQ6IFwiZWRpdFRlbXBsYXRlVmlld1wiLCBcbiAgICAgICAgICAgY2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLWluZm9cIiwgXG4gICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonYmxvY2snfX0sIFxuICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicGFuZWwtaGVhZGluZ1wiLCBzdHlsZToge2hlaWdodDo1MH19LCBcbiAgICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7ZmxvYXQ6J2xlZnQnfX0sIFxuICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1maWxlLXRleHQtb1wifSksIFxuICAgICAgICAgICAgICAgXCIgIFwiICsgdGhpcy5wcm9wcy5pbml0aWFsVGVtcGxhdGVWYWx1ZXMubmFtZVxuICAgICAgICAgICAgICksIFxuICAgICAgICAgIHRvZ2dsZUJ1dHRvblxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInBhbmVsLWJvZHlcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJlZGl0VGVtcGxhdGVUaXRsZVwifSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uc3BhbihudWxsLCBcIlN1YmplY3Q6IFwiKSwgXG4gICAgICAgICAgICBzdWJqZWN0UGxhY2VcbiAgICAgICAgICApLCBcbiAgICAgICAgIFJlYWN0LkRPTS5icihudWxsKSwgXG4gICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwidGVtcGxhdGVEZXRhaWxzXCJ9LCBcbiAgICAgICAgICAgUmVhY3QuRE9NLmg2KHtzdHlsZToge21hcmdpbkJvdHRvbTonMCd9LCBjbGFzc05hbWU6IFwidGV4dC1tdXRlZFwifSwgXG4gICAgICAgICAgICAgXCJDcmVhdGVkIGJ5IE1hcmsgb24gSnVsLiAyMSwgMjAxNFwiXG4gICAgICAgICAgICksIFxuICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7bWFyZ2luVG9wOicwJ30sIGNsYXNzTmFtZTogXCJ0ZXh0LW11dGVkXCJ9LCBcbiAgICAgICAgICAgICBcImxhc3QgdXBkYXRlZCA3IGRheXMgYWdvXCJcbiAgICAgICAgICAgKVxuICAgICAgICAgKSwgXG4gICAgICAgIFJlYWN0LkRPTS5icihudWxsKSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwYW5lbCBwYW5lbC1kZWZhdWx0XCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicGFuZWwtYm9keSBzdW1tZXIgdGVtcGxhdGUtYm9keVwifVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbilcbilcbiAgICApO1xuICB9XG59KTtcbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICAvLyBGb2xsb3d1cFRpbWVsaW5lXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgdGhpc3MgPSB0aGlzO1xuICAgICQoJy5kYXknKS50b29sdGlwKClcbiAgICAkKCcuZGF5LXBvcG92ZXInKS5wb3BvdmVyKHtcbiAgICAgIGh0bWw6IHRydWUsXG4gICAgICBjb250ZW50OiAnPGg2IHN0eWxlPVwid2lkdGg6MTMwcHg7ZGlzcGxheTppbmxpbmUtYmxvY2s7XCI+PGkgY2xhc3M9XCJmYSBmYS1maWxlLXRleHQtb1wiID48L2k+Jm5ic3A7Jm5ic3A7RXhhbXBsZSBUZW1wbGF0ZTwvaDY+PGJ1dHRvbiBjbGFzcz1cIndpbi1idG4gYnRuIGJ0bi1zdWNjZXNzIGJ0bi14c1wiPjxpIGNsYXNzPVwiZmEgZmEtcGFwZXItcGxhbmVcIj48L2k+Jm5ic3A7U2VuZDwvYnV0dG9uPiZuYnNwOzxidXR0b24gY2xhc3M9XCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHNcIj48aSBjbGFzcz1cImZhIGZhLXBlbmNpbFwiPjwvaT48L2J1dHRvbj4mbmJzcDs8YnV0dG9uIGNsYXNzPVwid2luLWJ0biBidG4gYnRuLWRlZmF1bHQgYnRuLXhzXCI+PGkgY2xhc3M9XCJmYSBmYS10cmFzaC1vXCI+PC9pPjwvYnV0dG9uPidcbiAgICB9KVxuXG4gICAgJCgnLmRheS1wb3BvdmVyJykucG9wb3Zlcignc2hvdycpXG4gICAgJCgnLndpbi1idG4nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgIC8vY29uc29sZS5sb2coJ2NsaWNrZWQgd2luIGJ0bicpXG4gICAgfSk7XG5cbiAgICAvLyBGb2xsb3d1cHMgdGhhdCBiZWxvbmcgdG8gY2FtcGFpZ25cbiAgICAgY29tcGFueSA9IEpTT04uc3RyaW5naWZ5KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKS5jb21wYW55KVxuICAgICBjdXJyZW50Q2FtcGFpZ24gPSB7XG4gICAgICAgJ19fdHlwZSc6ICdQb2ludGVyJyxcbiAgICAgICAnY2xhc3NOYW1lJzonQ2FtcGFpZ24nLFxuICAgICAgICdvYmplY3RJZCc6dGhpcy5wcm9wcy5jdXJyZW50Q2FtcGFpZ24ub2JqZWN0SWRcbiAgICAgfVxuICAgICBjdXJyZW50Q2FtcGFpZ24gPSBKU09OLnN0cmluZ2lmeShjdXJyZW50Q2FtcGFpZ24pXG4gICAgIC8vcXJ5ID0gJ3doZXJlPXtcImNvbXBhbnlcIjonK2NvbXBhbnkrJyxcImNhbXBhaWduXCI6JytjdXJyZW50Q2FtcGFpZ24rJ30maW5jbHVkZT10ZW1wbGF0ZSdcbiAgICAgcXJ5ID0gJ3doZXJlPXtcImNhbXBhaWduXCI6JytjdXJyZW50Q2FtcGFpZ24rJ30maW5jbHVkZT10ZW1wbGF0ZSdcbiAgICAgJC5hamF4KHtcbiAgICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvRm9sbG93dXAnLFxuICAgICAgIHR5cGU6J0dFVCcsXG4gICAgICAgaGVhZGVyczogYXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICAgZGF0YTogcXJ5LFxuICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAgY29uc29sZS5sb2cocmVzLnJlc3VsdHMpXG4gICAgICAgfSxcbiAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgIH1cbiAgICAgfSlcbiAgfSxcbiAgXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLmZvbGxvd3VwcylcbiAgICB0aW1lbGluZUVsZW1lbnRzID0gW11cbiAgICBmb3IoaT0wO2k8IDMxO2krKyl7XG4gICAgICBmb3IoaWk9MDtpaTwgdGhpcy5wcm9wcy5mb2xsb3d1cHMubGVuZ3RoOyBpaSsrKXtcbiAgICAgICAgZWxlbWVudFR5cGUgPSBpID09IHRoaXMucHJvcHMuZm9sbG93dXBzW2lpXS5kYXlcbiAgICAgICAgaWYoZWxlbWVudFR5cGUpXG4gICAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICAgIHRpbWVsaW5lRWxlbWVudHMucHVzaChUaW1lbGluZURheUVsZW1lbnQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5Q291bnQ6IGksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6ICFlbGVtZW50VHlwZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2dnbGVUZW1wbGF0ZUVkaXRNZW51OiB0aGlzLnRvZ2dsZVRlbXBsYXRlRWRpdE1lbnV9KSlcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYobnVsbCwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInRpbWVsaW5lXCIsIFxuICAgICAgICAgICAgICAgc3R5bGU6IHtoZWlnaHQ6JzkwMHB4JyxiYWNrZ3JvdW5kQ29sb3I6J3JnYig5MCwgMTA3LCAxMTkpJyx3aWR0aDo1fX0sIFxuICAgICAgICAgICAgICAgdGltZWxpbmVFbGVtZW50c1xuICAgICAgICAgIClcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIFRpbWVsaW5lRGF5RWxlbWVudCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1RpbWVsaW5lRGF5RWxlbWVudCcsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdGltZWxpbmVEYXkgPSBcImxvbFwiXG4gICAgaWYodGhpcy5wcm9wcy5lbGVtZW50VHlwZSkge1xuICAgICAgdGltZWxpbmVEYXkgPSBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZGF5XCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucHJvcHMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtdG9nZ2xlJzogXCJ0b29sdGlwXCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXBsYWNlbWVudCc6IFwicmlnaHRcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwiKyBBZGQgYSBmb2xsb3ctdXBcIn0sIFwiRFwiK3RoaXMucHJvcHMuZGF5Q291bnQpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRpbWVsaW5lRGF5ID0gUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRheSBkYXktcG9wb3ZlclwiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnByb3BzLnRvZ2dsZVRlbXBsYXRlRWRpdE1lbnUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICdkYXRhLXRvZ2dsZSc6IFwicG9wb3ZlclwiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAnZGF0YS10cmlnZ2VyJzogXCJtYW51YWxcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgJ2RhdGEtcGxhY2VtZW50JzogXCJyaWdodFwifSwgXCJEXCIrdGhpcy5wcm9wcy5kYXlDb3VudCwgXCIgXCIpXG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgdGltZWxpbmVEYXlcbiAgICAgIClcbiAgICApXG4gIH1cbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vVGVtcGxhdGVzTWVudVxuXG4gIHRvZ2dsZVRlbXBsYXRlRWRpdE1lbnU6IGZ1bmN0aW9uKGN1cnJlbnRUZW1wbGF0ZSkge1xuICAgIHRoaXMucHJvcHMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudShjdXJyZW50VGVtcGxhdGUpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMudGVtcGxhdGVzKVxuICAgIHRlbXBsYXRlcyA9IFtdXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGVtcGxhdGVzLnB1c2goXG4gICAgICAgIFRlbXBsYXRlTGlzdEl0ZW0oe1xuICAgICAgICAgIHRvZ2dsZVRlbXBsYXRlRWRpdE1lbnU6IHRoaXMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudSwgXG4gICAgICAgICAgdGVtcGxhdGU6IHRoaXMucHJvcHMudGVtcGxhdGVzW2ldfSlcbiAgICAgIClcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIlwiLCBzdHlsZToge3BhZGRpbmc6JzAnLCBib3JkZXJSaWdodDonMnB4IHNvbGlkIHJnYmEoMCwwLDAsMCknLGhlaWdodDonMTAwJScsdGV4dEFsaWduOidjZW50ZXInfX0sIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicGFuZWwgcGFuZWwtZGVmYXVsdFwiLCBcbiAgICAgICAgICAgICBzdHlsZToge2JvcmRlclJpZ2h0OjAsYm9yZGVyUmFkaXVzOjAsaGVpZ2h0OicxMDAlJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicGFuZWwtaGVhZGluZ1wiLCBzdHlsZToge2hlaWdodDo0MH19LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2Zsb2F0OidsZWZ0Jyxmb250U2l6ZToxNCxmb250V2VpZ2h0Oidib2xkJ319LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1maWxlLXRleHQtb1wifSksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7c3R5bGU6IHttYXJnaW5MZWZ0OjV9fSwgXCJUZW1wbGF0ZXNcIilcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXN1Y2Nlc3MgYnRuLXhzXCIsIFxuICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnByb3BzLnRvZ2dsZVRlbXBsYXRlRWRpdE1lbnUsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7ZmxvYXQ6J3JpZ2h0J319LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1wbHVzXCJ9KSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge21hcmdpbkxlZnQ6NX19LCBcIkNyZWF0ZSBUZW1wbGF0ZVwiKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImxpc3QtZ3JvdXBcIiwgXG4gICAgICAgICAgICAgIHN0eWxlOiB7dGV4dEFsaWduOidsZWZ0JywgYm9yZGVyQm90dG9tOicxcHggc29saWQgI2RkZCd9fSwgXG4gICAgICAgICAgICB0ZW1wbGF0ZXNcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gIH1cbn0pO1xuXG52YXIgVGVtcGxhdGVMaXN0SXRlbSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1RlbXBsYXRlTGlzdEl0ZW0nLFxuICB0b2dnbGVUZW1wbGF0ZUVkaXRNZW51OiBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZyh0aGlzLnByb3BzLnRlbXBsYXRlKVxuICAgIHRoaXMucHJvcHMudG9nZ2xlVGVtcGxhdGVFZGl0TWVudSh0aGlzLnByb3BzLnRlbXBsYXRlKVxuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgb25DbGljazogdGhpcy50b2dnbGVUZW1wbGF0ZUVkaXRNZW51LCBcbiAgICAgICAgICAgY2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAtaXRlbVwifSwgXG4gICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwibGFiZWwgbGFiZWwtZGVmYXVsdFwifSwgXG4gICAgICAgICAgICAgdGhpcy5wcm9wcy50ZW1wbGF0ZS5uYW1lXG4gICAgICAgICAgICksIFxuICAgICAgICAgICBSZWFjdC5ET00uaDYobnVsbCwgXCJTdWJqZWN0OlwiLCBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcInRleHQgdGV4dC1tdXRlZFwifSwgXG4gICAgICAgICAgICAgXCIgXCIgKyB0aGlzLnByb3BzLnRlbXBsYXRlLnN1YmplY3RcbiAgICAgICAgICAgKSlcbiAgICAgICAgIClcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcbiJdfQ==
