(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    currentUser = JSON.parse(localStorage.currentUser)
    _id = Date.now()
    data =  {
      name : $('#listTitle').val().trim(),
      user : appConfig.pointer('_User', currentUser.objectId),
      user_company: Parse._user_company,
      count: 0,
      tmp: _id
    }
    console.log(data)

    thiss = this;
    listClassName = (this.props.listClassName) ? this.props.listClassName : 'ProspectList'
    var _this = this;
    $.ajax({
      url:'https://api.parse.com/1/classes/'+listClassName,
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) { 
        console.log(res) 
        console.log("should be updating")
        _this.props.updateList(_id, res.objectId)
      },
      error: function(err) { console.log(err) }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-example-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Create List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.createMiningJob}, 
                    React.DOM.input({id: "listTitle", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", onClick: this.createListButtonClick, placeholder: "Enter City Area...", className: "btn btn-success", style: {display:'block', width:'100%'}}, "Create List")
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],2:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  deleteList: function() {
    this.props.deleteList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-deleteList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-trash-o"}), "  Delete List?")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({className: "deleteForm", onSubmit: this.deleteList}, 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-danger", 
                      style: {display:'block', width:'100%'}}, 
                      "Delete"
                    ), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-default", 
                      style: {display:'block', width:'100%'}}, 
                      "Cancel"
                    )
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],3:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //Messenger
  render: function() {
    return (
        React.DOM.div({className: "alert alert-success", 
             'data-alert': "alert", 
             style: {position:'absolute',
                     top: 31, 
                     right:30, 
                     display:'none',
                     width:200}}, 
                     React.DOM.a({className: "close", 
                       href: "javascript:", 
                       onClick: this.hideAlert}, "×"), 
            "Test"
        )
    );
  }
});

},{}]},{},[1])


},{}],4:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  renameList: function(e) {
    e.preventDefault()
    //console.log($('#newListName').val())
    newListName = $('#newListName').val()
    if(newListName.trim() != "")
      this.props.renameList(newListName)
    // Disable Modal
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-renameList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Rename List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.renameList}, 
                    React.DOM.input({id: "newListName", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.renameList, 
                      className: "btn btn-success", 
                      style: {display:'block', width:'100%'}}, 
                      "Create List"
                    )
                  )
                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],5:[function(require,module,exports){
/** @jsx React.DOM */

var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var CreateListModal = require('./create_list_modal.js.min.js')
var Messenger = require('./messenger.js.min.js')

var DeleteListModal = require('./delete_list_modal.js.min.js')
var RenameListModal = require('./rename_list_modal.js.min.js')
var SideMenuListOption = require('./user_side_menu_list.js.min.js');

module.exports = React.createClass({displayName: 'exports',
  //SideMenuProspects - SideList
  getInitialState: function() {
    return {
      /*
      createList: 
      renameList:
      deleteList:
      changeList:
      currentList:
      totalCount:
      lists:

      */
     lists: [],
    }
  },

  createList: function (data) {
    this.props.createList(data)
  },

  componentDidUpdate: function() {
    $('.dropdown-copy-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.copySelectedProspects(listSelect[0].objectId)
    })

    $('.dropdown-move-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('move-objectId'))
      //this.props.moveSelectedProspects(listSelect[0].objectId)
    })
  },

  componentDidMount: function() {
    var _this = this;
    Parse.get(this.props.listClassName, { order: '-createdAt'}).done(function(res) {
      _this.setState({lists: res.results})
    })

    $('.dropdown-copy-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.copySelectedProspects(listSelect[0].objectId)
    })

    $('.dropdown-move-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.moveSelectedProspects(listSelect[0].objectId)
    })
  },
  
  removeSelectedProspects: function() {
    // remove selected from list
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    _list = Parse._pointer(this.props.listClassName, this.state.currentListObjectId)
    body = { lists: { '__op' : 'Remove', "objects" : [_list] } }
    if(this.state.currentList == 'All'){ body = { archived: true } }
    Parse.batchUpdate('Prospect', selectedProspects, body)
    // Update List Counts
    //
  },

  moveSelectedProspects: function(_list) {
    // move to list
    // only if the current list is not all
    // remove prospects from currentList
    if(!this.props.currentListObjectId){ console.log('not supported'); return 0}
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    old_list = Parse._pointer(this.props.listClassName, this.props.currentListObjectId)
    new_list = Parse._pointer(this.props.listClassName, _list)
    this.props.removeProspects(selectedProspects)

    var _this = this;
    console.log(_list)
    console.log(this.props.currentListObjectId)
    body = { lists: { '__op' : 'Remove', "objects" : [old_list] } }
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function() {
      increment = {count: {__op: 'Increment', amount: -1*selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _this.props.currentListObjectId)
          item.count = item.count - amount
        return item
      })
      console.log(lists)
      _this.setState({lists: lists})
    })

    body = { lists: { '__op' : 'AddUnique', "objects" : [new_list] } }
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function() {
      increment = {count: {__op: 'Increment', amount: selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _list)
          item.count = (item.count) ? item.count + amount : amount
        return item
      })
      //console.log(lists)
      _this.setState({lists: lists})
    })
    // Update List Counts
  },

  copySelectedProspects: function(_list) {
    // TODO - check to see if prospect exists in the other list
    // TODO - Remove from selected prospects If prospects already exist in list do not increment
    console.log('update')
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    new_list = Parse._pointer(this.props.listClassName, _list)
    body = { lists: { '__op' : 'AddUnique', "objects" : [new_list] } }
    console.log(body)

    //

    var _this = this;
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function(res) {
      console.log(res)
      // if success
      increment = {count: {__op: 'Increment', amount: selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _list)
            item.count = (item.count) ? item.count + amount : amount
        return item
      })
      console.log(lists)
      _this.setState({lists: lists})
    })
  },

  changeList: function(e) {
    /*
    currentList = $(e.target).parent()//.data('list')
    console.log(currentList)
    this.props.changeList(currentList.name, currentList.objectId)
    */
  },

  render: function() {
    if(this.props.currentList == "All")
      styles = {'backgroundColor':'rgb(0, 122, 255)', 'color':'white'} 
    else
      styles =  {}

    lists = [SideMenuListOption({list: {name: 'All', count: this.props.totalCount}, 
                                 iconType: 'users', 
                                 changeList: this.props.changeList}), 
             SideMenuListOption({list: {name: 'Archived', count: '~'}, 
                                 iconType: 'archive', 
                                 changeList: this.props.changeList, 
                                 hideCount: true})]

    for(i=0;i< this.state.lists.length;i++){
      list = this.state.lists[i]
      if(list.list_type == "signal_list")
        iconType = "wifi"
      else if (list.list_type == "mining_job")
        iconType = "cloudDownload"
      if(list.list_type)
        lists.push(SideMenuListOption({list: list, 
                                       iconType: iconType, 
                                       changeList: this.props.changeList}))
      else 
        lists.push(SideMenuListOption({list: list, 
                                       changeList: this.props.changeList}))
    }

    return (
      React.DOM.div({className: "col-lg-2 col-md-2 col-sm-2 col-xs-2", 
           style: {padding:'0',height:'438px',backgroundColor:'#e0e9ee',
                   borderRight:'1px solid #b0b8bf',textAlign:'center'}}, 
                   React.DOM.div({className: "prospect-list-header", style: {paddingLeft:10, textAlign:'center'}}, 
                     "Lists"

                   ), 
        React.DOM.div({className: "btn-group-vertical", 
             style: {width:'100%', height: '320px', overflow: 'auto'}}, 
          lists
        ), 
        React.DOM.br(null), React.DOM.br(null), 
        React.DOM.a({href: "javascript:", className: "btn btn-primary new-list-btn", 
              'data-toggle': "modal", 'data-target': ".bs-example-modal-sm", 
              style: { backgroundImage: 'linear-gradient(180deg, #0096ff 0%, #005dff 100%)'}}, 
          React.DOM.i({className: "fa fa-plus-circle"}), "  New List"
        ), 
        CreateListModal({createList: this.createList, 
                         updateList: this.updateList, 
                         listClassName: this.props.listClassName}), " ", React.DOM.br(null)
      )
    );
  },

  createList: function(data) { 
    this.setState({ lists: [data].concat(this.state.lists) }) 
  },

  updateList: function(_id, objId) {
    updated = _.map(this.state.lists, function(list) {
      if(list.tmp == _id)
          list.objectId = objId
      return list
    })
    console.log("update broski")
    this.setState({lists: updated})
  },

  renameList: function(newListName) {
    thiss = this;
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.name == thiss.state.currentList) {
        item.name = newListName
        return item
      }
      return item
    });

    this.setState({lists : filtered, currentList: newListName})

    $('.modal').click()
    $('#newListName').val('')
    $('.modal-backdrop').click()

    Parse.update(this.props.listClassName, {'name':newListName})
  },

  deleteList: function() {
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.objectId == thiss.state.currentListObjectId)
        return false
      return true
    });

    this.setState({lists: filtered, currentList: 'All'})
    this.changeList('All', '')

    appConfig.closeModal(); 
    $('#newListName').val('');
    Parse.delete(this.props.listClassName+'/'+this.state.currentListObjectId);
  },
});

var CurrentLists = React.createClass({displayName: 'CurrentLists',
  listAction: function(e) {
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == $(e.target).text()
    });

    this.props.moveSelectedProspects(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
            className: "dropdown-list-name", 
            href: "javascript:", 
            onClick: this.listAction}, this.props.lists[i].name))
      )
    }
    //console.log(this.props.copyDropdownStyle)
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {right:-23,top:27}}, 
        lists
      )
    );
  }
});

var CurrentListsTwo = React.createClass({displayName: 'CurrentListsTwo',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.copySelectedProspects(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
               className: "dropdown-list-name", 
               href: "javascript:", 
               onClick: this.listAction}, 
          this.props.lists[i].name))
      )
    }
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {width:114,right:-71,top:27}}, 
        lists
      )
    );
  }
});

},{"./create_list_modal.js.min.js":1,"./delete_list_modal.js.min.js":2,"./messenger.js.min.js":3,"./rename_list_modal.js.min.js":4,"./user_side_menu_list.js.min.js":6}],6:[function(require,module,exports){
/** @jsx React.DOM */
//TODO - move list
//TODO - copy list
//TODO - create new list

module.exports = React.createClass({displayName: 'exports',
  //SideMenuListOption
  getInitialState: function() {
    return {
      count: '~',
    }
  },


  componentDidMount: function() {
  },

  changeList: function() {
    this.props.changeList(this.props.list.name, this.props.list.objectId)
  },

  getIconType: function(iconType) {
    icon = ""
    if(iconType == "archive"){
      icon = React.DOM.i({className: "fa fa-archive", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "users"){
      icon = React.DOM.i({className: "fa fa-user", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "wifi"){
      icon = React.DOM.i({className: "fa fa-wifi", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "cloudDownload"){
      icon = React.DOM.i({className: "fa fa-cloud-download", style: {float:'left',lineHeight:1.5,marginRight:5}})
    }
    return icon
  },

  render: function() {
    listName = this.props.list.name
    propsCount = this.props.count
    count = (typeof(propsCount)== "undefined") ? this.state.count : propsCount

    icon = ""
    listStyle=(icon == "") ? "list-name" : "icon-list-name"
    if(this.props.iconType == "users")
      listStyle = "all-list-name" 
    count = React.DOM.div({className: "badge badge-default cnt-bg"}, this.props.list.count)
    count = (this.props.hideCount) ? "" : count
    return (
      React.DOM.button({type: "button", 
              onClick: this.changeList, 
              className: "list-names btn btn-default"}, 
              icon, "   ", React.DOM.span({className: listStyle}, listName), " ", count
      )
    );
  }
});


},{}]},{},[5])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvc2lkZV9tZW51X3VzZXJfcHJvc3BlY3RzLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQWpGQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQTFGQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQXJCQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbnZhciBTaWRlTWVudUxpc3RPcHRpb24gPSByZXF1aXJlKCcuL3VzZXJfc2lkZV9tZW51X2xpc3QuanMubWluLmpzJyk7XG52YXIgQ3JlYXRlTGlzdE1vZGFsID0gcmVxdWlyZSgnLi9jcmVhdGVfbGlzdF9tb2RhbC5qcy5taW4uanMnKVxudmFyIE1lc3NlbmdlciA9IHJlcXVpcmUoJy4vbWVzc2VuZ2VyLmpzLm1pbi5qcycpXG5cbnZhciBEZWxldGVMaXN0TW9kYWwgPSByZXF1aXJlKCcuL2RlbGV0ZV9saXN0X21vZGFsLmpzLm1pbi5qcycpXG52YXIgUmVuYW1lTGlzdE1vZGFsID0gcmVxdWlyZSgnLi9yZW5hbWVfbGlzdF9tb2RhbC5qcy5taW4uanMnKVxudmFyIFNpZGVNZW51TGlzdE9wdGlvbiA9IHJlcXVpcmUoJy4vdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy9TaWRlTWVudVByb3NwZWN0cyAtIFNpZGVMaXN0XG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8qXG4gICAgICBjcmVhdGVMaXN0OiBcbiAgICAgIHJlbmFtZUxpc3Q6XG4gICAgICBkZWxldGVMaXN0OlxuICAgICAgY2hhbmdlTGlzdDpcbiAgICAgIGN1cnJlbnRMaXN0OlxuICAgICAgdG90YWxDb3VudDpcbiAgICAgIGxpc3RzOlxuXG4gICAgICAqL1xuICAgICBsaXN0czogW10sXG4gICAgfVxuICB9LFxuXG4gIGNyZWF0ZUxpc3Q6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdGhpcy5wcm9wcy5jcmVhdGVMaXN0KGRhdGEpXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAkKCcuZHJvcGRvd24tY29weS1saXN0LW5hbWUnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlLnRhcmdldClcbiAgICAgIGNvbnNvbGUubG9nKCQoZS50YXJnZXQpLmRhdGEoJ29iamVjdElkJykpXG4gICAgICAvL3RoaXMucHJvcHMuY29weVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gICAgfSlcblxuICAgICQoJy5kcm9wZG93bi1tb3ZlLWxpc3QtbmFtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KVxuICAgICAgY29uc29sZS5sb2coJChlLnRhcmdldCkuZGF0YSgnbW92ZS1vYmplY3RJZCcpKVxuICAgICAgLy90aGlzLnByb3BzLm1vdmVTZWxlY3RlZFByb3NwZWN0cyhsaXN0U2VsZWN0WzBdLm9iamVjdElkKVxuICAgIH0pXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgUGFyc2UuZ2V0KHRoaXMucHJvcHMubGlzdENsYXNzTmFtZSwgeyBvcmRlcjogJy1jcmVhdGVkQXQnfSkuZG9uZShmdW5jdGlvbihyZXMpIHtcbiAgICAgIF90aGlzLnNldFN0YXRlKHtsaXN0czogcmVzLnJlc3VsdHN9KVxuICAgIH0pXG5cbiAgICAkKCcuZHJvcGRvd24tY29weS1saXN0LW5hbWUnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlLnRhcmdldClcbiAgICAgIGNvbnNvbGUubG9nKCQoZS50YXJnZXQpLmRhdGEoJ29iamVjdElkJykpXG4gICAgICAvL3RoaXMucHJvcHMuY29weVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gICAgfSlcblxuICAgICQoJy5kcm9wZG93bi1tb3ZlLWxpc3QtbmFtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KVxuICAgICAgY29uc29sZS5sb2coJChlLnRhcmdldCkuZGF0YSgnb2JqZWN0SWQnKSlcbiAgICAgIC8vdGhpcy5wcm9wcy5tb3ZlU2VsZWN0ZWRQcm9zcGVjdHMobGlzdFNlbGVjdFswXS5vYmplY3RJZClcbiAgICB9KVxuICB9LFxuICBcbiAgcmVtb3ZlU2VsZWN0ZWRQcm9zcGVjdHM6IGZ1bmN0aW9uKCkge1xuICAgIC8vIHJlbW92ZSBzZWxlY3RlZCBmcm9tIGxpc3RcbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzKVxuICAgIF9saXN0ID0gUGFyc2UuX3BvaW50ZXIodGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLCB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgYm9keSA9IHsgbGlzdHM6IHsgJ19fb3AnIDogJ1JlbW92ZScsIFwib2JqZWN0c1wiIDogW19saXN0XSB9IH1cbiAgICBpZih0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09ICdBbGwnKXsgYm9keSA9IHsgYXJjaGl2ZWQ6IHRydWUgfSB9XG4gICAgUGFyc2UuYmF0Y2hVcGRhdGUoJ1Byb3NwZWN0Jywgc2VsZWN0ZWRQcm9zcGVjdHMsIGJvZHkpXG4gICAgLy8gVXBkYXRlIExpc3QgQ291bnRzXG4gICAgLy9cbiAgfSxcblxuICBtb3ZlU2VsZWN0ZWRQcm9zcGVjdHM6IGZ1bmN0aW9uKF9saXN0KSB7XG4gICAgLy8gbW92ZSB0byBsaXN0XG4gICAgLy8gb25seSBpZiB0aGUgY3VycmVudCBsaXN0IGlzIG5vdCBhbGxcbiAgICAvLyByZW1vdmUgcHJvc3BlY3RzIGZyb20gY3VycmVudExpc3RcbiAgICBpZighdGhpcy5wcm9wcy5jdXJyZW50TGlzdE9iamVjdElkKXsgY29uc29sZS5sb2coJ25vdCBzdXBwb3J0ZWQnKTsgcmV0dXJuIDB9XG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICBvbGRfbGlzdCA9IFBhcnNlLl9wb2ludGVyKHRoaXMucHJvcHMubGlzdENsYXNzTmFtZSwgdGhpcy5wcm9wcy5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgIG5ld19saXN0ID0gUGFyc2UuX3BvaW50ZXIodGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLCBfbGlzdClcbiAgICB0aGlzLnByb3BzLnJlbW92ZVByb3NwZWN0cyhzZWxlY3RlZFByb3NwZWN0cylcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgY29uc29sZS5sb2coX2xpc3QpXG4gICAgY29uc29sZS5sb2codGhpcy5wcm9wcy5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgIGJvZHkgPSB7IGxpc3RzOiB7ICdfX29wJyA6ICdSZW1vdmUnLCBcIm9iamVjdHNcIiA6IFtvbGRfbGlzdF0gfSB9XG4gICAgUGFyc2UuYmF0Y2hVcGRhdGUoJ1Byb3NwZWN0Jywgc2VsZWN0ZWRQcm9zcGVjdHMsIGJvZHkpLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICBpbmNyZW1lbnQgPSB7Y291bnQ6IHtfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiAtMSpzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGh9fVxuICAgICAgUGFyc2UucHV0KF90aGlzLnByb3BzLmxpc3RDbGFzc05hbWUrJy8nK19saXN0LCBpbmNyZW1lbnQsIGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICB9KVxuXG4gICAgICBhbW91bnQgPSBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGhcbiAgICAgIHZhciBsaXN0cyA9IF8ubWFwKF90aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gX3RoaXMucHJvcHMuY3VycmVudExpc3RPYmplY3RJZClcbiAgICAgICAgICBpdGVtLmNvdW50ID0gaXRlbS5jb3VudCAtIGFtb3VudFxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfSlcbiAgICAgIGNvbnNvbGUubG9nKGxpc3RzKVxuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xpc3RzOiBsaXN0c30pXG4gICAgfSlcblxuICAgIGJvZHkgPSB7IGxpc3RzOiB7ICdfX29wJyA6ICdBZGRVbmlxdWUnLCBcIm9iamVjdHNcIiA6IFtuZXdfbGlzdF0gfSB9XG4gICAgUGFyc2UuYmF0Y2hVcGRhdGUoJ1Byb3NwZWN0Jywgc2VsZWN0ZWRQcm9zcGVjdHMsIGJvZHkpLmRvbmUoZnVuY3Rpb24oKSB7XG4gICAgICBpbmNyZW1lbnQgPSB7Y291bnQ6IHtfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGh9fVxuICAgICAgUGFyc2UucHV0KF90aGlzLnByb3BzLmxpc3RDbGFzc05hbWUrJy8nK19saXN0LCBpbmNyZW1lbnQsIGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICB9KVxuXG4gICAgICBhbW91bnQgPSBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGhcbiAgICAgIHZhciBsaXN0cyA9IF8ubWFwKF90aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gX2xpc3QpXG4gICAgICAgICAgaXRlbS5jb3VudCA9IChpdGVtLmNvdW50KSA/IGl0ZW0uY291bnQgKyBhbW91bnQgOiBhbW91bnRcbiAgICAgICAgcmV0dXJuIGl0ZW1cbiAgICAgIH0pXG4gICAgICAvL2NvbnNvbGUubG9nKGxpc3RzKVxuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xpc3RzOiBsaXN0c30pXG4gICAgfSlcbiAgICAvLyBVcGRhdGUgTGlzdCBDb3VudHNcbiAgfSxcblxuICBjb3B5U2VsZWN0ZWRQcm9zcGVjdHM6IGZ1bmN0aW9uKF9saXN0KSB7XG4gICAgLy8gVE9ETyAtIGNoZWNrIHRvIHNlZSBpZiBwcm9zcGVjdCBleGlzdHMgaW4gdGhlIG90aGVyIGxpc3RcbiAgICAvLyBUT0RPIC0gUmVtb3ZlIGZyb20gc2VsZWN0ZWQgcHJvc3BlY3RzIElmIHByb3NwZWN0cyBhbHJlYWR5IGV4aXN0IGluIGxpc3QgZG8gbm90IGluY3JlbWVudFxuICAgIGNvbnNvbGUubG9nKCd1cGRhdGUnKVxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgbmV3X2xpc3QgPSBQYXJzZS5fcG9pbnRlcih0aGlzLnByb3BzLmxpc3RDbGFzc05hbWUsIF9saXN0KVxuICAgIGJvZHkgPSB7IGxpc3RzOiB7ICdfX29wJyA6ICdBZGRVbmlxdWUnLCBcIm9iamVjdHNcIiA6IFtuZXdfbGlzdF0gfSB9XG4gICAgY29uc29sZS5sb2coYm9keSlcblxuICAgIC8vXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIFBhcnNlLmJhdGNoVXBkYXRlKCdQcm9zcGVjdCcsIHNlbGVjdGVkUHJvc3BlY3RzLCBib2R5KS5kb25lKGZ1bmN0aW9uKHJlcykge1xuICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgLy8gaWYgc3VjY2Vzc1xuICAgICAgaW5jcmVtZW50ID0ge2NvdW50OiB7X19vcDogJ0luY3JlbWVudCcsIGFtb3VudDogc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RofX1cbiAgICAgIFBhcnNlLnB1dChfdGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lKycvJytfbGlzdCwgaW5jcmVtZW50LCBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgfSlcblxuICAgICAgYW1vdW50ID0gc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoXG4gICAgICB2YXIgbGlzdHMgPSBfLm1hcChfdGhpcy5zdGF0ZS5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICBpZihpdGVtLm9iamVjdElkID09IF9saXN0KVxuICAgICAgICAgICAgaXRlbS5jb3VudCA9IChpdGVtLmNvdW50KSA/IGl0ZW0uY291bnQgKyBhbW91bnQgOiBhbW91bnRcbiAgICAgICAgcmV0dXJuIGl0ZW1cbiAgICAgIH0pXG4gICAgICBjb25zb2xlLmxvZyhsaXN0cylcbiAgICAgIF90aGlzLnNldFN0YXRlKHtsaXN0czogbGlzdHN9KVxuICAgIH0pXG4gIH0sXG5cbiAgY2hhbmdlTGlzdDogZnVuY3Rpb24oZSkge1xuICAgIC8qXG4gICAgY3VycmVudExpc3QgPSAkKGUudGFyZ2V0KS5wYXJlbnQoKS8vLmRhdGEoJ2xpc3QnKVxuICAgIGNvbnNvbGUubG9nKGN1cnJlbnRMaXN0KVxuICAgIHRoaXMucHJvcHMuY2hhbmdlTGlzdChjdXJyZW50TGlzdC5uYW1lLCBjdXJyZW50TGlzdC5vYmplY3RJZClcbiAgICAqL1xuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgaWYodGhpcy5wcm9wcy5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKVxuICAgICAgc3R5bGVzID0geydiYWNrZ3JvdW5kQ29sb3InOidyZ2IoMCwgMTIyLCAyNTUpJywgJ2NvbG9yJzond2hpdGUnfSBcbiAgICBlbHNlXG4gICAgICBzdHlsZXMgPSAge31cblxuICAgIGxpc3RzID0gW1NpZGVNZW51TGlzdE9wdGlvbih7bGlzdDoge25hbWU6ICdBbGwnLCBjb3VudDogdGhpcy5wcm9wcy50b3RhbENvdW50fSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uVHlwZTogJ3VzZXJzJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KSwgXG4gICAgICAgICAgICAgU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiB7bmFtZTogJ0FyY2hpdmVkJywgY291bnQ6ICd+J30sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvblR5cGU6ICdhcmNoaXZlJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZUNvdW50OiB0cnVlfSldXG5cbiAgICBmb3IoaT0wO2k8IHRoaXMuc3RhdGUubGlzdHMubGVuZ3RoO2krKyl7XG4gICAgICBsaXN0ID0gdGhpcy5zdGF0ZS5saXN0c1tpXVxuICAgICAgaWYobGlzdC5saXN0X3R5cGUgPT0gXCJzaWduYWxfbGlzdFwiKVxuICAgICAgICBpY29uVHlwZSA9IFwid2lmaVwiXG4gICAgICBlbHNlIGlmIChsaXN0Lmxpc3RfdHlwZSA9PSBcIm1pbmluZ19qb2JcIilcbiAgICAgICAgaWNvblR5cGUgPSBcImNsb3VkRG93bmxvYWRcIlxuICAgICAgaWYobGlzdC5saXN0X3R5cGUpXG4gICAgICAgIGxpc3RzLnB1c2goU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiBsaXN0LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25UeXBlOiBpY29uVHlwZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KSlcbiAgICAgIGVsc2UgXG4gICAgICAgIGxpc3RzLnB1c2goU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiBsaXN0LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMucHJvcHMuY2hhbmdlTGlzdH0pKVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY29sLWxnLTIgY29sLW1kLTIgY29sLXNtLTIgY29sLXhzLTJcIiwgXG4gICAgICAgICAgIHN0eWxlOiB7cGFkZGluZzonMCcsaGVpZ2h0Oic0MzhweCcsYmFja2dyb3VuZENvbG9yOicjZTBlOWVlJyxcbiAgICAgICAgICAgICAgICAgICBib3JkZXJSaWdodDonMXB4IHNvbGlkICNiMGI4YmYnLHRleHRBbGlnbjonY2VudGVyJ319LCBcbiAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicHJvc3BlY3QtbGlzdC1oZWFkZXJcIiwgc3R5bGU6IHtwYWRkaW5nTGVmdDoxMCwgdGV4dEFsaWduOidjZW50ZXInfX0sIFxuICAgICAgICAgICAgICAgICAgICAgXCJMaXN0c1wiXG5cbiAgICAgICAgICAgICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImJ0bi1ncm91cC12ZXJ0aWNhbFwiLCBcbiAgICAgICAgICAgICBzdHlsZToge3dpZHRoOicxMDAlJywgaGVpZ2h0OiAnMzIwcHgnLCBvdmVyZmxvdzogJ2F1dG8nfX0sIFxuICAgICAgICAgIGxpc3RzXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uYnIobnVsbCksIFJlYWN0LkRPTS5icihudWxsKSwgXG4gICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgbmV3LWxpc3QtYnRuXCIsIFxuICAgICAgICAgICAgICAnZGF0YS10b2dnbGUnOiBcIm1vZGFsXCIsICdkYXRhLXRhcmdldCc6IFwiLmJzLWV4YW1wbGUtbW9kYWwtc21cIiwgXG4gICAgICAgICAgICAgIHN0eWxlOiB7IGJhY2tncm91bmRJbWFnZTogJ2xpbmVhci1ncmFkaWVudCgxODBkZWcsICMwMDk2ZmYgMCUsICMwMDVkZmYgMTAwJSknfX0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGx1cy1jaXJjbGVcIn0pLCBcIsKgwqBOZXcgTGlzdFwiXG4gICAgICAgICksIFxuICAgICAgICBDcmVhdGVMaXN0TW9kYWwoe2NyZWF0ZUxpc3Q6IHRoaXMuY3JlYXRlTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlTGlzdDogdGhpcy51cGRhdGVMaXN0LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0Q2xhc3NOYW1lOiB0aGlzLnByb3BzLmxpc3RDbGFzc05hbWV9KSwgXCIgXCIsIFJlYWN0LkRPTS5icihudWxsKVxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgY3JlYXRlTGlzdDogZnVuY3Rpb24oZGF0YSkgeyBcbiAgICB0aGlzLnNldFN0YXRlKHsgbGlzdHM6IFtkYXRhXS5jb25jYXQodGhpcy5zdGF0ZS5saXN0cykgfSkgXG4gIH0sXG5cbiAgdXBkYXRlTGlzdDogZnVuY3Rpb24oX2lkLCBvYmpJZCkge1xuICAgIHVwZGF0ZWQgPSBfLm1hcCh0aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihsaXN0KSB7XG4gICAgICBpZihsaXN0LnRtcCA9PSBfaWQpXG4gICAgICAgICAgbGlzdC5vYmplY3RJZCA9IG9iaklkXG4gICAgICByZXR1cm4gbGlzdFxuICAgIH0pXG4gICAgY29uc29sZS5sb2coXCJ1cGRhdGUgYnJvc2tpXCIpXG4gICAgdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IHVwZGF0ZWR9KVxuICB9LFxuXG4gIHJlbmFtZUxpc3Q6IGZ1bmN0aW9uKG5ld0xpc3ROYW1lKSB7XG4gICAgdGhpc3MgPSB0aGlzO1xuICAgIHZhciBmaWx0ZXJlZCA9IF8uZmlsdGVyKHRoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmKGl0ZW0ubmFtZSA9PSB0aGlzcy5zdGF0ZS5jdXJyZW50TGlzdCkge1xuICAgICAgICBpdGVtLm5hbWUgPSBuZXdMaXN0TmFtZVxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfVxuICAgICAgcmV0dXJuIGl0ZW1cbiAgICB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoe2xpc3RzIDogZmlsdGVyZWQsIGN1cnJlbnRMaXN0OiBuZXdMaXN0TmFtZX0pXG5cbiAgICAkKCcubW9kYWwnKS5jbGljaygpXG4gICAgJCgnI25ld0xpc3ROYW1lJykudmFsKCcnKVxuICAgICQoJy5tb2RhbC1iYWNrZHJvcCcpLmNsaWNrKClcblxuICAgIFBhcnNlLnVwZGF0ZSh0aGlzLnByb3BzLmxpc3RDbGFzc05hbWUsIHsnbmFtZSc6bmV3TGlzdE5hbWV9KVxuICB9LFxuXG4gIGRlbGV0ZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmaWx0ZXJlZCA9IF8uZmlsdGVyKHRoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IGZpbHRlcmVkLCBjdXJyZW50TGlzdDogJ0FsbCd9KVxuICAgIHRoaXMuY2hhbmdlTGlzdCgnQWxsJywgJycpXG5cbiAgICBhcHBDb25maWcuY2xvc2VNb2RhbCgpOyBcbiAgICAkKCcjbmV3TGlzdE5hbWUnKS52YWwoJycpO1xuICAgIFBhcnNlLmRlbGV0ZSh0aGlzLnByb3BzLmxpc3RDbGFzc05hbWUrJy8nK3RoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZCk7XG4gIH0sXG59KTtcblxudmFyIEN1cnJlbnRMaXN0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0N1cnJlbnRMaXN0cycsXG4gIGxpc3RBY3Rpb246IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgbGlzdFNlbGVjdCA9IF8uZmlsdGVyKHRoaXMucHJvcHMubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICByZXR1cm4gaXRlbS5uYW1lID09ICQoZS50YXJnZXQpLnRleHQoKVxuICAgIH0pO1xuXG4gICAgdGhpcy5wcm9wcy5tb3ZlU2VsZWN0ZWRQcm9zcGVjdHMobGlzdFNlbGVjdFswXS5vYmplY3RJZClcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIGxpc3RzID0gW10gXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLmxpc3RzLmxlbmd0aDtpKyspIHtcbiAgICAgIGxpc3RzLnB1c2goXG4gICAgICAgIFJlYWN0LkRPTS5saShudWxsLCBSZWFjdC5ET00uYSh7c3R5bGU6IHtmb250V2VpZ2h0Oidib2xkJyxmb250U2l6ZTonMTBweCd9LCBcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJkcm9wZG93bi1saXN0LW5hbWVcIiwgXG4gICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgb25DbGljazogdGhpcy5saXN0QWN0aW9ufSwgdGhpcy5wcm9wcy5saXN0c1tpXS5uYW1lKSlcbiAgICAgIClcbiAgICB9XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLmNvcHlEcm9wZG93blN0eWxlKVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00udWwoe2NsYXNzTmFtZTogXCJkcm9wZG93bi1tZW51IGRyb3AtdGVzdFwiLCBpZDogXCJkcm9wZG93blwiLCBcbiAgICAgICAgICBzdHlsZToge3JpZ2h0Oi0yMyx0b3A6Mjd9fSwgXG4gICAgICAgIGxpc3RzXG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbnZhciBDdXJyZW50TGlzdHNUd28gPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdDdXJyZW50TGlzdHNUd28nLFxuICBsaXN0QWN0aW9uOiBmdW5jdGlvbihlKSB7XG4gICAgbGlzdE5hbWUgPSAkKGUudGFyZ2V0KS50ZXh0KClcbiAgICBcbiAgICB2YXIgbGlzdFNlbGVjdCA9IF8uZmlsdGVyKHRoaXMucHJvcHMubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICByZXR1cm4gaXRlbS5uYW1lID09IGxpc3ROYW1lXG4gICAgfSk7XG5cbiAgICB0aGlzLnByb3BzLmNvcHlTZWxlY3RlZFByb3NwZWN0cyhsaXN0U2VsZWN0WzBdLm9iamVjdElkKVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgbGlzdHMgPSBbXSBcbiAgICBmb3IoaT0wO2k8IHRoaXMucHJvcHMubGlzdHMubGVuZ3RoO2krKykge1xuICAgICAgbGlzdHMucHVzaChcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnLGZvbnRTaXplOicxMHB4J30sIFxuICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImRyb3Bkb3duLWxpc3QtbmFtZVwiLCBcbiAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmxpc3RBY3Rpb259LCBcbiAgICAgICAgICB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnVsKHtjbGFzc05hbWU6IFwiZHJvcGRvd24tbWVudSBkcm9wLXRlc3RcIiwgaWQ6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgc3R5bGU6IHt3aWR0aDoxMTQscmlnaHQ6LTcxLHRvcDoyN319LCBcbiAgICAgICAgbGlzdHNcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuLy9UT0RPIC0gbW92ZSBsaXN0XG4vL1RPRE8gLSBjb3B5IGxpc3Rcbi8vVE9ETyAtIGNyZWF0ZSBuZXcgbGlzdFxuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICAvL1NpZGVNZW51TGlzdE9wdGlvblxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjb3VudDogJ34nLFxuICAgIH1cbiAgfSxcblxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgfSxcblxuICBjaGFuZ2VMaXN0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnByb3BzLmNoYW5nZUxpc3QodGhpcy5wcm9wcy5saXN0Lm5hbWUsIHRoaXMucHJvcHMubGlzdC5vYmplY3RJZClcbiAgfSxcblxuICBnZXRJY29uVHlwZTogZnVuY3Rpb24oaWNvblR5cGUpIHtcbiAgICBpY29uID0gXCJcIlxuICAgIGlmKGljb25UeXBlID09IFwiYXJjaGl2ZVwiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFyY2hpdmVcIiwgc3R5bGU6IHtmbG9hdDonbGVmdCcsbGluZUhlaWdodDoxLjUsbWFyZ2luUmlnaHQ6NX19KVxuICAgIH0gZWxzZSBpZihpY29uVHlwZSA9PSBcInVzZXJzXCIpe1xuICAgICAgaWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdXNlclwiLCBzdHlsZToge2Zsb2F0OidsZWZ0JyxsaW5lSGVpZ2h0OjEuNSxtYXJnaW5SaWdodDo1fX0pXG4gICAgfSBlbHNlIGlmKGljb25UeXBlID09IFwid2lmaVwiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXdpZmlcIiwgc3R5bGU6IHtmbG9hdDonbGVmdCcsbGluZUhlaWdodDoxLjUsbWFyZ2luUmlnaHQ6NX19KVxuICAgIH0gZWxzZSBpZihpY29uVHlwZSA9PSBcImNsb3VkRG93bmxvYWRcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jbG91ZC1kb3dubG9hZFwiLCBzdHlsZToge2Zsb2F0OidsZWZ0JyxsaW5lSGVpZ2h0OjEuNSxtYXJnaW5SaWdodDo1fX0pXG4gICAgfVxuICAgIHJldHVybiBpY29uXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0TmFtZSA9IHRoaXMucHJvcHMubGlzdC5uYW1lXG4gICAgcHJvcHNDb3VudCA9IHRoaXMucHJvcHMuY291bnRcbiAgICBjb3VudCA9ICh0eXBlb2YocHJvcHNDb3VudCk9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuc3RhdGUuY291bnQgOiBwcm9wc0NvdW50XG5cbiAgICBpY29uID0gXCJcIlxuICAgIGxpc3RTdHlsZT0oaWNvbiA9PSBcIlwiKSA/IFwibGlzdC1uYW1lXCIgOiBcImljb24tbGlzdC1uYW1lXCJcbiAgICBpZih0aGlzLnByb3BzLmljb25UeXBlID09IFwidXNlcnNcIilcbiAgICAgIGxpc3RTdHlsZSA9IFwiYWxsLWxpc3QtbmFtZVwiIFxuICAgIGNvdW50ID0gUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImJhZGdlIGJhZGdlLWRlZmF1bHQgY250LWJnXCJ9LCB0aGlzLnByb3BzLmxpc3QuY291bnQpXG4gICAgY291bnQgPSAodGhpcy5wcm9wcy5oaWRlQ291bnQpID8gXCJcIiA6IGNvdW50XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmNoYW5nZUxpc3QsIFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwibGlzdC1uYW1lcyBidG4gYnRuLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICBpY29uLCBcIiDCoCBcIiwgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogbGlzdFN0eWxlfSwgbGlzdE5hbWUpLCBcIiBcIiwgY291bnRcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxuIl19
