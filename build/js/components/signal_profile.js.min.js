(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {
      reportCount:'~',
      companyCount: '~',
      peopleCount: '~'
    }
  },
  // SignalProfile
  setCurrentView: function(e) {
    if(!this.props.profile.mining_job)
      this.props.setCurrentView('Calendar')
    else
      this.props.setCurrentView('MiningJobCalendar')
    //e.stopPropagation()
  },

  calendarClick:function(e) {
    this.props.setCurrentProfile(this.props.profile)
    if(!this.props.profile.mining_job)
      this.props.setCurrentView('Calendar')
    else
      this.props.setCurrentView('MiningJobCalendar')
    e.stopPropagation()
  },

  analyticsClick:function(e) {
    this.props.setCurrentProfile(this.props.profile)
    this.props.setCurrentView('Analytics')
    e.stopPropagation()
  },

  setCurrentProfile: function() {
    this.props.setCurrentProfile(this.props.profile)
    if(this.props.profile.type == "prospect_profile") {
      this.props.setCurrentView('MiningJobCalendar')
    } else {
      if(this.props.profile.list_type == "territory")
        this.props.setCurrentView('TerritoryCalendar')
      else if(this.props.profile.list_type == "territory")
        this.props.setCurrentView('TerritoryCalendar')
      else
        this.props.setCurrentView('Calendar')
    }
  },

  removeTheProfile: function() {
    this.props.removeProfile(this.props.profile)
  },

  removeProfile: function() {
    thissss = this;
    console.log(thiss.removeTheProfile)

    swal({   
      title: "Are you sure?",   
      text: "Your will not be able to recover this prospect list!",   
      type: "warning",   
      showCancelButton: true,   
      confirmButtonColor: "#DD6B55",   
      confirmButtonText: "Yes, delete it!",   
      closeOnConfirm: false }, 
      function(){   
        swal("Deleted!", "Your prospect list has been deleted.", "success"); 
        thissss.removeTheProfile()
        console.log('deleted')
      });
  },

  //componentDidUpdate: function(prevProps, prevState) { },
  componentWillReceiveProps: function(nextProps) {
  //componentWillUpdate: function(nextProps) {
    if(typeof(this.props.profile.objectId) == "undefined") {
      console.log('RECEIVE PROPS')

      var pusher = new Pusher('1a68a96c8fde938fa75a');
      var thiss = this;
      console.log(nextProps)
      console.log(nextProps.profile)
      console.log(_.keys(nextProps.profile))
      console.log(nextProps.profile.objectId)
      objectId = nextProps.profile.objectId
      console.log('new pusher channel -> '+ objectId)

      var channel = pusher.subscribe(objectId);
      channel.bind("done", function(data) {
        console.log(data)
        console.log(thiss.props)
        //thiss.setState({ done: data.done_timestamp })
        thiss.props.updateMiningJobDone(thiss.props.profile)
        alertify.success("Success notification");
      });
    }
  },

  componentDidMount: function() {
    var pusher = new Pusher('1a68a96c8fde938fa75a');
    objectId = this.props.profile.objectId
    console.log('new pusher channel ->', objectId)
    var channel = pusher.subscribe(objectId);
    var thiss = this;
    channel.bind("done", function(data) {
      console.log(data)
      console.log(thiss.props)
      //thiss.setState({ done: data.done_timestamp })
      thiss.props.updateMiningJobDone(thiss.props.profile)
      alertify.success("Success notification");
    });

    var thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/classes/PeopleSignal',
      headers: appConfig.headers,
      data: {where: JSON.stringify( {profile: appConfig.pointer('ProspectProfile',this.props.profile.objectId)}),
             count: true},
      success: function(res) { thiss.setState({peopleCount: res.count})},
      error: function(err) { }
    })
    $.ajax({
      url:'https://api.parse.com/1/classes/CompanySignal',
      headers: appConfig.headers,
      data: {where: JSON.stringify({profile:
             appConfig.pointer('ProspectProfile',this.props.profile.objectId)}),
             count: true},
      success: function(res) { thiss.setState({companyCount: res.count})},
      error: function(err) { }
    })
    $.ajax({
      url:'https://api.parse.com/1/classes/SignalReport',
      headers: appConfig.headers,
      data: {where: JSON.stringify({profile:
             appConfig.pointer('ProspectProfile',this.props.profile.objectId)}),
             count: true},
      success: function(res) { thiss.setState({reportCount: res.count})},
      error: function(err) { }
    })
  },

  render: function() {
    signalDetails = []
    for(i=0;i< this.props.profile.profiles.length; i++) {
      signalDetails.push(ProfileType({profile: this.props.profile.profiles[i]}))
    }
    //console.log(this.props.profile.list_type)
    //console.log(this.props.profile.list_type == "territory")
    if(this.props.profile.list_type == "signal") 
      icon = React.DOM.i({className: "fa fa-wifi", style: {marginRight:5}})
    else if(this.props.profile.list_type == "territory") 
      icon = React.DOM.i({className: "fa fa-globe", style: {marginRight:5}})
    else
      icon = React.DOM.i({className: "fa fa-cloud-download", style: {marginRight:5}})

    loading = (!this.props.profile.done) ? React.DOM.div({className: "profile-loading"}, 
            React.DOM.div({className: "double-bounce1"}), 
            React.DOM.div({className: "double-bounce2"})
          ) : ""
    
    if(this.props.profile.mining_job && this.props.profile.done)
      mining_job_done = React.DOM.i({className: "fa fa-check-circle", style: {color:'#0096ff',marginLeft:5,fontSize:15}})
    else
      mining_job_done = ""

    selectedStyle = {paddingTop:5,borderLeft:0,paddingLeft:10, borderRight:'1px solid #ddd', borderLeft: '5px solid #0096ff !important'}
    regularStyle = {paddingTop:5,borderLeft:0,paddingLeft:10, borderRight:'1px solid #ddd', borderLeft: '5px solid red !important'}
    regularStyle = {paddingTop:5,borderLeft:0,paddingLeft:10, borderRight:'1px solid #ddd', borderLeft:'5px solid rgba(0,0,0,0)'}
    selected= this.props.profile.objectId == this.props.currentProfile.objectId
    itemStyle = (selected) ? selectedStyle : regularStyle
    itemClass = (selected) ? "list-group-item ideal-company-profile list-group-selected" : "list-group-item ideal-company-profile"


    signal_type = this.props.profile.signal_type
    return (
      React.DOM.div({className: itemClass, 
           onClick: this.setCurrentProfile, 
           style: regularStyle}, 
        React.DOM.span({className: "profile-title"}, 
          React.DOM.h6({className: "label label-primary profile-name", 
              style: {backgroundColor:'rgb(0, 122, 265)'}}, 
            icon, " ", this.props.profile.name
          ), 
          React.DOM.h6({className: "profile-name"}, 
            React.DOM.span({className: "label label-default"}, 
              React.DOM.i({className: "fa fa-calendar"}), " ", this.state.reportCount
            ), "  ", 
            React.DOM.span({className: "label label-default"}, 
              React.DOM.i({className: "fa fa-building"}), " ", this.state.companyCount, "  ", 
              React.DOM.i({className: "fa fa-user"}), " ", this.state.peopleCount
            )
          ), 
          loading, mining_job_done, 
          React.DOM.a({href: "javascript:", 
             className: "btn btn-primary btn-xs signal-detail-btn", 
             onClick: this.removeProfile}, 
            React.DOM.i({className: "fa fa-archive"})), 
          React.DOM.a({href: "javascript:", 
            style: {display:'block'}, 
            className: "btn btn-primary btn-xs signal-detail-btn", 
             onClick: this.analyticsClick}, 
            React.DOM.i({className: "fa fa-pie-chart"})), 
          React.DOM.a({href: "javascript:", 
            style: {display:'block'}, 
            className: "btn btn-primary btn-xs signal-detail-btn", 
             onClick: this.settingsClick}, 
            React.DOM.i({className: "fa fa-wrench"})), 
          React.DOM.a({href: "javascript:", className: "btn btn-primary btn-xs signal-detail-btn", 
             style: {display:'none'}, 
             onClick: this.calendarClick}, 
            React.DOM.i({className: "fa fa-calendar"})), 
          React.DOM.a({href: "javascript:", 
             onClick: this.launchModal, 
             style: (signal_type != "signal") ? {display:'block'}:{display:'none'}, 
             className: "btn btn-primary btn-xs signal-detail-btn"}, 
            React.DOM.i({className: "fa fa-cloud-download"}))
        ), 

        React.DOM.div({className: "profile-body", style: {marginTop:5}}, 
          signalDetails
        )
      )
    );
  },

  launchModal: function(e) {
    $('#createMiningJobModal').modal()
    this.props.setCurrentProfile(this.props.profile)
    if(this.props.currentView == 'Calendar')
      this.props.setCurrentView('Calendar')
    else if(this.props.currentView == 'Feed')
      this.props.setCurrentView('Feed')
    e.stopPropagation()
  }
});

var ProfileType = React.createClass({displayName: 'ProfileType',
  render: function() {

  if(this.props.profile){
    if(this.props.profile.className == "HiringProfile") {
      signalIcon = React.DOM.i({className: "fa fa-suitcase"})
      signalName = "Hiring"
      signalValue = _.reduce(this.props.profile.roles, function(result, role) {
        return role + ", "+ result
      }, "");
      //console.log('wtf')
      //console.log(signalValue)
    } else if (this.props.profile.className  == "EmployeeProfile") {
      signalIcon = React.DOM.i({className: "fa fa-users"})
      signalName = "Company Size"
      signalValue = _.reduce(this.props.profile.employees, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "FundingProfile") {
      signalIcon = React.DOM.i({className: "fa fa-institution"})
      signalName = "Funding"
      signalValue = _.reduce(this.props.profile.revenues, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "RevenueProfile") {
      signalIcon = React.DOM.i({className: "fa fa-money"})
      signalName = "Revenue"
      signalValue = _.reduce(this.props.profile.revenues, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "TechnologyProfile") {
      signalIcon = React.DOM.i({className: "fa fa-wrench"})
      signalName = "Technology"
    } else if (this.props.profile.className  == "LocationProfile") {
      signalIcon = React.DOM.i({className: "fa fa-map-marker"})
      signalName = "Locale"
      signalValue = _.reduce(this.props.profile.locale, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "IndustryProfile") {
      signalIcon = React.DOM.i({className: "fa fa-building"})
      signalName = "Industries"
      signalValue = _.reduce(this.props.profile.industries, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "TerritoryProfile") {
      console.log()
      signalIcon = React.DOM.i({className: "fa fa-globe"})
      signalName = (this.props.profile.territories.length == 1) ? "Territory" : "Territories"
      signalValue = _.reduce(this.props.profile.territories, function(result, role) {
        return role + ", "+ result
      }, "");
    } else if (this.props.profile.className  == "CompanySizeProfile") {
      signalIcon = React.DOM.i({className: "fa fa-wrench"})
      signalName = "Technology"
    } else if (this.props.profile.className  == "ListProfile") {
      signalIcon = React.DOM.i({className: "fa fa-list-alt"})
      signalName = "Company List"
      signalValue = this.props.profile.listName
    } else if (this.props.profile.className  == "ProspectTitleProfile") {
      signalIcon = React.DOM.i({className: "fa fa-user"})
      signalName = "Titles"
      signalValue = _.reduce(this.props.profile.title_keywords, 
     function(result, role) {
        return role + ", "+ result
      }, "");
    } else {
      signalIcon = "not found"
      signalName = "Not found"
      signalValue= "Not found"
    }
  } else {
      signalIcon = "not found"
      signalName = "Not found"
      signalValue= "Not found"

  }

    return (
      React.DOM.span({className: "ideal-profile"}, " ", signalIcon, 
        React.DOM.h6({className: "profile-signal-name"}, signalName, " - "), 
        React.DOM.span({className: "profile-signal-value"}, " "+signalValue)
      )
    );
  }
});

/*
  Funding Profile
  - Amount Raised - btn group
  - Stage - btn group

  People Profile
  - Locale - tags w/ typahead
  - Title - tags w/ typahead

  Company Profile
  - Industries - tags with typahead
  - Revenue - btn group
  - # of Employees - btn group
  - Locale - tags with typahead
*/


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvc2lnbmFsX3Byb2ZpbGUuanMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICByZXBvcnRDb3VudDonficsXG4gICAgICBjb21wYW55Q291bnQ6ICd+JyxcbiAgICAgIHBlb3BsZUNvdW50OiAnfidcbiAgICB9XG4gIH0sXG4gIC8vIFNpZ25hbFByb2ZpbGVcbiAgc2V0Q3VycmVudFZpZXc6IGZ1bmN0aW9uKGUpIHtcbiAgICBpZighdGhpcy5wcm9wcy5wcm9maWxlLm1pbmluZ19qb2IpXG4gICAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdDYWxlbmRhcicpXG4gICAgZWxzZVxuICAgICAgdGhpcy5wcm9wcy5zZXRDdXJyZW50VmlldygnTWluaW5nSm9iQ2FsZW5kYXInKVxuICAgIC8vZS5zdG9wUHJvcGFnYXRpb24oKVxuICB9LFxuXG4gIGNhbGVuZGFyQ2xpY2s6ZnVuY3Rpb24oZSkge1xuICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudFByb2ZpbGUodGhpcy5wcm9wcy5wcm9maWxlKVxuICAgIGlmKCF0aGlzLnByb3BzLnByb2ZpbGUubWluaW5nX2pvYilcbiAgICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudFZpZXcoJ0NhbGVuZGFyJylcbiAgICBlbHNlXG4gICAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdNaW5pbmdKb2JDYWxlbmRhcicpXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICB9LFxuXG4gIGFuYWx5dGljc0NsaWNrOmZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRQcm9maWxlKHRoaXMucHJvcHMucHJvZmlsZSlcbiAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdBbmFseXRpY3MnKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgfSxcblxuICBzZXRDdXJyZW50UHJvZmlsZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5zZXRDdXJyZW50UHJvZmlsZSh0aGlzLnByb3BzLnByb2ZpbGUpXG4gICAgaWYodGhpcy5wcm9wcy5wcm9maWxlLnR5cGUgPT0gXCJwcm9zcGVjdF9wcm9maWxlXCIpIHtcbiAgICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudFZpZXcoJ01pbmluZ0pvYkNhbGVuZGFyJylcbiAgICB9IGVsc2Uge1xuICAgICAgaWYodGhpcy5wcm9wcy5wcm9maWxlLmxpc3RfdHlwZSA9PSBcInRlcnJpdG9yeVwiKVxuICAgICAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdUZXJyaXRvcnlDYWxlbmRhcicpXG4gICAgICBlbHNlIGlmKHRoaXMucHJvcHMucHJvZmlsZS5saXN0X3R5cGUgPT0gXCJ0ZXJyaXRvcnlcIilcbiAgICAgICAgdGhpcy5wcm9wcy5zZXRDdXJyZW50VmlldygnVGVycml0b3J5Q2FsZW5kYXInKVxuICAgICAgZWxzZVxuICAgICAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdDYWxlbmRhcicpXG4gICAgfVxuICB9LFxuXG4gIHJlbW92ZVRoZVByb2ZpbGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHJvcHMucmVtb3ZlUHJvZmlsZSh0aGlzLnByb3BzLnByb2ZpbGUpXG4gIH0sXG5cbiAgcmVtb3ZlUHJvZmlsZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpc3NzcyA9IHRoaXM7XG4gICAgY29uc29sZS5sb2codGhpc3MucmVtb3ZlVGhlUHJvZmlsZSlcblxuICAgIHN3YWwoeyAgIFxuICAgICAgdGl0bGU6IFwiQXJlIHlvdSBzdXJlP1wiLCAgIFxuICAgICAgdGV4dDogXCJZb3VyIHdpbGwgbm90IGJlIGFibGUgdG8gcmVjb3ZlciB0aGlzIHByb3NwZWN0IGxpc3QhXCIsICAgXG4gICAgICB0eXBlOiBcIndhcm5pbmdcIiwgICBcbiAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsICAgXG4gICAgICBjb25maXJtQnV0dG9uQ29sb3I6IFwiI0RENkI1NVwiLCAgIFxuICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzLCBkZWxldGUgaXQhXCIsICAgXG4gICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2UgfSwgXG4gICAgICBmdW5jdGlvbigpeyAgIFxuICAgICAgICBzd2FsKFwiRGVsZXRlZCFcIiwgXCJZb3VyIHByb3NwZWN0IGxpc3QgaGFzIGJlZW4gZGVsZXRlZC5cIiwgXCJzdWNjZXNzXCIpOyBcbiAgICAgICAgdGhpc3Nzcy5yZW1vdmVUaGVQcm9maWxlKClcbiAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZWQnKVxuICAgICAgfSk7XG4gIH0sXG5cbiAgLy9jb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uKHByZXZQcm9wcywgcHJldlN0YXRlKSB7IH0sXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IGZ1bmN0aW9uKG5leHRQcm9wcykge1xuICAvL2NvbXBvbmVudFdpbGxVcGRhdGU6IGZ1bmN0aW9uKG5leHRQcm9wcykge1xuICAgIGlmKHR5cGVvZih0aGlzLnByb3BzLnByb2ZpbGUub2JqZWN0SWQpID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdSRUNFSVZFIFBST1BTJylcblxuICAgICAgdmFyIHB1c2hlciA9IG5ldyBQdXNoZXIoJzFhNjhhOTZjOGZkZTkzOGZhNzVhJyk7XG4gICAgICB2YXIgdGhpc3MgPSB0aGlzO1xuICAgICAgY29uc29sZS5sb2cobmV4dFByb3BzKVxuICAgICAgY29uc29sZS5sb2cobmV4dFByb3BzLnByb2ZpbGUpXG4gICAgICBjb25zb2xlLmxvZyhfLmtleXMobmV4dFByb3BzLnByb2ZpbGUpKVxuICAgICAgY29uc29sZS5sb2cobmV4dFByb3BzLnByb2ZpbGUub2JqZWN0SWQpXG4gICAgICBvYmplY3RJZCA9IG5leHRQcm9wcy5wcm9maWxlLm9iamVjdElkXG4gICAgICBjb25zb2xlLmxvZygnbmV3IHB1c2hlciBjaGFubmVsIC0+ICcrIG9iamVjdElkKVxuXG4gICAgICB2YXIgY2hhbm5lbCA9IHB1c2hlci5zdWJzY3JpYmUob2JqZWN0SWQpO1xuICAgICAgY2hhbm5lbC5iaW5kKFwiZG9uZVwiLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEpXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXNzLnByb3BzKVxuICAgICAgICAvL3RoaXNzLnNldFN0YXRlKHsgZG9uZTogZGF0YS5kb25lX3RpbWVzdGFtcCB9KVxuICAgICAgICB0aGlzcy5wcm9wcy51cGRhdGVNaW5pbmdKb2JEb25lKHRoaXNzLnByb3BzLnByb2ZpbGUpXG4gICAgICAgIGFsZXJ0aWZ5LnN1Y2Nlc3MoXCJTdWNjZXNzIG5vdGlmaWNhdGlvblwiKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHB1c2hlciA9IG5ldyBQdXNoZXIoJzFhNjhhOTZjOGZkZTkzOGZhNzVhJyk7XG4gICAgb2JqZWN0SWQgPSB0aGlzLnByb3BzLnByb2ZpbGUub2JqZWN0SWRcbiAgICBjb25zb2xlLmxvZygnbmV3IHB1c2hlciBjaGFubmVsIC0+Jywgb2JqZWN0SWQpXG4gICAgdmFyIGNoYW5uZWwgPSBwdXNoZXIuc3Vic2NyaWJlKG9iamVjdElkKTtcbiAgICB2YXIgdGhpc3MgPSB0aGlzO1xuICAgIGNoYW5uZWwuYmluZChcImRvbmVcIiwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgY29uc29sZS5sb2coZGF0YSlcbiAgICAgIGNvbnNvbGUubG9nKHRoaXNzLnByb3BzKVxuICAgICAgLy90aGlzcy5zZXRTdGF0ZSh7IGRvbmU6IGRhdGEuZG9uZV90aW1lc3RhbXAgfSlcbiAgICAgIHRoaXNzLnByb3BzLnVwZGF0ZU1pbmluZ0pvYkRvbmUodGhpc3MucHJvcHMucHJvZmlsZSlcbiAgICAgIGFsZXJ0aWZ5LnN1Y2Nlc3MoXCJTdWNjZXNzIG5vdGlmaWNhdGlvblwiKTtcbiAgICB9KTtcblxuICAgIHZhciB0aGlzcyA9IHRoaXM7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9QZW9wbGVTaWduYWwnLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBkYXRhOiB7d2hlcmU6IEpTT04uc3RyaW5naWZ5KCB7cHJvZmlsZTogYXBwQ29uZmlnLnBvaW50ZXIoJ1Byb3NwZWN0UHJvZmlsZScsdGhpcy5wcm9wcy5wcm9maWxlLm9iamVjdElkKX0pLFxuICAgICAgICAgICAgIGNvdW50OiB0cnVlfSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyB0aGlzcy5zZXRTdGF0ZSh7cGVvcGxlQ291bnQ6IHJlcy5jb3VudH0pfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgfVxuICAgIH0pXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Db21wYW55U2lnbmFsJyxcbiAgICAgIGhlYWRlcnM6IGFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgZGF0YToge3doZXJlOiBKU09OLnN0cmluZ2lmeSh7cHJvZmlsZTpcbiAgICAgICAgICAgICBhcHBDb25maWcucG9pbnRlcignUHJvc3BlY3RQcm9maWxlJyx0aGlzLnByb3BzLnByb2ZpbGUub2JqZWN0SWQpfSksXG4gICAgICAgICAgICAgY291bnQ6IHRydWV9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7IHRoaXNzLnNldFN0YXRlKHtjb21wYW55Q291bnQ6IHJlcy5jb3VudH0pfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgfVxuICAgIH0pXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9TaWduYWxSZXBvcnQnLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBkYXRhOiB7d2hlcmU6IEpTT04uc3RyaW5naWZ5KHtwcm9maWxlOlxuICAgICAgICAgICAgIGFwcENvbmZpZy5wb2ludGVyKCdQcm9zcGVjdFByb2ZpbGUnLHRoaXMucHJvcHMucHJvZmlsZS5vYmplY3RJZCl9KSxcbiAgICAgICAgICAgICBjb3VudDogdHJ1ZX0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsgdGhpc3Muc2V0U3RhdGUoe3JlcG9ydENvdW50OiByZXMuY291bnR9KX0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IH1cbiAgICB9KVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgc2lnbmFsRGV0YWlscyA9IFtdXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLnByb2ZpbGUucHJvZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHNpZ25hbERldGFpbHMucHVzaChQcm9maWxlVHlwZSh7cHJvZmlsZTogdGhpcy5wcm9wcy5wcm9maWxlLnByb2ZpbGVzW2ldfSkpXG4gICAgfVxuICAgIC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5wcm9maWxlLmxpc3RfdHlwZSlcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMucHJvZmlsZS5saXN0X3R5cGUgPT0gXCJ0ZXJyaXRvcnlcIilcbiAgICBpZih0aGlzLnByb3BzLnByb2ZpbGUubGlzdF90eXBlID09IFwic2lnbmFsXCIpIFxuICAgICAgaWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtd2lmaVwiLCBzdHlsZToge21hcmdpblJpZ2h0OjV9fSlcbiAgICBlbHNlIGlmKHRoaXMucHJvcHMucHJvZmlsZS5saXN0X3R5cGUgPT0gXCJ0ZXJyaXRvcnlcIikgXG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1nbG9iZVwiLCBzdHlsZToge21hcmdpblJpZ2h0OjV9fSlcbiAgICBlbHNlXG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jbG91ZC1kb3dubG9hZFwiLCBzdHlsZToge21hcmdpblJpZ2h0OjV9fSlcblxuICAgIGxvYWRpbmcgPSAoIXRoaXMucHJvcHMucHJvZmlsZS5kb25lKSA/IFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwcm9maWxlLWxvYWRpbmdcIn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRvdWJsZS1ib3VuY2UxXCJ9KSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZG91YmxlLWJvdW5jZTJcIn0pXG4gICAgICAgICAgKSA6IFwiXCJcbiAgICBcbiAgICBpZih0aGlzLnByb3BzLnByb2ZpbGUubWluaW5nX2pvYiAmJiB0aGlzLnByb3BzLnByb2ZpbGUuZG9uZSlcbiAgICAgIG1pbmluZ19qb2JfZG9uZSA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2hlY2stY2lyY2xlXCIsIHN0eWxlOiB7Y29sb3I6JyMwMDk2ZmYnLG1hcmdpbkxlZnQ6NSxmb250U2l6ZToxNX19KVxuICAgIGVsc2VcbiAgICAgIG1pbmluZ19qb2JfZG9uZSA9IFwiXCJcblxuICAgIHNlbGVjdGVkU3R5bGUgPSB7cGFkZGluZ1RvcDo1LGJvcmRlckxlZnQ6MCxwYWRkaW5nTGVmdDoxMCwgYm9yZGVyUmlnaHQ6JzFweCBzb2xpZCAjZGRkJywgYm9yZGVyTGVmdDogJzVweCBzb2xpZCAjMDA5NmZmICFpbXBvcnRhbnQnfVxuICAgIHJlZ3VsYXJTdHlsZSA9IHtwYWRkaW5nVG9wOjUsYm9yZGVyTGVmdDowLHBhZGRpbmdMZWZ0OjEwLCBib3JkZXJSaWdodDonMXB4IHNvbGlkICNkZGQnLCBib3JkZXJMZWZ0OiAnNXB4IHNvbGlkIHJlZCAhaW1wb3J0YW50J31cbiAgICByZWd1bGFyU3R5bGUgPSB7cGFkZGluZ1RvcDo1LGJvcmRlckxlZnQ6MCxwYWRkaW5nTGVmdDoxMCwgYm9yZGVyUmlnaHQ6JzFweCBzb2xpZCAjZGRkJywgYm9yZGVyTGVmdDonNXB4IHNvbGlkIHJnYmEoMCwwLDAsMCknfVxuICAgIHNlbGVjdGVkPSB0aGlzLnByb3BzLnByb2ZpbGUub2JqZWN0SWQgPT0gdGhpcy5wcm9wcy5jdXJyZW50UHJvZmlsZS5vYmplY3RJZFxuICAgIGl0ZW1TdHlsZSA9IChzZWxlY3RlZCkgPyBzZWxlY3RlZFN0eWxlIDogcmVndWxhclN0eWxlXG4gICAgaXRlbUNsYXNzID0gKHNlbGVjdGVkKSA/IFwibGlzdC1ncm91cC1pdGVtIGlkZWFsLWNvbXBhbnktcHJvZmlsZSBsaXN0LWdyb3VwLXNlbGVjdGVkXCIgOiBcImxpc3QtZ3JvdXAtaXRlbSBpZGVhbC1jb21wYW55LXByb2ZpbGVcIlxuXG5cbiAgICBzaWduYWxfdHlwZSA9IHRoaXMucHJvcHMucHJvZmlsZS5zaWduYWxfdHlwZVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IGl0ZW1DbGFzcywgXG4gICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuc2V0Q3VycmVudFByb2ZpbGUsIFxuICAgICAgICAgICBzdHlsZTogcmVndWxhclN0eWxlfSwgXG4gICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwicHJvZmlsZS10aXRsZVwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmg2KHtjbGFzc05hbWU6IFwibGFiZWwgbGFiZWwtcHJpbWFyeSBwcm9maWxlLW5hbWVcIiwgXG4gICAgICAgICAgICAgIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOidyZ2IoMCwgMTIyLCAyNjUpJ319LCBcbiAgICAgICAgICAgIGljb24sIFwiIFwiLCB0aGlzLnByb3BzLnByb2ZpbGUubmFtZVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS5oNih7Y2xhc3NOYW1lOiBcInByb2ZpbGUtbmFtZVwifSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcImxhYmVsIGxhYmVsLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNhbGVuZGFyXCJ9KSwgXCIgXCIsIHRoaXMuc3RhdGUucmVwb3J0Q291bnRcbiAgICAgICAgICAgICksIFwiIMKgXCIsIFxuICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJsYWJlbCBsYWJlbC1kZWZhdWx0XCJ9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1idWlsZGluZ1wifSksIFwiIFwiLCB0aGlzLnN0YXRlLmNvbXBhbnlDb3VudCwgXCIgwqBcIiwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdXNlclwifSksIFwiIFwiLCB0aGlzLnN0YXRlLnBlb3BsZUNvdW50XG4gICAgICAgICAgICApXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgbG9hZGluZywgbWluaW5nX2pvYl9kb25lLCBcbiAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBzaWduYWwtZGV0YWlsLWJ0blwiLCBcbiAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnJlbW92ZVByb2ZpbGV9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJjaGl2ZVwifSkpLCBcbiAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonYmxvY2snfSwgXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBzaWduYWwtZGV0YWlsLWJ0blwiLCBcbiAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmFuYWx5dGljc0NsaWNrfSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXBpZS1jaGFydFwifSkpLCBcbiAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonYmxvY2snfSwgXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBzaWduYWwtZGV0YWlsLWJ0blwiLCBcbiAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnNldHRpbmdzQ2xpY2t9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtd3JlbmNoXCJ9KSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgYnRuLXhzIHNpZ25hbC1kZXRhaWwtYnRuXCIsIFxuICAgICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonbm9uZSd9LCBcbiAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmNhbGVuZGFyQ2xpY2t9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2FsZW5kYXJcIn0pKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgb25DbGljazogdGhpcy5sYXVuY2hNb2RhbCwgXG4gICAgICAgICAgICAgc3R5bGU6IChzaWduYWxfdHlwZSAhPSBcInNpZ25hbFwiKSA/IHtkaXNwbGF5OidibG9jayd9OntkaXNwbGF5Oidub25lJ30sIFxuICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgYnRuLXhzIHNpZ25hbC1kZXRhaWwtYnRuXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2xvdWQtZG93bmxvYWRcIn0pKVxuICAgICAgICApLCBcblxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicHJvZmlsZS1ib2R5XCIsIHN0eWxlOiB7bWFyZ2luVG9wOjV9fSwgXG4gICAgICAgICAgc2lnbmFsRGV0YWlsc1xuICAgICAgICApXG4gICAgICApXG4gICAgKTtcbiAgfSxcblxuICBsYXVuY2hNb2RhbDogZnVuY3Rpb24oZSkge1xuICAgICQoJyNjcmVhdGVNaW5pbmdKb2JNb2RhbCcpLm1vZGFsKClcbiAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRQcm9maWxlKHRoaXMucHJvcHMucHJvZmlsZSlcbiAgICBpZih0aGlzLnByb3BzLmN1cnJlbnRWaWV3ID09ICdDYWxlbmRhcicpXG4gICAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRWaWV3KCdDYWxlbmRhcicpXG4gICAgZWxzZSBpZih0aGlzLnByb3BzLmN1cnJlbnRWaWV3ID09ICdGZWVkJylcbiAgICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudFZpZXcoJ0ZlZWQnKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgfVxufSk7XG5cbnZhciBQcm9maWxlVHlwZSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1Byb2ZpbGVUeXBlJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcblxuICBpZih0aGlzLnByb3BzLnByb2ZpbGUpe1xuICAgIGlmKHRoaXMucHJvcHMucHJvZmlsZS5jbGFzc05hbWUgPT0gXCJIaXJpbmdQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXN1aXRjYXNlXCJ9KVxuICAgICAgc2lnbmFsTmFtZSA9IFwiSGlyaW5nXCJcbiAgICAgIHNpZ25hbFZhbHVlID0gXy5yZWR1Y2UodGhpcy5wcm9wcy5wcm9maWxlLnJvbGVzLCBmdW5jdGlvbihyZXN1bHQsIHJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHJvbGUgKyBcIiwgXCIrIHJlc3VsdFxuICAgICAgfSwgXCJcIik7XG4gICAgICAvL2NvbnNvbGUubG9nKCd3dGYnKVxuICAgICAgLy9jb25zb2xlLmxvZyhzaWduYWxWYWx1ZSlcbiAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMucHJvZmlsZS5jbGFzc05hbWUgID09IFwiRW1wbG95ZWVQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXVzZXJzXCJ9KVxuICAgICAgc2lnbmFsTmFtZSA9IFwiQ29tcGFueSBTaXplXCJcbiAgICAgIHNpZ25hbFZhbHVlID0gXy5yZWR1Y2UodGhpcy5wcm9wcy5wcm9maWxlLmVtcGxveWVlcywgZnVuY3Rpb24ocmVzdWx0LCByb2xlKSB7XG4gICAgICAgIHJldHVybiByb2xlICsgXCIsIFwiKyByZXN1bHRcbiAgICAgIH0sIFwiXCIpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5wcm9maWxlLmNsYXNzTmFtZSAgPT0gXCJGdW5kaW5nUHJvZmlsZVwiKSB7XG4gICAgICBzaWduYWxJY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1pbnN0aXR1dGlvblwifSlcbiAgICAgIHNpZ25hbE5hbWUgPSBcIkZ1bmRpbmdcIlxuICAgICAgc2lnbmFsVmFsdWUgPSBfLnJlZHVjZSh0aGlzLnByb3BzLnByb2ZpbGUucmV2ZW51ZXMsIGZ1bmN0aW9uKHJlc3VsdCwgcm9sZSkge1xuICAgICAgICByZXR1cm4gcm9sZSArIFwiLCBcIisgcmVzdWx0XG4gICAgICB9LCBcIlwiKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMucHJvZmlsZS5jbGFzc05hbWUgID09IFwiUmV2ZW51ZVByb2ZpbGVcIikge1xuICAgICAgc2lnbmFsSWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtbW9uZXlcIn0pXG4gICAgICBzaWduYWxOYW1lID0gXCJSZXZlbnVlXCJcbiAgICAgIHNpZ25hbFZhbHVlID0gXy5yZWR1Y2UodGhpcy5wcm9wcy5wcm9maWxlLnJldmVudWVzLCBmdW5jdGlvbihyZXN1bHQsIHJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHJvbGUgKyBcIiwgXCIrIHJlc3VsdFxuICAgICAgfSwgXCJcIik7XG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnByb2ZpbGUuY2xhc3NOYW1lICA9PSBcIlRlY2hub2xvZ3lQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXdyZW5jaFwifSlcbiAgICAgIHNpZ25hbE5hbWUgPSBcIlRlY2hub2xvZ3lcIlxuICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5wcm9maWxlLmNsYXNzTmFtZSAgPT0gXCJMb2NhdGlvblByb2ZpbGVcIikge1xuICAgICAgc2lnbmFsSWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtbWFwLW1hcmtlclwifSlcbiAgICAgIHNpZ25hbE5hbWUgPSBcIkxvY2FsZVwiXG4gICAgICBzaWduYWxWYWx1ZSA9IF8ucmVkdWNlKHRoaXMucHJvcHMucHJvZmlsZS5sb2NhbGUsIGZ1bmN0aW9uKHJlc3VsdCwgcm9sZSkge1xuICAgICAgICByZXR1cm4gcm9sZSArIFwiLCBcIisgcmVzdWx0XG4gICAgICB9LCBcIlwiKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMucHJvcHMucHJvZmlsZS5jbGFzc05hbWUgID09IFwiSW5kdXN0cnlQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWJ1aWxkaW5nXCJ9KVxuICAgICAgc2lnbmFsTmFtZSA9IFwiSW5kdXN0cmllc1wiXG4gICAgICBzaWduYWxWYWx1ZSA9IF8ucmVkdWNlKHRoaXMucHJvcHMucHJvZmlsZS5pbmR1c3RyaWVzLCBmdW5jdGlvbihyZXN1bHQsIHJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHJvbGUgKyBcIiwgXCIrIHJlc3VsdFxuICAgICAgfSwgXCJcIik7XG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnByb2ZpbGUuY2xhc3NOYW1lICA9PSBcIlRlcnJpdG9yeVByb2ZpbGVcIikge1xuICAgICAgY29uc29sZS5sb2coKVxuICAgICAgc2lnbmFsSWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtZ2xvYmVcIn0pXG4gICAgICBzaWduYWxOYW1lID0gKHRoaXMucHJvcHMucHJvZmlsZS50ZXJyaXRvcmllcy5sZW5ndGggPT0gMSkgPyBcIlRlcnJpdG9yeVwiIDogXCJUZXJyaXRvcmllc1wiXG4gICAgICBzaWduYWxWYWx1ZSA9IF8ucmVkdWNlKHRoaXMucHJvcHMucHJvZmlsZS50ZXJyaXRvcmllcywgZnVuY3Rpb24ocmVzdWx0LCByb2xlKSB7XG4gICAgICAgIHJldHVybiByb2xlICsgXCIsIFwiKyByZXN1bHRcbiAgICAgIH0sIFwiXCIpO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wcm9wcy5wcm9maWxlLmNsYXNzTmFtZSAgPT0gXCJDb21wYW55U2l6ZVByb2ZpbGVcIikge1xuICAgICAgc2lnbmFsSWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtd3JlbmNoXCJ9KVxuICAgICAgc2lnbmFsTmFtZSA9IFwiVGVjaG5vbG9neVwiXG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnByb2ZpbGUuY2xhc3NOYW1lICA9PSBcIkxpc3RQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWxpc3QtYWx0XCJ9KVxuICAgICAgc2lnbmFsTmFtZSA9IFwiQ29tcGFueSBMaXN0XCJcbiAgICAgIHNpZ25hbFZhbHVlID0gdGhpcy5wcm9wcy5wcm9maWxlLmxpc3ROYW1lXG4gICAgfSBlbHNlIGlmICh0aGlzLnByb3BzLnByb2ZpbGUuY2xhc3NOYW1lICA9PSBcIlByb3NwZWN0VGl0bGVQcm9maWxlXCIpIHtcbiAgICAgIHNpZ25hbEljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXVzZXJcIn0pXG4gICAgICBzaWduYWxOYW1lID0gXCJUaXRsZXNcIlxuICAgICAgc2lnbmFsVmFsdWUgPSBfLnJlZHVjZSh0aGlzLnByb3BzLnByb2ZpbGUudGl0bGVfa2V5d29yZHMsIFxuICAgICBmdW5jdGlvbihyZXN1bHQsIHJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHJvbGUgKyBcIiwgXCIrIHJlc3VsdFxuICAgICAgfSwgXCJcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNpZ25hbEljb24gPSBcIm5vdCBmb3VuZFwiXG4gICAgICBzaWduYWxOYW1lID0gXCJOb3QgZm91bmRcIlxuICAgICAgc2lnbmFsVmFsdWU9IFwiTm90IGZvdW5kXCJcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgICBzaWduYWxJY29uID0gXCJub3QgZm91bmRcIlxuICAgICAgc2lnbmFsTmFtZSA9IFwiTm90IGZvdW5kXCJcbiAgICAgIHNpZ25hbFZhbHVlPSBcIk5vdCBmb3VuZFwiXG5cbiAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwiaWRlYWwtcHJvZmlsZVwifSwgXCIgXCIsIHNpZ25hbEljb24sIFxuICAgICAgICBSZWFjdC5ET00uaDYoe2NsYXNzTmFtZTogXCJwcm9maWxlLXNpZ25hbC1uYW1lXCJ9LCBzaWduYWxOYW1lLCBcIiAtIFwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwicHJvZmlsZS1zaWduYWwtdmFsdWVcIn0sIFwiIFwiK3NpZ25hbFZhbHVlKVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG4vKlxuICBGdW5kaW5nIFByb2ZpbGVcbiAgLSBBbW91bnQgUmFpc2VkIC0gYnRuIGdyb3VwXG4gIC0gU3RhZ2UgLSBidG4gZ3JvdXBcblxuICBQZW9wbGUgUHJvZmlsZVxuICAtIExvY2FsZSAtIHRhZ3Mgdy8gdHlwYWhlYWRcbiAgLSBUaXRsZSAtIHRhZ3Mgdy8gdHlwYWhlYWRcblxuICBDb21wYW55IFByb2ZpbGVcbiAgLSBJbmR1c3RyaWVzIC0gdGFncyB3aXRoIHR5cGFoZWFkXG4gIC0gUmV2ZW51ZSAtIGJ0biBncm91cFxuICAtICMgb2YgRW1wbG95ZWVzIC0gYnRuIGdyb3VwXG4gIC0gTG9jYWxlIC0gdGFncyB3aXRoIHR5cGFoZWFkXG4qL1xuXG4iXX0=
