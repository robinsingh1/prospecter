(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Spinner
  render: function() {
    return (
      React.DOM.div({className: "horizantal-spinner"}, 
        React.DOM.div({className: "hoz-bounce1"}), 
        React.DOM.div({className: "hoz-bounce2"}), 
        React.DOM.div({className: "hoz-bounce3"})
      )
    )
  }
})

},{}]},{},[1])


},{}],2:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // LoadingSpinner
  render: function() {
    return (
    React.DOM.div({className: "spinner", style: {marginTop:'180px'}}, 
      React.DOM.div({className: "spinner-container container1"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container2"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container3"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      )
    )
    )
  }
});

},{}]},{},[1])


},{}],3:[function(require,module,exports){
/** @jsx React.DOM */
var HorizantalSpinner = require('./horizantal_spinner.js.min.js')
var LoadingSpinner = require('./loading_spinner.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    loading  = true
    if(this.props.prospect.company)
      if(this.props.prospect.company.email_pattern)
        loading  = false
    if(!this.props.prospect.company_name.length)
      loading = false
    return { 
      prospect: this.props.prospect,
      checked: false,
      initialLoading: loading,
      loading: loading,
      editMode: false,
      mouseOver: false
    }
  },

  mouseEnter: function() {
    this.setState({mouseOver: true})
  },

  mouseLeave: function() {
    this.setState({mouseOver: false})
  },

  clickCheck: function(e) {
    e.stopPropagation()
    domNode = this.getDOMNode()
    //isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
    //console.log(isChecked)
    this.setState({checked: isChecked})
    this.props.checkboxAction(isChecked, this.state.prospect.objectId)
  },

  rowClick: function() {
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
  },

  keyboardClick: function() {
    $($('.keySelect').find('input[type="checkbox"]')[0]).click()
  },

  componentDidUpdate: function() {
    //
  },

  _make_email: function(name, pattern) {
    name = name.trim()
    vars = {
      first_name: _.first(name.split(' ')),
      last_name: _.last(name.split(' ')),
      first_initial: _.first(name.split(' '))[0],
      last_initial: _.last(name.split(' '))[0],
      domain: prospect.company.domain
    }
    pattern = (pattern[0]) ? pattern[0].pattern : ""
    prospect_email = Mustache.render(pattern, vars).toLowerCase()
    //console.debug('PROSPECT EMAIL')
    //console.debug(prospect_email)
    return ReadOnlyForm({icon: "envelope", value: prospect_email})
  },

  realtimeCompanyInfo: function() {
    var _this = this;
    channel.bind(this.state.prospect.company_name.replace(' ','-'), function(data) {
      _prospect = _this.state.prospect; _prospect.company = data.company;
      _this.setState({prospect: _prospect})
      console.log(data.company)
      console.log('no listening for email')
      if(_prospect.company.email_pattern){
         _this.setState({loading: false}) 
      } else {
        console.log('binding for email pattern')
        console.log(data.company.domain)
        _this.realtimeEmailPattern(data.company.domain)
      }
    });
  },

  realtimeEmailPattern: function(domain) {
    var _this = this;
    channel.bind(domain, function(data) {
      // add email pattern
      console.log('got email pattern')
      console.log(data)
      console.log(_this.state.prospect)
      _prospect = _this.state.prospect
      if(_prospect.company)
        _prospect.company.email_pattern = data.email_pattern
      else
        _prospect.company= {'email_pattern': data.email_pattern}

      _this.setState({prospect: prospect})
      _this.setState({loading: false})
    })
  },

  componentDidMount: function() { 
    //TODO - start if loading is true 
    //if(this.state.loading){
      if(this.state.prospect.company)
        this.realtimeEmailPattern(this.state.prospect.company.domain)
      else
        this.realtimeCompanyInfo(this.state.prospect.company_name)
    //}
  },

  _keyboardShortcuts: function() {
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
    thissss = this
    if(this.props.keyboardSelected) {
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
      Mousetrap.unbind('x')
      Mousetrap.bind('x', function() { 
        thissss.keyboardClick()
        if(thissss.state.checked)
          console.log("lmao")
      });
    }
  },

  render: function() {
    prospect = this.state.prospect
    if(this.props.masterCheckboxChecked && this.state.checked)
      checked = true
    else if(this.props.alreadyChecked)
      checked = true
    else if(this.state.checked)
      checked = true
    else if(this.props.masterCheckboxChecked || this.state.checked)
      checked = true
    else
      checked = false

    checked        = this.state.checked || this.props.alreadyChecked
    color = (checked) ? {backgroundColor: '#eef8ff'} : {}
    infoColor = (checked) ? {backgroundColor: '#eef8ff',paddingBottom:2} : {paddingBottom:2}
    checkboxColor = (checked) ? {backgroundColor: '#eef8ff',verticalAlign:'middle'} : {verticalAlign:'middle'}
    company = (prospect.company) ? prospect.company : {}
    prospect_email = ReadOnlyForm({disabled: true, icon: "envelope", value: "No Email Found"})
    if(company.email_pattern)
      if(company.email_pattern.length)
        prospect_email = this._make_email(prospect.name, company.email_pattern)

    //console.log(prospect.name)
    if(prospect.name == "LinkedIn Member" || _.last(prospect.name) == ".")
      prospect_email = ReadOnlyForm({disabled: true, icon: "envelope", 
                                     value: "Ambiguous Name"})
    prospect_email = (this.state.loading) ? LoadingLabel(null) : prospect_email
    if(!this.props.prospect.company_name.length)
        prospect_email = ""

    if(company.phone && company.phone != "null")
      phone = React.DOM.div({style: {display:'block',paddingTop:2}}, ReadOnlyForm({icon: "phone", value: company.phone})) 
    else 
      phone = ""

    company_size   = (this.state.loading) ? LoadingLabel(null) : ""
    if(company.headcount){ 
      company_size = prospect.company.headcount+" employees" 
    }

    if(company.address)
      city = (company.address) ? company.address.normalizedLocation : prospect.locale
    else if(prospect.locale != "" && prospect.locale)
      city = prospect.locale
    else if(_.isEqual(company, {}))
      city = LoadingLabel(null)
    else
      city = ""

    company_url = (company.domain) ? ShinyButton({icon: "globe", link: "http://"+company.domain}) : ""
    position    = (prospect.title) ? prospect.title.trim() : ""

    prospect_company_name = prospect.company_name
    prospect_name = prospect.name
    if(!this.state.prospect.loading){
      if(typeof(prospect.company_name) == "undefined" || prospect.company_name == "" || prospect.company_name == "not_found")
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, formText: "Enter Company Name."}) 
      if(typeof(prospect.name) == "undefined" || prospect.name == "LinkedIn Member")
        prospect_name = UserUpdateForm({updateProspect: this.updateProspect, var: "name", formText: "Enter Full Name."}) 
      if(typeof(position) == "undefined" || position == "")
        position = UserUpdateForm({updateProspect: this.updateProspect, var: "pos", prospect: this.state.prospect, formText: "Enter Title."}) 
    }
    if(this.state.editMode){
        pcn = prospect_company_name; pn = prospect_name; pos = position;
        pcn = (pcn != "" && pcn) ? pcn : "Enter Company Name."
        pn  = (pn != "" && pn) ? pn : "Enter Full Name."
        pos = (pos != "" && pos) ? pos : "Enter Title."
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, value: pcn, single: 1}) 
        prospect_name = UserUpdateForm({updateProspect: this.updateProspect, var: "name", value: pn, single: 1}) 
        position = UserUpdateForm({updateProspect: this.updateProspect, var: "pos", prospect: this.state.prospect, value: pos, single: 1}) 
    }
    if(!this.props.prospect.company_name.length)
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, formText: "Enter Company Name"}) 

    liProfileSimilars = (prospect.linkedin_url) ? React.DOM.a({onClick: this.openSimilars, style: {marginLeft:5, float:'right'}, href: "javascript:", className: "btn btn-xs btn-primary btn-gradient similar_link"}, " ", React.DOM.i({className: "fa fa-copy", style: {fontWeight:'bold'}})) : ""
    
    if(typeof(prospect_name) == "string")
      if(prospect_name.indexOf(".") != -1 || prospect_name == "LinkedIn Member")
        prospect_name = React.DOM.span(null, prospect_name, React.DOM.button({className: "btn btn-xs btn-default", style: {marginLeft:5,marginTop:-4,width:25,fontSize:11,lineHeight:1}, onClick: this.searchProspect}, " ", React.DOM.i({className: "fa fa-search"})))

    optionsMenu = React.DOM.div({style: {fontSize:10, cursor:'pointer',height:20,marginTop:-20}}, 
            React.DOM.a({className: "text-muted", onClick: this.toggleEditMode}, 
              React.DOM.i({className: (this.state.editMode) ? "fa fa-check" : "fa fa-pencil"})
            ), 
            React.DOM.a({className: "text-muted", onClick: this.searchProspect, style: {marginTop:5}}, 
              React.DOM.i({className: "fa fa-search"})
            ), 
            React.DOM.a({className: "text-muted", onClick: this.archiveProspects, 
              style: {marginTop:5}}, 
              React.DOM.i({className: "fa fa-archive"})
            )
            )
          
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
            //keyboardSelected = {}
    //
    if(this.props.keyboardSelected) {
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
    }
    

    return (
      React.DOM.tr({className: "prospects-tr", 
          onClick: this.rowClick, 
          onMouseEnter: this.mouseEnter, 
          onMouseLeave: this.mouseLeave, 
          style: keyboardSelected}, 
          React.DOM.td({style: checkboxColor}, 
              React.DOM.input({type: "checkbox", 
                     onChange: this.clickCheck, 
                     style: {lineHeight:'normal',marginTop:-8,height:17}, 
                     checked: checked})
          ), 
          React.DOM.td({style: checkboxColor}, 
            (this.state.mouseOver) ? optionsMenu : React.DOM.div({style: {height:20}}, "   ")
          ), 
          React.DOM.td({style: checkboxColor}, 
           (this.state.loading) ? LoadingPulse(null) : "", 
           (!this.state.loading && this.state.initialLoading) ? React.DOM.i({className: "fa fa-check-circle ", style: {color:'rgb(0, 122, 265)',paddingLeft:6,}}) : ""
          ), 
          React.DOM.td({style: color, className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, prospect_name), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}}, " ", position, " ")
          ), 
          React.DOM.td({style: color, className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, " ", prospect_company_name, " "), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}, className: "company-size"}, 
            company_size
            ), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px',display:'none',fontStyle:'italic'}, 
                className: "company-size"}, 
              (prospect.industry) ? prospect.industry : ""
            )
          ), 

          React.DOM.td({style: color}, 
            React.DOM.h6({style: {margin:'0px'}}, city)), 
          React.DOM.td({style: infoColor}, " ", prospect_email, " ", phone, " "), 
          React.DOM.td({style: color}, 
            React.DOM.div({style: {width:92,paddingTop:5,height:5}}, 
              React.DOM.a({href: "javascript:", 
                onClick: this.openLinkedinProfile, 
                className: "btn btn-xs btn-primary btn-gradient linkedin_link", 
                style: {float:'right',marginLeft:5}}, 
                React.DOM.i({className: "fa fa-linkedin-square"})), 
              "   ", 
              liProfileSimilars, 
              company_url
            )
          )
        )
    );
  },

  searchProspect: function(e) {
    e.preventDefault()
    e.stopPropagation()
    url = "http://www.google.com/#q="
    prospect = this.state.prospect
    name = (prospect.name != "LinkedIn Member") ? prospect.name : ""
    args = '-inurl:"/dir/" -inurl:"/find/" -inurl:"/updates"'
    if(name == "" && prospect.company_name != "not_found")
      linkedin = '"at '+prospect.company_name+'" site:linkedin.com '+args
    else
      linkedin = " site:linkedin.com/in/ OR site:linkedin.com/pub/ -site:linkedin.com/pub/dir/"
    window.open(url+name+" "+prospect.company_name+" "+prospect.title+linkedin)
  },

  archiveProspects: function() {
    console.log(this.getDOMNode())
    //$(this.getDOMNode()).click()
    this.props.archiveProspects([this.state.prospect.objectId])
  },

  toggleEditMode: function(e) {
    e.stopPropagation()
    this.setState({editMode: !this.state.editMode})
  },

  openTest: function() {
    e.stopPropagation()
  },

  openLinkedinProfile: function(e) {
    window.open(this.state.prospect.linkedin_url)
    e.stopPropagation()
  },

  emailInputClick: function(e) {e.stopPropagation() },

  openSimilars: function(e) {
    // TODO - move to backend
    console.log('similars')
    if(this.state.prospect.linkedin_url.indexOf('profile') != -1){
      urlargs = this.state.prospect.linkedin_url.split('?')[1].split('&')
      args = []
      for(i=0;i< urlargs.length; i++)
        args.push(urlargs[i].split('='))
      args = _.object(args)
    }
    window.open("https://www.linkedin.com/vsearch/p?pivotType=sim&pid="+args.id)
    e.stopPropagation()
  },

  deleteProspect: function() {
    this.props.deleteProspect(this.state.prospect.objectId, 'Prospect')
  },
  
  updateProspect: function(prop, value) {
    prospect = this.state.prospect
    prospect[prop] = value
    this.setState({prospect: prospect})
  },
  
  refresh: function(e) {
    e.preventDefault()
    e.stopPropagation()
    prospect = this.state.prospect
    console.log(prospect)

    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
      url:'http://127.0.0.1:5000/profile_detail',
      type:'GET',
      dataType:'json',
      data: prospect,
      //headers:appConfig.headers,
      success: function(res) { console.log(res)},
      error: function(err) { console.log(err.responseText) }
    })
  },
});

var UserUpdateForm = React.createClass({displayName: 'UserUpdateForm',
  getInitialState: function() {
    return {
      submitted: false,
      value: this.props.value
    }
  },

  formClick: function(e) { e.stopPropagation() },

  submitForm: function(e) {
    e.preventDefault()
    e.stopPropagation()
    this.props.updateProspect(this.props.var, $(e.target).find('input').val())
    this.setState({submitted: true})
    prospect = this.props.prospect
    prospect[this.props.var] = $(e.target).find('input').val()

    // persist
    data = {}
    varr = this.props.var
    val = $(e.target).find('input').val()
    data[varr] = val
    objectId = this.state.prospect.objectId

    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
      url:'http://127.0.0.1:5000/profile_detail',
      data: prospect,
      //headers:appConfig.headers,
      success: function(res) { console.log(res)},
      error: function(err) { console.log(err.responseText) }
    })

    /*
    $.ajax({
      url:'https://api.parse.com/1/classes/Prospect/'+objectId,
      type: 'PUT',
      data: JSON.stringify(data),
      headers: appConfig.headers,
      success: function(res) { console.log(res) 
        // sent current prospect state as data to 
        $.ajax({
          url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
          data: prospect,
          headers:appConfig.headers,
          success: function(res) { console.log(res)},
          error: function(err) { console.log(err.responseText) }
        })
      },
      error: function(err) { console.log(err.responseText) }
    })
    */
  },

  handleChange: function(event) {
    console.log(event.target.value)
    this.setState({value: event.target.value});
  },

  render: function() {
    //"Enter Website."
    btn = (this.state.submitted) ? "btn btn-xs btn-success" : "btn btn-xs btn-default"
    single = {display:'inline', width:22, marginLeft:5}
    single.display = (this.props.single) ? 'none' : 'inline'
    input = {width:'100%', display:'inline', height:24, marginBottom:6}
    input.width = (this.props.single) ? '100%' : '70%'
    return (
      React.DOM.form({onClick: this.formClick, onSubmit: this.submitForm}, 
        React.DOM.input({style: input, 
          type: "text", className: "form-control input-sm", 
          disabled: this.state.submitted, 
          onChange: this.handleChange, 
          value: this.state.value, 
          placeholder: this.props.formText}), 
        React.DOM.button({type: "submit", className: btn, 
          style: single}, 
          React.DOM.i({className: "fa fa-check"}))
      )
    )
  },

  profileSearch: function(e) {
    e.preventDefault()
    url = "http://www.google.com/#q="
    prospect = this.state.prospect
    name = (prospect.name != "LinkedIn Member") ? prospect.name : ""
    args = '-inurl:"/dir/" -inurl:"/find/" -inurl:"/updates"'
    if(name == "" && prospect.company_name != "not_found")
      linkedin = '"at '+prospect.company_name+'" site:linkedin.com '+args
    else
      linkedin = " site:linkedin.com/in/ OR site:linkedin.com/pub/ -site:linkedin.com/pub/dir/"
    window.open(url+name+" "+prospect.company_name+" "+prospect.pos+linkedin)
  },

  websiteSearch: function(e) {
    e.preventDefault()
    url = "http://www.google.com/#q="
    window.open(url+this.state.prospect.company_name+" site:linkedin.com/company")
  },

  _make_email: function(name, pattern) {
    name = name.trim()
    vars = {
      first_name: _.first(name.split(' ')),
      last_name: _.last(name.split(' ')),
      first_initial: _.first(name.split(' '))[0],
      last_initial: _.last(name.split(' '))[0],
      domain: prospect.company.domain
    }
    pattern = (pattern) ? pattern[0].pattern : ""
    prospect_email = Mustache.render(pattern, vars).toLowerCase()
    //console.debug('PROSPECT EMAIL')
    //console.debug(prospect_email)
    return ReadOnlyForm({icon: "envelope", value: prospect_email})

    if(prospect_email) {
        prospect_email = (prospect_email) ? prospect_email.toLowerCase() : ""
        prospect_email = React.DOM.input({onClick: this.emailInputClick, type: "text", value: prospect_email, className: "form-control form-sm", style: {fontSize:12, width:160, height:22, marginTop: 0}})
        prospect_email = React.DOM.div({className: "input-group input-group-xs"}, 
          React.DOM.span({className: "input-group-addon", id: "sizing-addon3", style: {paddingTop:2,paddingBottom:2}}, 
            React.DOM.i({className: "fa fa-envelope"})
          ), 
          prospect_email
        )
    }
    return email
  },
})

var ReadOnlyForm = React.createClass({displayName: 'ReadOnlyForm',
  render: function() {
    style = {fontSize:12, width:'70%', height:22, marginTop: 0, zIndex:1,cursor:'default'}

    style.fontStyle = (this.props.disabled) ? 'italic' : ''
    return (
      React.DOM.div({className: "input-group input-group-xs", style: {display:'inline-block'}}, 
        React.DOM.span({className: "input-group-addon", id: "sizing-addon3", 
          style: {paddingTop:2,paddingBottom:2,display:'inline-block',
                  height:22,width:37,float:'left',marginTop:0}}, 
          React.DOM.i({className: "fa fa-"+this.props.icon})
        ), 
          React.DOM.input({disabled: this.props.disabled, onClick: this.emailInputClick, type: "text", value: this.props.value, className: "form-control form-sm", style: style})
      )
    )
  },
  emailInputClick: function(e) {
    e.stopPropagation()
  }
})

var LoadingLabel = React.createClass({displayName: 'LoadingLabel',
  render: function() {
    return (
        React.DOM.label({className: "label label-primary", style: {backgroundColor: 'rgb(0, 122, 265)'}}, "Loading...")
    )
  }   
})

var WarningLabel = React.createClass({displayName: 'WarningLabel',
  render: function() {
    return (
        React.DOM.label({className: "label label-warning", style: {display:'block',width:'90%'}}, "Warning...")
    )
  }   
})

var ShinyButton = React.createClass({displayName: 'ShinyButton',
  openLink: function(e) {
    e.stopPropagation()
    window.open(this.props.link)
  },

  render: function() {
    return (
      React.DOM.a({href: "javascript:", 
         onClick: this.openLink, 
         className: "btn btn-xs btn-primary btn-gradient", 
         style: {marginLeft:-5, float:'right'}}, 
       React.DOM.i({className: "fa fa-globe"})
      )
    )
  }
})

var LoadingPulse = React.createClass({displayName: 'LoadingPulse',
  render: function() {
    return (
      React.DOM.div({className: "profile-loading", style: {marginTop:0}}, 
        React.DOM.div({className: "double-bounce1", style: {backgroundColor:'rgb(0, 122, 265)'}}), 
        React.DOM.div({className: "double-bounce2", style: {backgroundColor:'rgb(0, 122, 265)'}})
      )
    )
  }
})

},{"./horizantal_spinner.js.min.js":1,"./loading_spinner.js.min.js":2}]},{},[3])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9wcm9zcGVjdC5qcy5taW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFkQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xudmFyIEhvcml6YW50YWxTcGlubmVyID0gcmVxdWlyZSgnLi9ob3JpemFudGFsX3NwaW5uZXIuanMubWluLmpzJylcbnZhciBMb2FkaW5nU3Bpbm5lciA9IHJlcXVpcmUoJy4vbG9hZGluZ19zcGlubmVyLmpzLm1pbi5qcycpXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgbG9hZGluZyAgPSB0cnVlXG4gICAgaWYodGhpcy5wcm9wcy5wcm9zcGVjdC5jb21wYW55KVxuICAgICAgaWYodGhpcy5wcm9wcy5wcm9zcGVjdC5jb21wYW55LmVtYWlsX3BhdHRlcm4pXG4gICAgICAgIGxvYWRpbmcgID0gZmFsc2VcbiAgICBpZighdGhpcy5wcm9wcy5wcm9zcGVjdC5jb21wYW55X25hbWUubGVuZ3RoKVxuICAgICAgbG9hZGluZyA9IGZhbHNlXG4gICAgcmV0dXJuIHsgXG4gICAgICBwcm9zcGVjdDogdGhpcy5wcm9wcy5wcm9zcGVjdCxcbiAgICAgIGNoZWNrZWQ6IGZhbHNlLFxuICAgICAgaW5pdGlhbExvYWRpbmc6IGxvYWRpbmcsXG4gICAgICBsb2FkaW5nOiBsb2FkaW5nLFxuICAgICAgZWRpdE1vZGU6IGZhbHNlLFxuICAgICAgbW91c2VPdmVyOiBmYWxzZVxuICAgIH1cbiAgfSxcblxuICBtb3VzZUVudGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHttb3VzZU92ZXI6IHRydWV9KVxuICB9LFxuXG4gIG1vdXNlTGVhdmU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe21vdXNlT3ZlcjogZmFsc2V9KVxuICB9LFxuXG4gIGNsaWNrQ2hlY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgZG9tTm9kZSA9IHRoaXMuZ2V0RE9NTm9kZSgpXG4gICAgLy9pc0NoZWNrZWQgPSAkKCQoZG9tTm9kZSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLnByb3AoJ2NoZWNrZWQnKVxuICAgIGlzQ2hlY2tlZCA9ICQoJChkb21Ob2RlKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkucHJvcCgnY2hlY2tlZCcpXG4gICAgJCgkKHRoaXMuZ2V0RE9NTm9kZSgpKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkuY2xpY2soKVxuICAgIC8vY29uc29sZS5sb2coaXNDaGVja2VkKVxuICAgIHRoaXMuc2V0U3RhdGUoe2NoZWNrZWQ6IGlzQ2hlY2tlZH0pXG4gICAgdGhpcy5wcm9wcy5jaGVja2JveEFjdGlvbihpc0NoZWNrZWQsIHRoaXMuc3RhdGUucHJvc3BlY3Qub2JqZWN0SWQpXG4gIH0sXG5cbiAgcm93Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICQoJCh0aGlzLmdldERPTU5vZGUoKSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLmNsaWNrKClcbiAgfSxcblxuICBrZXlib2FyZENsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAkKCQoJy5rZXlTZWxlY3QnKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkuY2xpY2soKVxuICB9LFxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgLy9cbiAgfSxcblxuICBfbWFrZV9lbWFpbDogZnVuY3Rpb24obmFtZSwgcGF0dGVybikge1xuICAgIG5hbWUgPSBuYW1lLnRyaW0oKVxuICAgIHZhcnMgPSB7XG4gICAgICBmaXJzdF9uYW1lOiBfLmZpcnN0KG5hbWUuc3BsaXQoJyAnKSksXG4gICAgICBsYXN0X25hbWU6IF8ubGFzdChuYW1lLnNwbGl0KCcgJykpLFxuICAgICAgZmlyc3RfaW5pdGlhbDogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpWzBdLFxuICAgICAgbGFzdF9pbml0aWFsOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKVswXSxcbiAgICAgIGRvbWFpbjogcHJvc3BlY3QuY29tcGFueS5kb21haW5cbiAgICB9XG4gICAgcGF0dGVybiA9IChwYXR0ZXJuWzBdKSA/IHBhdHRlcm5bMF0ucGF0dGVybiA6IFwiXCJcbiAgICBwcm9zcGVjdF9lbWFpbCA9IE11c3RhY2hlLnJlbmRlcihwYXR0ZXJuLCB2YXJzKS50b0xvd2VyQ2FzZSgpXG4gICAgLy9jb25zb2xlLmRlYnVnKCdQUk9TUEVDVCBFTUFJTCcpXG4gICAgLy9jb25zb2xlLmRlYnVnKHByb3NwZWN0X2VtYWlsKVxuICAgIHJldHVybiBSZWFkT25seUZvcm0oe2ljb246IFwiZW52ZWxvcGVcIiwgdmFsdWU6IHByb3NwZWN0X2VtYWlsfSlcbiAgfSxcblxuICByZWFsdGltZUNvbXBhbnlJbmZvOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGNoYW5uZWwuYmluZCh0aGlzLnN0YXRlLnByb3NwZWN0LmNvbXBhbnlfbmFtZS5yZXBsYWNlKCcgJywnLScpLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICBfcHJvc3BlY3QgPSBfdGhpcy5zdGF0ZS5wcm9zcGVjdDsgX3Byb3NwZWN0LmNvbXBhbnkgPSBkYXRhLmNvbXBhbnk7XG4gICAgICBfdGhpcy5zZXRTdGF0ZSh7cHJvc3BlY3Q6IF9wcm9zcGVjdH0pXG4gICAgICBjb25zb2xlLmxvZyhkYXRhLmNvbXBhbnkpXG4gICAgICBjb25zb2xlLmxvZygnbm8gbGlzdGVuaW5nIGZvciBlbWFpbCcpXG4gICAgICBpZihfcHJvc3BlY3QuY29tcGFueS5lbWFpbF9wYXR0ZXJuKXtcbiAgICAgICAgIF90aGlzLnNldFN0YXRlKHtsb2FkaW5nOiBmYWxzZX0pIFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2JpbmRpbmcgZm9yIGVtYWlsIHBhdHRlcm4nKVxuICAgICAgICBjb25zb2xlLmxvZyhkYXRhLmNvbXBhbnkuZG9tYWluKVxuICAgICAgICBfdGhpcy5yZWFsdGltZUVtYWlsUGF0dGVybihkYXRhLmNvbXBhbnkuZG9tYWluKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIHJlYWx0aW1lRW1haWxQYXR0ZXJuOiBmdW5jdGlvbihkb21haW4pIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGNoYW5uZWwuYmluZChkb21haW4sIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIC8vIGFkZCBlbWFpbCBwYXR0ZXJuXG4gICAgICBjb25zb2xlLmxvZygnZ290IGVtYWlsIHBhdHRlcm4nKVxuICAgICAgY29uc29sZS5sb2coZGF0YSlcbiAgICAgIGNvbnNvbGUubG9nKF90aGlzLnN0YXRlLnByb3NwZWN0KVxuICAgICAgX3Byb3NwZWN0ID0gX3RoaXMuc3RhdGUucHJvc3BlY3RcbiAgICAgIGlmKF9wcm9zcGVjdC5jb21wYW55KVxuICAgICAgICBfcHJvc3BlY3QuY29tcGFueS5lbWFpbF9wYXR0ZXJuID0gZGF0YS5lbWFpbF9wYXR0ZXJuXG4gICAgICBlbHNlXG4gICAgICAgIF9wcm9zcGVjdC5jb21wYW55PSB7J2VtYWlsX3BhdHRlcm4nOiBkYXRhLmVtYWlsX3BhdHRlcm59XG5cbiAgICAgIF90aGlzLnNldFN0YXRlKHtwcm9zcGVjdDogcHJvc3BlY3R9KVxuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xvYWRpbmc6IGZhbHNlfSlcbiAgICB9KVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHsgXG4gICAgLy9UT0RPIC0gc3RhcnQgaWYgbG9hZGluZyBpcyB0cnVlIFxuICAgIC8vaWYodGhpcy5zdGF0ZS5sb2FkaW5nKXtcbiAgICAgIGlmKHRoaXMuc3RhdGUucHJvc3BlY3QuY29tcGFueSlcbiAgICAgICAgdGhpcy5yZWFsdGltZUVtYWlsUGF0dGVybih0aGlzLnN0YXRlLnByb3NwZWN0LmNvbXBhbnkuZG9tYWluKVxuICAgICAgZWxzZVxuICAgICAgICB0aGlzLnJlYWx0aW1lQ29tcGFueUluZm8odGhpcy5zdGF0ZS5wcm9zcGVjdC5jb21wYW55X25hbWUpXG4gICAgLy99XG4gIH0sXG5cbiAgX2tleWJvYXJkU2hvcnRjdXRzOiBmdW5jdGlvbigpIHtcbiAgICBrZXlib2FyZFNlbGVjdGVkID0ge2JvcmRlckxlZnQ6JzdweCBzb2xpZCByZ2JhKDAsMCwwLDApJ31cbiAgICB0aGlzc3NzID0gdGhpc1xuICAgIGlmKHRoaXMucHJvcHMua2V5Ym9hcmRTZWxlY3RlZCkge1xuICAgICAga2V5Ym9hcmRTZWxlY3RlZCA9IHtib3JkZXJMZWZ0Oic3cHggc29saWQgIzAwOTZmZiAhaW1wb3J0YW50J31cbiAgICAgIE1vdXNldHJhcC51bmJpbmQoJ3gnKVxuICAgICAgTW91c2V0cmFwLmJpbmQoJ3gnLCBmdW5jdGlvbigpIHsgXG4gICAgICAgIHRoaXNzc3Mua2V5Ym9hcmRDbGljaygpXG4gICAgICAgIGlmKHRoaXNzc3Muc3RhdGUuY2hlY2tlZClcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImxtYW9cIilcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdFxuICAgIGlmKHRoaXMucHJvcHMubWFzdGVyQ2hlY2tib3hDaGVja2VkICYmIHRoaXMuc3RhdGUuY2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZSBpZih0aGlzLnByb3BzLmFscmVhZHlDaGVja2VkKVxuICAgICAgY2hlY2tlZCA9IHRydWVcbiAgICBlbHNlIGlmKHRoaXMuc3RhdGUuY2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZSBpZih0aGlzLnByb3BzLm1hc3RlckNoZWNrYm94Q2hlY2tlZCB8fCB0aGlzLnN0YXRlLmNoZWNrZWQpXG4gICAgICBjaGVja2VkID0gdHJ1ZVxuICAgIGVsc2VcbiAgICAgIGNoZWNrZWQgPSBmYWxzZVxuXG4gICAgY2hlY2tlZCAgICAgICAgPSB0aGlzLnN0YXRlLmNoZWNrZWQgfHwgdGhpcy5wcm9wcy5hbHJlYWR5Q2hlY2tlZFxuICAgIGNvbG9yID0gKGNoZWNrZWQpID8ge2JhY2tncm91bmRDb2xvcjogJyNlZWY4ZmYnfSA6IHt9XG4gICAgaW5mb0NvbG9yID0gKGNoZWNrZWQpID8ge2JhY2tncm91bmRDb2xvcjogJyNlZWY4ZmYnLHBhZGRpbmdCb3R0b206Mn0gOiB7cGFkZGluZ0JvdHRvbToyfVxuICAgIGNoZWNrYm94Q29sb3IgPSAoY2hlY2tlZCkgPyB7YmFja2dyb3VuZENvbG9yOiAnI2VlZjhmZicsdmVydGljYWxBbGlnbjonbWlkZGxlJ30gOiB7dmVydGljYWxBbGlnbjonbWlkZGxlJ31cbiAgICBjb21wYW55ID0gKHByb3NwZWN0LmNvbXBhbnkpID8gcHJvc3BlY3QuY29tcGFueSA6IHt9XG4gICAgcHJvc3BlY3RfZW1haWwgPSBSZWFkT25seUZvcm0oe2Rpc2FibGVkOiB0cnVlLCBpY29uOiBcImVudmVsb3BlXCIsIHZhbHVlOiBcIk5vIEVtYWlsIEZvdW5kXCJ9KVxuICAgIGlmKGNvbXBhbnkuZW1haWxfcGF0dGVybilcbiAgICAgIGlmKGNvbXBhbnkuZW1haWxfcGF0dGVybi5sZW5ndGgpXG4gICAgICAgIHByb3NwZWN0X2VtYWlsID0gdGhpcy5fbWFrZV9lbWFpbChwcm9zcGVjdC5uYW1lLCBjb21wYW55LmVtYWlsX3BhdHRlcm4pXG5cbiAgICAvL2NvbnNvbGUubG9nKHByb3NwZWN0Lm5hbWUpXG4gICAgaWYocHJvc3BlY3QubmFtZSA9PSBcIkxpbmtlZEluIE1lbWJlclwiIHx8IF8ubGFzdChwcm9zcGVjdC5uYW1lKSA9PSBcIi5cIilcbiAgICAgIHByb3NwZWN0X2VtYWlsID0gUmVhZE9ubHlGb3JtKHtkaXNhYmxlZDogdHJ1ZSwgaWNvbjogXCJlbnZlbG9wZVwiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJBbWJpZ3VvdXMgTmFtZVwifSlcbiAgICBwcm9zcGVjdF9lbWFpbCA9ICh0aGlzLnN0YXRlLmxvYWRpbmcpID8gTG9hZGluZ0xhYmVsKG51bGwpIDogcHJvc3BlY3RfZW1haWxcbiAgICBpZighdGhpcy5wcm9wcy5wcm9zcGVjdC5jb21wYW55X25hbWUubGVuZ3RoKVxuICAgICAgICBwcm9zcGVjdF9lbWFpbCA9IFwiXCJcblxuICAgIGlmKGNvbXBhbnkucGhvbmUgJiYgY29tcGFueS5waG9uZSAhPSBcIm51bGxcIilcbiAgICAgIHBob25lID0gUmVhY3QuRE9NLmRpdih7c3R5bGU6IHtkaXNwbGF5OidibG9jaycscGFkZGluZ1RvcDoyfX0sIFJlYWRPbmx5Rm9ybSh7aWNvbjogXCJwaG9uZVwiLCB2YWx1ZTogY29tcGFueS5waG9uZX0pKSBcbiAgICBlbHNlIFxuICAgICAgcGhvbmUgPSBcIlwiXG5cbiAgICBjb21wYW55X3NpemUgICA9ICh0aGlzLnN0YXRlLmxvYWRpbmcpID8gTG9hZGluZ0xhYmVsKG51bGwpIDogXCJcIlxuICAgIGlmKGNvbXBhbnkuaGVhZGNvdW50KXsgXG4gICAgICBjb21wYW55X3NpemUgPSBwcm9zcGVjdC5jb21wYW55LmhlYWRjb3VudCtcIiBlbXBsb3llZXNcIiBcbiAgICB9XG5cbiAgICBpZihjb21wYW55LmFkZHJlc3MpXG4gICAgICBjaXR5ID0gKGNvbXBhbnkuYWRkcmVzcykgPyBjb21wYW55LmFkZHJlc3Mubm9ybWFsaXplZExvY2F0aW9uIDogcHJvc3BlY3QubG9jYWxlXG4gICAgZWxzZSBpZihwcm9zcGVjdC5sb2NhbGUgIT0gXCJcIiAmJiBwcm9zcGVjdC5sb2NhbGUpXG4gICAgICBjaXR5ID0gcHJvc3BlY3QubG9jYWxlXG4gICAgZWxzZSBpZihfLmlzRXF1YWwoY29tcGFueSwge30pKVxuICAgICAgY2l0eSA9IExvYWRpbmdMYWJlbChudWxsKVxuICAgIGVsc2VcbiAgICAgIGNpdHkgPSBcIlwiXG5cbiAgICBjb21wYW55X3VybCA9IChjb21wYW55LmRvbWFpbikgPyBTaGlueUJ1dHRvbih7aWNvbjogXCJnbG9iZVwiLCBsaW5rOiBcImh0dHA6Ly9cIitjb21wYW55LmRvbWFpbn0pIDogXCJcIlxuICAgIHBvc2l0aW9uICAgID0gKHByb3NwZWN0LnRpdGxlKSA/IHByb3NwZWN0LnRpdGxlLnRyaW0oKSA6IFwiXCJcblxuICAgIHByb3NwZWN0X2NvbXBhbnlfbmFtZSA9IHByb3NwZWN0LmNvbXBhbnlfbmFtZVxuICAgIHByb3NwZWN0X25hbWUgPSBwcm9zcGVjdC5uYW1lXG4gICAgaWYoIXRoaXMuc3RhdGUucHJvc3BlY3QubG9hZGluZyl7XG4gICAgICBpZih0eXBlb2YocHJvc3BlY3QuY29tcGFueV9uYW1lKSA9PSBcInVuZGVmaW5lZFwiIHx8IHByb3NwZWN0LmNvbXBhbnlfbmFtZSA9PSBcIlwiIHx8IHByb3NwZWN0LmNvbXBhbnlfbmFtZSA9PSBcIm5vdF9mb3VuZFwiKVxuICAgICAgICBwcm9zcGVjdF9jb21wYW55X25hbWUgPSBVc2VyVXBkYXRlRm9ybSh7dXBkYXRlUHJvc3BlY3Q6IHRoaXMudXBkYXRlUHJvc3BlY3QsIHZhcjogXCJjb21wYW55X25hbWVcIiwgcHJvc3BlY3Q6IHRoaXMuc3RhdGUucHJvc3BlY3QsIGZvcm1UZXh0OiBcIkVudGVyIENvbXBhbnkgTmFtZS5cIn0pIFxuICAgICAgaWYodHlwZW9mKHByb3NwZWN0Lm5hbWUpID09IFwidW5kZWZpbmVkXCIgfHwgcHJvc3BlY3QubmFtZSA9PSBcIkxpbmtlZEluIE1lbWJlclwiKVxuICAgICAgICBwcm9zcGVjdF9uYW1lID0gVXNlclVwZGF0ZUZvcm0oe3VwZGF0ZVByb3NwZWN0OiB0aGlzLnVwZGF0ZVByb3NwZWN0LCB2YXI6IFwibmFtZVwiLCBmb3JtVGV4dDogXCJFbnRlciBGdWxsIE5hbWUuXCJ9KSBcbiAgICAgIGlmKHR5cGVvZihwb3NpdGlvbikgPT0gXCJ1bmRlZmluZWRcIiB8fCBwb3NpdGlvbiA9PSBcIlwiKVxuICAgICAgICBwb3NpdGlvbiA9IFVzZXJVcGRhdGVGb3JtKHt1cGRhdGVQcm9zcGVjdDogdGhpcy51cGRhdGVQcm9zcGVjdCwgdmFyOiBcInBvc1wiLCBwcm9zcGVjdDogdGhpcy5zdGF0ZS5wcm9zcGVjdCwgZm9ybVRleHQ6IFwiRW50ZXIgVGl0bGUuXCJ9KSBcbiAgICB9XG4gICAgaWYodGhpcy5zdGF0ZS5lZGl0TW9kZSl7XG4gICAgICAgIHBjbiA9IHByb3NwZWN0X2NvbXBhbnlfbmFtZTsgcG4gPSBwcm9zcGVjdF9uYW1lOyBwb3MgPSBwb3NpdGlvbjtcbiAgICAgICAgcGNuID0gKHBjbiAhPSBcIlwiICYmIHBjbikgPyBwY24gOiBcIkVudGVyIENvbXBhbnkgTmFtZS5cIlxuICAgICAgICBwbiAgPSAocG4gIT0gXCJcIiAmJiBwbikgPyBwbiA6IFwiRW50ZXIgRnVsbCBOYW1lLlwiXG4gICAgICAgIHBvcyA9IChwb3MgIT0gXCJcIiAmJiBwb3MpID8gcG9zIDogXCJFbnRlciBUaXRsZS5cIlxuICAgICAgICBwcm9zcGVjdF9jb21wYW55X25hbWUgPSBVc2VyVXBkYXRlRm9ybSh7dXBkYXRlUHJvc3BlY3Q6IHRoaXMudXBkYXRlUHJvc3BlY3QsIHZhcjogXCJjb21wYW55X25hbWVcIiwgcHJvc3BlY3Q6IHRoaXMuc3RhdGUucHJvc3BlY3QsIHZhbHVlOiBwY24sIHNpbmdsZTogMX0pIFxuICAgICAgICBwcm9zcGVjdF9uYW1lID0gVXNlclVwZGF0ZUZvcm0oe3VwZGF0ZVByb3NwZWN0OiB0aGlzLnVwZGF0ZVByb3NwZWN0LCB2YXI6IFwibmFtZVwiLCB2YWx1ZTogcG4sIHNpbmdsZTogMX0pIFxuICAgICAgICBwb3NpdGlvbiA9IFVzZXJVcGRhdGVGb3JtKHt1cGRhdGVQcm9zcGVjdDogdGhpcy51cGRhdGVQcm9zcGVjdCwgdmFyOiBcInBvc1wiLCBwcm9zcGVjdDogdGhpcy5zdGF0ZS5wcm9zcGVjdCwgdmFsdWU6IHBvcywgc2luZ2xlOiAxfSkgXG4gICAgfVxuICAgIGlmKCF0aGlzLnByb3BzLnByb3NwZWN0LmNvbXBhbnlfbmFtZS5sZW5ndGgpXG4gICAgICAgIHByb3NwZWN0X2NvbXBhbnlfbmFtZSA9IFVzZXJVcGRhdGVGb3JtKHt1cGRhdGVQcm9zcGVjdDogdGhpcy51cGRhdGVQcm9zcGVjdCwgdmFyOiBcImNvbXBhbnlfbmFtZVwiLCBwcm9zcGVjdDogdGhpcy5zdGF0ZS5wcm9zcGVjdCwgZm9ybVRleHQ6IFwiRW50ZXIgQ29tcGFueSBOYW1lXCJ9KSBcblxuICAgIGxpUHJvZmlsZVNpbWlsYXJzID0gKHByb3NwZWN0LmxpbmtlZGluX3VybCkgPyBSZWFjdC5ET00uYSh7b25DbGljazogdGhpcy5vcGVuU2ltaWxhcnMsIHN0eWxlOiB7bWFyZ2luTGVmdDo1LCBmbG9hdDoncmlnaHQnfSwgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi14cyBidG4tcHJpbWFyeSBidG4tZ3JhZGllbnQgc2ltaWxhcl9saW5rXCJ9LCBcIiBcIiwgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jb3B5XCIsIHN0eWxlOiB7Zm9udFdlaWdodDonYm9sZCd9fSkpIDogXCJcIlxuICAgIFxuICAgIGlmKHR5cGVvZihwcm9zcGVjdF9uYW1lKSA9PSBcInN0cmluZ1wiKVxuICAgICAgaWYocHJvc3BlY3RfbmFtZS5pbmRleE9mKFwiLlwiKSAhPSAtMSB8fCBwcm9zcGVjdF9uYW1lID09IFwiTGlua2VkSW4gTWVtYmVyXCIpXG4gICAgICAgIHByb3NwZWN0X25hbWUgPSBSZWFjdC5ET00uc3BhbihudWxsLCBwcm9zcGVjdF9uYW1lLCBSZWFjdC5ET00uYnV0dG9uKHtjbGFzc05hbWU6IFwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiLCBzdHlsZToge21hcmdpbkxlZnQ6NSxtYXJnaW5Ub3A6LTQsd2lkdGg6MjUsZm9udFNpemU6MTEsbGluZUhlaWdodDoxfSwgb25DbGljazogdGhpcy5zZWFyY2hQcm9zcGVjdH0sIFwiIFwiLCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXNlYXJjaFwifSkpKVxuXG4gICAgb3B0aW9uc01lbnUgPSBSZWFjdC5ET00uZGl2KHtzdHlsZToge2ZvbnRTaXplOjEwLCBjdXJzb3I6J3BvaW50ZXInLGhlaWdodDoyMCxtYXJnaW5Ub3A6LTIwfX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2NsYXNzTmFtZTogXCJ0ZXh0LW11dGVkXCIsIG9uQ2xpY2s6IHRoaXMudG9nZ2xlRWRpdE1vZGV9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogKHRoaXMuc3RhdGUuZWRpdE1vZGUpID8gXCJmYSBmYS1jaGVja1wiIDogXCJmYSBmYS1wZW5jaWxcIn0pXG4gICAgICAgICAgICApLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtjbGFzc05hbWU6IFwidGV4dC1tdXRlZFwiLCBvbkNsaWNrOiB0aGlzLnNlYXJjaFByb3NwZWN0LCBzdHlsZToge21hcmdpblRvcDo1fX0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXNlYXJjaFwifSlcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2NsYXNzTmFtZTogXCJ0ZXh0LW11dGVkXCIsIG9uQ2xpY2s6IHRoaXMuYXJjaGl2ZVByb3NwZWN0cywgXG4gICAgICAgICAgICAgIHN0eWxlOiB7bWFyZ2luVG9wOjV9fSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJjaGl2ZVwifSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICBcbiAgICBrZXlib2FyZFNlbGVjdGVkID0ge2JvcmRlckxlZnQ6JzdweCBzb2xpZCByZ2JhKDAsMCwwLDApJ31cbiAgICAgICAgICAgIC8va2V5Ym9hcmRTZWxlY3RlZCA9IHt9XG4gICAgLy9cbiAgICBpZih0aGlzLnByb3BzLmtleWJvYXJkU2VsZWN0ZWQpIHtcbiAgICAgIGtleWJvYXJkU2VsZWN0ZWQgPSB7Ym9yZGVyTGVmdDonN3B4IHNvbGlkICMwMDk2ZmYgIWltcG9ydGFudCd9XG4gICAgfVxuICAgIFxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS50cih7Y2xhc3NOYW1lOiBcInByb3NwZWN0cy10clwiLCBcbiAgICAgICAgICBvbkNsaWNrOiB0aGlzLnJvd0NsaWNrLCBcbiAgICAgICAgICBvbk1vdXNlRW50ZXI6IHRoaXMubW91c2VFbnRlciwgXG4gICAgICAgICAgb25Nb3VzZUxlYXZlOiB0aGlzLm1vdXNlTGVhdmUsIFxuICAgICAgICAgIHN0eWxlOiBrZXlib2FyZFNlbGVjdGVkfSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY2hlY2tib3hDb2xvcn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaW5wdXQoe3R5cGU6IFwiY2hlY2tib3hcIiwgXG4gICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5jbGlja0NoZWNrLCBcbiAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7bGluZUhlaWdodDonbm9ybWFsJyxtYXJnaW5Ub3A6LTgsaGVpZ2h0OjE3fSwgXG4gICAgICAgICAgICAgICAgICAgICBjaGVja2VkOiBjaGVja2VkfSlcbiAgICAgICAgICApLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjaGVja2JveENvbG9yfSwgXG4gICAgICAgICAgICAodGhpcy5zdGF0ZS5tb3VzZU92ZXIpID8gb3B0aW9uc01lbnUgOiBSZWFjdC5ET00uZGl2KHtzdHlsZToge2hlaWdodDoyMH19LCBcIsKgwqDCoFwiKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNoZWNrYm94Q29sb3J9LCBcbiAgICAgICAgICAgKHRoaXMuc3RhdGUubG9hZGluZykgPyBMb2FkaW5nUHVsc2UobnVsbCkgOiBcIlwiLCBcbiAgICAgICAgICAgKCF0aGlzLnN0YXRlLmxvYWRpbmcgJiYgdGhpcy5zdGF0ZS5pbml0aWFsTG9hZGluZykgPyBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNoZWNrLWNpcmNsZSBcIiwgc3R5bGU6IHtjb2xvcjoncmdiKDAsIDEyMiwgMjY1KScscGFkZGluZ0xlZnQ6Nix9fSkgOiBcIlwiXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY29sb3IsIGNsYXNzTmFtZTogXCJmaXhlZC1kYXRhLWNvbHVtblwifSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7c3R5bGU6IHtmb250V2VpZ2h0Oidib2xkJ319LCBwcm9zcGVjdF9uYW1lKSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7Zm9udFdlaWdodDonNDAwJyxtYXJnaW46JzBweCd9fSwgXCIgXCIsIHBvc2l0aW9uLCBcIiBcIilcbiAgICAgICAgICApLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvciwgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIFwiIFwiLCBwcm9zcGVjdF9jb21wYW55X25hbWUsIFwiIFwiKSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7Zm9udFdlaWdodDonNDAwJyxtYXJnaW46JzBweCd9LCBjbGFzc05hbWU6IFwiY29tcGFueS1zaXplXCJ9LCBcbiAgICAgICAgICAgIGNvbXBhbnlfc2l6ZVxuICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7Zm9udFdlaWdodDonNDAwJyxtYXJnaW46JzBweCcsZGlzcGxheTonbm9uZScsZm9udFN0eWxlOidpdGFsaWMnfSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImNvbXBhbnktc2l6ZVwifSwgXG4gICAgICAgICAgICAgIChwcm9zcGVjdC5pbmR1c3RyeSkgPyBwcm9zcGVjdC5pbmR1c3RyeSA6IFwiXCJcbiAgICAgICAgICAgIClcbiAgICAgICAgICApLCBcblxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yfSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7bWFyZ2luOicwcHgnfX0sIGNpdHkpKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogaW5mb0NvbG9yfSwgXCIgXCIsIHByb3NwZWN0X2VtYWlsLCBcIiBcIiwgcGhvbmUsIFwiIFwiKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY29sb3J9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe3N0eWxlOiB7d2lkdGg6OTIscGFkZGluZ1RvcDo1LGhlaWdodDo1fX0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLm9wZW5MaW5rZWRpblByb2ZpbGUsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXhzIGJ0bi1wcmltYXJ5IGJ0bi1ncmFkaWVudCBsaW5rZWRpbl9saW5rXCIsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7ZmxvYXQ6J3JpZ2h0JyxtYXJnaW5MZWZ0OjV9fSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1saW5rZWRpbi1zcXVhcmVcIn0pKSwgXG4gICAgICAgICAgICAgIFwiwqAgwqBcIiwgXG4gICAgICAgICAgICAgIGxpUHJvZmlsZVNpbWlsYXJzLCBcbiAgICAgICAgICAgICAgY29tcGFueV91cmxcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApO1xuICB9LFxuXG4gIHNlYXJjaFByb3NwZWN0OiBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHVybCA9IFwiaHR0cDovL3d3dy5nb29nbGUuY29tLyNxPVwiXG4gICAgcHJvc3BlY3QgPSB0aGlzLnN0YXRlLnByb3NwZWN0XG4gICAgbmFtZSA9IChwcm9zcGVjdC5uYW1lICE9IFwiTGlua2VkSW4gTWVtYmVyXCIpID8gcHJvc3BlY3QubmFtZSA6IFwiXCJcbiAgICBhcmdzID0gJy1pbnVybDpcIi9kaXIvXCIgLWludXJsOlwiL2ZpbmQvXCIgLWludXJsOlwiL3VwZGF0ZXNcIidcbiAgICBpZihuYW1lID09IFwiXCIgJiYgcHJvc3BlY3QuY29tcGFueV9uYW1lICE9IFwibm90X2ZvdW5kXCIpXG4gICAgICBsaW5rZWRpbiA9ICdcImF0ICcrcHJvc3BlY3QuY29tcGFueV9uYW1lKydcIiBzaXRlOmxpbmtlZGluLmNvbSAnK2FyZ3NcbiAgICBlbHNlXG4gICAgICBsaW5rZWRpbiA9IFwiIHNpdGU6bGlua2VkaW4uY29tL2luLyBPUiBzaXRlOmxpbmtlZGluLmNvbS9wdWIvIC1zaXRlOmxpbmtlZGluLmNvbS9wdWIvZGlyL1wiXG4gICAgd2luZG93Lm9wZW4odXJsK25hbWUrXCIgXCIrcHJvc3BlY3QuY29tcGFueV9uYW1lK1wiIFwiK3Byb3NwZWN0LnRpdGxlK2xpbmtlZGluKVxuICB9LFxuXG4gIGFyY2hpdmVQcm9zcGVjdHM6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKHRoaXMuZ2V0RE9NTm9kZSgpKVxuICAgIC8vJCh0aGlzLmdldERPTU5vZGUoKSkuY2xpY2soKVxuICAgIHRoaXMucHJvcHMuYXJjaGl2ZVByb3NwZWN0cyhbdGhpcy5zdGF0ZS5wcm9zcGVjdC5vYmplY3RJZF0pXG4gIH0sXG5cbiAgdG9nZ2xlRWRpdE1vZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgdGhpcy5zZXRTdGF0ZSh7ZWRpdE1vZGU6ICF0aGlzLnN0YXRlLmVkaXRNb2RlfSlcbiAgfSxcblxuICBvcGVuVGVzdDogZnVuY3Rpb24oKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICB9LFxuXG4gIG9wZW5MaW5rZWRpblByb2ZpbGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB3aW5kb3cub3Blbih0aGlzLnN0YXRlLnByb3NwZWN0LmxpbmtlZGluX3VybClcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gIH0sXG5cbiAgZW1haWxJbnB1dENsaWNrOiBmdW5jdGlvbihlKSB7ZS5zdG9wUHJvcGFnYXRpb24oKSB9LFxuXG4gIG9wZW5TaW1pbGFyczogZnVuY3Rpb24oZSkge1xuICAgIC8vIFRPRE8gLSBtb3ZlIHRvIGJhY2tlbmRcbiAgICBjb25zb2xlLmxvZygnc2ltaWxhcnMnKVxuICAgIGlmKHRoaXMuc3RhdGUucHJvc3BlY3QubGlua2VkaW5fdXJsLmluZGV4T2YoJ3Byb2ZpbGUnKSAhPSAtMSl7XG4gICAgICB1cmxhcmdzID0gdGhpcy5zdGF0ZS5wcm9zcGVjdC5saW5rZWRpbl91cmwuc3BsaXQoJz8nKVsxXS5zcGxpdCgnJicpXG4gICAgICBhcmdzID0gW11cbiAgICAgIGZvcihpPTA7aTwgdXJsYXJncy5sZW5ndGg7IGkrKylcbiAgICAgICAgYXJncy5wdXNoKHVybGFyZ3NbaV0uc3BsaXQoJz0nKSlcbiAgICAgIGFyZ3MgPSBfLm9iamVjdChhcmdzKVxuICAgIH1cbiAgICB3aW5kb3cub3BlbihcImh0dHBzOi8vd3d3LmxpbmtlZGluLmNvbS92c2VhcmNoL3A/cGl2b3RUeXBlPXNpbSZwaWQ9XCIrYXJncy5pZClcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gIH0sXG5cbiAgZGVsZXRlUHJvc3BlY3Q6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHJvcHMuZGVsZXRlUHJvc3BlY3QodGhpcy5zdGF0ZS5wcm9zcGVjdC5vYmplY3RJZCwgJ1Byb3NwZWN0JylcbiAgfSxcbiAgXG4gIHVwZGF0ZVByb3NwZWN0OiBmdW5jdGlvbihwcm9wLCB2YWx1ZSkge1xuICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdFxuICAgIHByb3NwZWN0W3Byb3BdID0gdmFsdWVcbiAgICB0aGlzLnNldFN0YXRlKHtwcm9zcGVjdDogcHJvc3BlY3R9KVxuICB9LFxuICBcbiAgcmVmcmVzaDogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICBwcm9zcGVjdCA9IHRoaXMuc3RhdGUucHJvc3BlY3RcbiAgICBjb25zb2xlLmxvZyhwcm9zcGVjdClcblxuICAgICQuYWpheCh7XG4gICAgICAvL3VybDonaHR0cHM6Ly9uYW1lbGVzcy1yZXRyZWF0LTM1MjUuaGVyb2t1YXBwLmNvbS9wcm9maWxlX2RldGFpbCcsXG4gICAgICB1cmw6J2h0dHA6Ly8xMjcuMC4wLjE6NTAwMC9wcm9maWxlX2RldGFpbCcsXG4gICAgICB0eXBlOidHRVQnLFxuICAgICAgZGF0YVR5cGU6J2pzb24nLFxuICAgICAgZGF0YTogcHJvc3BlY3QsXG4gICAgICAvL2hlYWRlcnM6YXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsgY29uc29sZS5sb2cocmVzKX0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVyci5yZXNwb25zZVRleHQpIH1cbiAgICB9KVxuICB9LFxufSk7XG5cbnZhciBVc2VyVXBkYXRlRm9ybSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1VzZXJVcGRhdGVGb3JtJyxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VibWl0dGVkOiBmYWxzZSxcbiAgICAgIHZhbHVlOiB0aGlzLnByb3BzLnZhbHVlXG4gICAgfVxuICB9LFxuXG4gIGZvcm1DbGljazogZnVuY3Rpb24oZSkgeyBlLnN0b3BQcm9wYWdhdGlvbigpIH0sXG5cbiAgc3VibWl0Rm9ybTogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICB0aGlzLnByb3BzLnVwZGF0ZVByb3NwZWN0KHRoaXMucHJvcHMudmFyLCAkKGUudGFyZ2V0KS5maW5kKCdpbnB1dCcpLnZhbCgpKVxuICAgIHRoaXMuc2V0U3RhdGUoe3N1Ym1pdHRlZDogdHJ1ZX0pXG4gICAgcHJvc3BlY3QgPSB0aGlzLnByb3BzLnByb3NwZWN0XG4gICAgcHJvc3BlY3RbdGhpcy5wcm9wcy52YXJdID0gJChlLnRhcmdldCkuZmluZCgnaW5wdXQnKS52YWwoKVxuXG4gICAgLy8gcGVyc2lzdFxuICAgIGRhdGEgPSB7fVxuICAgIHZhcnIgPSB0aGlzLnByb3BzLnZhclxuICAgIHZhbCA9ICQoZS50YXJnZXQpLmZpbmQoJ2lucHV0JykudmFsKClcbiAgICBkYXRhW3ZhcnJdID0gdmFsXG4gICAgb2JqZWN0SWQgPSB0aGlzLnN0YXRlLnByb3NwZWN0Lm9iamVjdElkXG5cbiAgICAkLmFqYXgoe1xuICAgICAgLy91cmw6J2h0dHBzOi8vbmFtZWxlc3MtcmV0cmVhdC0zNTI1Lmhlcm9rdWFwcC5jb20vcHJvZmlsZV9kZXRhaWwnLFxuICAgICAgdXJsOidodHRwOi8vMTI3LjAuMC4xOjUwMDAvcHJvZmlsZV9kZXRhaWwnLFxuICAgICAgZGF0YTogcHJvc3BlY3QsXG4gICAgICAvL2hlYWRlcnM6YXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsgY29uc29sZS5sb2cocmVzKX0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVyci5yZXNwb25zZVRleHQpIH1cbiAgICB9KVxuXG4gICAgLypcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1Byb3NwZWN0Lycrb2JqZWN0SWQsXG4gICAgICB0eXBlOiAnUFVUJyxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsgY29uc29sZS5sb2cocmVzKSBcbiAgICAgICAgLy8gc2VudCBjdXJyZW50IHByb3NwZWN0IHN0YXRlIGFzIGRhdGEgdG8gXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOidodHRwczovL25hbWVsZXNzLXJldHJlYXQtMzUyNS5oZXJva3VhcHAuY29tL3Byb2ZpbGVfZGV0YWlsJyxcbiAgICAgICAgICBkYXRhOiBwcm9zcGVjdCxcbiAgICAgICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpfSxcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVyci5yZXNwb25zZVRleHQpIH1cbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVyci5yZXNwb25zZVRleHQpIH1cbiAgICB9KVxuICAgICovXG4gIH0sXG5cbiAgaGFuZGxlQ2hhbmdlOiBmdW5jdGlvbihldmVudCkge1xuICAgIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldC52YWx1ZSlcbiAgICB0aGlzLnNldFN0YXRlKHt2YWx1ZTogZXZlbnQudGFyZ2V0LnZhbHVlfSk7XG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICAvL1wiRW50ZXIgV2Vic2l0ZS5cIlxuICAgIGJ0biA9ICh0aGlzLnN0YXRlLnN1Ym1pdHRlZCkgPyBcImJ0biBidG4teHMgYnRuLXN1Y2Nlc3NcIiA6IFwiYnRuIGJ0bi14cyBidG4tZGVmYXVsdFwiXG4gICAgc2luZ2xlID0ge2Rpc3BsYXk6J2lubGluZScsIHdpZHRoOjIyLCBtYXJnaW5MZWZ0OjV9XG4gICAgc2luZ2xlLmRpc3BsYXkgPSAodGhpcy5wcm9wcy5zaW5nbGUpID8gJ25vbmUnIDogJ2lubGluZSdcbiAgICBpbnB1dCA9IHt3aWR0aDonMTAwJScsIGRpc3BsYXk6J2lubGluZScsIGhlaWdodDoyNCwgbWFyZ2luQm90dG9tOjZ9XG4gICAgaW5wdXQud2lkdGggPSAodGhpcy5wcm9wcy5zaW5nbGUpID8gJzEwMCUnIDogJzcwJSdcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmZvcm0oe29uQ2xpY2s6IHRoaXMuZm9ybUNsaWNrLCBvblN1Ym1pdDogdGhpcy5zdWJtaXRGb3JtfSwgXG4gICAgICAgIFJlYWN0LkRPTS5pbnB1dCh7c3R5bGU6IGlucHV0LCBcbiAgICAgICAgICB0eXBlOiBcInRleHRcIiwgY2xhc3NOYW1lOiBcImZvcm0tY29udHJvbCBpbnB1dC1zbVwiLCBcbiAgICAgICAgICBkaXNhYmxlZDogdGhpcy5zdGF0ZS5zdWJtaXR0ZWQsIFxuICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLmhhbmRsZUNoYW5nZSwgXG4gICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUudmFsdWUsIFxuICAgICAgICAgIHBsYWNlaG9sZGVyOiB0aGlzLnByb3BzLmZvcm1UZXh0fSksIFxuICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcInN1Ym1pdFwiLCBjbGFzc05hbWU6IGJ0biwgXG4gICAgICAgICAgc3R5bGU6IHNpbmdsZX0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2hlY2tcIn0pKVxuICAgICAgKVxuICAgIClcbiAgfSxcblxuICBwcm9maWxlU2VhcmNoOiBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgdXJsID0gXCJodHRwOi8vd3d3Lmdvb2dsZS5jb20vI3E9XCJcbiAgICBwcm9zcGVjdCA9IHRoaXMuc3RhdGUucHJvc3BlY3RcbiAgICBuYW1lID0gKHByb3NwZWN0Lm5hbWUgIT0gXCJMaW5rZWRJbiBNZW1iZXJcIikgPyBwcm9zcGVjdC5uYW1lIDogXCJcIlxuICAgIGFyZ3MgPSAnLWludXJsOlwiL2Rpci9cIiAtaW51cmw6XCIvZmluZC9cIiAtaW51cmw6XCIvdXBkYXRlc1wiJ1xuICAgIGlmKG5hbWUgPT0gXCJcIiAmJiBwcm9zcGVjdC5jb21wYW55X25hbWUgIT0gXCJub3RfZm91bmRcIilcbiAgICAgIGxpbmtlZGluID0gJ1wiYXQgJytwcm9zcGVjdC5jb21wYW55X25hbWUrJ1wiIHNpdGU6bGlua2VkaW4uY29tICcrYXJnc1xuICAgIGVsc2VcbiAgICAgIGxpbmtlZGluID0gXCIgc2l0ZTpsaW5rZWRpbi5jb20vaW4vIE9SIHNpdGU6bGlua2VkaW4uY29tL3B1Yi8gLXNpdGU6bGlua2VkaW4uY29tL3B1Yi9kaXIvXCJcbiAgICB3aW5kb3cub3Blbih1cmwrbmFtZStcIiBcIitwcm9zcGVjdC5jb21wYW55X25hbWUrXCIgXCIrcHJvc3BlY3QucG9zK2xpbmtlZGluKVxuICB9LFxuXG4gIHdlYnNpdGVTZWFyY2g6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB1cmwgPSBcImh0dHA6Ly93d3cuZ29vZ2xlLmNvbS8jcT1cIlxuICAgIHdpbmRvdy5vcGVuKHVybCt0aGlzLnN0YXRlLnByb3NwZWN0LmNvbXBhbnlfbmFtZStcIiBzaXRlOmxpbmtlZGluLmNvbS9jb21wYW55XCIpXG4gIH0sXG5cbiAgX21ha2VfZW1haWw6IGZ1bmN0aW9uKG5hbWUsIHBhdHRlcm4pIHtcbiAgICBuYW1lID0gbmFtZS50cmltKClcbiAgICB2YXJzID0ge1xuICAgICAgZmlyc3RfbmFtZTogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpLFxuICAgICAgbGFzdF9uYW1lOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKSxcbiAgICAgIGZpcnN0X2luaXRpYWw6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKVswXSxcbiAgICAgIGxhc3RfaW5pdGlhbDogXy5sYXN0KG5hbWUuc3BsaXQoJyAnKSlbMF0sXG4gICAgICBkb21haW46IHByb3NwZWN0LmNvbXBhbnkuZG9tYWluXG4gICAgfVxuICAgIHBhdHRlcm4gPSAocGF0dGVybikgPyBwYXR0ZXJuWzBdLnBhdHRlcm4gOiBcIlwiXG4gICAgcHJvc3BlY3RfZW1haWwgPSBNdXN0YWNoZS5yZW5kZXIocGF0dGVybiwgdmFycykudG9Mb3dlckNhc2UoKVxuICAgIC8vY29uc29sZS5kZWJ1ZygnUFJPU1BFQ1QgRU1BSUwnKVxuICAgIC8vY29uc29sZS5kZWJ1Zyhwcm9zcGVjdF9lbWFpbClcbiAgICByZXR1cm4gUmVhZE9ubHlGb3JtKHtpY29uOiBcImVudmVsb3BlXCIsIHZhbHVlOiBwcm9zcGVjdF9lbWFpbH0pXG5cbiAgICBpZihwcm9zcGVjdF9lbWFpbCkge1xuICAgICAgICBwcm9zcGVjdF9lbWFpbCA9IChwcm9zcGVjdF9lbWFpbCkgPyBwcm9zcGVjdF9lbWFpbC50b0xvd2VyQ2FzZSgpIDogXCJcIlxuICAgICAgICBwcm9zcGVjdF9lbWFpbCA9IFJlYWN0LkRPTS5pbnB1dCh7b25DbGljazogdGhpcy5lbWFpbElucHV0Q2xpY2ssIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogcHJvc3BlY3RfZW1haWwsIGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2wgZm9ybS1zbVwiLCBzdHlsZToge2ZvbnRTaXplOjEyLCB3aWR0aDoxNjAsIGhlaWdodDoyMiwgbWFyZ2luVG9wOiAwfX0pXG4gICAgICAgIHByb3NwZWN0X2VtYWlsID0gUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImlucHV0LWdyb3VwIGlucHV0LWdyb3VwLXhzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcImlucHV0LWdyb3VwLWFkZG9uXCIsIGlkOiBcInNpemluZy1hZGRvbjNcIiwgc3R5bGU6IHtwYWRkaW5nVG9wOjIscGFkZGluZ0JvdHRvbToyfX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1lbnZlbG9wZVwifSlcbiAgICAgICAgICApLCBcbiAgICAgICAgICBwcm9zcGVjdF9lbWFpbFxuICAgICAgICApXG4gICAgfVxuICAgIHJldHVybiBlbWFpbFxuICB9LFxufSlcblxudmFyIFJlYWRPbmx5Rm9ybSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1JlYWRPbmx5Rm9ybScsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgc3R5bGUgPSB7Zm9udFNpemU6MTIsIHdpZHRoOic3MCUnLCBoZWlnaHQ6MjIsIG1hcmdpblRvcDogMCwgekluZGV4OjEsY3Vyc29yOidkZWZhdWx0J31cblxuICAgIHN0eWxlLmZvbnRTdHlsZSA9ICh0aGlzLnByb3BzLmRpc2FibGVkKSA/ICdpdGFsaWMnIDogJydcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImlucHV0LWdyb3VwIGlucHV0LWdyb3VwLXhzXCIsIHN0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJ319LCBcbiAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJpbnB1dC1ncm91cC1hZGRvblwiLCBpZDogXCJzaXppbmctYWRkb24zXCIsIFxuICAgICAgICAgIHN0eWxlOiB7cGFkZGluZ1RvcDoyLHBhZGRpbmdCb3R0b206MixkaXNwbGF5OidpbmxpbmUtYmxvY2snLFxuICAgICAgICAgICAgICAgICAgaGVpZ2h0OjIyLHdpZHRoOjM3LGZsb2F0OidsZWZ0JyxtYXJnaW5Ub3A6MH19LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLVwiK3RoaXMucHJvcHMuaWNvbn0pXG4gICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS5pbnB1dCh7ZGlzYWJsZWQ6IHRoaXMucHJvcHMuZGlzYWJsZWQsIG9uQ2xpY2s6IHRoaXMuZW1haWxJbnB1dENsaWNrLCB0eXBlOiBcInRleHRcIiwgdmFsdWU6IHRoaXMucHJvcHMudmFsdWUsIGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2wgZm9ybS1zbVwiLCBzdHlsZTogc3R5bGV9KVxuICAgICAgKVxuICAgIClcbiAgfSxcbiAgZW1haWxJbnB1dENsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICB9XG59KVxuXG52YXIgTG9hZGluZ0xhYmVsID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTG9hZGluZ0xhYmVsJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00ubGFiZWwoe2NsYXNzTmFtZTogXCJsYWJlbCBsYWJlbC1wcmltYXJ5XCIsIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOiAncmdiKDAsIDEyMiwgMjY1KSd9fSwgXCJMb2FkaW5nLi4uXCIpXG4gICAgKVxuICB9ICAgXG59KVxuXG52YXIgV2FybmluZ0xhYmVsID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnV2FybmluZ0xhYmVsJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00ubGFiZWwoe2NsYXNzTmFtZTogXCJsYWJlbCBsYWJlbC13YXJuaW5nXCIsIHN0eWxlOiB7ZGlzcGxheTonYmxvY2snLHdpZHRoOic5MCUnfX0sIFwiV2FybmluZy4uLlwiKVxuICAgIClcbiAgfSAgIFxufSlcblxudmFyIFNoaW55QnV0dG9uID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnU2hpbnlCdXR0b24nLFxuICBvcGVuTGluazogZnVuY3Rpb24oZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICB3aW5kb3cub3Blbih0aGlzLnByb3BzLmxpbmspXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICBvbkNsaWNrOiB0aGlzLm9wZW5MaW5rLCBcbiAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXhzIGJ0bi1wcmltYXJ5IGJ0bi1ncmFkaWVudFwiLCBcbiAgICAgICAgIHN0eWxlOiB7bWFyZ2luTGVmdDotNSwgZmxvYXQ6J3JpZ2h0J319LCBcbiAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWdsb2JlXCJ9KVxuICAgICAgKVxuICAgIClcbiAgfVxufSlcblxudmFyIExvYWRpbmdQdWxzZSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0xvYWRpbmdQdWxzZScsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwcm9maWxlLWxvYWRpbmdcIiwgc3R5bGU6IHttYXJnaW5Ub3A6MH19LCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRvdWJsZS1ib3VuY2UxXCIsIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOidyZ2IoMCwgMTIyLCAyNjUpJ319KSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJkb3VibGUtYm91bmNlMlwiLCBzdHlsZToge2JhY2tncm91bmRDb2xvcjoncmdiKDAsIDEyMiwgMjY1KSd9fSlcbiAgICAgIClcbiAgICApXG4gIH1cbn0pXG4iXX0=
