(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    currentUser = JSON.parse(localStorage.currentUser)
    data =  {
      name : $('#listTitle').val().trim(),
      user : appConfig.pointer('_User', currentUser.objectId),
      company: currentUser.company
    }

    thiss = this;
    listClassName = (this.props.listClassName) ? this.props.listClassName : 'ProspectList'
    $.ajax({
      url:'https://api.parse.com/1/classes/'+listClassName,
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) { console.log(res) },
      error: function(err) { console.log(err) }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-example-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Create List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.createMiningJob}, 
                    React.DOM.input({id: "listTitle", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", onClick: this.createListButtonClick, placeholder: "Enter City Area...", className: "btn btn-success", style: {display:'block', width:'100%'}}, "Create List")
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],2:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  deleteList: function() {
    this.props.deleteList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-deleteList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-trash-o"}), "  Delete List?")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({className: "deleteForm", onSubmit: this.deleteList}, 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-danger", 
                      style: {display:'block', width:'100%'}}, 
                      "Delete"
                    ), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-default", 
                      style: {display:'block', width:'100%'}}, 
                      "Cancel"
                    )
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],3:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // LoadingSpinner
  render: function() {
    return (
    React.DOM.div({className: "spinner", style: {marginTop:'180px'}}, 
      React.DOM.div({className: "spinner-container container1"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container2"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container3"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      )
    )
    )
  }
});

},{}]},{},[1])


},{}],4:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //Messenger
  render: function() {
    return (
        React.DOM.div({className: "alert alert-success", 
             'data-alert': "alert", 
             style: {position:'absolute',
                     top: 31, 
                     right:30, 
                     display:'none',
                     width:200}}, 
                     React.DOM.a({className: "close", 
                       href: "javascript:", 
                       onClick: this.hideAlert}, "×"), 
            "Test"
        )
    );
  }
});

},{}]},{},[1])


},{}],5:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Panel Footing
  paginatePrevious: function() {
    var thiss = this;

    qry = {
      where: JSON.stringify({
        company: appConfig.company,
        archived: true,
      }),
      count: 1,
      skip: (thiss.props.currentPage-2)*thiss.props.prospectsPerPage,
      limit: thiss.props.prospectsPerPage
    }
    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect',
      type:'GET',
      beforeSend: function() {
        console.log('before Send')
        thiss.props.setPaginate(true)
      },
      headers: appConfig.parseHeaders,
      data: qry,
      success: function(res){
        //thiss.setState({prospects: res.results})
        //thiss.setState({currentPage: this.props.currentPage - 1})
        thiss.props.paginate(res.results, thiss.props.currentPage - 1)
        thiss.props.setPaginate(false)
      },
      error: function(res){ console.log(res) }
    });
  },


  paginate: function(direction) {
    prospectsPerPage = this.props.prospectsPerPage
    if(direction=='previous')
      skip = (this.props.currentPage - 2)*prospectsPerPage
    else if(direction=="forward")
      skip = this.props.currentPage*prospectsPerPage

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect?skip='+skip,
      type:'GET',
      headers: parse_headers,
      data: 'where={"company":'+appConfig.company+'}&count=1',
      success: function(res){
        //thiss.setState({prospects: res.results})
        //thiss.setState({currentPage: this.props.currentPage + 1})
        this.props.paginate(res.results, this.props.currentPage + 1)
      },
      error: function(res){
        console.log(res)
      }
    });
  },

  paginateForward: function() {
    var thiss = this;
    qry = {
      where: JSON.stringify({
        company: appConfig.company,
        //user: appConfig.user,
        archived: true
      }),
      count: 1,
      skip: thiss.props.currentPage*thiss.props.prospectsPerPage,
      limit: thiss.props.prospectsPerPage,
    }

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect',
      type:'GET',
      headers: appConfig.parseHeaders,
      data: qry,
      beforeSend: function() {
        thiss.props.setPaginate(true)
      },
      success: function(res){
        console.log(res.results)
        console.log("success")
        thiss.props.paginate(res.results, thiss.props.currentPage + 1)
        thiss.props.setPaginate(false)
      },
      error: function(res){ console.log(res); }
    });
  },

  componentDidMount: function() {
    paginateForward = this.paginateForward
    paginatePrevious = this.paginatePrevious

    Mousetrap.bind('l', function() { 
      console.log('new forward')
      paginateForward()
    });

    Mousetrap.bind('h', function() { 
      console.log('new back')
      paginatePrevious()
    });
  },

  render: function() {
    // Should be handled by Panle Footing

    lastPage = this.props.currentPage == this.props.pages
    lessThanOnePage = this.props.count < this.props.prospectsPerPage
    forward = (lastPage || lessThanOnePage) ? 'disabled' : ''

    previous = (this.props.currentPage - 1) ? '' : 'disabled'

    lowerLimit = (this.props.currentPage-1)*this.props.prospectsPerPage
    upperLimit = this.props.currentPage*this.props.prospectsPerPage

    lowerLimit = (lowerLimit) ? lowerLimit : 1
    upperLimit = (upperLimit > this.props.count) ? this.props.count : upperLimit

    return (
      React.DOM.div({className: "panel-footing", 
           id: "navbar", 
           style: {height:'35px',padding:'0px', paddingTop:'7px'}}, 
          React.DOM.span({style: {float:'right',marginRight:'20px'}}, 
            React.DOM.a({href: "javascript:", 
               style: {marginRight:'5px'}, 
               onClick: this.paginatePrevious, 
               className: "blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-fast-backward"})
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginatePrevious, 
             className: "paginate-back-btn blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-chevron-left"})
          ), 
          React.DOM.span({style: {marginLeft:5, marginRight:5,display:'inline-block',width:115, textAlign:'center'}}, 
            lowerLimit+' - '+upperLimit+' of '+this.props.count
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginateForward, 
             className: "paginate-forward-btn blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-chevron-right"})
          ), 
          React.DOM.a({href: "javascript:", 
             style: {marginLeft:'5px'}, 
             onClick: this.paginateForward, 
             className: "blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-fast-forward"}))
          )
        )
    );
  }
});

},{}]},{},[1])


},{}],6:[function(require,module,exports){
/** @jsx React.DOM */

//TODO - abstract lists
var SideMenuProspects = require('./side_menu_user_prospects.js.min.js');

var UserProspect = require('./user_prospect.js.min.js');
var UserProspectHeader = require('./user_prospect_header.js.min.js');
var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var LoadingSpinner = require('./loading_spinner.js.min.js')
var Spinner = require('./spinner.js.min.js')
var PanelFooting = require('./panel_footing.js.min.js')
var Messenger = require('./messenger.js.min.js')

var DeleteListModal = require('./delete_list_modal.js.min.js')
var RenameListModal = require('./rename_list_modal.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {  prospects   : [],
              currentPage : 1,
              className: 'Prospect',
              listClassName: 'ProspectList',
              pages       : 1,
              currentList : 'All',
              currentListObjectId : '',
              loading: true,
              paginating: false,
              prospectsPerPage: 50,
              downloading: false,
              lists : [],
              masterCheckboxChecked: false,
              keyboardActiveProspect: 0, //first
              selectedProspects: [],
              totalCount  : "~", 
              count       : "~", }
  },

  createList: function(data) {
    lists = this.state.lists
    lists = [data].concat(lists)
    this.setState({ lists: lists })
  },

  renameList: function(newListName) {
    // Update Local State
    thiss = this;
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.name == thiss.state.currentList){
        item.name = newListName
        return item
      }
      return item
    });

    this.setState({lists : filtered, currentList: newListName})

    $('.modal').click()
    $('#newListName').val('')
    $('.modal-backdrop').click()

    // Persist / Ajax
    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList/'+thiss.state.currentListObjectId,
      headers: appConfig.parseHeaders,
      type:'PUT',
      data:JSON.stringify({'name':newListName}),
      success: function(res) { console.log(res) },
      error: function(err) { console.log(err) }
    });
  },

  deleteList: function() {
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.objectId == thiss.state.currentListObjectId)
        return false
      return true
    });

    this.setState({lists: filtered, currentList: 'All'})
    this.changeList('All', '')

    // Remove
    appConfig.closeModal()
    $('#newListName').val('')

    // Persist / Ajax
    var thiss = this;
    $.ajax({
      url: appConfig.url+'ProspectList/'+thiss.state.currentListObjectId,
      headers: appConfig.parseHeaders,
      type:'DELETE',
      success: function(res) { console.log(res) },
      error: function(err) { console.log(err) }
    });
  },

  setPaginate: function(value) {
    this.setState({paginating: value})
  },

  setDownloading: function(value) {
    this.setState({downloading: value})
  },

  changeList: function(newListName,objectId) {
    // add overlay loading
    //console.log(newListName)
    //console.log(objectId)

    localStorage.selectedProspects = JSON.stringify([])

    this.setState({currentList : newListName})
    this.setState({currentListObjectId : objectId})
    this.setState({prospects  : []    })
    this.setState({count      : '~'   })
    this.setState({pages      : 1     })
    this.setState({loading    : true  })
    this.setState({currentPage: 1})
    this.setState({keyboardActiveProspect: 0})

    company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
    qry = 'where={"company":'+company+',"archived":true}&count=1&order=-createdAt'
    console.log(newListName)

    if(this.state.currentList != 'All' || typeof(objectId) != "undefined" && newListName != 'Archived'){
      currentList = JSON.stringify({
        'objectId'  : objectId, 
        '__type'    : 'Pointer', 
        'className' : 'ProspectList' 
      })

      company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
      qry = 'where={"company":'+company+'}&count=1'
      qry = 'where={"lists":'+currentList+'}&count=1&order=-createdAt&include=email_guesses,email_guesses.pattern'
    } else if (newListName == 'Archived') {
      qry = 'where={"company":'+company+',"archived":false}&count=1&order=-createdAt&include=email_guesses,email_guesses.pattern'
    }
    console.log(qry)
    var thisss = this;

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect',
      type:'GET',
      headers: appConfig.parseHeaders,
      async: true,
      data: qry,
      ajaxStart: function() {
        console.log('started list')
      },
      success: function(res){
        thisss.setState({prospects: res.results})
        thisss.setState({count: res.count})
        //thisss.setState({totalCount: res.count})
        thisss.setState({pages: Math.ceil(res.count/thisss.props.prospectsPerPage)})
        thisss.setState({loading: false})
      },
      error: function(res){
        //console.log('error')
        //console.log(res)
      }
    })
  },

  checkboxAction: function(checkedState, objId) {
    /* Storing Checked Prospects In LocalStorage To Make it Easier To
     * Copy and Move Prospects 
     *
     * Move To User_Prospects?
     */
    
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    //console.log(checkedState)
    if(checkedState)
      selectedProspects.push(objId)
    else
      selectedProspects = _.reject(selectedProspects, 
                                   function(id){return id == objId})

    selectedProspects = _.uniq(selectedProspects)
    console.log(selectedProspects)
    localStorage.selectedProspects = JSON.stringify(selectedProspects)
    this.setState({selectedProspects: selectedProspects})
  },

  masterCheckboxChanged: function(masterCheckboxValue) {
    this.setState({masterCheckboxChecked: masterCheckboxValue})
  },

  render: function() {
    this.startKeyboardShortcuts()
    $('body').css({overflow:'auto'})

    prospects = []
    for(i=0;i< this.state.prospects.length;i++) {
      url = this.state.prospects[i].url
      prospect = this.state.prospects[i]

      if(url != "no linkedin website" && typeof(url) != "undefined" && url != ""){
        url = url.replace('http://','')
        the_link = React.DOM.a({href: 'http://'+url}, React.DOM.i({className: "fa fa-globe"}))
      } else {
        the_link = ""
      }

      profile = this.state.prospects[i].linkedin_url.replace('http://','')
      profile = this.state.prospects[i].linkedin_url.replace('https://','')
      li = React.DOM.a({href: 'http://'+profile, className: "linkedin_link"}, React.DOM.i({className: "fa fa-linkedin-square"}))

      keyboardSelected = (i == this.state.keyboardActiveProspect)

      selectedProspects = JSON.parse(localStorage.selectedProspects)
      alreadyChecked=false
      for(ii=0;ii< selectedProspects.length;ii++)
        if(prospect.objectId == selectedProspects[ii])
          alreadyChecked = true

        //console.log(alreadyChecked)

      prospects.push(
        UserProspect({deleteProspect: this.deleteProspect, 
                      prospect: this.state.prospects[i], 
                      masterCheckboxChecked: this.state.masterCheckboxChecked, 
                      key: this.generate_id(), 
                      link: the_link, 
                      keyboardSelected: keyboardSelected, 
                      checkboxAction: this.checkboxAction, 
                      alreadyChecked: alreadyChecked, 
                      li: li}))
    }

    listType = (this.state.currentList == "All") ? {display:'none'} : {float:'left'}
    listNameStyle = (this.state.currentList == "All") ? {display:'none'} : {float:'left',display:'inline-block', fontWeight: 200, marginTop: 1, paddingRight: 10, marginLeft: -10}
    listBtn = (this.state.currentList == "All") ? {display:'none'} : {float:'left',marginLeft:5}
    listOptions = (this.state.currentList == "All") ? {display:'none'} : {float:'right'}
    copyDropdownStyle = (this.state.currentList == "All") ? {width:114, right:4} : {width:114, right:36}
    currentList = this.state.currentList
    paginateOverlay = (this.state.paginating) ? PaginateOverlay(null) : ""

    downloadIcon = (!this.state.downloading) ? React.DOM.i({className: "fa fa-download"}) : Spinner({circleStyle: {backgroundColor:'white',height:4,width:4}, spinnerStyle: {height:13, width:13,margin:0,display:'inline-block',paddingTop:2}})
    return (
        React.DOM.div(null, 
      React.DOM.div({className: "container", style: {width:'100%',padding:'0', background: 'linear-gradient(#dae8ff,#dae8ff)', backgroundImage: 'radial-gradient(circle at center center,#fff,#dff1fd 900px)'}}, 
        SideMenuProspects({currentList: this.state.currentList, 
                           count: this.state.count, 
                           totalCount: this.state.totalCount, 
                           changeList: this.changeList, 
                           createList: this.createList, 
                           lists: this.state.lists}), 

        React.DOM.div({className: "col-ld-10 col-md-10 col-sm-10 col-xs-10", 
             style: {padding:'0'}}, 
              paginateOverlay, 
              React.DOM.div({id: "prospectDetailButtons"}, 
                ListDetailButtons({
                  renameList: this.renameList, 
                  deleteList: this.deleteList, 
                  currentListName: this.state.currentList, 
                  currentList: this.state.currentListObjectId}), 

                React.DOM.div({className: "dropdown", style: {display:'none'}}, 
                  React.DOM.a({href: "javascript:", 
                     className: "btn btn-primary btn-xs list-options", 
                     id: "", 
                     style: listOptions}, 
                    React.DOM.i({className: "fa fa-bars"})
                  )
                ), 

                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     id: "copyToList", 
                     href: "javascript:", 
                     className: "drop-target btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-copy"}), 
                       "  Copy To List  ",  
                     React.DOM.i({className: "fa fa-caret-down"})
                ), 
                CurrentListsTwo({lists: this.state.lists, 
                                 copyDropdownStyle: copyDropdownStyle, 
                                 listAction: this.copySelectedProspects})
                ), 
  
                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     href: "javascript:", 
                     id: "moveToList", 
                     style: listOptions, 
                     className: "btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-share"}), 
                     "  Move To List  ",  
                     React.DOM.i({className: "fa fa-caret-down"})
                ), 
                CurrentLists({lists: this.state.lists, 
                              listAction: this.moveSelectedProspects})
                ), 

                React.DOM.a({onClick: this.downloadFile, 
                   href: "javascript:", 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                   downloadIcon, 
                   "  Download CSV  " 
                ), 

                React.DOM.a({onClick: this.downloadFile, 
                     style: listOptions, 
                   href: "javascript:", 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                  React.DOM.i({className: "fa fa-building"}), "   Generate Company List  " 
                )
              ), 
        

          React.DOM.div({id: "autoscroll", style: {height:'400px',overflow:'auto'}}, 
            React.DOM.table({className: "prospects-table table table-striped", style: {marginBottom:'0px'}}, 
              React.DOM.thead({style: {backgroundColor:'white'}}, 
                UserProspectHeader({masterCheckboxChanged: this.masterCheckboxChanged})
              ), 
              React.DOM.tbody(null, 
                prospects
              )
            ), 
            (this.state.loading) ? LoadingSpinner(null) : ""
          )
        )
      ), 

      PanelFooting({currentPage: this.state.currentPage, 
                    count: this.state.count, 
                    paginate: this.paginate, 
                    prospectsPerPage: this.state.prospectsPerPage, 
                    setPaginate: this.setPaginate, 
                    pages: this.state.pages}), 
      Messenger(null)
    )
    );
  },

  paginate: function(newProspects, newPage) {
    this.setState({
      prospects: newProspects,
      currentPage: newPage,
      keyboardActiveProspect: 0
    })
    this.startKeyboardShortcuts()
    document.getElementById('autoscroll').scrollTop = 0
  },

  downloadFile: function() {
    list = {
      '__type'   :  'Pointer',
      'className':  'ProspectList',
      'objectId' :  this.state.currentListObjectId
    }
    localStorage.download_total = Math.ceil(this.state.count/1000)
    localStorage.downloads      = 0

    if(this.state.currentList == "All") {
      qry = {
        where : JSON.stringify({
          company: appConfig.company
        }),
        count: 1,
        archived: true,
      }
    } else {
      qry = {
        where: JSON.stringify({
          lists: list
        }),
        count: 1,
        archived: true,
      }
    }

    var thiss = this;
    for(i=0;i< Math.ceil(this.state.count/1000); i++){
      $.ajax({
        url: 'https://api.parse.com/1/classes/Prospect?limit=1000&skip='+i,
        type:'GET',
        headers: appConfig.parseHeaders,
        beforeSend: function() {
          thiss.setState({downloading: true})
        },
        downloadFile: 'download_'+i,
        data: qry,
        success: function(res){
          for(i=0;i< res.results.length;i++) {
            delete res.results[i].company
            delete res.results[i].pos
            delete res.results[i].user
            delete res.results[i].objectId
            delete res.results[i].createdAt
            delete res.results[i].updatedAt
          }

          // Add Results To LocalStorage
          localStorage.downloads = JSON.parse(localStorage.downloads) + 1 
          localStorage.setItem(this.downloadFile, JSON.stringify(res.results))

          // Check to see if all ajax reqs in for loop are complete
          if(localStorage.downloads == localStorage.download_total) {
            console.log('matched')
            // Merge all localStorage results
            prospects = []
            for(ii=0;ii < JSON.parse(localStorage.download_total); ii++){
              prospects = prospects.concat(JSON.parse(localStorage.getItem('download_'+ii)))
              console.log(prospects)
            }

            console.log(prospects)
            // Output as CSV
            var blob = new Blob([Papa.unparse(prospects)], {type: "text/plain;charset=utf-8"});
            console.log(blob)
            saveAs(blob, "prospects.csv");
            thiss.setState({downloading: false})
          }
      },

      error: function(res){
        console.log(res)
      }
      });
    }
    
    company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
    

  },

  removeSelectedProspects: function() {
    // If List Type is All Archive the prospect
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []

    for(i=0;i< selectedProspects.length;i++){
      if(this.state.currentList != 'All'){
        tmp = {
          method:'PUT',
          path:'/1/classes/Prospect/'+selectedProspects[i],
          body: {
            lists: {
              '__op'    : 'Remove',
              "objects" : [{ 
                  '__type':'Pointer',
                  'className':'ProspectList',
                  'objectId':this.state.currentListObjectId
              }]
            }
          }
        }
      }else{
        tmp = {
          method:'PUT',
          path:'/1/classes/Prospect/'+selectedProspects[i],
          body: {
            archived:false,
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        lists = thiss.state.lists

        for(i=0;i< lists.length; i++) { 
          // Subtract From Old List - Not Working For Archive
          if(lists[i].objectId == thiss.state.currentListObjectId)
            lists[i].count = parseInt(lists[i].count) - parseInt(selectedProspects.length)
        }
        // Update local list count
        thiss.setState({lists: lists})

        // remove from current list ui
        selectedProspects = JSON.parse(localStorage.selectedProspects)
        console.log('remove selected prospects')
        console.log(selectedProspects)
        console.log(thiss.state.prospects)
        var filtered = _.filter(thiss.state.prospects, function(item) {
          for(i=0;i< selectedProspects.length;i++) 
            if(item.objectId == selectedProspects[i])
              return false
          return true
        });
        console.log(filtered)
        thiss.setState({prospects: filtered})
        localStorage.selectedProspects = JSON.stringify([])

        // add alert to inform user
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  moveSelectedProspects: function(listObjectId) {
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    // get the selected objectId from selectedProspects state
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []


    // Batch Update Parse
    // - Remove All Selected Prospects From Current List
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospect/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'Remove',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':this.state.currentListObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }
    
    // - Add Other List 
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospect/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'AddUnique',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':listObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        lists = thiss.state.lists

        for(i=0;i< lists.length; i++) { 
          // Add To New List
          if(lists[i].objectId == listObjectId)
            lists[i].count = parseInt(lists[i].count) + parseInt(selectedProspects.length)
          // Subtract From Old List
          if(lists[i].objectId == thiss.state.currentListObjectId)
            lists[i].count = parseInt(lists[i].count) - parseInt(selectedProspects.length)
        }
        // Update local list count
        thiss.setState({lists: lists})

        // remove from current list ui
        console.log('selectedProspects')
        console.log(thiss.state.prospects)
        var filtered = _.filter(thiss.state.prospects, function(item) {
          is_selected = true
          for(i=0;i< selectedProspects.length;i++) 
            if(item.objectId == selectedProspects[i])
              is_selected = false
          return is_selected
        });
        console.log(filtered)
        thiss.setState({prospects: filtered})
        localStorage.selectedProspects = JSON.stringify([])

        // add alert to inform user
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  copySelectedProspects: function(listObjectId) {
    console.log(listObjectId)
    
    // make batch ajax request to parse
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    // Add Loading Sign To List

    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospect/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'AddUnique',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':listObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        // Update With the number of successes
        // Update local list count
        lists = thiss.state.lists
        for(i=0;i< lists.length; i++) { 
          if(lists[i].objectId == listObjectId)
            lists[i].count = parseInt(lists[i].count) + parseInt(res.length)
        }
        thiss.setState({lists: lists})
        localStorage.selectedProspects = "[]"
        thiss.setState({selectedProspects : [] })
        
        // add alert to inform user
        // Unselect all selected
      },
      error: function(err) {
        console.log(err)
      }
    });

  },

  hideAlert: function() {
    $('.alert').hide()
  },

  adjustHeight: function(whichOne) {
    prospectWindowTop = $('#prospectDetailButtons').position().top
    prospectWindowTop = prospectWindowTop + $('#prospectDetailButtons').height()
    prospectWindowBottom = $('#autoscroll').position().top + $('#autoscroll').height()

    if(whichOne == 'j')
      activeProspect = this.state.keyboardActiveProspect +1 
    else
      activeProspect = this.state.keyboardActiveProspect -1 

    activeTop = $($('.prospects-tr')[activeProspect]).position().top
    selectedHeight = $($('.prospects-tr')[activeProspect]).height()
    activeBottom = $($('.prospects-tr')[activeProspect]).position().top+selectedHeight

    console.log(prospectWindowTop, prospectWindowBottom)
    console.log(activeTop, activeBottom)

    scrollTop = document.getElementById('autoscroll').scrollTop
    if(activeBottom > prospectWindowBottom)
      document.getElementById('autoscroll').scrollTop = scrollTop + activeBottom - prospectWindowBottom

    if(activeTop < 0)
      document.getElementById('autoscroll').scrollTop = scrollTop + activeTop - 37
    else if(activeTop == $($('.prospects-tr')[0]).position().top)
      document.getElementById('autoscroll').scrollTop = 0
      
    // Get Postion of Top
    // Get Position of Bottom 
    // Get Position of Current Selected
    // Adjust by scrolling down or up
  },

  startKeyboardShortcuts: function() {
    /* Keyboard Shortcuts */
    Mousetrap.reset()
    //Mousetrap.unbind(['j','k','o'])
    thiss = this;

    /* Prospect Table Shortcuts */
    Mousetrap.bind('j', function() { 
      keyboard = thiss.state.keyboardActiveProspect
      if(keyboard != thiss.state.prospectsPerPage+1)
        thiss.adjustHeight('j')
        thiss.setState({keyboardActiveProspect: keyboard+1})
    });

    Mousetrap.bind('k', function() { 
      keyboard = thiss.state.keyboardActiveProspect
      if(keyboard != 1)
        thiss.adjustHeight('k')
        thiss.setState({keyboardActiveProspect: keyboard-1})
    });


    Mousetrap.bind('o', function() { 
      console.log('open current prospect')
      console.log($($('.keySelect').find('a.linkedin_link')[0]).attr('href'))
      link = $($('.keySelect').find('a.linkedin_link')[0]).attr('href')
      /*
      window.open(link, '_blank')
      console.log('new')
      */
      //popupWindow.blur();
      //window.focus();
      // keyboard = thiss.state.keyboardActiveProspect
      
      var a = document.createElement("a");
      a.href = link
      var evt = document.createEvent("MouseEvents");
      //the tenth parameter of initMouseEvent sets ctrl key
      // For Mac This Works Check For - Windows
      evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0,
                                  false, false, false, true, 0, null);
      a.dispatchEvent(evt);
    });



    /* List Modification Shortcuts */
    Mousetrap.bind('tab+r', function(){
      //console.log('reload')
      $('#renameListBtn').click()
    })

    Mousetrap.bind('tab+d', function(){
      //console.log('reload')
      $('#deleteListModal').click()
    })

    Mousetrap.bind('tab+s', function(){
      //console.log('reload')
      //$('#downloadProspects').click()
      thiss.downloadFile()
    })

    Mousetrap.bind('shift+l', function(){
      //console.log('reload')
      //$('#downloadProspects').click()
      //thiss.downloadFile()
      $('.new-list-btn').click()
    })

    Mousetrap.bind('e', function(){
      console.log('reload')
      //$('#downloadProspects').click()
      thiss.removeSelectedProspects()
    })

    Mousetrap.bind('c', function() { 
      console.log('copy')
      $('#copyToList').click()
    });

    Mousetrap.bind('m', function() { 
      console.log('copy')
      $('#moveToList').click()
    });

    //Mousetrap.bind('e', function() { console.log('e'); });
    Mousetrap.bind('right', function() { console.log('right'); });
    Mousetrap.bind('left', function() { console.log('left'); });

  },

  componentDidMount: function() {
    /* OnLoad For The First Time Function */
    var thisss = this;
    localStorage.selectedProspects = JSON.stringify([])
    currentUser = JSON.parse(localStorage.currentUser)
    user = appConfig.pointer('User', currentUser.objectId)

    archiveList = JSON.stringify({ 
      'objectId':'SerPQjckve', // TODO - Differente For Watch User
      '__type':'Pointer', 
      'className' : 'ProspectList' 
    })

    qry = {
      where: JSON.stringify({
        company: currentUser.company,
        archived: true,
      }),
      count: 1,
      order: '-createdAt',
      limit: this.state.prospectsPerPage,
      include: 'email_guesses,email_guesses.pattern'
    }

    if(this.state.currentList != 'All'){
      currentList=appConfig.pointer('ProspectList',this.state.currentListObjectId)
      qry = {
        where: JSON.stringify({
          company: currentUser.company,
          lists: currentList
        }),
        count: 1
      }
    }

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect',
      type:'GET',
      headers: appConfig.parseHeaders,
      cache: true,
      data: qry,
      success: function(res){
        console.log(res)
        thisss.setState({
          prospects: res.results,
          count: res.count,
          totalCount: res.count,
          pages: Math.ceil(res.count/thisss.props.prospectsPerPage),
          loading: false,
        })
      },
      error: function(res){ console.log(res) }
    })

    currentUser = { 
      '__type'   : 'Pointer',
      'className': '_User',
      'objectId' : JSON.parse(localStorage.currentUser).objectId
    }

    thiss = this;
    qry = {
      where: JSON.stringify({
        user: appConfig.pointer('_User', currentUser.objectId)
      }),
      count: 1,
      order: '-createdAt',
    }
    $.ajax({
      url: 'https://api.parse.com/1/classes/ProspectList',
      type: 'GET',
      headers: appConfig.parseHeaders,
      data: qry,
      success: function(res) {
        console.log(res)
        results = res.results
        for(i=0;i< results.length; i++) {
          results.count = '~'
        }
        thiss.setState({lists: results})
        // Make batch request to get list counts after they are loaded
        for(i=0;i < res.results.length; i++) {
          localStorage.setItem(res.results[i].objectId, "")
        }

        for(i=0;i< res.results.length; i++) {
          list = {
            '__type'    : 'Pointer',
            'objectId'  : res.results[i].objectId,
            'className' : 'ProspectList', 
          }

          $.ajax({
            url:'https://api.parse.com/1/classes/Prospect',
            type:'GET',
            headers: appConfig.parseHeaders,
            listObjectId: res.results[i].objectId,
            data: 'where={"lists":'+JSON.stringify(list)+'}&count=1',
            success: function(res) {
              //console.log(this.listObjectId)
              localStorage.setItem(this.listObjectId, res.count)
              amount = 0
              for(ii=0;ii< results.length;ii++){
                if(localStorage.getItem(results[ii].objectId) == "")
                  amount = amount + 1
              }

              if(amount == 0) {
                for(ii=0;ii< results.length;ii++)
                  results[ii].count = localStorage.getItem(results[ii].objectId)

                thiss.setState({lists: results})
                //console.log('Got Counts')
              }

              // updated res.count
              //thiss.setState({count: res.count})
            },
            error: function(err) {
              console.log(err)
            }
          })
        }
      },
      error: function(err) { console.log(err) }
    });
  },

  generate_id : function () {
    return '_' + Math.random().toString(36).substr(2, 9);
  },
});

/*  Dropdown Menus */

var CurrentLists = React.createClass({displayName: 'CurrentLists',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.listAction(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
            className: "dropdown-list-name", 
            href: "javascript:", 
            onClick: this.listAction}, this.props.lists[i].name))
      )
    }
    //console.log(this.props.copyDropdownStyle)
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {right:158}}, 
        lists
      )
    );
  }
});

var ListsMenu = React.createClass({displayName: 'ListsMenu',
  render: function() {
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {
            minWidth:'inherit',
            top: '20px',
            width: '125px',
            right: '154px',
            left:'auto'
          }}, 
        React.DOM.li(null, React.DOM.a({href: "#books"}, 
          React.DOM.i({className: "fa fa-times"}), "  " + ' ' +
          "Delete List"
        )), 
        React.DOM.li(null, React.DOM.a({href: "#podcasts"}, 
          "Rename Lists"
        ))
      )
    );
  }
});

var CurrentListsTwo = React.createClass({displayName: 'CurrentListsTwo',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.listAction(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i<this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
               className: "dropdown-list-name", 
               href: "javascript:", 
               onClick: this.listAction}, 
          this.props.lists[i].name))
      )
    }
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: this.props.copyDropdownStyle}, 
        lists
      )
    );
  }
});

var ListDetailButtons = React.createClass({displayName: 'ListDetailButtons',
  // Rename List
  getInitialState: function() {
    return {
      editMode: false
    }
  },
  render: function() {
    //console.log(this.props.currentListObjectId)
    if(!this.state.editMode) {
      stuff = React.DOM.span({className: "", style: listNameStyle}, 
            (this.props.currentListName == "All") ? '' : React.DOM.i({className: "fa fa-bars", style: {fontSize:16, marginTop:-5}}), 
            (this.props.currentListName == "All") ? '' : "   " +this.props.currentListName
              )
    } else {
      stuff = React.DOM.input({className: "form-control", style: {width: 100, float: 'left', height: 24, marginTop: -1}})
    }
    return (

          React.DOM.div(null, 
            React.DOM.h4({style: {margin:0}}, 
              stuff, 
              React.DOM.a({href: "javascript:", 
                style: listBtn, 
                'data-toggle': "modal", 
                id: "renameListBtn", 
                'data-target': ".bs-renameList-modal-sm", 
                className: "btn btn-xs btn-default"}, 
                React.DOM.i({className: "fa fa-pencil"})
              ), 
              React.DOM.a({href: "javascript:", 
                onClick: this.deleteList, 
                style: listBtn, 
                className: "btn btn-xs btn-default"}, 
                React.DOM.i({className: "fa fa-trash-o"})
              )
            ), 

            RenameListModal({renameList: this.props.renameList}), 
            DeleteListModal({deleteList: this.props.deleteList})
          )
      );
  },

  renameList: function(newListName) {
    this.props.renameList(newListName)
  },

  deleteList: function(){
    thiss = this;
    swal({   
      title: "Are you sure?",   
      text: "Your will not be able to recover this prospect list!",   
      type: "warning",   
      showCancelButton: true,   
      confirmButtonColor: "#DD6B55",   
      confirmButtonText: "Yes, delete it!",   
      closeOnConfirm: false }, 
      function(){   swal("Deleted!", "Your prospect list has been deleted.", "success"); 
        console.log('deleted')
        thiss.props.deleteList()
      });
  },

  toggleEdit: function() {
    this.setState({editMode: !this.state.editMode })
  }
});



var PaginateOverlay = React.createClass({displayName: 'PaginateOverlay',
  render: function() {
    return (
        React.DOM.div({id: "paginate-overlay", style: {paddingTop:70}}, 
          Spinner({circleStyle: {backgroundColor:'white'}})
        )

    )
  }
})


},{"./delete_list_modal.js.min.js":2,"./loading_spinner.js.min.js":3,"./messenger.js.min.js":4,"./panel_footing.js.min.js":5,"./rename_list_modal.js.min.js":7,"./side_menu_user_prospects.js.min.js":8,"./spinner.js.min.js":9,"./user_prospect.js.min.js":10,"./user_prospect_header.js.min.js":11,"./user_side_menu_list.js.min.js":12}],7:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  renameList: function(e) {
    e.preventDefault()
    //console.log($('#newListName').val())
    newListName = $('#newListName').val()
    if(newListName.trim() != "")
      this.props.renameList(newListName)
    // Disable Modal
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-renameList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Rename List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.renameList}, 
                    React.DOM.input({id: "newListName", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.renameList, 
                      className: "btn btn-success", 
                      style: {display:'block', width:'100%'}}, 
                      "Create List"
                    )
                  )
                )
              )
            )
          )
    );
  }
});


},{}],8:[function(require,module,exports){
/** @jsx React.DOM */

var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var createListModal = require('./create_list_modal.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  //SideMenuProspects - SideList
  getInitialState: function() {
    return {
      /*
      createList: 
      renameList:
      deleteList:
      changeList:
      currentList:
      totalCount:
      lists:
      */
    }
  },

  createList: function (data) {
    this.props.createList(data)
  },

  componentDidMount: function() {
  },

  changeList: function(e) {
    /*
    currentList = $(e.target).parent()//.data('list')
    console.log(currentList)
    this.props.changeList(currentList.name, currentList.objectId)
    */
  },

  render: function() {
    if(this.props.currentList == "All")
      styles = {'backgroundColor':'rgb(0, 122, 255)', 'color':'white'} 
    else
      styles =  {}

    lists = [SideMenuListOption({list: {name: 'All',count: this.props.totalCount}, 
                                 iconType: 'users', 
                                 changeList: this.props.changeList}), 
             SideMenuListOption({list: {name: 'Archived', count: '~'}, 
                                 iconType: 'archive', 
                                 changeList: this.props.changeList, 
                                 hideCount: true})]

    for(i=0;i< this.props.lists.length;i++){
      list = this.props.lists[i]
      if(list.list_type == "signal_list")
        iconType = "wifi"
      else if (list.list_type == "mining_job")
        iconType = "cloudDownload"
      if(list.list_type)
        lists.push( SideMenuListOption({list: list, 
                                        iconType: iconType, 
                                        changeList: this.props.changeList}))
      else 
        lists.push( SideMenuListOption({list: list, 
                                        changeList: this.props.changeList}))
    }

    return (
      React.DOM.div({className: "col-lg-2 col-md-2 col-sm-2 col-xs-2", 
           style: {padding:'0',height:'438px',backgroundColor:'#e0e9ee',
                   borderRight:'1px solid #b0b8bf',textAlign:'center'}}, 
        React.DOM.div({className: "prospect-list-header"}, " Lists "), 
        React.DOM.div({className: "btn-group-vertical", 
             style: {width:'100%', height: '320px', overflow: 'auto'}}, 
          lists
        ), 
        React.DOM.br(null), React.DOM.br(null), 
        React.DOM.a({href: "javascript:", className: "btn btn-primary new-list-btn", 
              'data-toggle': "modal", 'data-target': ".bs-example-modal-sm", 
              style: { backgroundImage: 'linear-gradient(180deg, #0096ff 0%, #005dff 100%)'}}, 
          React.DOM.i({className: "fa fa-plus-circle"}), "  New List"
        ), 
        createListModal({createList: this.createList, 
                         listClassName: this.props.listClassName}), " ", React.DOM.br(null)
      )
    );
  },
});

},{"./create_list_modal.js.min.js":1,"./user_side_menu_list.js.min.js":12}],9:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Spinner
  render: function() {
    circleStyle=(this.props.circleStyle) ? this.props.circleStyle : {}
    spinnerStyle=this.props.spinnerStyle ? this.props.spinnerStyle : {}
    return (
      React.DOM.div({className: "spinner", style: spinnerStyle}, 
        React.DOM.div({className: "spinner-container container1"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        ), 
        React.DOM.div({className: "spinner-container container2"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        ), 
        React.DOM.div({className: "spinner-container container3"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        )
      )

    )
  },
})

},{}],10:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // UserProspect
  getInitialState: function() {
    return { }
  },

  clickCheck: function(e) {
    e.stopPropagation()
    domNode = this.getDOMNode()
    //isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
    //console.log(isChecked)
    this.setState({checked: isChecked})
    this.props.checkboxAction(isChecked, this.props.prospect.objectId)
  },

  rowClick: function() {
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
  },

  keyboardClick: function() {
    $($('.keySelect').find('input[type="checkbox"]')[0]).click()
  },

  componentDidMount: function() { },

  render: function() {
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
    thissss = this
    if(this.props.keyboardSelected) {
      // Adjust Scroll depending on where the prospect is
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
      Mousetrap.unbind('x')
      Mousetrap.bind('x', function() { 
        thissss.keyboardClick()
        if(thissss.state.checked)
          console.log("lmao")
      });
    }

    prospect = this.props.prospect

    if(this.props.masterCheckboxChecked && this.state.checked)
      checked = true
    else if(this.props.alreadyChecked)
      checked = true
    else if(this.state.checked)
      checked = true
    else if(this.props.masterCheckboxChecked || this.state.checked)
      checked = true
    else
      checked = false

    //console.log(this.state.checked)
    //console.log(checked)
    //{prospect.employeeCountRange.name + " employees" }
    
    color = {}
    if(this.state.checked || this.props.alreadyChecked)
      color = {backgroundColor: '#eef8ff'}
      
    rowCl = (this.props.keyboardSelected) ? "prospects-tr keySelect" : "prospects-tr"
    websiteBtn = (prospect.websiteUrl) ?  React.DOM.a({href: "http://"+prospect.websiteUrl.replace('http://','')}, " ", React.DOM.i({className: "fa fa-globe"}), " ") : ""
    
    prospect_email = prospect.email
    if(typeof(prospect.domain) == "undefined")
      prospect.email = "website not found"
    if(prospect.email == "no_email") {
      if(prospect.email_guesses) {
        guess = _.findWhere(prospect.email_guesses, {tried: false})
        name = this.props.prospect.name

        vars = {
          first: _.first(name.split(' ')),
          last: _.last(name.split(' ')),
          fi: _.first(name.split(' '))[0],
          li: _.last(name.split(' '))[0]
        }
        if(guess){
          prospect_email = Mustache.render(guess.pattern.pattern, vars)
          prospect_email = prospect_email+"@"+prospect.domain
        }
      }
    }
    prospect_email = (prospect_email) ? prospect_email.toLowerCase() : ""

    return (
      React.DOM.tr({className: rowCl, 
          onClick: this.rowClick, 
          style: keyboardSelected}, 
          React.DOM.td({style: color}, 
              React.DOM.input({type: "checkbox", 
                     onChange: this.clickCheck, 
                     checked: checked})
          ), 
          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, prospect.name), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}}, 
              (prospect.pos) ? prospect.pos.trim() : ""
            )
          ), 
          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, 
              prospect.company_name
            ), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}, className: "company-size"}, 
              (prospect.company_size) ? prospect.company_size : ""
            ), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px',display:'none',fontStyle:'italic'}, className: "company-size"}, 
              (prospect.industry) ? prospect.industry : ""
            )
          ), 

          React.DOM.td({style: color}, 
            React.DOM.h6({style: {margin:'0px'}}, prospect.city)), 
          React.DOM.td({style: color}, 
            React.DOM.a({href: "mailto:"+prospect_email, 
               style: {margin:'0px'}}, 
               prospect_email
          )), 
          React.DOM.td({style: color}, this.props.li, " ", this.props.link), 
          React.DOM.td({style: color}, 
            websiteBtn
          )
        )
    );
  },

  deleteProspect: function() {
    this.props.deleteProspect(this.props.prospect.objectId, 'Prospect')
  }
});


},{}],11:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  checkboxAction: function(e) {
    checkboxVal = $(e.target).is(':checked')
    checkboxes = _.rest($('body').find('input[type="checkbox"]'))
    console.log(checkboxes)
    if(checkboxVal){
      // make sure all checkboxes are checked
      _.map(checkboxes, function(checkbox){
        if(!$(checkbox).prop('checked'))
          $(checkbox).click()
      })
      
    } else {
      // make sure all checkboxes are unchecked
      _.map(checkboxes, function(checkbox){
        if($(checkbox).prop('checked'))
          $(checkbox).click()
      })
    }
  },

  componentDidMount: function() {

  },

  render: function() {
    return (
            React.DOM.tr(null, 
              React.DOM.th({style: {paddingLeft:11}}, 
                React.DOM.input({type: "checkbox", onChange: this.checkboxAction})
              ), 
              React.DOM.th(null, "Name"), 
              React.DOM.th(null, "Company"), 
              React.DOM.th({style: {width:'170px'}}, "City"), 
              React.DOM.th(null, "Email"), 
              React.DOM.th(null, " "), 
              React.DOM.th(null, " ")
            )
    );
  }
});

},{}],12:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //SideMenuListOption
  getInitialState: function() {
    return {count: '~'}
  },

  componentDidMount: function() {
    // make ajax request to get each requests 
    /*
    list = {
      '__type'    : 'Pointer',
      'objectId'  : this.props.list.objectId,
      'className' : 'ProspectList', 
    }

    parse_headers = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
    }

    thiss = this;

    //console.log(this.props.list.name)
    $.ajax({
      url:'https://api.parse.com/1/classes/Prospects',
      type:'GET',
      headers:parse_headers,
      data: 'where={"lists":'+JSON.stringify(list)+'}&count=1',
      success: function(res) {
        thiss.setState({count: res.count})
      },
      error: function(err) {
        console.log(err)
      }
    })
    */
  },

  changeList: function() {
    this.props.changeList(this.props.list.name, this.props.list.objectId)
  },

  render: function() {
    listName = this.props.list.name
    propsCount = this.props.count
    count = (typeof(propsCount)== "undefined") ? this.state.count : propsCount

    //console.log(this.props.iconType)
    icon = ""
    if(this.props.iconType == "archive"){
      icon = React.DOM.i({className: "fa fa-archive", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(this.props.iconType == "users"){
      icon = React.DOM.i({className: "fa fa-user", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(this.props.iconType == "wifi"){
      icon = React.DOM.i({className: "fa fa-wifi", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(this.props.iconType == "cloudDownload"){
      icon = React.DOM.i({className: "fa fa-cloud-download", style: {float:'left',lineHeight:1.5,marginRight:5}})
    }


    countStyle = (this.props.hideCount) ? {'display':'none'} : {backgroundColor:'#999',float:'right',marginTop:2.25}
    listStyle=(icon == "") ? "list-name" : "icon-list-name"
    if(this.props.iconType == "users")
      listStyle = "all-list-name" 
    return (
      React.DOM.button({type: "button", 
              onClick: this.changeList, 
              className: "list-names btn btn-default"}, 
              icon, 
              " ", 
              React.DOM.span({className: listStyle}, listName), 
              React.DOM.span({style: countStyle, 
                className: "badge badge-default"}, this.props.list.count)
      )
    );
  }
});


},{}]},{},[6])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcHJvc3BlY3RzLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcmVuYW1lX2xpc3RfbW9kYWwuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zaWRlX21lbnVfdXNlcl9wcm9zcGVjdHMuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zcGlubmVyLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9wcm9zcGVjdC5qcy5taW4uanMiLCIvVXNlcnMvcm9iaW4vUHJvamVjdHMvcHJvc3BlY3Rlci9wcm9zcGVjdGVyLXBhcnNlL2Rldi9idWlsZC9qcy9jb21wb25lbnRzL3VzZXJfcHJvc3BlY3RfaGVhZGVyLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQXhFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQTFGQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUE3QkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFyQkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hrQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxuLy9UT0RPIC0gYWJzdHJhY3QgbGlzdHNcbnZhciBTaWRlTWVudVByb3NwZWN0cyA9IHJlcXVpcmUoJy4vc2lkZV9tZW51X3VzZXJfcHJvc3BlY3RzLmpzLm1pbi5qcycpO1xuXG52YXIgVXNlclByb3NwZWN0ID0gcmVxdWlyZSgnLi91c2VyX3Byb3NwZWN0LmpzLm1pbi5qcycpO1xudmFyIFVzZXJQcm9zcGVjdEhlYWRlciA9IHJlcXVpcmUoJy4vdXNlcl9wcm9zcGVjdF9oZWFkZXIuanMubWluLmpzJyk7XG52YXIgU2lkZU1lbnVMaXN0T3B0aW9uID0gcmVxdWlyZSgnLi91c2VyX3NpZGVfbWVudV9saXN0LmpzLm1pbi5qcycpO1xudmFyIExvYWRpbmdTcGlubmVyID0gcmVxdWlyZSgnLi9sb2FkaW5nX3NwaW5uZXIuanMubWluLmpzJylcbnZhciBTcGlubmVyID0gcmVxdWlyZSgnLi9zcGlubmVyLmpzLm1pbi5qcycpXG52YXIgUGFuZWxGb290aW5nID0gcmVxdWlyZSgnLi9wYW5lbF9mb290aW5nLmpzLm1pbi5qcycpXG52YXIgTWVzc2VuZ2VyID0gcmVxdWlyZSgnLi9tZXNzZW5nZXIuanMubWluLmpzJylcblxudmFyIERlbGV0ZUxpc3RNb2RhbCA9IHJlcXVpcmUoJy4vZGVsZXRlX2xpc3RfbW9kYWwuanMubWluLmpzJylcbnZhciBSZW5hbWVMaXN0TW9kYWwgPSByZXF1aXJlKCcuL3JlbmFtZV9saXN0X21vZGFsLmpzLm1pbi5qcycpXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHsgIHByb3NwZWN0cyAgIDogW10sXG4gICAgICAgICAgICAgIGN1cnJlbnRQYWdlIDogMSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnUHJvc3BlY3QnLFxuICAgICAgICAgICAgICBsaXN0Q2xhc3NOYW1lOiAnUHJvc3BlY3RMaXN0JyxcbiAgICAgICAgICAgICAgcGFnZXMgICAgICAgOiAxLFxuICAgICAgICAgICAgICBjdXJyZW50TGlzdCA6ICdBbGwnLFxuICAgICAgICAgICAgICBjdXJyZW50TGlzdE9iamVjdElkIDogJycsXG4gICAgICAgICAgICAgIGxvYWRpbmc6IHRydWUsXG4gICAgICAgICAgICAgIHBhZ2luYXRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICBwcm9zcGVjdHNQZXJQYWdlOiA1MCxcbiAgICAgICAgICAgICAgZG93bmxvYWRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICBsaXN0cyA6IFtdLFxuICAgICAgICAgICAgICBtYXN0ZXJDaGVja2JveENoZWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBrZXlib2FyZEFjdGl2ZVByb3NwZWN0OiAwLCAvL2ZpcnN0XG4gICAgICAgICAgICAgIHNlbGVjdGVkUHJvc3BlY3RzOiBbXSxcbiAgICAgICAgICAgICAgdG90YWxDb3VudCAgOiBcIn5cIiwgXG4gICAgICAgICAgICAgIGNvdW50ICAgICAgIDogXCJ+XCIsIH1cbiAgfSxcblxuICBjcmVhdGVMaXN0OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgbGlzdHMgPSB0aGlzLnN0YXRlLmxpc3RzXG4gICAgbGlzdHMgPSBbZGF0YV0uY29uY2F0KGxpc3RzKVxuICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0czogbGlzdHMgfSlcbiAgfSxcblxuICByZW5hbWVMaXN0OiBmdW5jdGlvbihuZXdMaXN0TmFtZSkge1xuICAgIC8vIFVwZGF0ZSBMb2NhbCBTdGF0ZVxuICAgIHRoaXNzID0gdGhpcztcbiAgICB2YXIgZmlsdGVyZWQgPSBfLmZpbHRlcih0aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpZihpdGVtLm5hbWUgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3Qpe1xuICAgICAgICBpdGVtLm5hbWUgPSBuZXdMaXN0TmFtZVxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfVxuICAgICAgcmV0dXJuIGl0ZW1cbiAgICB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoe2xpc3RzIDogZmlsdGVyZWQsIGN1cnJlbnRMaXN0OiBuZXdMaXN0TmFtZX0pXG5cbiAgICAkKCcubW9kYWwnKS5jbGljaygpXG4gICAgJCgnI25ld0xpc3ROYW1lJykudmFsKCcnKVxuICAgICQoJy5tb2RhbC1iYWNrZHJvcCcpLmNsaWNrKClcblxuICAgIC8vIFBlcnNpc3QgLyBBamF4XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QvJyt0aGlzcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLnBhcnNlSGVhZGVycyxcbiAgICAgIHR5cGU6J1BVVCcsXG4gICAgICBkYXRhOkpTT04uc3RyaW5naWZ5KHsnbmFtZSc6bmV3TGlzdE5hbWV9KSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVycikgfVxuICAgIH0pO1xuICB9LFxuXG4gIGRlbGV0ZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBmaWx0ZXJlZCA9IF8uZmlsdGVyKHRoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IGZpbHRlcmVkLCBjdXJyZW50TGlzdDogJ0FsbCd9KVxuICAgIHRoaXMuY2hhbmdlTGlzdCgnQWxsJywgJycpXG5cbiAgICAvLyBSZW1vdmVcbiAgICBhcHBDb25maWcuY2xvc2VNb2RhbCgpXG4gICAgJCgnI25ld0xpc3ROYW1lJykudmFsKCcnKVxuXG4gICAgLy8gUGVyc2lzdCAvIEFqYXhcbiAgICB2YXIgdGhpc3MgPSB0aGlzO1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6IGFwcENvbmZpZy51cmwrJ1Byb3NwZWN0TGlzdC8nK3RoaXNzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQsXG4gICAgICBoZWFkZXJzOiBhcHBDb25maWcucGFyc2VIZWFkZXJzLFxuICAgICAgdHlwZTonREVMRVRFJyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVycikgfVxuICAgIH0pO1xuICB9LFxuXG4gIHNldFBhZ2luYXRlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe3BhZ2luYXRpbmc6IHZhbHVlfSlcbiAgfSxcblxuICBzZXREb3dubG9hZGluZzogZnVuY3Rpb24odmFsdWUpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtkb3dubG9hZGluZzogdmFsdWV9KVxuICB9LFxuXG4gIGNoYW5nZUxpc3Q6IGZ1bmN0aW9uKG5ld0xpc3ROYW1lLG9iamVjdElkKSB7XG4gICAgLy8gYWRkIG92ZXJsYXkgbG9hZGluZ1xuICAgIC8vY29uc29sZS5sb2cobmV3TGlzdE5hbWUpXG4gICAgLy9jb25zb2xlLmxvZyhvYmplY3RJZClcblxuICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cyA9IEpTT04uc3RyaW5naWZ5KFtdKVxuXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudExpc3QgOiBuZXdMaXN0TmFtZX0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudExpc3RPYmplY3RJZCA6IG9iamVjdElkfSlcbiAgICB0aGlzLnNldFN0YXRlKHtwcm9zcGVjdHMgIDogW10gICAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtjb3VudCAgICAgIDogJ34nICAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtwYWdlcyAgICAgIDogMSAgICAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtsb2FkaW5nICAgIDogdHJ1ZSAgfSlcbiAgICB0aGlzLnNldFN0YXRlKHtjdXJyZW50UGFnZTogMX0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7a2V5Ym9hcmRBY3RpdmVQcm9zcGVjdDogMH0pXG5cbiAgICBjb21wYW55ID0gSlNPTi5zdHJpbmdpZnkoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpLmNvbXBhbnkpXG4gICAgcXJ5ID0gJ3doZXJlPXtcImNvbXBhbnlcIjonK2NvbXBhbnkrJyxcImFyY2hpdmVkXCI6dHJ1ZX0mY291bnQ9MSZvcmRlcj0tY3JlYXRlZEF0J1xuICAgIGNvbnNvbGUubG9nKG5ld0xpc3ROYW1lKVxuXG4gICAgaWYodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCAhPSAnQWxsJyB8fCB0eXBlb2Yob2JqZWN0SWQpICE9IFwidW5kZWZpbmVkXCIgJiYgbmV3TGlzdE5hbWUgIT0gJ0FyY2hpdmVkJyl7XG4gICAgICBjdXJyZW50TGlzdCA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgJ29iamVjdElkJyAgOiBvYmplY3RJZCwgXG4gICAgICAgICdfX3R5cGUnICAgIDogJ1BvaW50ZXInLCBcbiAgICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JyBcbiAgICAgIH0pXG5cbiAgICAgIGNvbXBhbnkgPSBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikuY29tcGFueSlcbiAgICAgIHFyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55Kyd9JmNvdW50PTEnXG4gICAgICBxcnkgPSAnd2hlcmU9e1wibGlzdHNcIjonK2N1cnJlbnRMaXN0Kyd9JmNvdW50PTEmb3JkZXI9LWNyZWF0ZWRBdCZpbmNsdWRlPWVtYWlsX2d1ZXNzZXMsZW1haWxfZ3Vlc3Nlcy5wYXR0ZXJuJ1xuICAgIH0gZWxzZSBpZiAobmV3TGlzdE5hbWUgPT0gJ0FyY2hpdmVkJykge1xuICAgICAgcXJ5ID0gJ3doZXJlPXtcImNvbXBhbnlcIjonK2NvbXBhbnkrJyxcImFyY2hpdmVkXCI6ZmFsc2V9JmNvdW50PTEmb3JkZXI9LWNyZWF0ZWRBdCZpbmNsdWRlPWVtYWlsX2d1ZXNzZXMsZW1haWxfZ3Vlc3Nlcy5wYXR0ZXJuJ1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhxcnkpXG4gICAgdmFyIHRoaXNzcyA9IHRoaXM7XG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdCcsXG4gICAgICB0eXBlOidHRVQnLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLnBhcnNlSGVhZGVycyxcbiAgICAgIGFzeW5jOiB0cnVlLFxuICAgICAgZGF0YTogcXJ5LFxuICAgICAgYWpheFN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0ZWQgbGlzdCcpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtwcm9zcGVjdHM6IHJlcy5yZXN1bHRzfSlcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtjb3VudDogcmVzLmNvdW50fSlcbiAgICAgICAgLy90aGlzc3Muc2V0U3RhdGUoe3RvdGFsQ291bnQ6IHJlcy5jb3VudH0pXG4gICAgICAgIHRoaXNzcy5zZXRTdGF0ZSh7cGFnZXM6IE1hdGguY2VpbChyZXMuY291bnQvdGhpc3NzLnByb3BzLnByb3NwZWN0c1BlclBhZ2UpfSlcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtsb2FkaW5nOiBmYWxzZX0pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXMpXG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICBjaGVja2JveEFjdGlvbjogZnVuY3Rpb24oY2hlY2tlZFN0YXRlLCBvYmpJZCkge1xuICAgIC8qIFN0b3JpbmcgQ2hlY2tlZCBQcm9zcGVjdHMgSW4gTG9jYWxTdG9yYWdlIFRvIE1ha2UgaXQgRWFzaWVyIFRvXG4gICAgICogQ29weSBhbmQgTW92ZSBQcm9zcGVjdHMgXG4gICAgICpcbiAgICAgKiBNb3ZlIFRvIFVzZXJfUHJvc3BlY3RzP1xuICAgICAqL1xuICAgIFxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgLy9jb25zb2xlLmxvZyhjaGVja2VkU3RhdGUpXG4gICAgaWYoY2hlY2tlZFN0YXRlKVxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMucHVzaChvYmpJZClcbiAgICBlbHNlXG4gICAgICBzZWxlY3RlZFByb3NwZWN0cyA9IF8ucmVqZWN0KHNlbGVjdGVkUHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oaWQpe3JldHVybiBpZCA9PSBvYmpJZH0pXG5cbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IF8udW5pcShzZWxlY3RlZFByb3NwZWN0cylcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFByb3NwZWN0cylcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFByb3NwZWN0cylcbiAgICB0aGlzLnNldFN0YXRlKHtzZWxlY3RlZFByb3NwZWN0czogc2VsZWN0ZWRQcm9zcGVjdHN9KVxuICB9LFxuXG4gIG1hc3RlckNoZWNrYm94Q2hhbmdlZDogZnVuY3Rpb24obWFzdGVyQ2hlY2tib3hWYWx1ZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe21hc3RlckNoZWNrYm94Q2hlY2tlZDogbWFzdGVyQ2hlY2tib3hWYWx1ZX0pXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN0YXJ0S2V5Ym9hcmRTaG9ydGN1dHMoKVxuICAgICQoJ2JvZHknKS5jc3Moe292ZXJmbG93OidhdXRvJ30pXG5cbiAgICBwcm9zcGVjdHMgPSBbXVxuICAgIGZvcihpPTA7aTwgdGhpcy5zdGF0ZS5wcm9zcGVjdHMubGVuZ3RoO2krKykge1xuICAgICAgdXJsID0gdGhpcy5zdGF0ZS5wcm9zcGVjdHNbaV0udXJsXG4gICAgICBwcm9zcGVjdCA9IHRoaXMuc3RhdGUucHJvc3BlY3RzW2ldXG5cbiAgICAgIGlmKHVybCAhPSBcIm5vIGxpbmtlZGluIHdlYnNpdGVcIiAmJiB0eXBlb2YodXJsKSAhPSBcInVuZGVmaW5lZFwiICYmIHVybCAhPSBcIlwiKXtcbiAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ2h0dHA6Ly8nLCcnKVxuICAgICAgICB0aGVfbGluayA9IFJlYWN0LkRPTS5hKHtocmVmOiAnaHR0cDovLycrdXJsfSwgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1nbG9iZVwifSkpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGVfbGluayA9IFwiXCJcbiAgICAgIH1cblxuICAgICAgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvc3BlY3RzW2ldLmxpbmtlZGluX3VybC5yZXBsYWNlKCdodHRwOi8vJywnJylcbiAgICAgIHByb2ZpbGUgPSB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXS5saW5rZWRpbl91cmwucmVwbGFjZSgnaHR0cHM6Ly8nLCcnKVxuICAgICAgbGkgPSBSZWFjdC5ET00uYSh7aHJlZjogJ2h0dHA6Ly8nK3Byb2ZpbGUsIGNsYXNzTmFtZTogXCJsaW5rZWRpbl9saW5rXCJ9LCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWxpbmtlZGluLXNxdWFyZVwifSkpXG5cbiAgICAgIGtleWJvYXJkU2VsZWN0ZWQgPSAoaSA9PSB0aGlzLnN0YXRlLmtleWJvYXJkQWN0aXZlUHJvc3BlY3QpXG5cbiAgICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgICBhbHJlYWR5Q2hlY2tlZD1mYWxzZVxuICAgICAgZm9yKGlpPTA7aWk8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpaSsrKVxuICAgICAgICBpZihwcm9zcGVjdC5vYmplY3RJZCA9PSBzZWxlY3RlZFByb3NwZWN0c1tpaV0pXG4gICAgICAgICAgYWxyZWFkeUNoZWNrZWQgPSB0cnVlXG5cbiAgICAgICAgLy9jb25zb2xlLmxvZyhhbHJlYWR5Q2hlY2tlZClcblxuICAgICAgcHJvc3BlY3RzLnB1c2goXG4gICAgICAgIFVzZXJQcm9zcGVjdCh7ZGVsZXRlUHJvc3BlY3Q6IHRoaXMuZGVsZXRlUHJvc3BlY3QsIFxuICAgICAgICAgICAgICAgICAgICAgIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXSwgXG4gICAgICAgICAgICAgICAgICAgICAgbWFzdGVyQ2hlY2tib3hDaGVja2VkOiB0aGlzLnN0YXRlLm1hc3RlckNoZWNrYm94Q2hlY2tlZCwgXG4gICAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLmdlbmVyYXRlX2lkKCksIFxuICAgICAgICAgICAgICAgICAgICAgIGxpbms6IHRoZV9saW5rLCBcbiAgICAgICAgICAgICAgICAgICAgICBrZXlib2FyZFNlbGVjdGVkOiBrZXlib2FyZFNlbGVjdGVkLCBcbiAgICAgICAgICAgICAgICAgICAgICBjaGVja2JveEFjdGlvbjogdGhpcy5jaGVja2JveEFjdGlvbiwgXG4gICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeUNoZWNrZWQ6IGFscmVhZHlDaGVja2VkLCBcbiAgICAgICAgICAgICAgICAgICAgICBsaTogbGl9KSlcbiAgICB9XG5cbiAgICBsaXN0VHlwZSA9ICh0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09IFwiQWxsXCIpID8ge2Rpc3BsYXk6J25vbmUnfSA6IHtmbG9hdDonbGVmdCd9XG4gICAgbGlzdE5hbWVTdHlsZSA9ICh0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09IFwiQWxsXCIpID8ge2Rpc3BsYXk6J25vbmUnfSA6IHtmbG9hdDonbGVmdCcsZGlzcGxheTonaW5saW5lLWJsb2NrJywgZm9udFdlaWdodDogMjAwLCBtYXJnaW5Ub3A6IDEsIHBhZGRpbmdSaWdodDogMTAsIG1hcmdpbkxlZnQ6IC0xMH1cbiAgICBsaXN0QnRuID0gKHRoaXMuc3RhdGUuY3VycmVudExpc3QgPT0gXCJBbGxcIikgPyB7ZGlzcGxheTonbm9uZSd9IDoge2Zsb2F0OidsZWZ0JyxtYXJnaW5MZWZ0OjV9XG4gICAgbGlzdE9wdGlvbnMgPSAodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKSA/IHtkaXNwbGF5Oidub25lJ30gOiB7ZmxvYXQ6J3JpZ2h0J31cbiAgICBjb3B5RHJvcGRvd25TdHlsZSA9ICh0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09IFwiQWxsXCIpID8ge3dpZHRoOjExNCwgcmlnaHQ6NH0gOiB7d2lkdGg6MTE0LCByaWdodDozNn1cbiAgICBjdXJyZW50TGlzdCA9IHRoaXMuc3RhdGUuY3VycmVudExpc3RcbiAgICBwYWdpbmF0ZU92ZXJsYXkgPSAodGhpcy5zdGF0ZS5wYWdpbmF0aW5nKSA/IFBhZ2luYXRlT3ZlcmxheShudWxsKSA6IFwiXCJcblxuICAgIGRvd25sb2FkSWNvbiA9ICghdGhpcy5zdGF0ZS5kb3dubG9hZGluZykgPyBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWRvd25sb2FkXCJ9KSA6IFNwaW5uZXIoe2NpcmNsZVN0eWxlOiB7YmFja2dyb3VuZENvbG9yOid3aGl0ZScsaGVpZ2h0OjQsd2lkdGg6NH0sIHNwaW5uZXJTdHlsZToge2hlaWdodDoxMywgd2lkdGg6MTMsbWFyZ2luOjAsZGlzcGxheTonaW5saW5lLWJsb2NrJyxwYWRkaW5nVG9wOjJ9fSlcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbnRhaW5lclwiLCBzdHlsZToge3dpZHRoOicxMDAlJyxwYWRkaW5nOicwJywgYmFja2dyb3VuZDogJ2xpbmVhci1ncmFkaWVudCgjZGFlOGZmLCNkYWU4ZmYpJywgYmFja2dyb3VuZEltYWdlOiAncmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCBjZW50ZXIgY2VudGVyLCNmZmYsI2RmZjFmZCA5MDBweCknfX0sIFxuICAgICAgICBTaWRlTWVudVByb3NwZWN0cyh7Y3VycmVudExpc3Q6IHRoaXMuc3RhdGUuY3VycmVudExpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHRoaXMuc3RhdGUuY291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudDogdGhpcy5zdGF0ZS50b3RhbENvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMuY2hhbmdlTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVMaXN0OiB0aGlzLmNyZWF0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHM6IHRoaXMuc3RhdGUubGlzdHN9KSwgXG5cbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbC1sZC0xMCBjb2wtbWQtMTAgY29sLXNtLTEwIGNvbC14cy0xMFwiLCBcbiAgICAgICAgICAgICBzdHlsZToge3BhZGRpbmc6JzAnfX0sIFxuICAgICAgICAgICAgICBwYWdpbmF0ZU92ZXJsYXksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtpZDogXCJwcm9zcGVjdERldGFpbEJ1dHRvbnNcIn0sIFxuICAgICAgICAgICAgICAgIExpc3REZXRhaWxCdXR0b25zKHtcbiAgICAgICAgICAgICAgICAgIHJlbmFtZUxpc3Q6IHRoaXMucmVuYW1lTGlzdCwgXG4gICAgICAgICAgICAgICAgICBkZWxldGVMaXN0OiB0aGlzLmRlbGV0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgY3VycmVudExpc3ROYW1lOiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0LCBcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaXN0OiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWR9KSwgXG5cbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZHJvcGRvd25cIiwgc3R5bGU6IHtkaXNwbGF5Oidub25lJ319LCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBidG4teHMgbGlzdC1vcHRpb25zXCIsIFxuICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiXCIsIFxuICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IGxpc3RPcHRpb25zfSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYmFyc1wifSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApLCBcblxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJkcm9wZG93blwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7J2RhdGEtdG9nZ2xlJzogXCJkcm9wZG93blwiLCBcbiAgICAgICAgICAgICAgICAgICAgIGlkOiBcImNvcHlUb0xpc3RcIiwgXG4gICAgICAgICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImRyb3AtdGFyZ2V0IGJ0biBidG4tcHJpbWFyeSBidG4teHMgbGlzdC1vcHRpb25zXCJ9LCBcbiAgICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY29weVwifSksIFxuICAgICAgICAgICAgICAgICAgICAgICBcIsKgIENvcHkgVG8gTGlzdCDCoFwiLCAgXG4gICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNhcmV0LWRvd25cIn0pXG4gICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgQ3VycmVudExpc3RzVHdvKHtsaXN0czogdGhpcy5zdGF0ZS5saXN0cywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3B5RHJvcGRvd25TdHlsZTogY29weURyb3Bkb3duU3R5bGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdEFjdGlvbjogdGhpcy5jb3B5U2VsZWN0ZWRQcm9zcGVjdHN9KVxuICAgICAgICAgICAgICAgICksIFxuICBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZHJvcGRvd25cIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoeydkYXRhLXRvZ2dsZSc6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgaWQ6IFwibW92ZVRvTGlzdFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBsaXN0T3B0aW9ucywgXG4gICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIn0sIFxuICAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1zaGFyZVwifSksIFxuICAgICAgICAgICAgICAgICAgICAgXCLCoCBNb3ZlIFRvIExpc3QgwqBcIiwgIFxuICAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jYXJldC1kb3duXCJ9KVxuICAgICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICAgIEN1cnJlbnRMaXN0cyh7bGlzdHM6IHRoaXMuc3RhdGUubGlzdHMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdEFjdGlvbjogdGhpcy5tb3ZlU2VsZWN0ZWRQcm9zcGVjdHN9KVxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe29uQ2xpY2s6IHRoaXMuZG93bmxvYWRGaWxlLCBcbiAgICAgICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgIGlkOiBcImRvd25sb2FkUHJvc3BlY3RzXCIsIFxuICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJkcm9wLXRhcmdldCBidG4gYnRuLXByaW1hcnkgYnRuLXhzIGxpc3Qtb3B0aW9uc1wifSwgXG4gICAgICAgICAgICAgICAgICAgZG93bmxvYWRJY29uLCBcbiAgICAgICAgICAgICAgICAgICBcIsKgIERvd25sb2FkIENTViDCoFwiIFxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe29uQ2xpY2s6IHRoaXMuZG93bmxvYWRGaWxlLCBcbiAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiBsaXN0T3B0aW9ucywgXG4gICAgICAgICAgICAgICAgICAgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICAgICAgICBpZDogXCJkb3dubG9hZFByb3NwZWN0c1wiLCBcbiAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcC10YXJnZXQgYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1idWlsZGluZ1wifSksIFwiIMKgIEdlbmVyYXRlIENvbXBhbnkgTGlzdCDCoFwiIFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKSwgXG4gICAgICAgIFxuXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7aWQ6IFwiYXV0b3Njcm9sbFwiLCBzdHlsZToge2hlaWdodDonNDAwcHgnLG92ZXJmbG93OidhdXRvJ319LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS50YWJsZSh7Y2xhc3NOYW1lOiBcInByb3NwZWN0cy10YWJsZSB0YWJsZSB0YWJsZS1zdHJpcGVkXCIsIHN0eWxlOiB7bWFyZ2luQm90dG9tOicwcHgnfX0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGhlYWQoe3N0eWxlOiB7YmFja2dyb3VuZENvbG9yOid3aGl0ZSd9fSwgXG4gICAgICAgICAgICAgICAgVXNlclByb3NwZWN0SGVhZGVyKHttYXN0ZXJDaGVja2JveENoYW5nZWQ6IHRoaXMubWFzdGVyQ2hlY2tib3hDaGFuZ2VkfSlcbiAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50Ym9keShudWxsLCBcbiAgICAgICAgICAgICAgICBwcm9zcGVjdHNcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAodGhpcy5zdGF0ZS5sb2FkaW5nKSA/IExvYWRpbmdTcGlubmVyKG51bGwpIDogXCJcIlxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKSwgXG5cbiAgICAgIFBhbmVsRm9vdGluZyh7Y3VycmVudFBhZ2U6IHRoaXMuc3RhdGUuY3VycmVudFBhZ2UsIFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5zdGF0ZS5jb3VudCwgXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRlOiB0aGlzLnBhZ2luYXRlLCBcbiAgICAgICAgICAgICAgICAgICAgcHJvc3BlY3RzUGVyUGFnZTogdGhpcy5zdGF0ZS5wcm9zcGVjdHNQZXJQYWdlLCBcbiAgICAgICAgICAgICAgICAgICAgc2V0UGFnaW5hdGU6IHRoaXMuc2V0UGFnaW5hdGUsIFxuICAgICAgICAgICAgICAgICAgICBwYWdlczogdGhpcy5zdGF0ZS5wYWdlc30pLCBcbiAgICAgIE1lc3NlbmdlcihudWxsKVxuICAgIClcbiAgICApO1xuICB9LFxuXG4gIHBhZ2luYXRlOiBmdW5jdGlvbihuZXdQcm9zcGVjdHMsIG5ld1BhZ2UpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIHByb3NwZWN0czogbmV3UHJvc3BlY3RzLFxuICAgICAgY3VycmVudFBhZ2U6IG5ld1BhZ2UsXG4gICAgICBrZXlib2FyZEFjdGl2ZVByb3NwZWN0OiAwXG4gICAgfSlcbiAgICB0aGlzLnN0YXJ0S2V5Ym9hcmRTaG9ydGN1dHMoKVxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvc2Nyb2xsJykuc2Nyb2xsVG9wID0gMFxuICB9LFxuXG4gIGRvd25sb2FkRmlsZTogZnVuY3Rpb24oKSB7XG4gICAgbGlzdCA9IHtcbiAgICAgICdfX3R5cGUnICAgOiAgJ1BvaW50ZXInLFxuICAgICAgJ2NsYXNzTmFtZSc6ICAnUHJvc3BlY3RMaXN0JyxcbiAgICAgICdvYmplY3RJZCcgOiAgdGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkXG4gICAgfVxuICAgIGxvY2FsU3RvcmFnZS5kb3dubG9hZF90b3RhbCA9IE1hdGguY2VpbCh0aGlzLnN0YXRlLmNvdW50LzEwMDApXG4gICAgbG9jYWxTdG9yYWdlLmRvd25sb2FkcyAgICAgID0gMFxuXG4gICAgaWYodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKSB7XG4gICAgICBxcnkgPSB7XG4gICAgICAgIHdoZXJlIDogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGNvbXBhbnk6IGFwcENvbmZpZy5jb21wYW55XG4gICAgICAgIH0pLFxuICAgICAgICBjb3VudDogMSxcbiAgICAgICAgYXJjaGl2ZWQ6IHRydWUsXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHFyeSA9IHtcbiAgICAgICAgd2hlcmU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBsaXN0czogbGlzdFxuICAgICAgICB9KSxcbiAgICAgICAgY291bnQ6IDEsXG4gICAgICAgIGFyY2hpdmVkOiB0cnVlLFxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciB0aGlzcyA9IHRoaXM7XG4gICAgZm9yKGk9MDtpPCBNYXRoLmNlaWwodGhpcy5zdGF0ZS5jb3VudC8xMDAwKTsgaSsrKXtcbiAgICAgICQuYWpheCh7XG4gICAgICAgIHVybDogJ2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3Q/bGltaXQ9MTAwMCZza2lwPScraSxcbiAgICAgICAgdHlwZTonR0VUJyxcbiAgICAgICAgaGVhZGVyczogYXBwQ29uZmlnLnBhcnNlSGVhZGVycyxcbiAgICAgICAgYmVmb3JlU2VuZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2Rvd25sb2FkaW5nOiB0cnVlfSlcbiAgICAgICAgfSxcbiAgICAgICAgZG93bmxvYWRGaWxlOiAnZG93bmxvYWRfJytpLFxuICAgICAgICBkYXRhOiBxcnksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgZm9yKGk9MDtpPCByZXMucmVzdWx0cy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICBkZWxldGUgcmVzLnJlc3VsdHNbaV0uY29tcGFueVxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnBvc1xuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnVzZXJcbiAgICAgICAgICAgIGRlbGV0ZSByZXMucmVzdWx0c1tpXS5vYmplY3RJZFxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLmNyZWF0ZWRBdFxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnVwZGF0ZWRBdFxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkZCBSZXN1bHRzIFRvIExvY2FsU3RvcmFnZVxuICAgICAgICAgIGxvY2FsU3RvcmFnZS5kb3dubG9hZHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5kb3dubG9hZHMpICsgMSBcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmRvd25sb2FkRmlsZSwgSlNPTi5zdHJpbmdpZnkocmVzLnJlc3VsdHMpKVxuXG4gICAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIGFsbCBhamF4IHJlcXMgaW4gZm9yIGxvb3AgYXJlIGNvbXBsZXRlXG4gICAgICAgICAgaWYobG9jYWxTdG9yYWdlLmRvd25sb2FkcyA9PSBsb2NhbFN0b3JhZ2UuZG93bmxvYWRfdG90YWwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtYXRjaGVkJylcbiAgICAgICAgICAgIC8vIE1lcmdlIGFsbCBsb2NhbFN0b3JhZ2UgcmVzdWx0c1xuICAgICAgICAgICAgcHJvc3BlY3RzID0gW11cbiAgICAgICAgICAgIGZvcihpaT0wO2lpIDwgSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZG93bmxvYWRfdG90YWwpOyBpaSsrKXtcbiAgICAgICAgICAgICAgcHJvc3BlY3RzID0gcHJvc3BlY3RzLmNvbmNhdChKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkb3dubG9hZF8nK2lpKSkpXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb3NwZWN0cylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvc3BlY3RzKVxuICAgICAgICAgICAgLy8gT3V0cHV0IGFzIENTVlxuICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbUGFwYS51bnBhcnNlKHByb3NwZWN0cyldLCB7dHlwZTogXCJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLThcIn0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYmxvYilcbiAgICAgICAgICAgIHNhdmVBcyhibG9iLCBcInByb3NwZWN0cy5jc3ZcIik7XG4gICAgICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7ZG93bmxvYWRpbmc6IGZhbHNlfSlcbiAgICAgICAgICB9XG4gICAgICB9LFxuXG4gICAgICBlcnJvcjogZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGNvbXBhbnkgPSBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikuY29tcGFueSlcbiAgICBcblxuICB9LFxuXG4gIHJlbW92ZVNlbGVjdGVkUHJvc3BlY3RzOiBmdW5jdGlvbigpIHtcbiAgICAvLyBJZiBMaXN0IFR5cGUgaXMgQWxsIEFyY2hpdmUgdGhlIHByb3NwZWN0XG4gICAgcGFyc2VIZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgICAgXCJDb250ZW50LVR5cGVcIiA6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxuXG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICBiYXRjaERhdGEgPSBbXVxuXG4gICAgZm9yKGk9MDtpPCBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGg7aSsrKXtcbiAgICAgIGlmKHRoaXMuc3RhdGUuY3VycmVudExpc3QgIT0gJ0FsbCcpe1xuICAgICAgICB0bXAgPSB7XG4gICAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3QvJytzZWxlY3RlZFByb3NwZWN0c1tpXSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBsaXN0czoge1xuICAgICAgICAgICAgICAnX19vcCcgICAgOiAnUmVtb3ZlJyxcbiAgICAgICAgICAgICAgXCJvYmplY3RzXCIgOiBbeyBcbiAgICAgICAgICAgICAgICAgICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOidQcm9zcGVjdExpc3QnLFxuICAgICAgICAgICAgICAgICAgJ29iamVjdElkJzp0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWRcbiAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICB0bXAgPSB7XG4gICAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3QvJytzZWxlY3RlZFByb3NwZWN0c1tpXSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBhcmNoaXZlZDpmYWxzZSxcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJhdGNoRGF0YS5wdXNoKHRtcClcbiAgICB9XG5cbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvYmF0Y2gnLFxuICAgICAgdHlwZTonUE9TVCcsXG4gICAgICBoZWFkZXJzOnBhcnNlSGVhZGVycyxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtyZXF1ZXN0czogYmF0Y2hEYXRhfSksXG4gICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgIGxpc3RzID0gdGhpc3Muc3RhdGUubGlzdHNcblxuICAgICAgICBmb3IoaT0wO2k8IGxpc3RzLmxlbmd0aDsgaSsrKSB7IFxuICAgICAgICAgIC8vIFN1YnRyYWN0IEZyb20gT2xkIExpc3QgLSBOb3QgV29ya2luZyBGb3IgQXJjaGl2ZVxuICAgICAgICAgIGlmKGxpc3RzW2ldLm9iamVjdElkID09IHRoaXNzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgICAgICAgICBsaXN0c1tpXS5jb3VudCA9IHBhcnNlSW50KGxpc3RzW2ldLmNvdW50KSAtIHBhcnNlSW50KHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aClcbiAgICAgICAgfVxuICAgICAgICAvLyBVcGRhdGUgbG9jYWwgbGlzdCBjb3VudFxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7bGlzdHM6IGxpc3RzfSlcblxuICAgICAgICAvLyByZW1vdmUgZnJvbSBjdXJyZW50IGxpc3QgdWlcbiAgICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICAgICAgY29uc29sZS5sb2coJ3JlbW92ZSBzZWxlY3RlZCBwcm9zcGVjdHMnKVxuICAgICAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFByb3NwZWN0cylcbiAgICAgICAgY29uc29sZS5sb2codGhpc3Muc3RhdGUucHJvc3BlY3RzKVxuICAgICAgICB2YXIgZmlsdGVyZWQgPSBfLmZpbHRlcih0aGlzcy5zdGF0ZS5wcm9zcGVjdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspIFxuICAgICAgICAgICAgaWYoaXRlbS5vYmplY3RJZCA9PSBzZWxlY3RlZFByb3NwZWN0c1tpXSlcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGZpbHRlcmVkKVxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7cHJvc3BlY3RzOiBmaWx0ZXJlZH0pXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cyA9IEpTT04uc3RyaW5naWZ5KFtdKVxuXG4gICAgICAgIC8vIGFkZCBhbGVydCB0byBpbmZvcm0gdXNlclxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIG1vdmVTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24obGlzdE9iamVjdElkKSB7XG4gICAgcGFyc2VIZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgICAgXCJDb250ZW50LVR5cGVcIiA6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxuXG4gICAgLy8gZ2V0IHRoZSBzZWxlY3RlZCBvYmplY3RJZCBmcm9tIHNlbGVjdGVkUHJvc3BlY3RzIHN0YXRlXG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICBiYXRjaERhdGEgPSBbXVxuXG5cbiAgICAvLyBCYXRjaCBVcGRhdGUgUGFyc2VcbiAgICAvLyAtIFJlbW92ZSBBbGwgU2VsZWN0ZWQgUHJvc3BlY3RzIEZyb20gQ3VycmVudCBMaXN0XG4gICAgZm9yKGk9MDtpPCBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGg7aSsrKXtcbiAgICAgIHRtcCA9IHtcbiAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICBwYXRoOicvMS9jbGFzc2VzL1Byb3NwZWN0Lycrc2VsZWN0ZWRQcm9zcGVjdHNbaV0sXG4gICAgICAgIGJvZHk6IHtcbiAgICAgICAgICBsaXN0czoge1xuICAgICAgICAgICAgJ19fb3AnICAgIDogJ1JlbW92ZScsXG4gICAgICAgICAgICBcIm9iamVjdHNcIiA6IFt7IFxuICAgICAgICAgICAgICAgICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonUHJvc3BlY3RMaXN0JyxcbiAgICAgICAgICAgICAgICAnb2JqZWN0SWQnOnRoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZFxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJhdGNoRGF0YS5wdXNoKHRtcClcbiAgICB9XG4gICAgXG4gICAgLy8gLSBBZGQgT3RoZXIgTGlzdCBcbiAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspe1xuICAgICAgdG1wID0ge1xuICAgICAgICBtZXRob2Q6J1BVVCcsXG4gICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3QvJytzZWxlY3RlZFByb3NwZWN0c1tpXSxcbiAgICAgICAgYm9keToge1xuICAgICAgICAgIGxpc3RzOiB7XG4gICAgICAgICAgICAnX19vcCcgICAgOiAnQWRkVW5pcXVlJyxcbiAgICAgICAgICAgIFwib2JqZWN0c1wiIDogW3sgXG4gICAgICAgICAgICAgICAgJ19fdHlwZSc6J1BvaW50ZXInLFxuICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOidQcm9zcGVjdExpc3QnLFxuICAgICAgICAgICAgICAgICdvYmplY3RJZCc6bGlzdE9iamVjdElkXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYmF0Y2hEYXRhLnB1c2godG1wKVxuICAgIH1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9iYXRjaCcsXG4gICAgICB0eXBlOidQT1NUJyxcbiAgICAgIGhlYWRlcnM6cGFyc2VIZWFkZXJzLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe3JlcXVlc3RzOiBiYXRjaERhdGF9KSxcbiAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgbGlzdHMgPSB0aGlzcy5zdGF0ZS5saXN0c1xuXG4gICAgICAgIGZvcihpPTA7aTwgbGlzdHMubGVuZ3RoOyBpKyspIHsgXG4gICAgICAgICAgLy8gQWRkIFRvIE5ldyBMaXN0XG4gICAgICAgICAgaWYobGlzdHNbaV0ub2JqZWN0SWQgPT0gbGlzdE9iamVjdElkKVxuICAgICAgICAgICAgbGlzdHNbaV0uY291bnQgPSBwYXJzZUludChsaXN0c1tpXS5jb3VudCkgKyBwYXJzZUludChzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGgpXG4gICAgICAgICAgLy8gU3VidHJhY3QgRnJvbSBPbGQgTGlzdFxuICAgICAgICAgIGlmKGxpc3RzW2ldLm9iamVjdElkID09IHRoaXNzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgICAgICAgICBsaXN0c1tpXS5jb3VudCA9IHBhcnNlSW50KGxpc3RzW2ldLmNvdW50KSAtIHBhcnNlSW50KHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aClcbiAgICAgICAgfVxuICAgICAgICAvLyBVcGRhdGUgbG9jYWwgbGlzdCBjb3VudFxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7bGlzdHM6IGxpc3RzfSlcblxuICAgICAgICAvLyByZW1vdmUgZnJvbSBjdXJyZW50IGxpc3QgdWlcbiAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdGVkUHJvc3BlY3RzJylcbiAgICAgICAgY29uc29sZS5sb2codGhpc3Muc3RhdGUucHJvc3BlY3RzKVxuICAgICAgICB2YXIgZmlsdGVyZWQgPSBfLmZpbHRlcih0aGlzcy5zdGF0ZS5wcm9zcGVjdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICBpc19zZWxlY3RlZCA9IHRydWVcbiAgICAgICAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspIFxuICAgICAgICAgICAgaWYoaXRlbS5vYmplY3RJZCA9PSBzZWxlY3RlZFByb3NwZWN0c1tpXSlcbiAgICAgICAgICAgICAgaXNfc2VsZWN0ZWQgPSBmYWxzZVxuICAgICAgICAgIHJldHVybiBpc19zZWxlY3RlZFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coZmlsdGVyZWQpXG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtwcm9zcGVjdHM6IGZpbHRlcmVkfSlcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5zdHJpbmdpZnkoW10pXG5cbiAgICAgICAgLy8gYWRkIGFsZXJ0IHRvIGluZm9ybSB1c2VyXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgY29weVNlbGVjdGVkUHJvc3BlY3RzOiBmdW5jdGlvbihsaXN0T2JqZWN0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhsaXN0T2JqZWN0SWQpXG4gICAgXG4gICAgLy8gbWFrZSBiYXRjaCBhamF4IHJlcXVlc3QgdG8gcGFyc2VcbiAgICBwYXJzZUhlYWRlcnMgPSB7XG4gICAgICAnWC1QYXJzZS1BcHBsaWNhdGlvbi1JZCcgIDogJ044NVFPa3RlRUVRa3VaVkpLQXZ0OE1WZXMwc2pHNnFOcEVHcVFGVkonLCBcbiAgICAgICdYLVBhcnNlLVJFU1QtQVBJLUtleScgICAgOiAnVk42RXdWeUJad08xdXBoc0JQc2F1OHQ3SlFScDAwVU0zS1lzaWlRYicsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiIDogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9XG5cbiAgICAvLyBBZGQgTG9hZGluZyBTaWduIFRvIExpc3RcblxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgYmF0Y2hEYXRhID0gW11cbiAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspe1xuICAgICAgdG1wID0ge1xuICAgICAgICBtZXRob2Q6J1BVVCcsXG4gICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3QvJytzZWxlY3RlZFByb3NwZWN0c1tpXSxcbiAgICAgICAgYm9keToge1xuICAgICAgICAgIGxpc3RzOiB7XG4gICAgICAgICAgICAnX19vcCcgICAgOiAnQWRkVW5pcXVlJyxcbiAgICAgICAgICAgIFwib2JqZWN0c1wiIDogW3sgXG4gICAgICAgICAgICAgICAgJ19fdHlwZSc6J1BvaW50ZXInLFxuICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOidQcm9zcGVjdExpc3QnLFxuICAgICAgICAgICAgICAgICdvYmplY3RJZCc6bGlzdE9iamVjdElkXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYmF0Y2hEYXRhLnB1c2godG1wKVxuICAgIH1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9iYXRjaCcsXG4gICAgICB0eXBlOidQT1NUJyxcbiAgICAgIGhlYWRlcnM6cGFyc2VIZWFkZXJzLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe3JlcXVlc3RzOiBiYXRjaERhdGF9KSxcbiAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgLy8gVXBkYXRlIFdpdGggdGhlIG51bWJlciBvZiBzdWNjZXNzZXNcbiAgICAgICAgLy8gVXBkYXRlIGxvY2FsIGxpc3QgY291bnRcbiAgICAgICAgbGlzdHMgPSB0aGlzcy5zdGF0ZS5saXN0c1xuICAgICAgICBmb3IoaT0wO2k8IGxpc3RzLmxlbmd0aDsgaSsrKSB7IFxuICAgICAgICAgIGlmKGxpc3RzW2ldLm9iamVjdElkID09IGxpc3RPYmplY3RJZClcbiAgICAgICAgICAgIGxpc3RzW2ldLmNvdW50ID0gcGFyc2VJbnQobGlzdHNbaV0uY291bnQpICsgcGFyc2VJbnQocmVzLmxlbmd0aClcbiAgICAgICAgfVxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7bGlzdHM6IGxpc3RzfSlcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzID0gXCJbXVwiXG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtzZWxlY3RlZFByb3NwZWN0cyA6IFtdIH0pXG4gICAgICAgIFxuICAgICAgICAvLyBhZGQgYWxlcnQgdG8gaW5mb3JtIHVzZXJcbiAgICAgICAgLy8gVW5zZWxlY3QgYWxsIHNlbGVjdGVkXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcblxuICBoaWRlQWxlcnQ6IGZ1bmN0aW9uKCkge1xuICAgICQoJy5hbGVydCcpLmhpZGUoKVxuICB9LFxuXG4gIGFkanVzdEhlaWdodDogZnVuY3Rpb24od2hpY2hPbmUpIHtcbiAgICBwcm9zcGVjdFdpbmRvd1RvcCA9ICQoJyNwcm9zcGVjdERldGFpbEJ1dHRvbnMnKS5wb3NpdGlvbigpLnRvcFxuICAgIHByb3NwZWN0V2luZG93VG9wID0gcHJvc3BlY3RXaW5kb3dUb3AgKyAkKCcjcHJvc3BlY3REZXRhaWxCdXR0b25zJykuaGVpZ2h0KClcbiAgICBwcm9zcGVjdFdpbmRvd0JvdHRvbSA9ICQoJyNhdXRvc2Nyb2xsJykucG9zaXRpb24oKS50b3AgKyAkKCcjYXV0b3Njcm9sbCcpLmhlaWdodCgpXG5cbiAgICBpZih3aGljaE9uZSA9PSAnaicpXG4gICAgICBhY3RpdmVQcm9zcGVjdCA9IHRoaXMuc3RhdGUua2V5Ym9hcmRBY3RpdmVQcm9zcGVjdCArMSBcbiAgICBlbHNlXG4gICAgICBhY3RpdmVQcm9zcGVjdCA9IHRoaXMuc3RhdGUua2V5Ym9hcmRBY3RpdmVQcm9zcGVjdCAtMSBcblxuICAgIGFjdGl2ZVRvcCA9ICQoJCgnLnByb3NwZWN0cy10cicpW2FjdGl2ZVByb3NwZWN0XSkucG9zaXRpb24oKS50b3BcbiAgICBzZWxlY3RlZEhlaWdodCA9ICQoJCgnLnByb3NwZWN0cy10cicpW2FjdGl2ZVByb3NwZWN0XSkuaGVpZ2h0KClcbiAgICBhY3RpdmVCb3R0b20gPSAkKCQoJy5wcm9zcGVjdHMtdHInKVthY3RpdmVQcm9zcGVjdF0pLnBvc2l0aW9uKCkudG9wK3NlbGVjdGVkSGVpZ2h0XG5cbiAgICBjb25zb2xlLmxvZyhwcm9zcGVjdFdpbmRvd1RvcCwgcHJvc3BlY3RXaW5kb3dCb3R0b20pXG4gICAgY29uc29sZS5sb2coYWN0aXZlVG9wLCBhY3RpdmVCb3R0b20pXG5cbiAgICBzY3JvbGxUb3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b3Njcm9sbCcpLnNjcm9sbFRvcFxuICAgIGlmKGFjdGl2ZUJvdHRvbSA+IHByb3NwZWN0V2luZG93Qm90dG9tKVxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9zY3JvbGwnKS5zY3JvbGxUb3AgPSBzY3JvbGxUb3AgKyBhY3RpdmVCb3R0b20gLSBwcm9zcGVjdFdpbmRvd0JvdHRvbVxuXG4gICAgaWYoYWN0aXZlVG9wIDwgMClcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvc2Nyb2xsJykuc2Nyb2xsVG9wID0gc2Nyb2xsVG9wICsgYWN0aXZlVG9wIC0gMzdcbiAgICBlbHNlIGlmKGFjdGl2ZVRvcCA9PSAkKCQoJy5wcm9zcGVjdHMtdHInKVswXSkucG9zaXRpb24oKS50b3ApXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b3Njcm9sbCcpLnNjcm9sbFRvcCA9IDBcbiAgICAgIFxuICAgIC8vIEdldCBQb3N0aW9uIG9mIFRvcFxuICAgIC8vIEdldCBQb3NpdGlvbiBvZiBCb3R0b20gXG4gICAgLy8gR2V0IFBvc2l0aW9uIG9mIEN1cnJlbnQgU2VsZWN0ZWRcbiAgICAvLyBBZGp1c3QgYnkgc2Nyb2xsaW5nIGRvd24gb3IgdXBcbiAgfSxcblxuICBzdGFydEtleWJvYXJkU2hvcnRjdXRzOiBmdW5jdGlvbigpIHtcbiAgICAvKiBLZXlib2FyZCBTaG9ydGN1dHMgKi9cbiAgICBNb3VzZXRyYXAucmVzZXQoKVxuICAgIC8vTW91c2V0cmFwLnVuYmluZChbJ2onLCdrJywnbyddKVxuICAgIHRoaXNzID0gdGhpcztcblxuICAgIC8qIFByb3NwZWN0IFRhYmxlIFNob3J0Y3V0cyAqL1xuICAgIE1vdXNldHJhcC5iaW5kKCdqJywgZnVuY3Rpb24oKSB7IFxuICAgICAga2V5Ym9hcmQgPSB0aGlzcy5zdGF0ZS5rZXlib2FyZEFjdGl2ZVByb3NwZWN0XG4gICAgICBpZihrZXlib2FyZCAhPSB0aGlzcy5zdGF0ZS5wcm9zcGVjdHNQZXJQYWdlKzEpXG4gICAgICAgIHRoaXNzLmFkanVzdEhlaWdodCgnaicpXG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtrZXlib2FyZEFjdGl2ZVByb3NwZWN0OiBrZXlib2FyZCsxfSlcbiAgICB9KTtcblxuICAgIE1vdXNldHJhcC5iaW5kKCdrJywgZnVuY3Rpb24oKSB7IFxuICAgICAga2V5Ym9hcmQgPSB0aGlzcy5zdGF0ZS5rZXlib2FyZEFjdGl2ZVByb3NwZWN0XG4gICAgICBpZihrZXlib2FyZCAhPSAxKVxuICAgICAgICB0aGlzcy5hZGp1c3RIZWlnaHQoJ2snKVxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7a2V5Ym9hcmRBY3RpdmVQcm9zcGVjdDoga2V5Ym9hcmQtMX0pXG4gICAgfSk7XG5cblxuICAgIE1vdXNldHJhcC5iaW5kKCdvJywgZnVuY3Rpb24oKSB7IFxuICAgICAgY29uc29sZS5sb2coJ29wZW4gY3VycmVudCBwcm9zcGVjdCcpXG4gICAgICBjb25zb2xlLmxvZygkKCQoJy5rZXlTZWxlY3QnKS5maW5kKCdhLmxpbmtlZGluX2xpbmsnKVswXSkuYXR0cignaHJlZicpKVxuICAgICAgbGluayA9ICQoJCgnLmtleVNlbGVjdCcpLmZpbmQoJ2EubGlua2VkaW5fbGluaycpWzBdKS5hdHRyKCdocmVmJylcbiAgICAgIC8qXG4gICAgICB3aW5kb3cub3BlbihsaW5rLCAnX2JsYW5rJylcbiAgICAgIGNvbnNvbGUubG9nKCduZXcnKVxuICAgICAgKi9cbiAgICAgIC8vcG9wdXBXaW5kb3cuYmx1cigpO1xuICAgICAgLy93aW5kb3cuZm9jdXMoKTtcbiAgICAgIC8vIGtleWJvYXJkID0gdGhpc3Muc3RhdGUua2V5Ym9hcmRBY3RpdmVQcm9zcGVjdFxuICAgICAgXG4gICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xuICAgICAgYS5ocmVmID0gbGlua1xuICAgICAgdmFyIGV2dCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KFwiTW91c2VFdmVudHNcIik7XG4gICAgICAvL3RoZSB0ZW50aCBwYXJhbWV0ZXIgb2YgaW5pdE1vdXNlRXZlbnQgc2V0cyBjdHJsIGtleVxuICAgICAgLy8gRm9yIE1hYyBUaGlzIFdvcmtzIENoZWNrIEZvciAtIFdpbmRvd3NcbiAgICAgIGV2dC5pbml0TW91c2VFdmVudChcImNsaWNrXCIsIHRydWUsIHRydWUsIHdpbmRvdywgMCwgMCwgMCwgMCwgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlLCB0cnVlLCAwLCBudWxsKTtcbiAgICAgIGEuZGlzcGF0Y2hFdmVudChldnQpO1xuICAgIH0pO1xuXG5cblxuICAgIC8qIExpc3QgTW9kaWZpY2F0aW9uIFNob3J0Y3V0cyAqL1xuICAgIE1vdXNldHJhcC5iaW5kKCd0YWIrcicsIGZ1bmN0aW9uKCl7XG4gICAgICAvL2NvbnNvbGUubG9nKCdyZWxvYWQnKVxuICAgICAgJCgnI3JlbmFtZUxpc3RCdG4nKS5jbGljaygpXG4gICAgfSlcblxuICAgIE1vdXNldHJhcC5iaW5kKCd0YWIrZCcsIGZ1bmN0aW9uKCl7XG4gICAgICAvL2NvbnNvbGUubG9nKCdyZWxvYWQnKVxuICAgICAgJCgnI2RlbGV0ZUxpc3RNb2RhbCcpLmNsaWNrKClcbiAgICB9KVxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ3RhYitzJywgZnVuY3Rpb24oKXtcbiAgICAgIC8vY29uc29sZS5sb2coJ3JlbG9hZCcpXG4gICAgICAvLyQoJyNkb3dubG9hZFByb3NwZWN0cycpLmNsaWNrKClcbiAgICAgIHRoaXNzLmRvd25sb2FkRmlsZSgpXG4gICAgfSlcblxuICAgIE1vdXNldHJhcC5iaW5kKCdzaGlmdCtsJywgZnVuY3Rpb24oKXtcbiAgICAgIC8vY29uc29sZS5sb2coJ3JlbG9hZCcpXG4gICAgICAvLyQoJyNkb3dubG9hZFByb3NwZWN0cycpLmNsaWNrKClcbiAgICAgIC8vdGhpc3MuZG93bmxvYWRGaWxlKClcbiAgICAgICQoJy5uZXctbGlzdC1idG4nKS5jbGljaygpXG4gICAgfSlcblxuICAgIE1vdXNldHJhcC5iaW5kKCdlJywgZnVuY3Rpb24oKXtcbiAgICAgIGNvbnNvbGUubG9nKCdyZWxvYWQnKVxuICAgICAgLy8kKCcjZG93bmxvYWRQcm9zcGVjdHMnKS5jbGljaygpXG4gICAgICB0aGlzcy5yZW1vdmVTZWxlY3RlZFByb3NwZWN0cygpXG4gICAgfSlcblxuICAgIE1vdXNldHJhcC5iaW5kKCdjJywgZnVuY3Rpb24oKSB7IFxuICAgICAgY29uc29sZS5sb2coJ2NvcHknKVxuICAgICAgJCgnI2NvcHlUb0xpc3QnKS5jbGljaygpXG4gICAgfSk7XG5cbiAgICBNb3VzZXRyYXAuYmluZCgnbScsIGZ1bmN0aW9uKCkgeyBcbiAgICAgIGNvbnNvbGUubG9nKCdjb3B5JylcbiAgICAgICQoJyNtb3ZlVG9MaXN0JykuY2xpY2soKVxuICAgIH0pO1xuXG4gICAgLy9Nb3VzZXRyYXAuYmluZCgnZScsIGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnZScpOyB9KTtcbiAgICBNb3VzZXRyYXAuYmluZCgncmlnaHQnLCBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ3JpZ2h0Jyk7IH0pO1xuICAgIE1vdXNldHJhcC5iaW5kKCdsZWZ0JywgZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKCdsZWZ0Jyk7IH0pO1xuXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIC8qIE9uTG9hZCBGb3IgVGhlIEZpcnN0IFRpbWUgRnVuY3Rpb24gKi9cbiAgICB2YXIgdGhpc3NzID0gdGhpcztcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShbXSlcbiAgICBjdXJyZW50VXNlciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKVxuICAgIHVzZXIgPSBhcHBDb25maWcucG9pbnRlcignVXNlcicsIGN1cnJlbnRVc2VyLm9iamVjdElkKVxuXG4gICAgYXJjaGl2ZUxpc3QgPSBKU09OLnN0cmluZ2lmeSh7IFxuICAgICAgJ29iamVjdElkJzonU2VyUFFqY2t2ZScsIC8vIFRPRE8gLSBEaWZmZXJlbnRlIEZvciBXYXRjaCBVc2VyXG4gICAgICAnX190eXBlJzonUG9pbnRlcicsIFxuICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JyBcbiAgICB9KVxuXG4gICAgcXJ5ID0ge1xuICAgICAgd2hlcmU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgY29tcGFueTogY3VycmVudFVzZXIuY29tcGFueSxcbiAgICAgICAgYXJjaGl2ZWQ6IHRydWUsXG4gICAgICB9KSxcbiAgICAgIGNvdW50OiAxLFxuICAgICAgb3JkZXI6ICctY3JlYXRlZEF0JyxcbiAgICAgIGxpbWl0OiB0aGlzLnN0YXRlLnByb3NwZWN0c1BlclBhZ2UsXG4gICAgICBpbmNsdWRlOiAnZW1haWxfZ3Vlc3NlcyxlbWFpbF9ndWVzc2VzLnBhdHRlcm4nXG4gICAgfVxuXG4gICAgaWYodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCAhPSAnQWxsJyl7XG4gICAgICBjdXJyZW50TGlzdD1hcHBDb25maWcucG9pbnRlcignUHJvc3BlY3RMaXN0Jyx0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgICBxcnkgPSB7XG4gICAgICAgIHdoZXJlOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgY29tcGFueTogY3VycmVudFVzZXIuY29tcGFueSxcbiAgICAgICAgICBsaXN0czogY3VycmVudExpc3RcbiAgICAgICAgfSksXG4gICAgICAgIGNvdW50OiAxXG4gICAgICB9XG4gICAgfVxuXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogJ2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3QnLFxuICAgICAgdHlwZTonR0VUJyxcbiAgICAgIGhlYWRlcnM6IGFwcENvbmZpZy5wYXJzZUhlYWRlcnMsXG4gICAgICBjYWNoZTogdHJ1ZSxcbiAgICAgIGRhdGE6IHFyeSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtcbiAgICAgICAgICBwcm9zcGVjdHM6IHJlcy5yZXN1bHRzLFxuICAgICAgICAgIGNvdW50OiByZXMuY291bnQsXG4gICAgICAgICAgdG90YWxDb3VudDogcmVzLmNvdW50LFxuICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwocmVzLmNvdW50L3RoaXNzcy5wcm9wcy5wcm9zcGVjdHNQZXJQYWdlKSxcbiAgICAgICAgICBsb2FkaW5nOiBmYWxzZSxcbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24ocmVzKXsgY29uc29sZS5sb2cocmVzKSB9XG4gICAgfSlcblxuICAgIGN1cnJlbnRVc2VyID0geyBcbiAgICAgICdfX3R5cGUnICAgOiAnUG9pbnRlcicsXG4gICAgICAnY2xhc3NOYW1lJzogJ19Vc2VyJyxcbiAgICAgICdvYmplY3RJZCcgOiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikub2JqZWN0SWRcbiAgICB9XG5cbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgcXJ5ID0ge1xuICAgICAgd2hlcmU6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdXNlcjogYXBwQ29uZmlnLnBvaW50ZXIoJ19Vc2VyJywgY3VycmVudFVzZXIub2JqZWN0SWQpXG4gICAgICB9KSxcbiAgICAgIGNvdW50OiAxLFxuICAgICAgb3JkZXI6ICctY3JlYXRlZEF0JyxcbiAgICB9XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogJ2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RMaXN0JyxcbiAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgaGVhZGVyczogYXBwQ29uZmlnLnBhcnNlSGVhZGVycyxcbiAgICAgIGRhdGE6IHFyeSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgIHJlc3VsdHMgPSByZXMucmVzdWx0c1xuICAgICAgICBmb3IoaT0wO2k8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICByZXN1bHRzLmNvdW50ID0gJ34nXG4gICAgICAgIH1cbiAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2xpc3RzOiByZXN1bHRzfSlcbiAgICAgICAgLy8gTWFrZSBiYXRjaCByZXF1ZXN0IHRvIGdldCBsaXN0IGNvdW50cyBhZnRlciB0aGV5IGFyZSBsb2FkZWRcbiAgICAgICAgZm9yKGk9MDtpIDwgcmVzLnJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShyZXMucmVzdWx0c1tpXS5vYmplY3RJZCwgXCJcIilcbiAgICAgICAgfVxuXG4gICAgICAgIGZvcihpPTA7aTwgcmVzLnJlc3VsdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBsaXN0ID0ge1xuICAgICAgICAgICAgJ19fdHlwZScgICAgOiAnUG9pbnRlcicsXG4gICAgICAgICAgICAnb2JqZWN0SWQnICA6IHJlcy5yZXN1bHRzW2ldLm9iamVjdElkLFxuICAgICAgICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JywgXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdCcsXG4gICAgICAgICAgICB0eXBlOidHRVQnLFxuICAgICAgICAgICAgaGVhZGVyczogYXBwQ29uZmlnLnBhcnNlSGVhZGVycyxcbiAgICAgICAgICAgIGxpc3RPYmplY3RJZDogcmVzLnJlc3VsdHNbaV0ub2JqZWN0SWQsXG4gICAgICAgICAgICBkYXRhOiAnd2hlcmU9e1wibGlzdHNcIjonK0pTT04uc3RyaW5naWZ5KGxpc3QpKyd9JmNvdW50PTEnLFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgICAgIC8vY29uc29sZS5sb2codGhpcy5saXN0T2JqZWN0SWQpXG4gICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMubGlzdE9iamVjdElkLCByZXMuY291bnQpXG4gICAgICAgICAgICAgIGFtb3VudCA9IDBcbiAgICAgICAgICAgICAgZm9yKGlpPTA7aWk8IHJlc3VsdHMubGVuZ3RoO2lpKyspe1xuICAgICAgICAgICAgICAgIGlmKGxvY2FsU3RvcmFnZS5nZXRJdGVtKHJlc3VsdHNbaWldLm9iamVjdElkKSA9PSBcIlwiKVxuICAgICAgICAgICAgICAgICAgYW1vdW50ID0gYW1vdW50ICsgMVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYoYW1vdW50ID09IDApIHtcbiAgICAgICAgICAgICAgICBmb3IoaWk9MDtpaTwgcmVzdWx0cy5sZW5ndGg7aWkrKylcbiAgICAgICAgICAgICAgICAgIHJlc3VsdHNbaWldLmNvdW50ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0ocmVzdWx0c1tpaV0ub2JqZWN0SWQpXG5cbiAgICAgICAgICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7bGlzdHM6IHJlc3VsdHN9KVxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ0dvdCBDb3VudHMnKVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gdXBkYXRlZCByZXMuY291bnRcbiAgICAgICAgICAgICAgLy90aGlzcy5zZXRTdGF0ZSh7Y291bnQ6IHJlcy5jb3VudH0pXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyKSB9XG4gICAgfSk7XG4gIH0sXG5cbiAgZ2VuZXJhdGVfaWQgOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICdfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTtcbiAgfSxcbn0pO1xuXG4vKiAgRHJvcGRvd24gTWVudXMgKi9cblxudmFyIEN1cnJlbnRMaXN0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0N1cnJlbnRMaXN0cycsXG4gIGxpc3RBY3Rpb246IGZ1bmN0aW9uKGUpIHtcbiAgICBsaXN0TmFtZSA9ICQoZS50YXJnZXQpLnRleHQoKVxuICAgIFxuICAgIHZhciBsaXN0U2VsZWN0ID0gXy5maWx0ZXIodGhpcy5wcm9wcy5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbGlzdE5hbWVcbiAgICB9KTtcblxuICAgIHRoaXMucHJvcHMubGlzdEFjdGlvbihsaXN0U2VsZWN0WzBdLm9iamVjdElkKVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgbGlzdHMgPSBbXSBcbiAgICBmb3IoaT0wO2k8IHRoaXMucHJvcHMubGlzdHMubGVuZ3RoO2krKykge1xuICAgICAgbGlzdHMucHVzaChcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnLGZvbnRTaXplOicxMHB4J30sIFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcImRyb3Bkb3duLWxpc3QtbmFtZVwiLCBcbiAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmxpc3RBY3Rpb259LCB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuY29weURyb3Bkb3duU3R5bGUpXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7cmlnaHQ6MTU4fX0sIFxuICAgICAgICBsaXN0c1xuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgTGlzdHNNZW51ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTGlzdHNNZW51JyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnVsKHtjbGFzc05hbWU6IFwiZHJvcGRvd24tbWVudSBkcm9wLXRlc3RcIiwgaWQ6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgIG1pbldpZHRoOidpbmhlcml0JyxcbiAgICAgICAgICAgIHRvcDogJzIwcHgnLFxuICAgICAgICAgICAgd2lkdGg6ICcxMjVweCcsXG4gICAgICAgICAgICByaWdodDogJzE1NHB4JyxcbiAgICAgICAgICAgIGxlZnQ6J2F1dG8nXG4gICAgICAgICAgfX0sIFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe2hyZWY6IFwiI2Jvb2tzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXRpbWVzXCJ9KSwgXCIgwqBcIiArICcgJyArXG4gICAgICAgICAgXCJEZWxldGUgTGlzdFwiXG4gICAgICAgICkpLCBcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtocmVmOiBcIiNwb2RjYXN0c1wifSwgXG4gICAgICAgICAgXCJSZW5hbWUgTGlzdHNcIlxuICAgICAgICApKVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgQ3VycmVudExpc3RzVHdvID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnQ3VycmVudExpc3RzVHdvJyxcbiAgbGlzdEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIGxpc3ROYW1lID0gJChlLnRhcmdldCkudGV4dCgpXG4gICAgXG4gICAgdmFyIGxpc3RTZWxlY3QgPSBfLmZpbHRlcih0aGlzLnByb3BzLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBsaXN0TmFtZVxuICAgIH0pO1xuXG4gICAgdGhpcy5wcm9wcy5saXN0QWN0aW9uKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0cyA9IFtdIFxuICAgIGZvcihpPTA7aTx0aGlzLnByb3BzLmxpc3RzLmxlbmd0aDtpKyspIHtcbiAgICAgIGxpc3RzLnB1c2goXG4gICAgICAgIFJlYWN0LkRPTS5saShudWxsLCBSZWFjdC5ET00uYSh7c3R5bGU6IHtmb250V2VpZ2h0Oidib2xkJyxmb250U2l6ZTonMTBweCd9LCBcbiAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJkcm9wZG93bi1saXN0LW5hbWVcIiwgXG4gICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5saXN0QWN0aW9ufSwgXG4gICAgICAgICAgdGhpcy5wcm9wcy5saXN0c1tpXS5uYW1lKSlcbiAgICAgIClcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB0aGlzLnByb3BzLmNvcHlEcm9wZG93blN0eWxlfSwgXG4gICAgICAgIGxpc3RzXG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbnZhciBMaXN0RGV0YWlsQnV0dG9ucyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0xpc3REZXRhaWxCdXR0b25zJyxcbiAgLy8gUmVuYW1lIExpc3RcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZWRpdE1vZGU6IGZhbHNlXG4gICAgfVxuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgIGlmKCF0aGlzLnN0YXRlLmVkaXRNb2RlKSB7XG4gICAgICBzdHVmZiA9IFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwiXCIsIHN0eWxlOiBsaXN0TmFtZVN0eWxlfSwgXG4gICAgICAgICAgICAodGhpcy5wcm9wcy5jdXJyZW50TGlzdE5hbWUgPT0gXCJBbGxcIikgPyAnJyA6IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYmFyc1wiLCBzdHlsZToge2ZvbnRTaXplOjE2LCBtYXJnaW5Ub3A6LTV9fSksIFxuICAgICAgICAgICAgKHRoaXMucHJvcHMuY3VycmVudExpc3ROYW1lID09IFwiQWxsXCIpID8gJycgOiBcIiAgIFwiICt0aGlzLnByb3BzLmN1cnJlbnRMaXN0TmFtZVxuICAgICAgICAgICAgICApXG4gICAgfSBlbHNlIHtcbiAgICAgIHN0dWZmID0gUmVhY3QuRE9NLmlucHV0KHtjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCIsIHN0eWxlOiB7d2lkdGg6IDEwMCwgZmxvYXQ6ICdsZWZ0JywgaGVpZ2h0OiAyNCwgbWFyZ2luVG9wOiAtMX19KVxuICAgIH1cbiAgICByZXR1cm4gKFxuXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdihudWxsLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNCh7c3R5bGU6IHttYXJnaW46MH19LCBcbiAgICAgICAgICAgICAgc3R1ZmYsIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICAgICBzdHlsZTogbGlzdEJ0biwgXG4gICAgICAgICAgICAgICAgJ2RhdGEtdG9nZ2xlJzogXCJtb2RhbFwiLCBcbiAgICAgICAgICAgICAgICBpZDogXCJyZW5hbWVMaXN0QnRuXCIsIFxuICAgICAgICAgICAgICAgICdkYXRhLXRhcmdldCc6IFwiLmJzLXJlbmFtZUxpc3QtbW9kYWwtc21cIiwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGVuY2lsXCJ9KVxuICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5kZWxldGVMaXN0LCBcbiAgICAgICAgICAgICAgICBzdHlsZTogbGlzdEJ0biwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdHJhc2gtb1wifSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSwgXG5cbiAgICAgICAgICAgIFJlbmFtZUxpc3RNb2RhbCh7cmVuYW1lTGlzdDogdGhpcy5wcm9wcy5yZW5hbWVMaXN0fSksIFxuICAgICAgICAgICAgRGVsZXRlTGlzdE1vZGFsKHtkZWxldGVMaXN0OiB0aGlzLnByb3BzLmRlbGV0ZUxpc3R9KVxuICAgICAgICAgIClcbiAgICAgICk7XG4gIH0sXG5cbiAgcmVuYW1lTGlzdDogZnVuY3Rpb24obmV3TGlzdE5hbWUpIHtcbiAgICB0aGlzLnByb3BzLnJlbmFtZUxpc3QobmV3TGlzdE5hbWUpXG4gIH0sXG5cbiAgZGVsZXRlTGlzdDogZnVuY3Rpb24oKXtcbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgc3dhbCh7ICAgXG4gICAgICB0aXRsZTogXCJBcmUgeW91IHN1cmU/XCIsICAgXG4gICAgICB0ZXh0OiBcIllvdXIgd2lsbCBub3QgYmUgYWJsZSB0byByZWNvdmVyIHRoaXMgcHJvc3BlY3QgbGlzdCFcIiwgICBcbiAgICAgIHR5cGU6IFwid2FybmluZ1wiLCAgIFxuICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSwgICBcbiAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogXCIjREQ2QjU1XCIsICAgXG4gICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJZZXMsIGRlbGV0ZSBpdCFcIiwgICBcbiAgICAgIGNsb3NlT25Db25maXJtOiBmYWxzZSB9LCBcbiAgICAgIGZ1bmN0aW9uKCl7ICAgc3dhbChcIkRlbGV0ZWQhXCIsIFwiWW91ciBwcm9zcGVjdCBsaXN0IGhhcyBiZWVuIGRlbGV0ZWQuXCIsIFwic3VjY2Vzc1wiKTsgXG4gICAgICAgIGNvbnNvbGUubG9nKCdkZWxldGVkJylcbiAgICAgICAgdGhpc3MucHJvcHMuZGVsZXRlTGlzdCgpXG4gICAgICB9KTtcbiAgfSxcblxuICB0b2dnbGVFZGl0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtlZGl0TW9kZTogIXRoaXMuc3RhdGUuZWRpdE1vZGUgfSlcbiAgfVxufSk7XG5cblxuXG52YXIgUGFnaW5hdGVPdmVybGF5ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnUGFnaW5hdGVPdmVybGF5JyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtpZDogXCJwYWdpbmF0ZS1vdmVybGF5XCIsIHN0eWxlOiB7cGFkZGluZ1RvcDo3MH19LCBcbiAgICAgICAgICBTcGlubmVyKHtjaXJjbGVTdHlsZToge2JhY2tncm91bmRDb2xvcjond2hpdGUnfX0pXG4gICAgICAgIClcblxuICAgIClcbiAgfVxufSlcblxuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIGNyZWF0ZUxpc3RNb2RhbFxuICBjcmVhdGVMaXN0OiBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZygkKCcjbGlzdFRpdGxlJykudmFsKCkpXG5cbiAgICBkYXRhID0gIHtcbiAgICAgICduYW1lJyAgICAgICAgOiAkKCcjbGlzdFRpdGxlJykudmFsKCkudHJpbSgpLCAgIC8vV2FpdGluZyAsIFJ1bm5pbmdcbiAgICAgICd1c2VyJyAgICAgICAgOiB7ICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonX1VzZXInLFxuICAgICAgICAgICAgICAgICAgICAgICdvYmplY3RJZCc6J3hXRVNpdzVTbWQnIH0sXG4gICAgfVxuXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QnLFxuICAgICAgdHlwZTonUE9TVCcsXG4gICAgICBoZWFkZXJzOiBhcHBDb25maWcucGFyc2VIZWFkZXJzLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZGF0YS5jb3VudCA9IDBcblxuICAgIHRoaXMucHJvcHMuY3JlYXRlTGlzdChkYXRhKVxuICAgIFxuICAgICQoJyNjcmVhdGVMaXN0TW9kYWwnKS5tb2RhbCgnaGlkZScpXG4gICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdtb2RhbC1vcGVuJyk7XG4gICAgJCgnLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7XG4gICAgLy8kKCdidXR0b24uY2xvc2UnKS5jbGljaygpXG4gIH0sXG5cbiAgcmVuYW1lTGlzdDogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIC8vY29uc29sZS5sb2coJCgnI25ld0xpc3ROYW1lJykudmFsKCkpXG4gICAgbmV3TGlzdE5hbWUgPSAkKCcjbmV3TGlzdE5hbWUnKS52YWwoKVxuICAgIGlmKG5ld0xpc3ROYW1lLnRyaW0oKSAhPSBcIlwiKVxuICAgICAgdGhpcy5wcm9wcy5yZW5hbWVMaXN0KG5ld0xpc3ROYW1lKVxuICAgIC8vIERpc2FibGUgTW9kYWxcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsIGZhZGUgYnMtcmVuYW1lTGlzdC1tb2RhbC1zbVwiLCB0YWJJbmRleDogXCItMVwiLCByb2xlOiBcImRpYWxvZ1wiLCAnYXJpYS1sYWJlbGxlZGJ5JzogXCJteVNtYWxsTW9kYWxMYWJlbFwiLCAnYXJpYS1oaWRkZW4nOiBcInRydWVcIiwgaWQ6IFwiY3JlYXRlTGlzdE1vZGFsXCIsIHN0eWxlOiB7dG9wOicyMDBweCd9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtZGlhbG9nIG1vZGFsLXNtXCJ9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWNvbnRlbnRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1oZWFkZXJcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImNsb3NlXCIsICdkYXRhLWRpc21pc3MnOiBcIm1vZGFsXCJ9LCBSZWFjdC5ET00uc3Bhbih7J2FyaWEtaGlkZGVuJzogXCJ0cnVlXCJ9LCBcIsOXXCIpLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJzci1vbmx5XCJ9LCBcIkNsb3NlXCIpKSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaDQoe2NsYXNzTmFtZTogXCJtb2RhbC10aXRsZVwiLCBpZDogXCJteU1vZGFsTGFiZWxcIn0sIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWxpc3RcIn0pLCBcIiDCoFJlbmFtZSBMaXN0XCIpXG4gICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWJvZHlcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmZvcm0oe29uU3VibWl0OiB0aGlzLnJlbmFtZUxpc3R9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmlucHV0KHtpZDogXCJuZXdMaXN0TmFtZVwiLCB0eXBlOiBcInRleHRcIiwgcGxhY2Vob2xkZXI6IFwiRW50ZXIgbGlzdCB0aXRsZS4uLlwiLCBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCJ9KSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5icihudWxsKSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucmVuYW1lTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tc3VjY2Vzc1wiLCBcbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZToge2Rpc3BsYXk6J2Jsb2NrJywgd2lkdGg6JzEwMCUnfX0sIFxuICAgICAgICAgICAgICAgICAgICAgIFwiQ3JlYXRlIExpc3RcIlxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxudmFyIFNpZGVNZW51TGlzdE9wdGlvbiA9IHJlcXVpcmUoJy4vdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMnKTtcbnZhciBjcmVhdGVMaXN0TW9kYWwgPSByZXF1aXJlKCcuL2NyZWF0ZV9saXN0X21vZGFsLmpzLm1pbi5qcycpXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vU2lkZU1lbnVQcm9zcGVjdHMgLSBTaWRlTGlzdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICAvKlxuICAgICAgY3JlYXRlTGlzdDogXG4gICAgICByZW5hbWVMaXN0OlxuICAgICAgZGVsZXRlTGlzdDpcbiAgICAgIGNoYW5nZUxpc3Q6XG4gICAgICBjdXJyZW50TGlzdDpcbiAgICAgIHRvdGFsQ291bnQ6XG4gICAgICBsaXN0czpcbiAgICAgICovXG4gICAgfVxuICB9LFxuXG4gIGNyZWF0ZUxpc3Q6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdGhpcy5wcm9wcy5jcmVhdGVMaXN0KGRhdGEpXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICB9LFxuXG4gIGNoYW5nZUxpc3Q6IGZ1bmN0aW9uKGUpIHtcbiAgICAvKlxuICAgIGN1cnJlbnRMaXN0ID0gJChlLnRhcmdldCkucGFyZW50KCkvLy5kYXRhKCdsaXN0JylcbiAgICBjb25zb2xlLmxvZyhjdXJyZW50TGlzdClcbiAgICB0aGlzLnByb3BzLmNoYW5nZUxpc3QoY3VycmVudExpc3QubmFtZSwgY3VycmVudExpc3Qub2JqZWN0SWQpXG4gICAgKi9cbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIGlmKHRoaXMucHJvcHMuY3VycmVudExpc3QgPT0gXCJBbGxcIilcbiAgICAgIHN0eWxlcyA9IHsnYmFja2dyb3VuZENvbG9yJzoncmdiKDAsIDEyMiwgMjU1KScsICdjb2xvcic6J3doaXRlJ30gXG4gICAgZWxzZVxuICAgICAgc3R5bGVzID0gIHt9XG5cbiAgICBsaXN0cyA9IFtTaWRlTWVudUxpc3RPcHRpb24oe2xpc3Q6IHtuYW1lOiAnQWxsJyxjb3VudDogdGhpcy5wcm9wcy50b3RhbENvdW50fSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uVHlwZTogJ3VzZXJzJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KSwgXG4gICAgICAgICAgICAgU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiB7bmFtZTogJ0FyY2hpdmVkJywgY291bnQ6ICd+J30sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvblR5cGU6ICdhcmNoaXZlJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGlkZUNvdW50OiB0cnVlfSldXG5cbiAgICBmb3IoaT0wO2k8IHRoaXMucHJvcHMubGlzdHMubGVuZ3RoO2krKyl7XG4gICAgICBsaXN0ID0gdGhpcy5wcm9wcy5saXN0c1tpXVxuICAgICAgaWYobGlzdC5saXN0X3R5cGUgPT0gXCJzaWduYWxfbGlzdFwiKVxuICAgICAgICBpY29uVHlwZSA9IFwid2lmaVwiXG4gICAgICBlbHNlIGlmIChsaXN0Lmxpc3RfdHlwZSA9PSBcIm1pbmluZ19qb2JcIilcbiAgICAgICAgaWNvblR5cGUgPSBcImNsb3VkRG93bmxvYWRcIlxuICAgICAgaWYobGlzdC5saXN0X3R5cGUpXG4gICAgICAgIGxpc3RzLnB1c2goIFNpZGVNZW51TGlzdE9wdGlvbih7bGlzdDogbGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvblR5cGU6IGljb25UeXBlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KSlcbiAgICAgIGVsc2UgXG4gICAgICAgIGxpc3RzLnB1c2goIFNpZGVNZW51TGlzdE9wdGlvbih7bGlzdDogbGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlTGlzdDogdGhpcy5wcm9wcy5jaGFuZ2VMaXN0fSkpXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjb2wtbGctMiBjb2wtbWQtMiBjb2wtc20tMiBjb2wteHMtMlwiLCBcbiAgICAgICAgICAgc3R5bGU6IHtwYWRkaW5nOicwJyxoZWlnaHQ6JzQzOHB4JyxiYWNrZ3JvdW5kQ29sb3I6JyNlMGU5ZWUnLFxuICAgICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0OicxcHggc29saWQgI2IwYjhiZicsdGV4dEFsaWduOidjZW50ZXInfX0sIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicHJvc3BlY3QtbGlzdC1oZWFkZXJcIn0sIFwiIExpc3RzIFwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJidG4tZ3JvdXAtdmVydGljYWxcIiwgXG4gICAgICAgICAgICAgc3R5bGU6IHt3aWR0aDonMTAwJScsIGhlaWdodDogJzMyMHB4Jywgb3ZlcmZsb3c6ICdhdXRvJ319LCBcbiAgICAgICAgICBsaXN0c1xuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmJyKG51bGwpLCBSZWFjdC5ET00uYnIobnVsbCksIFxuICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IG5ldy1saXN0LWJ0blwiLCBcbiAgICAgICAgICAgICAgJ2RhdGEtdG9nZ2xlJzogXCJtb2RhbFwiLCAnZGF0YS10YXJnZXQnOiBcIi5icy1leGFtcGxlLW1vZGFsLXNtXCIsIFxuICAgICAgICAgICAgICBzdHlsZTogeyBiYWNrZ3JvdW5kSW1hZ2U6ICdsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjMDA5NmZmIDAlLCAjMDA1ZGZmIDEwMCUpJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXBsdXMtY2lyY2xlXCJ9KSwgXCLCoMKgTmV3IExpc3RcIlxuICAgICAgICApLCBcbiAgICAgICAgY3JlYXRlTGlzdE1vZGFsKHtjcmVhdGVMaXN0OiB0aGlzLmNyZWF0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RDbGFzc05hbWU6IHRoaXMucHJvcHMubGlzdENsYXNzTmFtZX0pLCBcIiBcIiwgUmVhY3QuRE9NLmJyKG51bGwpXG4gICAgICApXG4gICAgKTtcbiAgfSxcbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIFNwaW5uZXJcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBjaXJjbGVTdHlsZT0odGhpcy5wcm9wcy5jaXJjbGVTdHlsZSkgPyB0aGlzLnByb3BzLmNpcmNsZVN0eWxlIDoge31cbiAgICBzcGlubmVyU3R5bGU9dGhpcy5wcm9wcy5zcGlubmVyU3R5bGUgPyB0aGlzLnByb3BzLnNwaW5uZXJTdHlsZSA6IHt9XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJzcGlubmVyXCIsIHN0eWxlOiBzcGlubmVyU3R5bGV9LCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInNwaW5uZXItY29udGFpbmVyIGNvbnRhaW5lcjFcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUxXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlMlwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTNcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGU0XCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwic3Bpbm5lci1jb250YWluZXIgY29udGFpbmVyMlwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTFcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUyXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlM1wiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTRcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSlcbiAgICAgICAgKSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJzcGlubmVyLWNvbnRhaW5lciBjb250YWluZXIzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlMVwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTJcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUzXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlNFwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KVxuICAgICAgICApXG4gICAgICApXG5cbiAgICApXG4gIH0sXG59KVxuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIFVzZXJQcm9zcGVjdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7IH1cbiAgfSxcblxuICBjbGlja0NoZWNrOiBmdW5jdGlvbihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIGRvbU5vZGUgPSB0aGlzLmdldERPTU5vZGUoKVxuICAgIC8vaXNDaGVja2VkID0gJCgkKGRvbU5vZGUpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpWzBdKS5wcm9wKCdjaGVja2VkJylcbiAgICBpc0NoZWNrZWQgPSAkKCQoZG9tTm9kZSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLnByb3AoJ2NoZWNrZWQnKVxuICAgICQoJCh0aGlzLmdldERPTU5vZGUoKSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLmNsaWNrKClcbiAgICAvL2NvbnNvbGUubG9nKGlzQ2hlY2tlZClcbiAgICB0aGlzLnNldFN0YXRlKHtjaGVja2VkOiBpc0NoZWNrZWR9KVxuICAgIHRoaXMucHJvcHMuY2hlY2tib3hBY3Rpb24oaXNDaGVja2VkLCB0aGlzLnByb3BzLnByb3NwZWN0Lm9iamVjdElkKVxuICB9LFxuXG4gIHJvd0NsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAkKCQodGhpcy5nZXRET01Ob2RlKCkpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpWzBdKS5jbGljaygpXG4gIH0sXG5cbiAga2V5Ym9hcmRDbGljazogZnVuY3Rpb24oKSB7XG4gICAgJCgkKCcua2V5U2VsZWN0JykuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLmNsaWNrKClcbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7IH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBrZXlib2FyZFNlbGVjdGVkID0ge2JvcmRlckxlZnQ6JzdweCBzb2xpZCByZ2JhKDAsMCwwLDApJ31cbiAgICB0aGlzc3NzID0gdGhpc1xuICAgIGlmKHRoaXMucHJvcHMua2V5Ym9hcmRTZWxlY3RlZCkge1xuICAgICAgLy8gQWRqdXN0IFNjcm9sbCBkZXBlbmRpbmcgb24gd2hlcmUgdGhlIHByb3NwZWN0IGlzXG4gICAgICBrZXlib2FyZFNlbGVjdGVkID0ge2JvcmRlckxlZnQ6JzdweCBzb2xpZCAjMDA5NmZmICFpbXBvcnRhbnQnfVxuICAgICAgTW91c2V0cmFwLnVuYmluZCgneCcpXG4gICAgICBNb3VzZXRyYXAuYmluZCgneCcsIGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgdGhpc3Nzcy5rZXlib2FyZENsaWNrKClcbiAgICAgICAgaWYodGhpc3Nzcy5zdGF0ZS5jaGVja2VkKVxuICAgICAgICAgIGNvbnNvbGUubG9nKFwibG1hb1wiKVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJvc3BlY3QgPSB0aGlzLnByb3BzLnByb3NwZWN0XG5cbiAgICBpZih0aGlzLnByb3BzLm1hc3RlckNoZWNrYm94Q2hlY2tlZCAmJiB0aGlzLnN0YXRlLmNoZWNrZWQpXG4gICAgICBjaGVja2VkID0gdHJ1ZVxuICAgIGVsc2UgaWYodGhpcy5wcm9wcy5hbHJlYWR5Q2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZSBpZih0aGlzLnN0YXRlLmNoZWNrZWQpXG4gICAgICBjaGVja2VkID0gdHJ1ZVxuICAgIGVsc2UgaWYodGhpcy5wcm9wcy5tYXN0ZXJDaGVja2JveENoZWNrZWQgfHwgdGhpcy5zdGF0ZS5jaGVja2VkKVxuICAgICAgY2hlY2tlZCA9IHRydWVcbiAgICBlbHNlXG4gICAgICBjaGVja2VkID0gZmFsc2VcblxuICAgIC8vY29uc29sZS5sb2codGhpcy5zdGF0ZS5jaGVja2VkKVxuICAgIC8vY29uc29sZS5sb2coY2hlY2tlZClcbiAgICAvL3twcm9zcGVjdC5lbXBsb3llZUNvdW50UmFuZ2UubmFtZSArIFwiIGVtcGxveWVlc1wiIH1cbiAgICBcbiAgICBjb2xvciA9IHt9XG4gICAgaWYodGhpcy5zdGF0ZS5jaGVja2VkIHx8IHRoaXMucHJvcHMuYWxyZWFkeUNoZWNrZWQpXG4gICAgICBjb2xvciA9IHtiYWNrZ3JvdW5kQ29sb3I6ICcjZWVmOGZmJ31cbiAgICAgIFxuICAgIHJvd0NsID0gKHRoaXMucHJvcHMua2V5Ym9hcmRTZWxlY3RlZCkgPyBcInByb3NwZWN0cy10ciBrZXlTZWxlY3RcIiA6IFwicHJvc3BlY3RzLXRyXCJcbiAgICB3ZWJzaXRlQnRuID0gKHByb3NwZWN0LndlYnNpdGVVcmwpID8gIFJlYWN0LkRPTS5hKHtocmVmOiBcImh0dHA6Ly9cIitwcm9zcGVjdC53ZWJzaXRlVXJsLnJlcGxhY2UoJ2h0dHA6Ly8nLCcnKX0sIFwiIFwiLCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWdsb2JlXCJ9KSwgXCIgXCIpIDogXCJcIlxuICAgIFxuICAgIHByb3NwZWN0X2VtYWlsID0gcHJvc3BlY3QuZW1haWxcbiAgICBpZih0eXBlb2YocHJvc3BlY3QuZG9tYWluKSA9PSBcInVuZGVmaW5lZFwiKVxuICAgICAgcHJvc3BlY3QuZW1haWwgPSBcIndlYnNpdGUgbm90IGZvdW5kXCJcbiAgICBpZihwcm9zcGVjdC5lbWFpbCA9PSBcIm5vX2VtYWlsXCIpIHtcbiAgICAgIGlmKHByb3NwZWN0LmVtYWlsX2d1ZXNzZXMpIHtcbiAgICAgICAgZ3Vlc3MgPSBfLmZpbmRXaGVyZShwcm9zcGVjdC5lbWFpbF9ndWVzc2VzLCB7dHJpZWQ6IGZhbHNlfSlcbiAgICAgICAgbmFtZSA9IHRoaXMucHJvcHMucHJvc3BlY3QubmFtZVxuXG4gICAgICAgIHZhcnMgPSB7XG4gICAgICAgICAgZmlyc3Q6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKSxcbiAgICAgICAgICBsYXN0OiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKSxcbiAgICAgICAgICBmaTogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpWzBdLFxuICAgICAgICAgIGxpOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKVswXVxuICAgICAgICB9XG4gICAgICAgIGlmKGd1ZXNzKXtcbiAgICAgICAgICBwcm9zcGVjdF9lbWFpbCA9IE11c3RhY2hlLnJlbmRlcihndWVzcy5wYXR0ZXJuLnBhdHRlcm4sIHZhcnMpXG4gICAgICAgICAgcHJvc3BlY3RfZW1haWwgPSBwcm9zcGVjdF9lbWFpbCtcIkBcIitwcm9zcGVjdC5kb21haW5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBwcm9zcGVjdF9lbWFpbCA9IChwcm9zcGVjdF9lbWFpbCkgPyBwcm9zcGVjdF9lbWFpbC50b0xvd2VyQ2FzZSgpIDogXCJcIlxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS50cih7Y2xhc3NOYW1lOiByb3dDbCwgXG4gICAgICAgICAgb25DbGljazogdGhpcy5yb3dDbGljaywgXG4gICAgICAgICAgc3R5bGU6IGtleWJvYXJkU2VsZWN0ZWR9LCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvcn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaW5wdXQoe3R5cGU6IFwiY2hlY2tib3hcIiwgXG4gICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5jbGlja0NoZWNrLCBcbiAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGNoZWNrZWR9KVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yLCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIHByb3NwZWN0Lm5hbWUpLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtmb250V2VpZ2h0Oic0MDAnLG1hcmdpbjonMHB4J319LCBcbiAgICAgICAgICAgICAgKHByb3NwZWN0LnBvcykgPyBwcm9zcGVjdC5wb3MudHJpbSgpIDogXCJcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yLCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIFxuICAgICAgICAgICAgICBwcm9zcGVjdC5jb21wYW55X25hbWVcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmg2KHtzdHlsZToge2ZvbnRXZWlnaHQ6JzQwMCcsbWFyZ2luOicwcHgnfSwgY2xhc3NOYW1lOiBcImNvbXBhbnktc2l6ZVwifSwgXG4gICAgICAgICAgICAgIChwcm9zcGVjdC5jb21wYW55X3NpemUpID8gcHJvc3BlY3QuY29tcGFueV9zaXplIDogXCJcIlxuICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7Zm9udFdlaWdodDonNDAwJyxtYXJnaW46JzBweCcsZGlzcGxheTonbm9uZScsZm9udFN0eWxlOidpdGFsaWMnfSwgY2xhc3NOYW1lOiBcImNvbXBhbnktc2l6ZVwifSwgXG4gICAgICAgICAgICAgIChwcm9zcGVjdC5pbmR1c3RyeSkgPyBwcm9zcGVjdC5pbmR1c3RyeSA6IFwiXCJcbiAgICAgICAgICAgIClcbiAgICAgICAgICApLCBcblxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yfSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7bWFyZ2luOicwcHgnfX0sIHByb3NwZWN0LmNpdHkpKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY29sb3J9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcIm1haWx0bzpcIitwcm9zcGVjdF9lbWFpbCwgXG4gICAgICAgICAgICAgICBzdHlsZToge21hcmdpbjonMHB4J319LCBcbiAgICAgICAgICAgICAgIHByb3NwZWN0X2VtYWlsXG4gICAgICAgICAgKSksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yfSwgdGhpcy5wcm9wcy5saSwgXCLCoFwiLCB0aGlzLnByb3BzLmxpbmspLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvcn0sIFxuICAgICAgICAgICAgd2Vic2l0ZUJ0blxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgZGVsZXRlUHJvc3BlY3Q6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHJvcHMuZGVsZXRlUHJvc3BlY3QodGhpcy5wcm9wcy5wcm9zcGVjdC5vYmplY3RJZCwgJ1Byb3NwZWN0JylcbiAgfVxufSk7XG5cbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICBjaGVja2JveEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIGNoZWNrYm94VmFsID0gJChlLnRhcmdldCkuaXMoJzpjaGVja2VkJylcbiAgICBjaGVja2JveGVzID0gXy5yZXN0KCQoJ2JvZHknKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSlcbiAgICBjb25zb2xlLmxvZyhjaGVja2JveGVzKVxuICAgIGlmKGNoZWNrYm94VmFsKXtcbiAgICAgIC8vIG1ha2Ugc3VyZSBhbGwgY2hlY2tib3hlcyBhcmUgY2hlY2tlZFxuICAgICAgXy5tYXAoY2hlY2tib3hlcywgZnVuY3Rpb24oY2hlY2tib3gpe1xuICAgICAgICBpZighJChjaGVja2JveCkucHJvcCgnY2hlY2tlZCcpKVxuICAgICAgICAgICQoY2hlY2tib3gpLmNsaWNrKClcbiAgICAgIH0pXG4gICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbWFrZSBzdXJlIGFsbCBjaGVja2JveGVzIGFyZSB1bmNoZWNrZWRcbiAgICAgIF8ubWFwKGNoZWNrYm94ZXMsIGZ1bmN0aW9uKGNoZWNrYm94KXtcbiAgICAgICAgaWYoJChjaGVja2JveCkucHJvcCgnY2hlY2tlZCcpKVxuICAgICAgICAgICQoY2hlY2tib3gpLmNsaWNrKClcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcblxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgICAgIFJlYWN0LkRPTS50cihudWxsLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKHtzdHlsZToge3BhZGRpbmdMZWZ0OjExfX0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pbnB1dCh7dHlwZTogXCJjaGVja2JveFwiLCBvbkNoYW5nZTogdGhpcy5jaGVja2JveEFjdGlvbn0pXG4gICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCJOYW1lXCIpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKG51bGwsIFwiQ29tcGFueVwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHt3aWR0aDonMTcwcHgnfX0sIFwiQ2l0eVwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIkVtYWlsXCIpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKG51bGwsIFwiwqBcIiksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCLCoFwiKVxuICAgICAgICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vU2lkZU1lbnVMaXN0T3B0aW9uXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtjb3VudDogJ34nfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAvLyBtYWtlIGFqYXggcmVxdWVzdCB0byBnZXQgZWFjaCByZXF1ZXN0cyBcbiAgICAvKlxuICAgIGxpc3QgPSB7XG4gICAgICAnX190eXBlJyAgICA6ICdQb2ludGVyJyxcbiAgICAgICdvYmplY3RJZCcgIDogdGhpcy5wcm9wcy5saXN0Lm9iamVjdElkLFxuICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JywgXG4gICAgfVxuXG4gICAgcGFyc2VfaGVhZGVycyA9IHtcbiAgICAgICdYLVBhcnNlLUFwcGxpY2F0aW9uLUlkJyAgOiAnTjg1UU9rdGVFRVFrdVpWSktBdnQ4TVZlczBzakc2cU5wRUdxUUZWSicsIFxuICAgICAgJ1gtUGFyc2UtUkVTVC1BUEktS2V5JyAgICA6ICdWTjZFd1Z5Qlp3TzF1cGhzQlBzYXU4dDdKUVJwMDBVTTNLWXNpaVFiJyxcbiAgICB9XG5cbiAgICB0aGlzcyA9IHRoaXM7XG5cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMubGlzdC5uYW1lKVxuICAgICQuYWpheCh7XG4gICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RzJyxcbiAgICAgIHR5cGU6J0dFVCcsXG4gICAgICBoZWFkZXJzOnBhcnNlX2hlYWRlcnMsXG4gICAgICBkYXRhOiAnd2hlcmU9e1wibGlzdHNcIjonK0pTT04uc3RyaW5naWZ5KGxpc3QpKyd9JmNvdW50PTEnLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtjb3VudDogcmVzLmNvdW50fSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KVxuICAgICovXG4gIH0sXG5cbiAgY2hhbmdlTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5jaGFuZ2VMaXN0KHRoaXMucHJvcHMubGlzdC5uYW1lLCB0aGlzLnByb3BzLmxpc3Qub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0TmFtZSA9IHRoaXMucHJvcHMubGlzdC5uYW1lXG4gICAgcHJvcHNDb3VudCA9IHRoaXMucHJvcHMuY291bnRcbiAgICBjb3VudCA9ICh0eXBlb2YocHJvcHNDb3VudCk9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuc3RhdGUuY291bnQgOiBwcm9wc0NvdW50XG5cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuaWNvblR5cGUpXG4gICAgaWNvbiA9IFwiXCJcbiAgICBpZih0aGlzLnByb3BzLmljb25UeXBlID09IFwiYXJjaGl2ZVwiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFyY2hpdmVcIiwgc3R5bGU6IHtmbG9hdDonbGVmdCcsbGluZUhlaWdodDoxLjUsbWFyZ2luUmlnaHQ6NX19KVxuICAgIH0gZWxzZSBpZih0aGlzLnByb3BzLmljb25UeXBlID09IFwidXNlcnNcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS11c2VyXCIsIHN0eWxlOiB7ZmxvYXQ6J2xlZnQnLGxpbmVIZWlnaHQ6MS41LG1hcmdpblJpZ2h0OjV9fSlcbiAgICB9IGVsc2UgaWYodGhpcy5wcm9wcy5pY29uVHlwZSA9PSBcIndpZmlcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS13aWZpXCIsIHN0eWxlOiB7ZmxvYXQ6J2xlZnQnLGxpbmVIZWlnaHQ6MS41LG1hcmdpblJpZ2h0OjV9fSlcbiAgICB9IGVsc2UgaWYodGhpcy5wcm9wcy5pY29uVHlwZSA9PSBcImNsb3VkRG93bmxvYWRcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jbG91ZC1kb3dubG9hZFwiLCBzdHlsZToge2Zsb2F0OidsZWZ0JyxsaW5lSGVpZ2h0OjEuNSxtYXJnaW5SaWdodDo1fX0pXG4gICAgfVxuXG5cbiAgICBjb3VudFN0eWxlID0gKHRoaXMucHJvcHMuaGlkZUNvdW50KSA/IHsnZGlzcGxheSc6J25vbmUnfSA6IHtiYWNrZ3JvdW5kQ29sb3I6JyM5OTknLGZsb2F0OidyaWdodCcsbWFyZ2luVG9wOjIuMjV9XG4gICAgbGlzdFN0eWxlPShpY29uID09IFwiXCIpID8gXCJsaXN0LW5hbWVcIiA6IFwiaWNvbi1saXN0LW5hbWVcIlxuICAgIGlmKHRoaXMucHJvcHMuaWNvblR5cGUgPT0gXCJ1c2Vyc1wiKVxuICAgICAgbGlzdFN0eWxlID0gXCJhbGwtbGlzdC1uYW1lXCIgXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmNoYW5nZUxpc3QsIFxuICAgICAgICAgICAgICBjbGFzc05hbWU6IFwibGlzdC1uYW1lcyBidG4gYnRuLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICBpY29uLCBcbiAgICAgICAgICAgICAgXCLCoFwiLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogbGlzdFN0eWxlfSwgbGlzdE5hbWUpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe3N0eWxlOiBjb3VudFN0eWxlLCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYmFkZ2UgYmFkZ2UtZGVmYXVsdFwifSwgdGhpcy5wcm9wcy5saXN0LmNvdW50KVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG4iXX0=
