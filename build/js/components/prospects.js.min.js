(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-example-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Create List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.createMiningJob}, 
                    React.DOM.input({id: "listTitle", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", onClick: this.createListButtonClick, placeholder: "Enter City Area...", className: "btn btn-success", style: {display:'block', width:'100%'}}, "Create List")
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],2:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  deleteList: function() {
    this.props.deleteList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-deleteList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-trash-o"}), "  Delete List?")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({className: "deleteForm", onSubmit: this.deleteList}, 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-danger", 
                      style: {display:'block', width:'100%'}}, 
                      "Delete"
                    ), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-default", 
                      style: {display:'block', width:'100%'}}, 
                      "Cancel"
                    )
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],3:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // LoadingSpinner
  render: function() {
    return (
    React.DOM.div({className: "spinner", style: {marginTop:'180px'}}, 
      React.DOM.div({className: "spinner-container container1"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container2"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container3"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      )
    )
    )
  }
});

},{}]},{},[1])


},{}],4:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //Messenger
  render: function() {
    return (
        React.DOM.div({className: "alert alert-success", 
             'data-alert': "alert", 
             style: {position:'absolute',
                     top: 31, 
                     right:30, 
                     display:'none',
                     width:200}}, 
                     React.DOM.a({className: "close", 
                       href: "javascript:", 
                       onClick: this.hideAlert}, "×"), 
            "Test"
        )
    );
  }
});

},{}]},{},[1])


},{}],5:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Panel Footing
  paginatePrevious: function() {
    thiss = this;

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospects?skip='+(thiss.props.currentPage-2)*thiss.props.prospectsPerPage,
      type:'GET',
      headers: parse_headers,
      data: 'where={"company":'+company+',"archived":true}&count=1',
      success: function(res){
        //thiss.setState({prospects: res.results})
        //thiss.setState({currentPage: this.props.currentPage - 1})
        thiss.props.paginate(res.results, thiss.props.currentPage - 1)
      },
      error: function(res){
        console.log(res)
      }
    });
  },


  paginate: function(direction) {
    prospectsPerPage = this.props.prospectsPerPage
    if(direction=='previous')
      skip = (this.props.currentPage - 2)*prospectsPerPage
    else if(direction=="forward")
      skip = this.props.currentPage*prospectsPerPage

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospect?skip='+skip,
      type:'GET',
      headers: parse_headers,
      data: 'where={"company":'+company+'}&count=1',
      success: function(res){
        //thiss.setState({prospects: res.results})
        //thiss.setState({currentPage: this.props.currentPage + 1})
        this.props.paginate(res.results, this.props.currentPage + 1)
      },
      error: function(res){
        console.log(res)
      }
    });
  },

  paginateForward: function() {
    thiss = this;
    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospects?skip='+thiss.props.currentPage*thiss.props.prospectsPerPage,
      type:'GET',
      headers: parse_headers,
      data: 'where={"company":'+company+',"archived":true}&count=1',
      success: function(res){
        //thiss.setState({prospects: res.results})
        //thiss.setState({currentPage: thiss.props.currentPage + 1})
        console.log("success")
        thiss.props.paginate(res.results, thiss.props.currentPage + 1)
      },
      error: function(res){
        console.log(res)
      }
    });
  },
  componentDidMount: function() {
    paginateForward = this.paginateForward
    paginatePrevious = this.paginatePrevious

    Mousetrap.bind('l', function() { 
      console.log('new forward')
      paginateForward()
    });

    Mousetrap.bind('h', function() { 
      console.log('new back')
      paginatePrevious()
    });
  },

  render: function() {
    // Should be handled by Panle Footing


    previous = (this.props.currentPage - 1) ? '' : 'disabled'
    forward = (this.props.currentPage == this.props.pages) ? 'disabled' : ''

    lowerLimit = (this.props.currentPage-1)*this.props.prospectsPerPage
    upperLimit = this.props.currentPage*this.props.prospectsPerPage

    lowerLimit = (lowerLimit) ? lowerLimit : 1
    upperLimit = (upperLimit > this.props.count) ? this.props.count : upperLimit

    return (
      React.DOM.div({className: "panel-footing", 
           id: "navbar", 
           style: {height:'35px',padding:'0px', paddingTop:'7px'}}, 
          React.DOM.span({style: {float:'right',marginRight:'20px'}}, 
            React.DOM.a({href: "javascript:", 
               style: {marginRight:'5px'}, 
               onClick: this.paginatePrevious, 
               className: "blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-fast-backward"})
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginatePrevious, 
             className: "paginate-back-btn blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-chevron-left"})
          ), 
          React.DOM.span({style: {marginLeft:5, marginRight:5,display:'inline-block',width:115, textAlign:'center'}}, 
            lowerLimit+' - '+upperLimit+' of '+this.props.count
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginateForward, 
             className: "paginate-forward-btn blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-chevron-right"})
          ), 
          React.DOM.a({href: "javascript:", 
             style: {marginLeft:'5px'}, 
             onClick: this.paginateForward, 
             className: "blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-fast-forward"}))
          )
        )
    );
  }
});

},{}]},{},[1])


},{}],6:[function(require,module,exports){
/** @jsx React.DOM */

var UserProspect = require('./user_prospect.js.min.js');
var UserProspectHeader = require('./user_prospect_header.js.min.js');
var SideMenuProspects = require('./side_menu_user_prospects.js.min.js');
var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var LoadingSpinner = require('./loading_spinner.js.min.js')
var PanelFooting = require('./panel_footing.js.min.js')
var Messenger = require('./messenger.js.min.js')
var DeleteListModal = require('./delete_list_modal.js.min.js')
var RenameListModal = require('./rename_list_modal.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {  prospects   : [],
              currentPage : 1,
              pages       : 1,
              currentList : 'All',
              currentListObjectId : '',
              loading: true,
              prospectsPerPage: 50,
              lists : [],
              masterCheckboxChecked: false,
              keyboardActiveProspect: 0, //first
              selectedProspects: [],
              totalCount  : "~", 
              count       : "~", }
  },

  createList: function(data) {
    lists = this.state.lists
    lists.push(data)
    this.setState({ lists: lists })
  },

  renameList: function(newListName) {
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      'Content-Type': 'application/json'
    }
    console.log(this.state.currentListObjectId)
    console.log(this.state.currentList)
    console.log(newListName)

    // Update Local State
    thiss = this;
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.name == thiss.state.currentList){
        item.name = newListName
        return item
      }
      return item
    });

    this.setState({lists : filtered})
    this.setState({currentList: newListName})

    $('.modal').click()
    $('#newListName').val('')
    $('.modal-backdrop').click()

    // Persist / Ajax
    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList/'+this.state.currentListObjectId,
      headers: parseHeaders,
      type:'PUT',
      data:JSON.stringify({'name':newListName}),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  deleteList: function() {
    // TODO 
    // Get All Members Of This List
    // Remove From List Array
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      'Content-Type': 'application/json'
    }
    
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.objectId == thiss.state.currentListObjectId)
        return false
      return true
    });

    this.setState({lists: filtered})
    this.setState({currentList: 'All'})
    this.changeList('All', '')

    // Remove
    $('.modal').click()
    $('#newListName').val('')
    $('.modal-backdrop').click()

    // Persist / Ajax
    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList/'+this.state.currentListObjectId,
      headers: parseHeaders,
      type:'DELETE',
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  changeList: function(newListName,objectId) {
    // add overlay loading
    //console.log(newListName)
    //console.log(objectId)

    localStorage.selectedProspects = JSON.stringify([])

    this.setState({currentList : newListName})
    this.setState({currentListObjectId : objectId})
    this.setState({prospects  : []    })
    this.setState({count      : '~'   })
    this.setState({pages      : 1     })
    this.setState({loading    : true  })
    this.setState({currentPage: 1})
    this.setState({keyboardActiveProspect: 0})

    qry = 'where={"company":'+company+',"archived":true}&count=1&order=-createdAt'
    console.log(newListName)

    if(this.state.currentList != 'All' || typeof(objectId) != "undefined" && newListName != 'Archived'){
      currentList = JSON.stringify({
        'objectId'  : objectId, 
        '__type'    : 'Pointer', 
        'className' : 'ProspectList' 
      })

      company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
      qry = 'where={"company":'+company+'}&count=1'
      qry = 'where={"lists":'+currentList+'}&count=1&order=-createdAt'
    } else if (newListName == 'Archived') {
      qry = 'where={"company":'+company+',"archived":false}&count=1&order=-createdAt'
    }
    console.log(qry)

    $.ajax({
      url: 'https://api.parse.com/1/classes/Prospects',
      type:'GET',
      headers: parse_headers,
      async: true,
      data: qry,
      ajaxStart: function() {
        console.log('started list')
      },
      success: function(res){
        thisss.setState({prospects: res.results})
        thisss.setState({count: res.count})
        //thisss.setState({totalCount: res.count})
        thisss.setState({pages: Math.ceil(res.count/thisss.props.prospectsPerPage)})
        thisss.setState({loading: false})
      },
      error: function(res){
        //console.log('error')
        //console.log(res)
      }
    })
  },

  checkboxAction: function(checkedState, objId) {
    /* Storing Checked Prospects In LocalStorage To Make it Easier To
     * Copy and Move Prospects 
     *
     * Move To User_Prospects?
     */
    
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    //console.log(checkedState)
    if(checkedState)
      selectedProspects.push(objId)
    else
      selectedProspects = _.reject(selectedProspects, 
                                   function(id){return id == objId})

    console.log(selectedProspects)
    localStorage.selectedProspects = JSON.stringify(selectedProspects)
    this.setState({selectedProspects: selectedProspects})
  },

  masterCheckboxChanged: function(masterCheckboxValue) {
    this.setState({masterCheckboxChecked: masterCheckboxValue})
  },

  render: function() {
    this.startKeyboardShortcuts()
    $('body').css({overflow:'auto'})

    prospects = []
    for(i=0;i<this.state.prospects.length;i++) {
      url = this.state.prospects[i].url
      prospect = this.state.prospects[i]

      if(url != "no linkedin website" && typeof(url) != "undefined" && url != ""){
        url = url.replace('http://','')
        the_link = React.DOM.a({href: 'http://'+url}, React.DOM.i({className: "fa fa-globe"}))
      } else {
        the_link = ""
      }

      profile = this.state.prospects[i].linkedin_url.replace('http://','')
      profile = this.state.prospects[i].linkedin_url.replace('https://','')
      li = React.DOM.a({href: 'http://'+profile, className: "linkedin_link"}, React.DOM.i({className: "fa fa-linkedin-square"}))

      keyboardSelected = (i == this.state.keyboardActiveProspect)

      selectedProspects = JSON.parse(localStorage.selectedProspects)
      alreadyChecked=false
      for(ii=0;ii< selectedProspects.length;ii++)
        if(prospect.objectId == selectedProspects[ii])
          alreadyChecked = true

        //console.log(alreadyChecked)

      prospects.push(
        UserProspect({deleteProspect: this.deleteProspect, 
                      prospect: this.state.prospects[i], 
                      masterCheckboxChecked: this.state.masterCheckboxChecked, 
                      key: this.generate_id(), 
                      link: the_link, 
                      keyboardSelected: keyboardSelected, 
                      checkboxAction: this.checkboxAction, 
                      alreadyChecked: alreadyChecked, 
                      li: li}))
    }

    listType = (this.state.currentList == "All") ? {display:'none'} : {float:'left'}
    listBtn = (this.state.currentList == "All") ? {display:'none'} : {float:'left',marginLeft:5}
    listOptions = (this.state.currentList == "All") ? {display:'none'} : {float:'right'}
    copyDropdownStyle = (this.state.currentList == "All") ? {width:114, right:4} : {width:114, right:36}
    currentList = this.state.currentList
    return (
        React.DOM.div(null, 
      React.DOM.div({className: "container", style: {width:'100%',padding:'0', background: 'linear-gradient(#dae8ff,#dae8ff)', backgroundImage: 'radial-gradient(circle at center center,#fff,#dff1fd 900px)'}}, 
        SideMenuProspects({currentList: this.state.currentList, 
                           count: this.state.count, 
                           totalCount: this.state.totalCount, 
                           changeList: this.changeList, 
                           createList: this.createList, 
                           lists: this.state.lists}), 

        React.DOM.div({className: "col-md-10", style: {padding:'0'}}, 
              React.DOM.div({id: "prospectDetailButtons"}, 
                ListDetailButtons({
                  renameList: this.renameList, 
                  deleteList: this.deleteList, 
                  currentListName: this.state.currentList, 
                  currentList: this.state.currentListObjectId}), 

                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({href: "javascript:", 
                     className: "btn btn-primary btn-xs list-options", 
                     id: "", 
                     style: listOptions}, 
                    React.DOM.i({className: "fa fa-bars"})
                  )
                ), 

                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     id: "copyToList", 
                     href: "javascript:", 
                     className: "drop-target btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-copy"}), 
                       "  Copy To List  ",  
                     React.DOM.i({className: "fa fa-caret-down"})
                ), 
                CurrentListsTwo({lists: this.state.lists, 
                                 copyDropdownStyle: copyDropdownStyle, 
                                 listAction: this.copySelectedProspects})
                ), 
  
                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     href: "javascript:", 
                     id: "moveToList", 
                     style: listOptions, 
                     className: "btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-share"}), 
                     "  Move To List  ",  
                     React.DOM.i({className: "fa fa-caret-down"})
                ), 
                CurrentLists({lists: this.state.lists, 
                              listAction: this.moveSelectedProspects})
                ), 

                React.DOM.a({onClick: this.downloadFile, 
                   href: "javascript:", 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                  React.DOM.i({className: "fa fa-download"}), "   Download CSV  " 
                )
              ), 
        

          React.DOM.div({id: "autoscroll", style: {height:'400px',overflow:'auto'}}, 
            React.DOM.table({className: "prospects-table table table-striped", style: {marginBottom:'0px'}}, 
              React.DOM.thead({style: {backgroundColor:'white'}}, 
                UserProspectHeader({masterCheckboxChanged: this.masterCheckboxChanged})
              ), 
              React.DOM.tbody(null, 
                prospects
              )
            ), 
            (this.state.loading) ? LoadingSpinner(null) : ""
          )
        )
      ), 

      PanelFooting({currentPage: this.state.currentPage, 
                    count: this.state.count, 
                    paginate: this.paginate, 
                    prospectsPerPage: this.state.prospectsPerPage, 
                    pages: this.state.pages}), 
      Messenger(null)
    )
    );
  },

  paginate: function(newProspects, newPage) {
    this.setState({
      prospects: newProspects,
      currentPage: newPage,
      keyboardActiveProspect: 0
    })
    this.startKeyboardShortcuts()
    document.getElementById('autoscroll').scrollTop = 0
  },

  downloadFile: function() {
    parse_headers = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
    }

    // Get List Count
    list = JSON.stringify({
      '__type'   :  'Pointer',
      'className':  'ProspectList',
      'objectId' :  this.state.currentListObjectId
    })
    console.log(list)
    // Add Support For More than 1000
    // num_of_requests
    localStorage.download_total = Math.ceil(this.state.count/1000)
        this.props.paginate(res.results, this.props.currentPage + 1)
    localStorage.downloads      = 0

    if(this.state.currentList == "All")
      qry = 'where={"company":'+company+'}&count=1'
    else
      qry = 'where={"lists":'+list+'}&count=1'

    for(i=0;i< Math.ceil(this.state.count/1000); i++){
      $.ajax({
        url: 'https://api.parse.com/1/classes/Prospects?limit=1000&skip='+i,
        type:'GET',
        headers: parse_headers,
        downloadFile: 'download_'+i,
        data: qry,
        success: function(res){
          // Clean Results
          // Remove Certain Parse Columns - created_at, updated_at, objectId
          // Rename createdAt as date prospected
          for(i=0;i< res.results.length;i++) {
            delete res.results[i].company
            delete res.results[i].pos
            delete res.results[i].user
            delete res.results[i].objectId
            delete res.results[i].createdAt
            delete res.results[i].updatedAt
          }

          // Add Results To LocalStorage
          localStorage.downloads = JSON.parse(localStorage.downloads) + 1 
          localStorage.setItem(this.downloadFile, JSON.stringify(res.results))

          // Check to see if all ajax reqs in for loop are complete
          if(localStorage.downloads == localStorage.download_total) {
            console.log('matched')
            // Merge all localStorage results
            prospects = []
            for(ii=0;ii < JSON.parse(localStorage.download_total); ii++){
              prospects = prospects.concat(JSON.parse(localStorage.getItem('download_'+ii)))
              console.log(prospects)
            }

            console.log(prospects)
            // Output as CSV
            var blob = new Blob([Papa.unparse(prospects)], {type: "text/plain;charset=utf-8"});
            console.log(blob)
            saveAs(blob, "prospects.csv");
          }
      },

      error: function(res){
        console.log(res)
      }
      });
    }
    
    company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
    

  },

  removeSelectedProspects: function() {
    // If List Type is All Archive the prospect
    //
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []

    for(i=0;i< selectedProspects.length;i++){
      if(this.state.currentList != 'All'){
        tmp = {
          method:'PUT',
          path:'/1/classes/Prospects/'+selectedProspects[i],
          body: {
            lists: {
              '__op'    : 'Remove',
              "objects" : [{ 
                  '__type':'Pointer',
                  'className':'ProspectList',
                  'objectId':this.state.currentListObjectId
              }]
            }
          }
        }
      }else{
        tmp = {
          method:'PUT',
          path:'/1/classes/Prospects/'+selectedProspects[i],
          body: {
            archived:false,
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        lists = thiss.state.lists

        for(i=0;i< lists.length; i++) { 
          // Subtract From Old List - Not Working For Archive
          if(lists[i].objectId == thiss.state.currentListObjectId)
            lists[i].count = parseInt(lists[i].count) - parseInt(selectedProspects.length)
        }
        // Update local list count
        thiss.setState({lists: lists})

        // remove from current list ui
        selectedProspects = JSON.parse(localStorage.selectedProspects)
        console.log('remove selected prospects')
        console.log(selectedProspects)
        console.log(thiss.state.prospects)
        var filtered = _.filter(thiss.state.prospects, function(item) {
          for(i=0;i< selectedProspects.length;i++) 
            if(item.objectId == selectedProspects[i])
              return false
          return true
        });
        console.log(filtered)
        thiss.setState({prospects: filtered})
        localStorage.selectedProspects = JSON.stringify([])

        // add alert to inform user
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  moveSelectedProspects: function(listObjectId) {
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    // get the selected objectId from selectedProspects state
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []


    // Batch Update Parse
    // - Remove All Selected Prospects From Current List
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospects/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'Remove',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':this.state.currentListObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }
    
    // - Add Other List 
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospects/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'AddUnique',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':listObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        lists = thiss.state.lists

        for(i=0;i< lists.length; i++) { 
          // Add To New List
          if(lists[i].objectId == listObjectId)
            lists[i].count = parseInt(lists[i].count) + parseInt(selectedProspects.length)
          // Subtract From Old List
          if(lists[i].objectId == thiss.state.currentListObjectId)
            lists[i].count = parseInt(lists[i].count) - parseInt(selectedProspects.length)
        }
        // Update local list count
        thiss.setState({lists: lists})

        // remove from current list ui
        console.log('selectedProspects')
        console.log(thiss.state.prospects)
        var filtered = _.filter(thiss.state.prospects, function(item) {
          is_selected = true
          for(i=0;i< selectedProspects.length;i++) 
            if(item.objectId == selectedProspects[i])
              is_selected = false
          return is_selected
        });
        console.log(filtered)
        thiss.setState({prospects: filtered})
        localStorage.selectedProspects = JSON.stringify([])

        // add alert to inform user
      },
      error: function(err) {
        console.log(err)
      }
    });
  },

  copySelectedProspects: function(listObjectId) {
    console.log(listObjectId)
    
    // make batch ajax request to parse
    parseHeaders = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
      "Content-Type" : "application/json"
    }

    // Add Loading Sign To List

    selectedProspects = JSON.parse(localStorage.selectedProspects)
    batchData = []
    for(i=0;i< selectedProspects.length;i++){
      tmp = {
        method:'PUT',
        path:'/1/classes/Prospects/'+selectedProspects[i],
        body: {
          lists: {
            '__op'    : 'AddUnique',
            "objects" : [{ 
                '__type':'Pointer',
                'className':'ProspectList',
                'objectId':listObjectId
            }]
          }
        }
      }
      batchData.push(tmp)
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/batch',
      type:'POST',
      headers:parseHeaders,
      data: JSON.stringify({requests: batchData}),
      success:function(res) {
        console.log(res)
        // Update With the number of successes
        // Update local list count
        lists = thiss.state.lists
        for(i=0;i< lists.length; i++) { 
          if(lists[i].objectId == listObjectId)
            lists[i].count = parseInt(lists[i].count) + parseInt(res.length)
        }
        thiss.setState({lists: lists})
        localStorage.selectedProspects = "[]"
        thiss.setState({selectedProspects : [] })
        
        // add alert to inform user
        // Unselect all selected
      },
      error: function(err) {
        console.log(err)
      }
    });

  },

  hideAlert: function() {
    $('.alert').hide()
  },

  adjustHeight: function(whichOne) {
    prospectWindowTop = $('#prospectDetailButtons').position().top
    prospectWindowTop = prospectWindowTop + $('#prospectDetailButtons').height()
    prospectWindowBottom = $('#autoscroll').position().top + $('#autoscroll').height()

    if(whichOne == 'j')
      activeProspect = this.state.keyboardActiveProspect +1 
    else
      activeProspect = this.state.keyboardActiveProspect -1 

    activeTop = $($('.prospects-tr')[activeProspect]).position().top
    selectedHeight = $($('.prospects-tr')[activeProspect]).height()
    activeBottom = $($('.prospects-tr')[activeProspect]).position().top+selectedHeight

    console.log(prospectWindowTop, prospectWindowBottom)
    console.log(activeTop, activeBottom)

    scrollTop = document.getElementById('autoscroll').scrollTop
    if(activeBottom > prospectWindowBottom)
      document.getElementById('autoscroll').scrollTop = scrollTop + activeBottom - prospectWindowBottom

    if(activeTop < 0)
      document.getElementById('autoscroll').scrollTop = scrollTop + activeTop - 37
    else if(activeTop == $($('.prospects-tr')[0]).position().top)
      document.getElementById('autoscroll').scrollTop = 0
      
    // Get Postion of Top
    // Get Position of Bottom 
    // Get Position of Current Selected
    // Adjust by scrolling down or up
  },

  startKeyboardShortcuts: function() {
    /* Keyboard Shortcuts */
    Mousetrap.reset()
    //Mousetrap.unbind(['j','k','o'])
    thiss = this;

    /* Prospect Table Shortcuts */
    Mousetrap.bind('j', function() { 
      keyboard = thiss.state.keyboardActiveProspect
      if(keyboard != thiss.state.prospectsPerPage+1)
        thiss.adjustHeight('j')
        thiss.setState({keyboardActiveProspect: keyboard+1})
    });

    Mousetrap.bind('k', function() { 
      keyboard = thiss.state.keyboardActiveProspect
      if(keyboard != 1)
        thiss.adjustHeight('k')
        thiss.setState({keyboardActiveProspect: keyboard-1})
    });


    Mousetrap.bind('o', function() { 
      console.log('open current prospect')
      console.log($($('.keySelect').find('a.linkedin_link')[0]).attr('href'))
      link = $($('.keySelect').find('a.linkedin_link')[0]).attr('href')
      /*
      window.open(link, '_blank')
      console.log('new')
      */
      //popupWindow.blur();
      //window.focus();
      // keyboard = thiss.state.keyboardActiveProspect
      
      var a = document.createElement("a");
      a.href = link
      var evt = document.createEvent("MouseEvents");
      //the tenth parameter of initMouseEvent sets ctrl key
      // For Mac This Works Check For - Windows
      evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0,
                                  false, false, false, true, 0, null);
      a.dispatchEvent(evt);
    });



    /* List Modification Shortcuts */
    Mousetrap.bind('tab+r', function(){
      //console.log('reload')
      $('#renameListBtn').click()
    })

    Mousetrap.bind('tab+d', function(){
      //console.log('reload')
      $('#deleteListModal').click()
    })

    Mousetrap.bind('tab+s', function(){
      //console.log('reload')
      //$('#downloadProspects').click()
      thiss.downloadFile()
    })

    Mousetrap.bind('shift+l', function(){
      //console.log('reload')
      //$('#downloadProspects').click()
      //thiss.downloadFile()
      $('.new-list-btn').click()
    })

    Mousetrap.bind('e', function(){
      console.log('reload')
      //$('#downloadProspects').click()
      thiss.removeSelectedProspects()
    })

    Mousetrap.bind('c', function() { 
      console.log('copy')
      $('#copyToList').click()
    });

    Mousetrap.bind('m', function() { 
      console.log('copy')
      $('#moveToList').click()
    });

    //Mousetrap.bind('e', function() { console.log('e'); });
    Mousetrap.bind('right', function() { console.log('right'); });
    Mousetrap.bind('left', function() { console.log('left'); });

  },

  componentDidMount: function() {
    /* OnLoad For The First Time Function */
    localStorage.selectedProspects = JSON.stringify([])
    thisss = this;

    //this.startKeyboardShortcuts()

    parse_headers = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb'
    }

    company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
    cuid = JSON.parse(localStorage.currentUser).objectId
    user = JSON.stringify({'__type':'Pointer',
                           'objectId':cuid, 
                           'className': 'User'})
    archiveList = JSON.stringify({
      //hardCode
      'objectId':'SerPQjckve',
      '__type':'Pointer', 
      'className' : 'ProspectList' 
    })

    qry = 'where={"company":'+company+',"archived":true}&count=1&order=-createdAt'

    if(this.state.currentList != 'All'){
      currentList = {
        'objectId':this.state.currentListObjectId, 
        '__type':'Pointer', 
        'className' : 'ProspectList' 
      }
      currentList = JSON.stringify(currentList)
      user = JSON.stringify({'__type':'Pointer','objectId':'xThAXc0LZT',
                             'className':'User'})

      // add company to prospects added through mining job
      qry = 'where={"company":'+company+',"lists":'+currentList+'}&count=1'
    }

    $.ajax({
      //url: 'https://api.parse.com/1/classes/Prospects?limit=50',
      url: 'https://api.parse.com/1/classes/Prospects?limit='+thisss.state.prospectsPerPage,
      type:'GET',
      headers: parse_headers,
      cache: true,
      data: qry,
      success: function(res){
        console.log(res)
        thisss.setState({prospects: res.results})
        thisss.setState({count: res.count})
        thisss.setState({totalCount: res.count})
        thisss.setState({pages: Math.ceil(res.count/thisss.props.prospectsPerPage)})
        thisss.setState({loading: false})
      },
      error: function(res){
        console.log('error')
        console.log(res)
      }
    })

    parse_headers = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
    }

    currentUser = { 
      '__type'   : 'Pointer',
      'className': '_User',
      'objectId' : JSON.parse(localStorage.currentUser).objectId
    }

    thiss = this;
    $.ajax({
      url: 'https://api.parse.com/1/classes/ProspectList',
      type: 'GET',
      headers: parse_headers,
      data: 'where={"user":'+JSON.stringify(currentUser)+"}&count=1",
      success: function(res) {
        console.log(res)
        results = res.results
        for(i=0;i< results.length; i++) {
          results.count = '~'
        }
        thiss.setState({lists: results})
        // Make batch request to get list counts after they are loaded
        for(i=0;i < res.results.length; i++) {
          localStorage.setItem(res.results[i].objectId, "")
        }

        for(i=0;i< res.results.length; i++) {
          list = {
            '__type'    : 'Pointer',
            'objectId'  : res.results[i].objectId,
            'className' : 'ProspectList', 
          }

          $.ajax({
            url:'https://api.parse.com/1/classes/Prospects',
            type:'GET',
            headers:parse_headers,
            listObjectId: res.results[i].objectId,
            data: 'where={"lists":'+JSON.stringify(list)+'}&count=1',
            success: function(res) {
              //console.log(this.listObjectId)
              localStorage.setItem(this.listObjectId, res.count)
              amount = 0
              for(ii=0;ii< results.length;ii++){
                if(localStorage.getItem(results[ii].objectId) == "")
                  amount = amount + 1
              }

              if(amount == 0) {
                for(ii=0;ii< results.length;ii++)
                  results[ii].count = localStorage.getItem(results[ii].objectId)

                thiss.setState({lists: results})
                //console.log('Got Counts')
              }

              // updated res.count
              //thiss.setState({count: res.count})
            },
            error: function(err) {
              console.log(err)
            }
          })
        }
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });
  },

  generate_id : function () {
    return '_' + Math.random().toString(36).substr(2, 9);
  },
});

/*  Dropdown Menus */

var CurrentLists = React.createClass({displayName: 'CurrentLists',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.listAction(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, href: "javascript:", onClick: this.listAction}, this.props.lists[i].name))
      )
    }
    //console.log(this.props.copyDropdownStyle)
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {right:158}}, 
        lists
      )
    );
  }
});

var ListsMenu = React.createClass({displayName: 'ListsMenu',
  render: function() {
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {
            minWidth:'inherit',
            top: '20px',
            width: '125px',
            right: '154px',
            left:'auto'
          }}, 
        React.DOM.li(null, React.DOM.a({href: "#books"}, 
          React.DOM.i({className: "fa fa-times"}), "  " + ' ' +
          "Delete List"
        )), 
        React.DOM.li(null, React.DOM.a({href: "#podcasts"}, 
          "Rename Lists"
        ))
      )
    );
  }
});

var CurrentListsTwo = React.createClass({displayName: 'CurrentListsTwo',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.listAction(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i<this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
               href: "javascript:", 
               onClick: this.listAction}, 
          this.props.lists[i].name))
      )
    }
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: this.props.copyDropdownStyle}, 
        lists
      )
    );
  }
});

var ListDetailButtons = React.createClass({displayName: 'ListDetailButtons',
  // Rename List
  getInitialState: function() {
    return {
      editMode: false
    }
  },
  render: function() {
    //console.log(this.props.currentListObjectId)
    if(!this.state.editMode) {
      stuff = React.DOM.span({className: "label label-default", style: listType}, 
            (this.props.currentListName == "All") ? '' : React.DOM.i({className: "fa fa-align-justify", style: {marginRight:'5px'}}), 
            (this.props.currentListName == "All") ? '' : "   " +this.props.currentListName
              )
    } else {
      stuff = React.DOM.input({className: "form-control", style: {width: 100, float: 'left', height: 24, marginTop: -1}})
    }
    return (

          React.DOM.div(null, 
            React.DOM.h4({style: {margin:0}}, 
              stuff, 
              React.DOM.a({href: "javascript:", 
                style: listBtn, 
                'data-toggle': "modal", 
                id: "renameListBtn", 
                'data-target': ".bs-renameList-modal-sm", 
                className: "btn-gradient btn btn-xs btn-primary"}, 
                React.DOM.i({className: "fa fa-pencil"})
              ), 
              React.DOM.a({href: "javascript:", 
                style: listBtn, 
                'data-toggle': "modal", 
                id: "deleteListModal", 
                'data-target': ".bs-deleteList-modal-sm", 
                className: "btn-gradient btn btn-xs btn-primary"}, 
                React.DOM.i({className: "fa fa-trash-o"})
              )
            ), 
            RenameListModal({renameList: this.props.renameList}), 
            DeleteListModal({deleteList: this.props.deleteList})
          )
      );
  },

  renameList: function(newListName) {
    this.props.renameList(newListName)
  },

  deleteList: function(){
    this.props.deleteList()
  },

  toggleEdit: function() {
    this.setState({editMode: !this.state.editMode })
  }
});


},{"./delete_list_modal.js.min.js":2,"./loading_spinner.js.min.js":3,"./messenger.js.min.js":4,"./panel_footing.js.min.js":5,"./rename_list_modal.js.min.js":7,"./side_menu_user_prospects.js.min.js":8,"./user_prospect.js.min.js":9,"./user_prospect_header.js.min.js":10,"./user_side_menu_list.js.min.js":11}],7:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  renameList: function(e) {
    e.preventDefault()
    //console.log($('#newListName').val())
    newListName = $('#newListName').val()
    if(newListName.trim() != "")
      this.props.renameList(newListName)
    // Disable Modal
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-renameList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Rename List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.renameList}, 
                    React.DOM.input({id: "newListName", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.renameList, 
                      className: "btn btn-success", 
                      style: {display:'block', width:'100%'}}, 
                      "Create List"
                    )
                  )
                )
              )
            )
          )
    );
  }
});


},{}],8:[function(require,module,exports){
/** @jsx React.DOM */

var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var createListModal = require('./create_list_modal.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  //SideMenuProspects
  createList: function (data) {
    this.props.createList(data)
  },

  componentDidMount: function() {
  },

  changeList: function(e) {
    /*
    currentList = $(e.target).parent()//.data('list')
    console.log(currentList)
    this.props.changeList(currentList.name, currentList.objectId)
    */
  },

  render: function() {
    
    styles = (this.props.currentList == "All") ? {'backgroundColor':'rgb(0, 122, 255)', 'color':'white'} : {}

    lists  = [ React.DOM.button({type: "button", onClick: this.props.changeList, style: styles, className: "list-names btn btn-default all"}, 'All', 
      React.DOM.span({style: {float:'right',marginTop:'1px', backgroundColor:'#999'}, className: "badge badge-default"}, this.props.count)),
      React.DOM.button({type: "button", onClick: this.props.changeList, style: styles, className: "list-names btn btn-default all"}, 
        React.DOM.i({className: "fa fa-archive"}), "  ", 
        'Archived', " ", React.DOM.span({style: {float:'right',marginTop:'1px', backgroundColor:'#999'}, className: "badge badge-default"}, this.props.count)) ]
  
    for(i=0;i<this.props.lists.length;i++){
      list = this.props.lists[i]
      lists.push(
        React.DOM.button({type: "button", onClick: this.props.changeList, 'data-list': JSON.stringify(list), className: "list-names btn btn-default"}, list.name, React.DOM.span({style: {backgroundColor:'#999',float:'right',marginTop:'1px'}, className: "badge badge-default"}, list.count), "      ")
      )
    }
    lists = [SideMenuListOption({list: {name: 'All',count: this.props.totalCount}, 
                iconType: 'users', 
                changeList: this.props.changeList}), SideMenuListOption({list: {name: 'Archived', count: '~'}, iconType: 'archive', changeList: this.props.changeList, hideCount: true})]
    for(i=0;i<this.props.lists.length;i++){
      list = this.props.lists[i]
      lists.push(
        SideMenuListOption({list: list, changeList: this.props.changeList})
      )
    }

    
    return (
      React.DOM.div({className: "col-md-2", style: {padding:'0',height:'438px',backgroundColor:'#e0e9ee',borderRight:'1px solid #b0b8bf',textAlign:'center'}}, 
        React.DOM.div({className: "prospect-list-header"}, 
          "Lists"
        ), 
        React.DOM.div({className: "btn-group-vertical", style: {width:'100%', height: '320px', overflow: 'auto'}}, 
          lists
        ), 
        React.DOM.br(null), 
        React.DOM.br(null), 
        React.DOM.a({href: "javascript:", className: "btn btn-primary new-list-btn", 
              'data-toggle': "modal", 'data-target': ".bs-example-modal-sm", 
              style: { backgroundImage: 'linear-gradient(180deg, #0096ff 0%, #005dff 100%)'}}, 
          React.DOM.i({className: "fa fa-plus-circle"}), "  New List"
        ), 
        createListModal({createList: this.createList}), 
        React.DOM.br(null)
      )
    );
  },

});

},{"./create_list_modal.js.min.js":1,"./user_side_menu_list.js.min.js":11}],9:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // UserProspect
  getInitialState: function() {
    return { }
  },

  clickCheck: function() {
    domNode = this.getDOMNode()
    isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    //console.log(isChecked)
    this.setState({checked: isChecked})
    this.props.checkboxAction(isChecked, this.props.prospect.objectId)
  },

  rowClick: function() {
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
  },

  keyboardClick: function() {
    $($('.keySelect').find('input[type="checkbox"]')[0]).click()
  },

  componentDidMount: function() { },

  render: function() {
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
    thissss = this
    if(this.props.keyboardSelected) {
      // Adjust Scroll depending on where the prospect is
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
      Mousetrap.unbind('x')
      Mousetrap.bind('x', function() { 
        thissss.keyboardClick()
        if(thissss.state.checked)
          console.log("lmao")
      });
    }

    prospect = this.props.prospect

    if(this.props.masterCheckboxChecked && this.state.checked)
      checked = true
    else if(this.props.alreadyChecked)
      checked = true
    else if(this.state.checked)
      checked = true
    else if(this.props.masterCheckboxChecked || this.state.checked)
      checked = true
    else
      checked = false

    //console.log(this.state.checked)
    //console.log(checked)
    //{prospect.employeeCountRange.name + " employees" }
    
    color = {}
    if(this.state.checked || this.props.alreadyChecked)
      color = {backgroundColor: '#eef8ff'}
      
    rowCl = (this.props.keyboardSelected) ? "prospects-tr keySelect" : "prospects-tr"
    websiteBtn = (prospect.websiteUrl) ?  React.DOM.a({href: "http://"+prospect.websiteUrl.replace('http://','')}, " ", React.DOM.i({className: "fa fa-globe"}), " ") : ""
    return (
      React.DOM.tr({className: rowCl, 
          onClick: this.rowClick, 
          style: keyboardSelected}, 
          React.DOM.td({style: color}, 
              React.DOM.input({type: "checkbox", 
                     onChange: this.clickCheck, 
                     checked: checked})
          ), 
          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, prospect.name), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}}, 
              (prospect.pos) ? prospect.pos.trim() : ""
            )
          ), 
          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, 
              prospect.company_name
            ), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}}, 
              (prospect.employeeCountRange) ? prospect.employeeCountRange.name + " employees" : ""
            )
          ), 

          React.DOM.td({style: color}, 
            React.DOM.h6({style: {margin:'0px'}}, prospect.city)), 
          React.DOM.td({style: color}, 
            React.DOM.a({href: "mailto:"+prospect.email, 
               style: {margin:'0px'}}, 
            (prospect.email) ? prospect.email.toLowerCase() : ""
          )), 
          React.DOM.td({style: color}, this.props.li, " ", this.props.link), 
          React.DOM.td({style: color}, 
            websiteBtn
          )
        )
    );
  },

  deleteProspect: function() {
    this.props.deleteProspect(this.props.prospect.objectId, 'Prospect')
  }
});


},{}],10:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  checkboxAction: function(e) {
    checkboxVal = $(e.target).is(':checked')
    this.props.masterCheckboxChanged(checkboxVal)
  },

  componentDidMount: function() {

  },

  render: function() {
    return (
            React.DOM.tr(null, 
              React.DOM.th(null, React.DOM.input({type: "checkbox", onChange: this.checkboxAction})), 
              React.DOM.th(null, "Name"), 
              React.DOM.th(null, "Company"), 
              React.DOM.th({style: {width:'170px'}}, "City"), 
              React.DOM.th(null, "Email"), 
              React.DOM.th(null, " "), 
              React.DOM.th(null, " ")
            )
    );
  }
});

},{}],11:[function(require,module,exports){
/** @jsx React.DOM */

//SideMenuListOption
module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {count: '~'}
  },

  componentDidMount: function() {
    // make ajax request to get each requests 
    /*
    list = {
      '__type'    : 'Pointer',
      'objectId'  : this.props.list.objectId,
      'className' : 'ProspectList', 
    }

    parse_headers = {
      'X-Parse-Application-Id'  : 'N85QOkteEEQkuZVJKAvt8MVes0sjG6qNpEGqQFVJ', 
      'X-Parse-REST-API-Key'    : 'VN6EwVyBZwO1uphsBPsau8t7JQRp00UM3KYsiiQb',
    }

    thiss = this;

    //console.log(this.props.list.name)
    $.ajax({
      url:'https://api.parse.com/1/classes/Prospects',
      type:'GET',
      headers:parse_headers,
      data: 'where={"lists":'+JSON.stringify(list)+'}&count=1',
      success: function(res) {
        thiss.setState({count: res.count})
      },
      error: function(err) {
        console.log(err)
      }
    })
    */
  },

  changeList: function() {
    this.props.changeList(this.props.list.name, this.props.list.objectId)
  },

  render: function() {
    listName = this.props.list.name
    propsCount = this.props.count
    count = (typeof(propsCount)== "undefined") ? this.state.count : propsCount

    //console.log(this.props.iconType)
    icon = ""
    if(this.props.iconType == "archive"){
      icon = React.DOM.i({className: "fa fa-archive"})
    } else if(this.props.iconType == "users"){
      icon = React.DOM.i({className: "fa fa-user"})
    }


    countStyle = (this.props.hideCount) ? {'display':'none'} : {backgroundColor:'#999',float:'right',marginTop:'1px'}
    return (
      React.DOM.button({type: "button", 
              onClick: this.changeList, 
              className: "list-names btn btn-default"}, 
              icon, 
              " ", 
              listName, 
              React.DOM.span({style: countStyle, 
                className: "badge badge-default"}, this.props.list.count)
      )
    );
  }
});


},{}]},{},[6])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcHJvc3BlY3RzLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcmVuYW1lX2xpc3RfbW9kYWwuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zaWRlX21lbnVfdXNlcl9wcm9zcGVjdHMuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy91c2VyX3Byb3NwZWN0LmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9wcm9zcGVjdF9oZWFkZXIuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy91c2VyX3NpZGVfbWVudV9saXN0LmpzLm1pbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUE1RUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUExRkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBN0JBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBckJBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDemlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG52YXIgVXNlclByb3NwZWN0ID0gcmVxdWlyZSgnLi91c2VyX3Byb3NwZWN0LmpzLm1pbi5qcycpO1xudmFyIFVzZXJQcm9zcGVjdEhlYWRlciA9IHJlcXVpcmUoJy4vdXNlcl9wcm9zcGVjdF9oZWFkZXIuanMubWluLmpzJyk7XG52YXIgU2lkZU1lbnVQcm9zcGVjdHMgPSByZXF1aXJlKCcuL3NpZGVfbWVudV91c2VyX3Byb3NwZWN0cy5qcy5taW4uanMnKTtcbnZhciBTaWRlTWVudUxpc3RPcHRpb24gPSByZXF1aXJlKCcuL3VzZXJfc2lkZV9tZW51X2xpc3QuanMubWluLmpzJyk7XG52YXIgTG9hZGluZ1NwaW5uZXIgPSByZXF1aXJlKCcuL2xvYWRpbmdfc3Bpbm5lci5qcy5taW4uanMnKVxudmFyIFBhbmVsRm9vdGluZyA9IHJlcXVpcmUoJy4vcGFuZWxfZm9vdGluZy5qcy5taW4uanMnKVxudmFyIE1lc3NlbmdlciA9IHJlcXVpcmUoJy4vbWVzc2VuZ2VyLmpzLm1pbi5qcycpXG52YXIgRGVsZXRlTGlzdE1vZGFsID0gcmVxdWlyZSgnLi9kZWxldGVfbGlzdF9tb2RhbC5qcy5taW4uanMnKVxudmFyIFJlbmFtZUxpc3RNb2RhbCA9IHJlcXVpcmUoJy4vcmVuYW1lX2xpc3RfbW9kYWwuanMubWluLmpzJylcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4geyAgcHJvc3BlY3RzICAgOiBbXSxcbiAgICAgICAgICAgICAgY3VycmVudFBhZ2UgOiAxLFxuICAgICAgICAgICAgICBwYWdlcyAgICAgICA6IDEsXG4gICAgICAgICAgICAgIGN1cnJlbnRMaXN0IDogJ0FsbCcsXG4gICAgICAgICAgICAgIGN1cnJlbnRMaXN0T2JqZWN0SWQgOiAnJyxcbiAgICAgICAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgcHJvc3BlY3RzUGVyUGFnZTogNTAsXG4gICAgICAgICAgICAgIGxpc3RzIDogW10sXG4gICAgICAgICAgICAgIG1hc3RlckNoZWNrYm94Q2hlY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgIGtleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDAsIC8vZmlyc3RcbiAgICAgICAgICAgICAgc2VsZWN0ZWRQcm9zcGVjdHM6IFtdLFxuICAgICAgICAgICAgICB0b3RhbENvdW50ICA6IFwiflwiLCBcbiAgICAgICAgICAgICAgY291bnQgICAgICAgOiBcIn5cIiwgfVxuICB9LFxuXG4gIGNyZWF0ZUxpc3Q6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBsaXN0cyA9IHRoaXMuc3RhdGUubGlzdHNcbiAgICBsaXN0cy5wdXNoKGRhdGEpXG4gICAgdGhpcy5zZXRTdGF0ZSh7IGxpc3RzOiBsaXN0cyB9KVxuICB9LFxuXG4gIHJlbmFtZUxpc3Q6IGZ1bmN0aW9uKG5ld0xpc3ROYW1lKSB7XG4gICAgcGFyc2VIZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyh0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgY29uc29sZS5sb2codGhpcy5zdGF0ZS5jdXJyZW50TGlzdClcbiAgICBjb25zb2xlLmxvZyhuZXdMaXN0TmFtZSlcblxuICAgIC8vIFVwZGF0ZSBMb2NhbCBTdGF0ZVxuICAgIHRoaXNzID0gdGhpcztcbiAgICB2YXIgZmlsdGVyZWQgPSBfLmZpbHRlcih0aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpZihpdGVtLm5hbWUgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3Qpe1xuICAgICAgICBpdGVtLm5hbWUgPSBuZXdMaXN0TmFtZVxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfVxuICAgICAgcmV0dXJuIGl0ZW1cbiAgICB9KTtcblxuICAgIHRoaXMuc2V0U3RhdGUoe2xpc3RzIDogZmlsdGVyZWR9KVxuICAgIHRoaXMuc2V0U3RhdGUoe2N1cnJlbnRMaXN0OiBuZXdMaXN0TmFtZX0pXG5cbiAgICAkKCcubW9kYWwnKS5jbGljaygpXG4gICAgJCgnI25ld0xpc3ROYW1lJykudmFsKCcnKVxuICAgICQoJy5tb2RhbC1iYWNrZHJvcCcpLmNsaWNrKClcblxuICAgIC8vIFBlcnNpc3QgLyBBamF4XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QvJyt0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQsXG4gICAgICBoZWFkZXJzOiBwYXJzZUhlYWRlcnMsXG4gICAgICB0eXBlOidQVVQnLFxuICAgICAgZGF0YTpKU09OLnN0cmluZ2lmeSh7J25hbWUnOm5ld0xpc3ROYW1lfSksXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIGRlbGV0ZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIC8vIFRPRE8gXG4gICAgLy8gR2V0IEFsbCBNZW1iZXJzIE9mIFRoaXMgTGlzdFxuICAgIC8vIFJlbW92ZSBGcm9tIExpc3QgQXJyYXlcbiAgICBwYXJzZUhlYWRlcnMgPSB7XG4gICAgICAnWC1QYXJzZS1BcHBsaWNhdGlvbi1JZCcgIDogJ044NVFPa3RlRUVRa3VaVkpLQXZ0OE1WZXMwc2pHNnFOcEVHcVFGVkonLCBcbiAgICAgICdYLVBhcnNlLVJFU1QtQVBJLUtleScgICAgOiAnVk42RXdWeUJad08xdXBoc0JQc2F1OHQ3SlFScDAwVU0zS1lzaWlRYicsXG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgfVxuICAgIFxuICAgIHZhciBmaWx0ZXJlZCA9IF8uZmlsdGVyKHRoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IGZpbHRlcmVkfSlcbiAgICB0aGlzLnNldFN0YXRlKHtjdXJyZW50TGlzdDogJ0FsbCd9KVxuICAgIHRoaXMuY2hhbmdlTGlzdCgnQWxsJywgJycpXG5cbiAgICAvLyBSZW1vdmVcbiAgICAkKCcubW9kYWwnKS5jbGljaygpXG4gICAgJCgnI25ld0xpc3ROYW1lJykudmFsKCcnKVxuICAgICQoJy5tb2RhbC1iYWNrZHJvcCcpLmNsaWNrKClcblxuICAgIC8vIFBlcnNpc3QgLyBBamF4XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QvJyt0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQsXG4gICAgICBoZWFkZXJzOiBwYXJzZUhlYWRlcnMsXG4gICAgICB0eXBlOidERUxFVEUnLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBjaGFuZ2VMaXN0OiBmdW5jdGlvbihuZXdMaXN0TmFtZSxvYmplY3RJZCkge1xuICAgIC8vIGFkZCBvdmVybGF5IGxvYWRpbmdcbiAgICAvL2NvbnNvbGUubG9nKG5ld0xpc3ROYW1lKVxuICAgIC8vY29uc29sZS5sb2cob2JqZWN0SWQpXG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShbXSlcblxuICAgIHRoaXMuc2V0U3RhdGUoe2N1cnJlbnRMaXN0IDogbmV3TGlzdE5hbWV9KVxuICAgIHRoaXMuc2V0U3RhdGUoe2N1cnJlbnRMaXN0T2JqZWN0SWQgOiBvYmplY3RJZH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7cHJvc3BlY3RzICA6IFtdICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y291bnQgICAgICA6ICd+JyAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7cGFnZXMgICAgICA6IDEgICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7bG9hZGluZyAgICA6IHRydWUgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudFBhZ2U6IDF9KVxuICAgIHRoaXMuc2V0U3RhdGUoe2tleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDB9KVxuXG4gICAgcXJ5ID0gJ3doZXJlPXtcImNvbXBhbnlcIjonK2NvbXBhbnkrJyxcImFyY2hpdmVkXCI6dHJ1ZX0mY291bnQ9MSZvcmRlcj0tY3JlYXRlZEF0J1xuICAgIGNvbnNvbGUubG9nKG5ld0xpc3ROYW1lKVxuXG4gICAgaWYodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCAhPSAnQWxsJyB8fCB0eXBlb2Yob2JqZWN0SWQpICE9IFwidW5kZWZpbmVkXCIgJiYgbmV3TGlzdE5hbWUgIT0gJ0FyY2hpdmVkJyl7XG4gICAgICBjdXJyZW50TGlzdCA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgJ29iamVjdElkJyAgOiBvYmplY3RJZCwgXG4gICAgICAgICdfX3R5cGUnICAgIDogJ1BvaW50ZXInLCBcbiAgICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JyBcbiAgICAgIH0pXG5cbiAgICAgIGNvbXBhbnkgPSBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikuY29tcGFueSlcbiAgICAgIHFyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55Kyd9JmNvdW50PTEnXG4gICAgICBxcnkgPSAnd2hlcmU9e1wibGlzdHNcIjonK2N1cnJlbnRMaXN0Kyd9JmNvdW50PTEmb3JkZXI9LWNyZWF0ZWRBdCdcbiAgICB9IGVsc2UgaWYgKG5ld0xpc3ROYW1lID09ICdBcmNoaXZlZCcpIHtcbiAgICAgIHFyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55KycsXCJhcmNoaXZlZFwiOmZhbHNlfSZjb3VudD0xJm9yZGVyPS1jcmVhdGVkQXQnXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHFyeSlcblxuICAgICQuYWpheCh7XG4gICAgICB1cmw6ICdodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1Byb3NwZWN0cycsXG4gICAgICB0eXBlOidHRVQnLFxuICAgICAgaGVhZGVyczogcGFyc2VfaGVhZGVycyxcbiAgICAgIGFzeW5jOiB0cnVlLFxuICAgICAgZGF0YTogcXJ5LFxuICAgICAgYWpheFN0YXJ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3N0YXJ0ZWQgbGlzdCcpXG4gICAgICB9LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtwcm9zcGVjdHM6IHJlcy5yZXN1bHRzfSlcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtjb3VudDogcmVzLmNvdW50fSlcbiAgICAgICAgLy90aGlzc3Muc2V0U3RhdGUoe3RvdGFsQ291bnQ6IHJlcy5jb3VudH0pXG4gICAgICAgIHRoaXNzcy5zZXRTdGF0ZSh7cGFnZXM6IE1hdGguY2VpbChyZXMuY291bnQvdGhpc3NzLnByb3BzLnByb3NwZWN0c1BlclBhZ2UpfSlcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtsb2FkaW5nOiBmYWxzZX0pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIC8vY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgICAgLy9jb25zb2xlLmxvZyhyZXMpXG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICBjaGVja2JveEFjdGlvbjogZnVuY3Rpb24oY2hlY2tlZFN0YXRlLCBvYmpJZCkge1xuICAgIC8qIFN0b3JpbmcgQ2hlY2tlZCBQcm9zcGVjdHMgSW4gTG9jYWxTdG9yYWdlIFRvIE1ha2UgaXQgRWFzaWVyIFRvXG4gICAgICogQ29weSBhbmQgTW92ZSBQcm9zcGVjdHMgXG4gICAgICpcbiAgICAgKiBNb3ZlIFRvIFVzZXJfUHJvc3BlY3RzP1xuICAgICAqL1xuICAgIFxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgLy9jb25zb2xlLmxvZyhjaGVja2VkU3RhdGUpXG4gICAgaWYoY2hlY2tlZFN0YXRlKVxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMucHVzaChvYmpJZClcbiAgICBlbHNlXG4gICAgICBzZWxlY3RlZFByb3NwZWN0cyA9IF8ucmVqZWN0KHNlbGVjdGVkUHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oaWQpe3JldHVybiBpZCA9PSBvYmpJZH0pXG5cbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFByb3NwZWN0cylcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFByb3NwZWN0cylcbiAgICB0aGlzLnNldFN0YXRlKHtzZWxlY3RlZFByb3NwZWN0czogc2VsZWN0ZWRQcm9zcGVjdHN9KVxuICB9LFxuXG4gIG1hc3RlckNoZWNrYm94Q2hhbmdlZDogZnVuY3Rpb24obWFzdGVyQ2hlY2tib3hWYWx1ZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe21hc3RlckNoZWNrYm94Q2hlY2tlZDogbWFzdGVyQ2hlY2tib3hWYWx1ZX0pXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnN0YXJ0S2V5Ym9hcmRTaG9ydGN1dHMoKVxuICAgICQoJ2JvZHknKS5jc3Moe292ZXJmbG93OidhdXRvJ30pXG5cbiAgICBwcm9zcGVjdHMgPSBbXVxuICAgIGZvcihpPTA7aTx0aGlzLnN0YXRlLnByb3NwZWN0cy5sZW5ndGg7aSsrKSB7XG4gICAgICB1cmwgPSB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXS51cmxcbiAgICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdHNbaV1cblxuICAgICAgaWYodXJsICE9IFwibm8gbGlua2VkaW4gd2Vic2l0ZVwiICYmIHR5cGVvZih1cmwpICE9IFwidW5kZWZpbmVkXCIgJiYgdXJsICE9IFwiXCIpe1xuICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgnaHR0cDovLycsJycpXG4gICAgICAgIHRoZV9saW5rID0gUmVhY3QuRE9NLmEoe2hyZWY6ICdodHRwOi8vJyt1cmx9LCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWdsb2JlXCJ9KSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoZV9saW5rID0gXCJcIlxuICAgICAgfVxuXG4gICAgICBwcm9maWxlID0gdGhpcy5zdGF0ZS5wcm9zcGVjdHNbaV0ubGlua2VkaW5fdXJsLnJlcGxhY2UoJ2h0dHA6Ly8nLCcnKVxuICAgICAgcHJvZmlsZSA9IHRoaXMuc3RhdGUucHJvc3BlY3RzW2ldLmxpbmtlZGluX3VybC5yZXBsYWNlKCdodHRwczovLycsJycpXG4gICAgICBsaSA9IFJlYWN0LkRPTS5hKHtocmVmOiAnaHR0cDovLycrcHJvZmlsZSwgY2xhc3NOYW1lOiBcImxpbmtlZGluX2xpbmtcIn0sIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtbGlua2VkaW4tc3F1YXJlXCJ9KSlcblxuICAgICAga2V5Ym9hcmRTZWxlY3RlZCA9IChpID09IHRoaXMuc3RhdGUua2V5Ym9hcmRBY3RpdmVQcm9zcGVjdClcblxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICAgIGFscmVhZHlDaGVja2VkPWZhbHNlXG4gICAgICBmb3IoaWk9MDtpaTwgc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoO2lpKyspXG4gICAgICAgIGlmKHByb3NwZWN0Lm9iamVjdElkID09IHNlbGVjdGVkUHJvc3BlY3RzW2lpXSlcbiAgICAgICAgICBhbHJlYWR5Q2hlY2tlZCA9IHRydWVcblxuICAgICAgICAvL2NvbnNvbGUubG9nKGFscmVhZHlDaGVja2VkKVxuXG4gICAgICBwcm9zcGVjdHMucHVzaChcbiAgICAgICAgVXNlclByb3NwZWN0KHtkZWxldGVQcm9zcGVjdDogdGhpcy5kZWxldGVQcm9zcGVjdCwgXG4gICAgICAgICAgICAgICAgICAgICAgcHJvc3BlY3Q6IHRoaXMuc3RhdGUucHJvc3BlY3RzW2ldLCBcbiAgICAgICAgICAgICAgICAgICAgICBtYXN0ZXJDaGVja2JveENoZWNrZWQ6IHRoaXMuc3RhdGUubWFzdGVyQ2hlY2tib3hDaGVja2VkLCBcbiAgICAgICAgICAgICAgICAgICAgICBrZXk6IHRoaXMuZ2VuZXJhdGVfaWQoKSwgXG4gICAgICAgICAgICAgICAgICAgICAgbGluazogdGhlX2xpbmssIFxuICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkU2VsZWN0ZWQ6IGtleWJvYXJkU2VsZWN0ZWQsIFxuICAgICAgICAgICAgICAgICAgICAgIGNoZWNrYm94QWN0aW9uOiB0aGlzLmNoZWNrYm94QWN0aW9uLCBcbiAgICAgICAgICAgICAgICAgICAgICBhbHJlYWR5Q2hlY2tlZDogYWxyZWFkeUNoZWNrZWQsIFxuICAgICAgICAgICAgICAgICAgICAgIGxpOiBsaX0pKVxuICAgIH1cblxuICAgIGxpc3RUeXBlID0gKHRoaXMuc3RhdGUuY3VycmVudExpc3QgPT0gXCJBbGxcIikgPyB7ZGlzcGxheTonbm9uZSd9IDoge2Zsb2F0OidsZWZ0J31cbiAgICBsaXN0QnRuID0gKHRoaXMuc3RhdGUuY3VycmVudExpc3QgPT0gXCJBbGxcIikgPyB7ZGlzcGxheTonbm9uZSd9IDoge2Zsb2F0OidsZWZ0JyxtYXJnaW5MZWZ0OjV9XG4gICAgbGlzdE9wdGlvbnMgPSAodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKSA/IHtkaXNwbGF5Oidub25lJ30gOiB7ZmxvYXQ6J3JpZ2h0J31cbiAgICBjb3B5RHJvcGRvd25TdHlsZSA9ICh0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09IFwiQWxsXCIpID8ge3dpZHRoOjExNCwgcmlnaHQ6NH0gOiB7d2lkdGg6MTE0LCByaWdodDozNn1cbiAgICBjdXJyZW50TGlzdCA9IHRoaXMuc3RhdGUuY3VycmVudExpc3RcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbnRhaW5lclwiLCBzdHlsZToge3dpZHRoOicxMDAlJyxwYWRkaW5nOicwJywgYmFja2dyb3VuZDogJ2xpbmVhci1ncmFkaWVudCgjZGFlOGZmLCNkYWU4ZmYpJywgYmFja2dyb3VuZEltYWdlOiAncmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCBjZW50ZXIgY2VudGVyLCNmZmYsI2RmZjFmZCA5MDBweCknfX0sIFxuICAgICAgICBTaWRlTWVudVByb3NwZWN0cyh7Y3VycmVudExpc3Q6IHRoaXMuc3RhdGUuY3VycmVudExpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQ6IHRoaXMuc3RhdGUuY291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxDb3VudDogdGhpcy5zdGF0ZS50b3RhbENvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMuY2hhbmdlTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVMaXN0OiB0aGlzLmNyZWF0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHM6IHRoaXMuc3RhdGUubGlzdHN9KSwgXG5cbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbC1tZC0xMFwiLCBzdHlsZToge3BhZGRpbmc6JzAnfX0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtpZDogXCJwcm9zcGVjdERldGFpbEJ1dHRvbnNcIn0sIFxuICAgICAgICAgICAgICAgIExpc3REZXRhaWxCdXR0b25zKHtcbiAgICAgICAgICAgICAgICAgIHJlbmFtZUxpc3Q6IHRoaXMucmVuYW1lTGlzdCwgXG4gICAgICAgICAgICAgICAgICBkZWxldGVMaXN0OiB0aGlzLmRlbGV0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgY3VycmVudExpc3ROYW1lOiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0LCBcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaXN0OiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWR9KSwgXG5cbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZHJvcGRvd25cIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIiwgXG4gICAgICAgICAgICAgICAgICAgICBpZDogXCJcIiwgXG4gICAgICAgICAgICAgICAgICAgICBzdHlsZTogbGlzdE9wdGlvbnN9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1iYXJzXCJ9KVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRyb3Bkb3duXCJ9LCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHsnZGF0YS10b2dnbGUnOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiY29weVRvTGlzdFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcC10YXJnZXQgYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIn0sIFxuICAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jb3B5XCJ9KSwgXG4gICAgICAgICAgICAgICAgICAgICAgIFwiwqAgQ29weSBUbyBMaXN0IMKgXCIsICBcbiAgICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2FyZXQtZG93blwifSlcbiAgICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgICBDdXJyZW50TGlzdHNUd28oe2xpc3RzOiB0aGlzLnN0YXRlLmxpc3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcHlEcm9wZG93blN0eWxlOiBjb3B5RHJvcGRvd25TdHlsZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0QWN0aW9uOiB0aGlzLmNvcHlTZWxlY3RlZFByb3NwZWN0c30pXG4gICAgICAgICAgICAgICAgKSwgXG4gIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJkcm9wZG93blwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7J2RhdGEtdG9nZ2xlJzogXCJkcm9wZG93blwiLCBcbiAgICAgICAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICBpZDogXCJtb3ZlVG9MaXN0XCIsIFxuICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IGxpc3RPcHRpb25zLCBcbiAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgYnRuLXhzIGxpc3Qtb3B0aW9uc1wifSwgXG4gICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXNoYXJlXCJ9KSwgXG4gICAgICAgICAgICAgICAgICAgICBcIsKgIE1vdmUgVG8gTGlzdCDCoFwiLCAgXG4gICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNhcmV0LWRvd25cIn0pXG4gICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgQ3VycmVudExpc3RzKHtsaXN0czogdGhpcy5zdGF0ZS5saXN0cywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0QWN0aW9uOiB0aGlzLm1vdmVTZWxlY3RlZFByb3NwZWN0c30pXG4gICAgICAgICAgICAgICAgKSwgXG5cbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7b25DbGljazogdGhpcy5kb3dubG9hZEZpbGUsIFxuICAgICAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgaWQ6IFwiZG93bmxvYWRQcm9zcGVjdHNcIiwgXG4gICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImRyb3AtdGFyZ2V0IGJ0biBidG4tcHJpbWFyeSBidG4teHMgbGlzdC1vcHRpb25zXCJ9LCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtZG93bmxvYWRcIn0pLCBcIiDCoCBEb3dubG9hZCBDU1YgwqBcIiBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksIFxuICAgICAgICBcblxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2lkOiBcImF1dG9zY3JvbGxcIiwgc3R5bGU6IHtoZWlnaHQ6JzQwMHB4JyxvdmVyZmxvdzonYXV0byd9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00udGFibGUoe2NsYXNzTmFtZTogXCJwcm9zcGVjdHMtdGFibGUgdGFibGUgdGFibGUtc3RyaXBlZFwiLCBzdHlsZToge21hcmdpbkJvdHRvbTonMHB4J319LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoZWFkKHtzdHlsZToge2JhY2tncm91bmRDb2xvcjond2hpdGUnfX0sIFxuICAgICAgICAgICAgICAgIFVzZXJQcm9zcGVjdEhlYWRlcih7bWFzdGVyQ2hlY2tib3hDaGFuZ2VkOiB0aGlzLm1hc3RlckNoZWNrYm94Q2hhbmdlZH0pXG4gICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGJvZHkobnVsbCwgXG4gICAgICAgICAgICAgICAgcHJvc3BlY3RzXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgKHRoaXMuc3RhdGUubG9hZGluZykgPyBMb2FkaW5nU3Bpbm5lcihudWxsKSA6IFwiXCJcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICksIFxuXG4gICAgICBQYW5lbEZvb3Rpbmcoe2N1cnJlbnRQYWdlOiB0aGlzLnN0YXRlLmN1cnJlbnRQYWdlLCBcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IHRoaXMuc3RhdGUuY291bnQsIFxuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0ZTogdGhpcy5wYWdpbmF0ZSwgXG4gICAgICAgICAgICAgICAgICAgIHByb3NwZWN0c1BlclBhZ2U6IHRoaXMuc3RhdGUucHJvc3BlY3RzUGVyUGFnZSwgXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzOiB0aGlzLnN0YXRlLnBhZ2VzfSksIFxuICAgICAgTWVzc2VuZ2VyKG51bGwpXG4gICAgKVxuICAgICk7XG4gIH0sXG5cbiAgcGFnaW5hdGU6IGZ1bmN0aW9uKG5ld1Byb3NwZWN0cywgbmV3UGFnZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgcHJvc3BlY3RzOiBuZXdQcm9zcGVjdHMsXG4gICAgICBjdXJyZW50UGFnZTogbmV3UGFnZSxcbiAgICAgIGtleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDBcbiAgICB9KVxuICAgIHRoaXMuc3RhcnRLZXlib2FyZFNob3J0Y3V0cygpXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9zY3JvbGwnKS5zY3JvbGxUb3AgPSAwXG4gIH0sXG5cbiAgZG93bmxvYWRGaWxlOiBmdW5jdGlvbigpIHtcbiAgICBwYXJzZV9oZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgIH1cblxuICAgIC8vIEdldCBMaXN0IENvdW50XG4gICAgbGlzdCA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICdfX3R5cGUnICAgOiAgJ1BvaW50ZXInLFxuICAgICAgJ2NsYXNzTmFtZSc6ICAnUHJvc3BlY3RMaXN0JyxcbiAgICAgICdvYmplY3RJZCcgOiAgdGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkXG4gICAgfSlcbiAgICBjb25zb2xlLmxvZyhsaXN0KVxuICAgIC8vIEFkZCBTdXBwb3J0IEZvciBNb3JlIHRoYW4gMTAwMFxuICAgIC8vIG51bV9vZl9yZXF1ZXN0c1xuICAgIGxvY2FsU3RvcmFnZS5kb3dubG9hZF90b3RhbCA9IE1hdGguY2VpbCh0aGlzLnN0YXRlLmNvdW50LzEwMDApXG4gICAgICAgIHRoaXMucHJvcHMucGFnaW5hdGUocmVzLnJlc3VsdHMsIHRoaXMucHJvcHMuY3VycmVudFBhZ2UgKyAxKVxuICAgIGxvY2FsU3RvcmFnZS5kb3dubG9hZHMgICAgICA9IDBcblxuICAgIGlmKHRoaXMuc3RhdGUuY3VycmVudExpc3QgPT0gXCJBbGxcIilcbiAgICAgIHFyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55Kyd9JmNvdW50PTEnXG4gICAgZWxzZVxuICAgICAgcXJ5ID0gJ3doZXJlPXtcImxpc3RzXCI6JytsaXN0Kyd9JmNvdW50PTEnXG5cbiAgICBmb3IoaT0wO2k8IE1hdGguY2VpbCh0aGlzLnN0YXRlLmNvdW50LzEwMDApOyBpKyspe1xuICAgICAgJC5hamF4KHtcbiAgICAgICAgdXJsOiAnaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdHM/bGltaXQ9MTAwMCZza2lwPScraSxcbiAgICAgICAgdHlwZTonR0VUJyxcbiAgICAgICAgaGVhZGVyczogcGFyc2VfaGVhZGVycyxcbiAgICAgICAgZG93bmxvYWRGaWxlOiAnZG93bmxvYWRfJytpLFxuICAgICAgICBkYXRhOiBxcnksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgLy8gQ2xlYW4gUmVzdWx0c1xuICAgICAgICAgIC8vIFJlbW92ZSBDZXJ0YWluIFBhcnNlIENvbHVtbnMgLSBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0LCBvYmplY3RJZFxuICAgICAgICAgIC8vIFJlbmFtZSBjcmVhdGVkQXQgYXMgZGF0ZSBwcm9zcGVjdGVkXG4gICAgICAgICAgZm9yKGk9MDtpPCByZXMucmVzdWx0cy5sZW5ndGg7aSsrKSB7XG4gICAgICAgICAgICBkZWxldGUgcmVzLnJlc3VsdHNbaV0uY29tcGFueVxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnBvc1xuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnVzZXJcbiAgICAgICAgICAgIGRlbGV0ZSByZXMucmVzdWx0c1tpXS5vYmplY3RJZFxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLmNyZWF0ZWRBdFxuICAgICAgICAgICAgZGVsZXRlIHJlcy5yZXN1bHRzW2ldLnVwZGF0ZWRBdFxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEFkZCBSZXN1bHRzIFRvIExvY2FsU3RvcmFnZVxuICAgICAgICAgIGxvY2FsU3RvcmFnZS5kb3dubG9hZHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5kb3dubG9hZHMpICsgMSBcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmRvd25sb2FkRmlsZSwgSlNPTi5zdHJpbmdpZnkocmVzLnJlc3VsdHMpKVxuXG4gICAgICAgICAgLy8gQ2hlY2sgdG8gc2VlIGlmIGFsbCBhamF4IHJlcXMgaW4gZm9yIGxvb3AgYXJlIGNvbXBsZXRlXG4gICAgICAgICAgaWYobG9jYWxTdG9yYWdlLmRvd25sb2FkcyA9PSBsb2NhbFN0b3JhZ2UuZG93bmxvYWRfdG90YWwpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtYXRjaGVkJylcbiAgICAgICAgICAgIC8vIE1lcmdlIGFsbCBsb2NhbFN0b3JhZ2UgcmVzdWx0c1xuICAgICAgICAgICAgcHJvc3BlY3RzID0gW11cbiAgICAgICAgICAgIGZvcihpaT0wO2lpIDwgSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZG93bmxvYWRfdG90YWwpOyBpaSsrKXtcbiAgICAgICAgICAgICAgcHJvc3BlY3RzID0gcHJvc3BlY3RzLmNvbmNhdChKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdkb3dubG9hZF8nK2lpKSkpXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKHByb3NwZWN0cylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvc3BlY3RzKVxuICAgICAgICAgICAgLy8gT3V0cHV0IGFzIENTVlxuICAgICAgICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbUGFwYS51bnBhcnNlKHByb3NwZWN0cyldLCB7dHlwZTogXCJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLThcIn0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYmxvYilcbiAgICAgICAgICAgIHNhdmVBcyhibG9iLCBcInByb3NwZWN0cy5jc3ZcIik7XG4gICAgICAgICAgfVxuICAgICAgfSxcblxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBjb21wYW55ID0gSlNPTi5zdHJpbmdpZnkoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpLmNvbXBhbnkpXG4gICAgXG5cbiAgfSxcblxuICByZW1vdmVTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24oKSB7XG4gICAgLy8gSWYgTGlzdCBUeXBlIGlzIEFsbCBBcmNoaXZlIHRoZSBwcm9zcGVjdFxuICAgIC8vXG4gICAgcGFyc2VIZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgICAgXCJDb250ZW50LVR5cGVcIiA6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxuXG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICBiYXRjaERhdGEgPSBbXVxuXG4gICAgZm9yKGk9MDtpPCBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGg7aSsrKXtcbiAgICAgIGlmKHRoaXMuc3RhdGUuY3VycmVudExpc3QgIT0gJ0FsbCcpe1xuICAgICAgICB0bXAgPSB7XG4gICAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3RzLycrc2VsZWN0ZWRQcm9zcGVjdHNbaV0sXG4gICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgbGlzdHM6IHtcbiAgICAgICAgICAgICAgJ19fb3AnICAgIDogJ1JlbW92ZScsXG4gICAgICAgICAgICAgIFwib2JqZWN0c1wiIDogW3sgXG4gICAgICAgICAgICAgICAgICAnX190eXBlJzonUG9pbnRlcicsXG4gICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonUHJvc3BlY3RMaXN0JyxcbiAgICAgICAgICAgICAgICAgICdvYmplY3RJZCc6dGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkXG4gICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdG1wID0ge1xuICAgICAgICAgIG1ldGhvZDonUFVUJyxcbiAgICAgICAgICBwYXRoOicvMS9jbGFzc2VzL1Byb3NwZWN0cy8nK3NlbGVjdGVkUHJvc3BlY3RzW2ldLFxuICAgICAgICAgIGJvZHk6IHtcbiAgICAgICAgICAgIGFyY2hpdmVkOmZhbHNlLFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYmF0Y2hEYXRhLnB1c2godG1wKVxuICAgIH1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9iYXRjaCcsXG4gICAgICB0eXBlOidQT1NUJyxcbiAgICAgIGhlYWRlcnM6cGFyc2VIZWFkZXJzLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe3JlcXVlc3RzOiBiYXRjaERhdGF9KSxcbiAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgbGlzdHMgPSB0aGlzcy5zdGF0ZS5saXN0c1xuXG4gICAgICAgIGZvcihpPTA7aTwgbGlzdHMubGVuZ3RoOyBpKyspIHsgXG4gICAgICAgICAgLy8gU3VidHJhY3QgRnJvbSBPbGQgTGlzdCAtIE5vdCBXb3JraW5nIEZvciBBcmNoaXZlXG4gICAgICAgICAgaWYobGlzdHNbaV0ub2JqZWN0SWQgPT0gdGhpc3Muc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcbiAgICAgICAgICAgIGxpc3RzW2ldLmNvdW50ID0gcGFyc2VJbnQobGlzdHNbaV0uY291bnQpIC0gcGFyc2VJbnQoc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoKVxuICAgICAgICB9XG4gICAgICAgIC8vIFVwZGF0ZSBsb2NhbCBsaXN0IGNvdW50XG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtsaXN0czogbGlzdHN9KVxuXG4gICAgICAgIC8vIHJlbW92ZSBmcm9tIGN1cnJlbnQgbGlzdCB1aVxuICAgICAgICBzZWxlY3RlZFByb3NwZWN0cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzKVxuICAgICAgICBjb25zb2xlLmxvZygncmVtb3ZlIHNlbGVjdGVkIHByb3NwZWN0cycpXG4gICAgICAgIGNvbnNvbGUubG9nKHNlbGVjdGVkUHJvc3BlY3RzKVxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzcy5zdGF0ZS5wcm9zcGVjdHMpXG4gICAgICAgIHZhciBmaWx0ZXJlZCA9IF8uZmlsdGVyKHRoaXNzLnN0YXRlLnByb3NwZWN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgIGZvcihpPTA7aTwgc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoO2krKykgXG4gICAgICAgICAgICBpZihpdGVtLm9iamVjdElkID09IHNlbGVjdGVkUHJvc3BlY3RzW2ldKVxuICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coZmlsdGVyZWQpXG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtwcm9zcGVjdHM6IGZpbHRlcmVkfSlcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5zdHJpbmdpZnkoW10pXG5cbiAgICAgICAgLy8gYWRkIGFsZXJ0IHRvIGluZm9ybSB1c2VyXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgbW92ZVNlbGVjdGVkUHJvc3BlY3RzOiBmdW5jdGlvbihsaXN0T2JqZWN0SWQpIHtcbiAgICBwYXJzZUhlYWRlcnMgPSB7XG4gICAgICAnWC1QYXJzZS1BcHBsaWNhdGlvbi1JZCcgIDogJ044NVFPa3RlRUVRa3VaVkpLQXZ0OE1WZXMwc2pHNnFOcEVHcVFGVkonLCBcbiAgICAgICdYLVBhcnNlLVJFU1QtQVBJLUtleScgICAgOiAnVk42RXdWeUJad08xdXBoc0JQc2F1OHQ3SlFScDAwVU0zS1lzaWlRYicsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiIDogXCJhcHBsaWNhdGlvbi9qc29uXCJcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIHNlbGVjdGVkIG9iamVjdElkIGZyb20gc2VsZWN0ZWRQcm9zcGVjdHMgc3RhdGVcbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzKVxuICAgIGJhdGNoRGF0YSA9IFtdXG5cblxuICAgIC8vIEJhdGNoIFVwZGF0ZSBQYXJzZVxuICAgIC8vIC0gUmVtb3ZlIEFsbCBTZWxlY3RlZCBQcm9zcGVjdHMgRnJvbSBDdXJyZW50IExpc3RcbiAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspe1xuICAgICAgdG1wID0ge1xuICAgICAgICBtZXRob2Q6J1BVVCcsXG4gICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3RzLycrc2VsZWN0ZWRQcm9zcGVjdHNbaV0sXG4gICAgICAgIGJvZHk6IHtcbiAgICAgICAgICBsaXN0czoge1xuICAgICAgICAgICAgJ19fb3AnICAgIDogJ1JlbW92ZScsXG4gICAgICAgICAgICBcIm9iamVjdHNcIiA6IFt7IFxuICAgICAgICAgICAgICAgICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonUHJvc3BlY3RMaXN0JyxcbiAgICAgICAgICAgICAgICAnb2JqZWN0SWQnOnRoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZFxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJhdGNoRGF0YS5wdXNoKHRtcClcbiAgICB9XG4gICAgXG4gICAgLy8gLSBBZGQgT3RoZXIgTGlzdCBcbiAgICBmb3IoaT0wO2k8IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aDtpKyspe1xuICAgICAgdG1wID0ge1xuICAgICAgICBtZXRob2Q6J1BVVCcsXG4gICAgICAgIHBhdGg6Jy8xL2NsYXNzZXMvUHJvc3BlY3RzLycrc2VsZWN0ZWRQcm9zcGVjdHNbaV0sXG4gICAgICAgIGJvZHk6IHtcbiAgICAgICAgICBsaXN0czoge1xuICAgICAgICAgICAgJ19fb3AnICAgIDogJ0FkZFVuaXF1ZScsXG4gICAgICAgICAgICBcIm9iamVjdHNcIiA6IFt7IFxuICAgICAgICAgICAgICAgICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonUHJvc3BlY3RMaXN0JyxcbiAgICAgICAgICAgICAgICAnb2JqZWN0SWQnOmxpc3RPYmplY3RJZFxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJhdGNoRGF0YS5wdXNoKHRtcClcbiAgICB9XG5cbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvYmF0Y2gnLFxuICAgICAgdHlwZTonUE9TVCcsXG4gICAgICBoZWFkZXJzOnBhcnNlSGVhZGVycyxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtyZXF1ZXN0czogYmF0Y2hEYXRhfSksXG4gICAgICBzdWNjZXNzOmZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgIGxpc3RzID0gdGhpc3Muc3RhdGUubGlzdHNcblxuICAgICAgICBmb3IoaT0wO2k8IGxpc3RzLmxlbmd0aDsgaSsrKSB7IFxuICAgICAgICAgIC8vIEFkZCBUbyBOZXcgTGlzdFxuICAgICAgICAgIGlmKGxpc3RzW2ldLm9iamVjdElkID09IGxpc3RPYmplY3RJZClcbiAgICAgICAgICAgIGxpc3RzW2ldLmNvdW50ID0gcGFyc2VJbnQobGlzdHNbaV0uY291bnQpICsgcGFyc2VJbnQoc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoKVxuICAgICAgICAgIC8vIFN1YnRyYWN0IEZyb20gT2xkIExpc3RcbiAgICAgICAgICBpZihsaXN0c1tpXS5vYmplY3RJZCA9PSB0aGlzcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgICAgICAgICAgbGlzdHNbaV0uY291bnQgPSBwYXJzZUludChsaXN0c1tpXS5jb3VudCkgLSBwYXJzZUludChzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGgpXG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIGxvY2FsIGxpc3QgY291bnRcbiAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2xpc3RzOiBsaXN0c30pXG5cbiAgICAgICAgLy8gcmVtb3ZlIGZyb20gY3VycmVudCBsaXN0IHVpXG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RlZFByb3NwZWN0cycpXG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXNzLnN0YXRlLnByb3NwZWN0cylcbiAgICAgICAgdmFyIGZpbHRlcmVkID0gXy5maWx0ZXIodGhpc3Muc3RhdGUucHJvc3BlY3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgICAgaXNfc2VsZWN0ZWQgPSB0cnVlXG4gICAgICAgICAgZm9yKGk9MDtpPCBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGg7aSsrKSBcbiAgICAgICAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gc2VsZWN0ZWRQcm9zcGVjdHNbaV0pXG4gICAgICAgICAgICAgIGlzX3NlbGVjdGVkID0gZmFsc2VcbiAgICAgICAgICByZXR1cm4gaXNfc2VsZWN0ZWRcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGZpbHRlcmVkKVxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7cHJvc3BlY3RzOiBmaWx0ZXJlZH0pXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cyA9IEpTT04uc3RyaW5naWZ5KFtdKVxuXG4gICAgICAgIC8vIGFkZCBhbGVydCB0byBpbmZvcm0gdXNlclxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuXG4gIGNvcHlTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24obGlzdE9iamVjdElkKSB7XG4gICAgY29uc29sZS5sb2cobGlzdE9iamVjdElkKVxuICAgIFxuICAgIC8vIG1ha2UgYmF0Y2ggYWpheCByZXF1ZXN0IHRvIHBhcnNlXG4gICAgcGFyc2VIZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInLFxuICAgICAgXCJDb250ZW50LVR5cGVcIiA6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfVxuXG4gICAgLy8gQWRkIExvYWRpbmcgU2lnbiBUbyBMaXN0XG5cbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzKVxuICAgIGJhdGNoRGF0YSA9IFtdXG4gICAgZm9yKGk9MDtpPCBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGg7aSsrKXtcbiAgICAgIHRtcCA9IHtcbiAgICAgICAgbWV0aG9kOidQVVQnLFxuICAgICAgICBwYXRoOicvMS9jbGFzc2VzL1Byb3NwZWN0cy8nK3NlbGVjdGVkUHJvc3BlY3RzW2ldLFxuICAgICAgICBib2R5OiB7XG4gICAgICAgICAgbGlzdHM6IHtcbiAgICAgICAgICAgICdfX29wJyAgICA6ICdBZGRVbmlxdWUnLFxuICAgICAgICAgICAgXCJvYmplY3RzXCIgOiBbeyBcbiAgICAgICAgICAgICAgICAnX190eXBlJzonUG9pbnRlcicsXG4gICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6J1Byb3NwZWN0TGlzdCcsXG4gICAgICAgICAgICAgICAgJ29iamVjdElkJzpsaXN0T2JqZWN0SWRcbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBiYXRjaERhdGEucHVzaCh0bXApXG4gICAgfVxuXG4gICAgdGhpc3MgPSB0aGlzO1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2JhdGNoJyxcbiAgICAgIHR5cGU6J1BPU1QnLFxuICAgICAgaGVhZGVyczpwYXJzZUhlYWRlcnMsXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7cmVxdWVzdHM6IGJhdGNoRGF0YX0pLFxuICAgICAgc3VjY2VzczpmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICAvLyBVcGRhdGUgV2l0aCB0aGUgbnVtYmVyIG9mIHN1Y2Nlc3Nlc1xuICAgICAgICAvLyBVcGRhdGUgbG9jYWwgbGlzdCBjb3VudFxuICAgICAgICBsaXN0cyA9IHRoaXNzLnN0YXRlLmxpc3RzXG4gICAgICAgIGZvcihpPTA7aTwgbGlzdHMubGVuZ3RoOyBpKyspIHsgXG4gICAgICAgICAgaWYobGlzdHNbaV0ub2JqZWN0SWQgPT0gbGlzdE9iamVjdElkKVxuICAgICAgICAgICAgbGlzdHNbaV0uY291bnQgPSBwYXJzZUludChsaXN0c1tpXS5jb3VudCkgKyBwYXJzZUludChyZXMubGVuZ3RoKVxuICAgICAgICB9XG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtsaXN0czogbGlzdHN9KVxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBcIltdXCJcbiAgICAgICAgdGhpc3Muc2V0U3RhdGUoe3NlbGVjdGVkUHJvc3BlY3RzIDogW10gfSlcbiAgICAgICAgXG4gICAgICAgIC8vIGFkZCBhbGVydCB0byBpbmZvcm0gdXNlclxuICAgICAgICAvLyBVbnNlbGVjdCBhbGwgc2VsZWN0ZWRcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KTtcblxuICB9LFxuXG4gIGhpZGVBbGVydDogZnVuY3Rpb24oKSB7XG4gICAgJCgnLmFsZXJ0JykuaGlkZSgpXG4gIH0sXG5cbiAgYWRqdXN0SGVpZ2h0OiBmdW5jdGlvbih3aGljaE9uZSkge1xuICAgIHByb3NwZWN0V2luZG93VG9wID0gJCgnI3Byb3NwZWN0RGV0YWlsQnV0dG9ucycpLnBvc2l0aW9uKCkudG9wXG4gICAgcHJvc3BlY3RXaW5kb3dUb3AgPSBwcm9zcGVjdFdpbmRvd1RvcCArICQoJyNwcm9zcGVjdERldGFpbEJ1dHRvbnMnKS5oZWlnaHQoKVxuICAgIHByb3NwZWN0V2luZG93Qm90dG9tID0gJCgnI2F1dG9zY3JvbGwnKS5wb3NpdGlvbigpLnRvcCArICQoJyNhdXRvc2Nyb2xsJykuaGVpZ2h0KClcblxuICAgIGlmKHdoaWNoT25lID09ICdqJylcbiAgICAgIGFjdGl2ZVByb3NwZWN0ID0gdGhpcy5zdGF0ZS5rZXlib2FyZEFjdGl2ZVByb3NwZWN0ICsxIFxuICAgIGVsc2VcbiAgICAgIGFjdGl2ZVByb3NwZWN0ID0gdGhpcy5zdGF0ZS5rZXlib2FyZEFjdGl2ZVByb3NwZWN0IC0xIFxuXG4gICAgYWN0aXZlVG9wID0gJCgkKCcucHJvc3BlY3RzLXRyJylbYWN0aXZlUHJvc3BlY3RdKS5wb3NpdGlvbigpLnRvcFxuICAgIHNlbGVjdGVkSGVpZ2h0ID0gJCgkKCcucHJvc3BlY3RzLXRyJylbYWN0aXZlUHJvc3BlY3RdKS5oZWlnaHQoKVxuICAgIGFjdGl2ZUJvdHRvbSA9ICQoJCgnLnByb3NwZWN0cy10cicpW2FjdGl2ZVByb3NwZWN0XSkucG9zaXRpb24oKS50b3Arc2VsZWN0ZWRIZWlnaHRcblxuICAgIGNvbnNvbGUubG9nKHByb3NwZWN0V2luZG93VG9wLCBwcm9zcGVjdFdpbmRvd0JvdHRvbSlcbiAgICBjb25zb2xlLmxvZyhhY3RpdmVUb3AsIGFjdGl2ZUJvdHRvbSlcblxuICAgIHNjcm9sbFRvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvc2Nyb2xsJykuc2Nyb2xsVG9wXG4gICAgaWYoYWN0aXZlQm90dG9tID4gcHJvc3BlY3RXaW5kb3dCb3R0b20pXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0b3Njcm9sbCcpLnNjcm9sbFRvcCA9IHNjcm9sbFRvcCArIGFjdGl2ZUJvdHRvbSAtIHByb3NwZWN0V2luZG93Qm90dG9tXG5cbiAgICBpZihhY3RpdmVUb3AgPCAwKVxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9zY3JvbGwnKS5zY3JvbGxUb3AgPSBzY3JvbGxUb3AgKyBhY3RpdmVUb3AgLSAzN1xuICAgIGVsc2UgaWYoYWN0aXZlVG9wID09ICQoJCgnLnByb3NwZWN0cy10cicpWzBdKS5wb3NpdGlvbigpLnRvcClcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRvc2Nyb2xsJykuc2Nyb2xsVG9wID0gMFxuICAgICAgXG4gICAgLy8gR2V0IFBvc3Rpb24gb2YgVG9wXG4gICAgLy8gR2V0IFBvc2l0aW9uIG9mIEJvdHRvbSBcbiAgICAvLyBHZXQgUG9zaXRpb24gb2YgQ3VycmVudCBTZWxlY3RlZFxuICAgIC8vIEFkanVzdCBieSBzY3JvbGxpbmcgZG93biBvciB1cFxuICB9LFxuXG4gIHN0YXJ0S2V5Ym9hcmRTaG9ydGN1dHM6IGZ1bmN0aW9uKCkge1xuICAgIC8qIEtleWJvYXJkIFNob3J0Y3V0cyAqL1xuICAgIE1vdXNldHJhcC5yZXNldCgpXG4gICAgLy9Nb3VzZXRyYXAudW5iaW5kKFsnaicsJ2snLCdvJ10pXG4gICAgdGhpc3MgPSB0aGlzO1xuXG4gICAgLyogUHJvc3BlY3QgVGFibGUgU2hvcnRjdXRzICovXG4gICAgTW91c2V0cmFwLmJpbmQoJ2onLCBmdW5jdGlvbigpIHsgXG4gICAgICBrZXlib2FyZCA9IHRoaXNzLnN0YXRlLmtleWJvYXJkQWN0aXZlUHJvc3BlY3RcbiAgICAgIGlmKGtleWJvYXJkICE9IHRoaXNzLnN0YXRlLnByb3NwZWN0c1BlclBhZ2UrMSlcbiAgICAgICAgdGhpc3MuYWRqdXN0SGVpZ2h0KCdqJylcbiAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2tleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IGtleWJvYXJkKzF9KVxuICAgIH0pO1xuXG4gICAgTW91c2V0cmFwLmJpbmQoJ2snLCBmdW5jdGlvbigpIHsgXG4gICAgICBrZXlib2FyZCA9IHRoaXNzLnN0YXRlLmtleWJvYXJkQWN0aXZlUHJvc3BlY3RcbiAgICAgIGlmKGtleWJvYXJkICE9IDEpXG4gICAgICAgIHRoaXNzLmFkanVzdEhlaWdodCgnaycpXG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtrZXlib2FyZEFjdGl2ZVByb3NwZWN0OiBrZXlib2FyZC0xfSlcbiAgICB9KTtcblxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ28nLCBmdW5jdGlvbigpIHsgXG4gICAgICBjb25zb2xlLmxvZygnb3BlbiBjdXJyZW50IHByb3NwZWN0JylcbiAgICAgIGNvbnNvbGUubG9nKCQoJCgnLmtleVNlbGVjdCcpLmZpbmQoJ2EubGlua2VkaW5fbGluaycpWzBdKS5hdHRyKCdocmVmJykpXG4gICAgICBsaW5rID0gJCgkKCcua2V5U2VsZWN0JykuZmluZCgnYS5saW5rZWRpbl9saW5rJylbMF0pLmF0dHIoJ2hyZWYnKVxuICAgICAgLypcbiAgICAgIHdpbmRvdy5vcGVuKGxpbmssICdfYmxhbmsnKVxuICAgICAgY29uc29sZS5sb2coJ25ldycpXG4gICAgICAqL1xuICAgICAgLy9wb3B1cFdpbmRvdy5ibHVyKCk7XG4gICAgICAvL3dpbmRvdy5mb2N1cygpO1xuICAgICAgLy8ga2V5Ym9hcmQgPSB0aGlzcy5zdGF0ZS5rZXlib2FyZEFjdGl2ZVByb3NwZWN0XG4gICAgICBcbiAgICAgIHZhciBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XG4gICAgICBhLmhyZWYgPSBsaW5rXG4gICAgICB2YXIgZXZ0ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJNb3VzZUV2ZW50c1wiKTtcbiAgICAgIC8vdGhlIHRlbnRoIHBhcmFtZXRlciBvZiBpbml0TW91c2VFdmVudCBzZXRzIGN0cmwga2V5XG4gICAgICAvLyBGb3IgTWFjIFRoaXMgV29ya3MgQ2hlY2sgRm9yIC0gV2luZG93c1xuICAgICAgZXZ0LmluaXRNb3VzZUV2ZW50KFwiY2xpY2tcIiwgdHJ1ZSwgdHJ1ZSwgd2luZG93LCAwLCAwLCAwLCAwLCAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHRydWUsIDAsIG51bGwpO1xuICAgICAgYS5kaXNwYXRjaEV2ZW50KGV2dCk7XG4gICAgfSk7XG5cblxuXG4gICAgLyogTGlzdCBNb2RpZmljYXRpb24gU2hvcnRjdXRzICovXG4gICAgTW91c2V0cmFwLmJpbmQoJ3RhYityJywgZnVuY3Rpb24oKXtcbiAgICAgIC8vY29uc29sZS5sb2coJ3JlbG9hZCcpXG4gICAgICAkKCcjcmVuYW1lTGlzdEJ0bicpLmNsaWNrKClcbiAgICB9KVxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ3RhYitkJywgZnVuY3Rpb24oKXtcbiAgICAgIC8vY29uc29sZS5sb2coJ3JlbG9hZCcpXG4gICAgICAkKCcjZGVsZXRlTGlzdE1vZGFsJykuY2xpY2soKVxuICAgIH0pXG5cbiAgICBNb3VzZXRyYXAuYmluZCgndGFiK3MnLCBmdW5jdGlvbigpe1xuICAgICAgLy9jb25zb2xlLmxvZygncmVsb2FkJylcbiAgICAgIC8vJCgnI2Rvd25sb2FkUHJvc3BlY3RzJykuY2xpY2soKVxuICAgICAgdGhpc3MuZG93bmxvYWRGaWxlKClcbiAgICB9KVxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ3NoaWZ0K2wnLCBmdW5jdGlvbigpe1xuICAgICAgLy9jb25zb2xlLmxvZygncmVsb2FkJylcbiAgICAgIC8vJCgnI2Rvd25sb2FkUHJvc3BlY3RzJykuY2xpY2soKVxuICAgICAgLy90aGlzcy5kb3dubG9hZEZpbGUoKVxuICAgICAgJCgnLm5ldy1saXN0LWJ0bicpLmNsaWNrKClcbiAgICB9KVxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ2UnLCBmdW5jdGlvbigpe1xuICAgICAgY29uc29sZS5sb2coJ3JlbG9hZCcpXG4gICAgICAvLyQoJyNkb3dubG9hZFByb3NwZWN0cycpLmNsaWNrKClcbiAgICAgIHRoaXNzLnJlbW92ZVNlbGVjdGVkUHJvc3BlY3RzKClcbiAgICB9KVxuXG4gICAgTW91c2V0cmFwLmJpbmQoJ2MnLCBmdW5jdGlvbigpIHsgXG4gICAgICBjb25zb2xlLmxvZygnY29weScpXG4gICAgICAkKCcjY29weVRvTGlzdCcpLmNsaWNrKClcbiAgICB9KTtcblxuICAgIE1vdXNldHJhcC5iaW5kKCdtJywgZnVuY3Rpb24oKSB7IFxuICAgICAgY29uc29sZS5sb2coJ2NvcHknKVxuICAgICAgJCgnI21vdmVUb0xpc3QnKS5jbGljaygpXG4gICAgfSk7XG5cbiAgICAvL01vdXNldHJhcC5iaW5kKCdlJywgZnVuY3Rpb24oKSB7IGNvbnNvbGUubG9nKCdlJyk7IH0pO1xuICAgIE1vdXNldHJhcC5iaW5kKCdyaWdodCcsIGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygncmlnaHQnKTsgfSk7XG4gICAgTW91c2V0cmFwLmJpbmQoJ2xlZnQnLCBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2xlZnQnKTsgfSk7XG5cbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgLyogT25Mb2FkIEZvciBUaGUgRmlyc3QgVGltZSBGdW5jdGlvbiAqL1xuICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cyA9IEpTT04uc3RyaW5naWZ5KFtdKVxuICAgIHRoaXNzcyA9IHRoaXM7XG5cbiAgICAvL3RoaXMuc3RhcnRLZXlib2FyZFNob3J0Y3V0cygpXG5cbiAgICBwYXJzZV9oZWFkZXJzID0ge1xuICAgICAgJ1gtUGFyc2UtQXBwbGljYXRpb24tSWQnICA6ICdOODVRT2t0ZUVFUWt1WlZKS0F2dDhNVmVzMHNqRzZxTnBFR3FRRlZKJywgXG4gICAgICAnWC1QYXJzZS1SRVNULUFQSS1LZXknICAgIDogJ1ZONkV3VnlCWndPMXVwaHNCUHNhdTh0N0pRUnAwMFVNM0tZc2lpUWInXG4gICAgfVxuXG4gICAgY29tcGFueSA9IEpTT04uc3RyaW5naWZ5KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmN1cnJlbnRVc2VyKS5jb21wYW55KVxuICAgIGN1aWQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikub2JqZWN0SWRcbiAgICB1c2VyID0gSlNPTi5zdHJpbmdpZnkoeydfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICdvYmplY3RJZCc6Y3VpZCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzogJ1VzZXInfSlcbiAgICBhcmNoaXZlTGlzdCA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgIC8vaGFyZENvZGVcbiAgICAgICdvYmplY3RJZCc6J1NlclBRamNrdmUnLFxuICAgICAgJ19fdHlwZSc6J1BvaW50ZXInLCBcbiAgICAgICdjbGFzc05hbWUnIDogJ1Byb3NwZWN0TGlzdCcgXG4gICAgfSlcblxuICAgIHFyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55KycsXCJhcmNoaXZlZFwiOnRydWV9JmNvdW50PTEmb3JkZXI9LWNyZWF0ZWRBdCdcblxuICAgIGlmKHRoaXMuc3RhdGUuY3VycmVudExpc3QgIT0gJ0FsbCcpe1xuICAgICAgY3VycmVudExpc3QgPSB7XG4gICAgICAgICdvYmplY3RJZCc6dGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkLCBcbiAgICAgICAgJ19fdHlwZSc6J1BvaW50ZXInLCBcbiAgICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JyBcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRMaXN0ID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudExpc3QpXG4gICAgICB1c2VyID0gSlNPTi5zdHJpbmdpZnkoeydfX3R5cGUnOidQb2ludGVyJywnb2JqZWN0SWQnOid4VGhBWGMwTFpUJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzTmFtZSc6J1VzZXInfSlcblxuICAgICAgLy8gYWRkIGNvbXBhbnkgdG8gcHJvc3BlY3RzIGFkZGVkIHRocm91Z2ggbWluaW5nIGpvYlxuICAgICAgcXJ5ID0gJ3doZXJlPXtcImNvbXBhbnlcIjonK2NvbXBhbnkrJyxcImxpc3RzXCI6JytjdXJyZW50TGlzdCsnfSZjb3VudD0xJ1xuICAgIH1cblxuICAgICQuYWpheCh7XG4gICAgICAvL3VybDogJ2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RzP2xpbWl0PTUwJyxcbiAgICAgIHVybDogJ2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RzP2xpbWl0PScrdGhpc3NzLnN0YXRlLnByb3NwZWN0c1BlclBhZ2UsXG4gICAgICB0eXBlOidHRVQnLFxuICAgICAgaGVhZGVyczogcGFyc2VfaGVhZGVycyxcbiAgICAgIGNhY2hlOiB0cnVlLFxuICAgICAgZGF0YTogcXJ5LFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICB0aGlzc3Muc2V0U3RhdGUoe3Byb3NwZWN0czogcmVzLnJlc3VsdHN9KVxuICAgICAgICB0aGlzc3Muc2V0U3RhdGUoe2NvdW50OiByZXMuY291bnR9KVxuICAgICAgICB0aGlzc3Muc2V0U3RhdGUoe3RvdGFsQ291bnQ6IHJlcy5jb3VudH0pXG4gICAgICAgIHRoaXNzcy5zZXRTdGF0ZSh7cGFnZXM6IE1hdGguY2VpbChyZXMuY291bnQvdGhpc3NzLnByb3BzLnByb3NwZWN0c1BlclBhZ2UpfSlcbiAgICAgICAgdGhpc3NzLnNldFN0YXRlKHtsb2FkaW5nOiBmYWxzZX0pXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcGFyc2VfaGVhZGVycyA9IHtcbiAgICAgICdYLVBhcnNlLUFwcGxpY2F0aW9uLUlkJyAgOiAnTjg1UU9rdGVFRVFrdVpWSktBdnQ4TVZlczBzakc2cU5wRUdxUUZWSicsIFxuICAgICAgJ1gtUGFyc2UtUkVTVC1BUEktS2V5JyAgICA6ICdWTjZFd1Z5Qlp3TzF1cGhzQlBzYXU4dDdKUVJwMDBVTTNLWXNpaVFiJyxcbiAgICB9XG5cbiAgICBjdXJyZW50VXNlciA9IHsgXG4gICAgICAnX190eXBlJyAgIDogJ1BvaW50ZXInLFxuICAgICAgJ2NsYXNzTmFtZSc6ICdfVXNlcicsXG4gICAgICAnb2JqZWN0SWQnIDogSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuY3VycmVudFVzZXIpLm9iamVjdElkXG4gICAgfVxuXG4gICAgdGhpc3MgPSB0aGlzO1xuICAgICQuYWpheCh7XG4gICAgICB1cmw6ICdodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1Byb3NwZWN0TGlzdCcsXG4gICAgICB0eXBlOiAnR0VUJyxcbiAgICAgIGhlYWRlcnM6IHBhcnNlX2hlYWRlcnMsXG4gICAgICBkYXRhOiAnd2hlcmU9e1widXNlclwiOicrSlNPTi5zdHJpbmdpZnkoY3VycmVudFVzZXIpK1wifSZjb3VudD0xXCIsXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICByZXN1bHRzID0gcmVzLnJlc3VsdHNcbiAgICAgICAgZm9yKGk9MDtpPCByZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgcmVzdWx0cy5jb3VudCA9ICd+J1xuICAgICAgICB9XG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtsaXN0czogcmVzdWx0c30pXG4gICAgICAgIC8vIE1ha2UgYmF0Y2ggcmVxdWVzdCB0byBnZXQgbGlzdCBjb3VudHMgYWZ0ZXIgdGhleSBhcmUgbG9hZGVkXG4gICAgICAgIGZvcihpPTA7aSA8IHJlcy5yZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0ocmVzLnJlc3VsdHNbaV0ub2JqZWN0SWQsIFwiXCIpXG4gICAgICAgIH1cblxuICAgICAgICBmb3IoaT0wO2k8IHJlcy5yZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgbGlzdCA9IHtcbiAgICAgICAgICAgICdfX3R5cGUnICAgIDogJ1BvaW50ZXInLFxuICAgICAgICAgICAgJ29iamVjdElkJyAgOiByZXMucmVzdWx0c1tpXS5vYmplY3RJZCxcbiAgICAgICAgICAgICdjbGFzc05hbWUnIDogJ1Byb3NwZWN0TGlzdCcsIFxuICAgICAgICAgIH1cblxuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RzJyxcbiAgICAgICAgICAgIHR5cGU6J0dFVCcsXG4gICAgICAgICAgICBoZWFkZXJzOnBhcnNlX2hlYWRlcnMsXG4gICAgICAgICAgICBsaXN0T2JqZWN0SWQ6IHJlcy5yZXN1bHRzW2ldLm9iamVjdElkLFxuICAgICAgICAgICAgZGF0YTogJ3doZXJlPXtcImxpc3RzXCI6JytKU09OLnN0cmluZ2lmeShsaXN0KSsnfSZjb3VudD0xJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKHRoaXMubGlzdE9iamVjdElkKVxuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLmxpc3RPYmplY3RJZCwgcmVzLmNvdW50KVxuICAgICAgICAgICAgICBhbW91bnQgPSAwXG4gICAgICAgICAgICAgIGZvcihpaT0wO2lpPCByZXN1bHRzLmxlbmd0aDtpaSsrKXtcbiAgICAgICAgICAgICAgICBpZihsb2NhbFN0b3JhZ2UuZ2V0SXRlbShyZXN1bHRzW2lpXS5vYmplY3RJZCkgPT0gXCJcIilcbiAgICAgICAgICAgICAgICAgIGFtb3VudCA9IGFtb3VudCArIDFcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmKGFtb3VudCA9PSAwKSB7XG4gICAgICAgICAgICAgICAgZm9yKGlpPTA7aWk8IHJlc3VsdHMubGVuZ3RoO2lpKyspXG4gICAgICAgICAgICAgICAgICByZXN1bHRzW2lpXS5jb3VudCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKHJlc3VsdHNbaWldLm9iamVjdElkKVxuXG4gICAgICAgICAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2xpc3RzOiByZXN1bHRzfSlcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdHb3QgQ291bnRzJylcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIC8vIHVwZGF0ZWQgcmVzLmNvdW50XG4gICAgICAgICAgICAgIC8vdGhpc3Muc2V0U3RhdGUoe2NvdW50OiByZXMuY291bnR9KVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBnZW5lcmF0ZV9pZCA6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJ18nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICB9LFxufSk7XG5cbi8qICBEcm9wZG93biBNZW51cyAqL1xuXG52YXIgQ3VycmVudExpc3RzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnQ3VycmVudExpc3RzJyxcbiAgbGlzdEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIGxpc3ROYW1lID0gJChlLnRhcmdldCkudGV4dCgpXG4gICAgXG4gICAgdmFyIGxpc3RTZWxlY3QgPSBfLmZpbHRlcih0aGlzLnByb3BzLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBsaXN0TmFtZVxuICAgIH0pO1xuXG4gICAgdGhpcy5wcm9wcy5saXN0QWN0aW9uKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0cyA9IFtdIFxuICAgIGZvcihpPTA7aTwgdGhpcy5wcm9wcy5saXN0cy5sZW5ndGg7aSsrKSB7XG4gICAgICBsaXN0cy5wdXNoKFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe3N0eWxlOiB7Zm9udFdlaWdodDonYm9sZCcsZm9udFNpemU6JzEwcHgnfSwgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBvbkNsaWNrOiB0aGlzLmxpc3RBY3Rpb259LCB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuY29weURyb3Bkb3duU3R5bGUpXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7cmlnaHQ6MTU4fX0sIFxuICAgICAgICBsaXN0c1xuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgTGlzdHNNZW51ID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTGlzdHNNZW51JyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnVsKHtjbGFzc05hbWU6IFwiZHJvcGRvd24tbWVudSBkcm9wLXRlc3RcIiwgaWQ6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgIG1pbldpZHRoOidpbmhlcml0JyxcbiAgICAgICAgICAgIHRvcDogJzIwcHgnLFxuICAgICAgICAgICAgd2lkdGg6ICcxMjVweCcsXG4gICAgICAgICAgICByaWdodDogJzE1NHB4JyxcbiAgICAgICAgICAgIGxlZnQ6J2F1dG8nXG4gICAgICAgICAgfX0sIFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe2hyZWY6IFwiI2Jvb2tzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXRpbWVzXCJ9KSwgXCIgwqBcIiArICcgJyArXG4gICAgICAgICAgXCJEZWxldGUgTGlzdFwiXG4gICAgICAgICkpLCBcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtocmVmOiBcIiNwb2RjYXN0c1wifSwgXG4gICAgICAgICAgXCJSZW5hbWUgTGlzdHNcIlxuICAgICAgICApKVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgQ3VycmVudExpc3RzVHdvID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnQ3VycmVudExpc3RzVHdvJyxcbiAgbGlzdEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIGxpc3ROYW1lID0gJChlLnRhcmdldCkudGV4dCgpXG4gICAgXG4gICAgdmFyIGxpc3RTZWxlY3QgPSBfLmZpbHRlcih0aGlzLnByb3BzLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBsaXN0TmFtZVxuICAgIH0pO1xuXG4gICAgdGhpcy5wcm9wcy5saXN0QWN0aW9uKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0cyA9IFtdIFxuICAgIGZvcihpPTA7aTx0aGlzLnByb3BzLmxpc3RzLmxlbmd0aDtpKyspIHtcbiAgICAgIGxpc3RzLnB1c2goXG4gICAgICAgIFJlYWN0LkRPTS5saShudWxsLCBSZWFjdC5ET00uYSh7c3R5bGU6IHtmb250V2VpZ2h0Oidib2xkJyxmb250U2l6ZTonMTBweCd9LCBcbiAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmxpc3RBY3Rpb259LCBcbiAgICAgICAgICB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnVsKHtjbGFzc05hbWU6IFwiZHJvcGRvd24tbWVudSBkcm9wLXRlc3RcIiwgaWQ6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgc3R5bGU6IHRoaXMucHJvcHMuY29weURyb3Bkb3duU3R5bGV9LCBcbiAgICAgICAgbGlzdHNcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIExpc3REZXRhaWxCdXR0b25zID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTGlzdERldGFpbEJ1dHRvbnMnLFxuICAvLyBSZW5hbWUgTGlzdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBlZGl0TW9kZTogZmFsc2VcbiAgICB9XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgaWYoIXRoaXMuc3RhdGUuZWRpdE1vZGUpIHtcbiAgICAgIHN0dWZmID0gUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJsYWJlbCBsYWJlbC1kZWZhdWx0XCIsIHN0eWxlOiBsaXN0VHlwZX0sIFxuICAgICAgICAgICAgKHRoaXMucHJvcHMuY3VycmVudExpc3ROYW1lID09IFwiQWxsXCIpID8gJycgOiBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFsaWduLWp1c3RpZnlcIiwgc3R5bGU6IHttYXJnaW5SaWdodDonNXB4J319KSwgXG4gICAgICAgICAgICAodGhpcy5wcm9wcy5jdXJyZW50TGlzdE5hbWUgPT0gXCJBbGxcIikgPyAnJyA6IFwiICAgXCIgK3RoaXMucHJvcHMuY3VycmVudExpc3ROYW1lXG4gICAgICAgICAgICAgIClcbiAgICB9IGVsc2Uge1xuICAgICAgc3R1ZmYgPSBSZWFjdC5ET00uaW5wdXQoe2NsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgc3R5bGU6IHt3aWR0aDogMTAwLCBmbG9hdDogJ2xlZnQnLCBoZWlnaHQ6IDI0LCBtYXJnaW5Ub3A6IC0xfX0pXG4gICAgfVxuICAgIHJldHVybiAoXG5cbiAgICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtzdHlsZToge21hcmdpbjowfX0sIFxuICAgICAgICAgICAgICBzdHVmZiwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiBsaXN0QnRuLCBcbiAgICAgICAgICAgICAgICAnZGF0YS10b2dnbGUnOiBcIm1vZGFsXCIsIFxuICAgICAgICAgICAgICAgIGlkOiBcInJlbmFtZUxpc3RCdG5cIiwgXG4gICAgICAgICAgICAgICAgJ2RhdGEtdGFyZ2V0JzogXCIuYnMtcmVuYW1lTGlzdC1tb2RhbC1zbVwiLCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuLWdyYWRpZW50IGJ0biBidG4teHMgYnRuLXByaW1hcnlcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGVuY2lsXCJ9KVxuICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IGxpc3RCdG4sIFxuICAgICAgICAgICAgICAgICdkYXRhLXRvZ2dsZSc6IFwibW9kYWxcIiwgXG4gICAgICAgICAgICAgICAgaWQ6IFwiZGVsZXRlTGlzdE1vZGFsXCIsIFxuICAgICAgICAgICAgICAgICdkYXRhLXRhcmdldCc6IFwiLmJzLWRlbGV0ZUxpc3QtbW9kYWwtc21cIiwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0bi1ncmFkaWVudCBidG4gYnRuLXhzIGJ0bi1wcmltYXJ5XCJ9LCBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXRyYXNoLW9cIn0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVuYW1lTGlzdE1vZGFsKHtyZW5hbWVMaXN0OiB0aGlzLnByb3BzLnJlbmFtZUxpc3R9KSwgXG4gICAgICAgICAgICBEZWxldGVMaXN0TW9kYWwoe2RlbGV0ZUxpc3Q6IHRoaXMucHJvcHMuZGVsZXRlTGlzdH0pXG4gICAgICAgICAgKVxuICAgICAgKTtcbiAgfSxcblxuICByZW5hbWVMaXN0OiBmdW5jdGlvbihuZXdMaXN0TmFtZSkge1xuICAgIHRoaXMucHJvcHMucmVuYW1lTGlzdChuZXdMaXN0TmFtZSlcbiAgfSxcblxuICBkZWxldGVMaXN0OiBmdW5jdGlvbigpe1xuICAgIHRoaXMucHJvcHMuZGVsZXRlTGlzdCgpXG4gIH0sXG5cbiAgdG9nZ2xlRWRpdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7ZWRpdE1vZGU6ICF0aGlzLnN0YXRlLmVkaXRNb2RlIH0pXG4gIH1cbn0pO1xuXG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy8gY3JlYXRlTGlzdE1vZGFsXG4gIGNyZWF0ZUxpc3Q6IGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKCQoJyNsaXN0VGl0bGUnKS52YWwoKSlcblxuICAgIGRhdGEgPSAge1xuICAgICAgJ25hbWUnICAgICAgICA6ICQoJyNsaXN0VGl0bGUnKS52YWwoKS50cmltKCksICAgLy9XYWl0aW5nICwgUnVubmluZ1xuICAgICAgJ3VzZXInICAgICAgICA6IHsgJ19fdHlwZSc6J1BvaW50ZXInLFxuICAgICAgICAgICAgICAgICAgICAgICdjbGFzc05hbWUnOidfVXNlcicsXG4gICAgICAgICAgICAgICAgICAgICAgJ29iamVjdElkJzoneFdFU2l3NVNtZCcgfSxcbiAgICB9XG5cbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1Byb3NwZWN0TGlzdCcsXG4gICAgICB0eXBlOidQT1NUJyxcbiAgICAgIGhlYWRlcnM6IGFwcENvbmZpZy5wYXJzZUhlYWRlcnMsXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICB9LFxuICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZygnZXJyb3InKVxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBkYXRhLmNvdW50ID0gMFxuXG4gICAgdGhpcy5wcm9wcy5jcmVhdGVMaXN0KGRhdGEpXG4gICAgXG4gICAgJCgnI2NyZWF0ZUxpc3RNb2RhbCcpLm1vZGFsKCdoaWRlJylcbiAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTtcbiAgICAkKCcubW9kYWwtYmFja2Ryb3AnKS5yZW1vdmUoKTtcbiAgICAvLyQoJ2J1dHRvbi5jbG9zZScpLmNsaWNrKClcbiAgfSxcblxuICByZW5hbWVMaXN0OiBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgLy9jb25zb2xlLmxvZygkKCcjbmV3TGlzdE5hbWUnKS52YWwoKSlcbiAgICBuZXdMaXN0TmFtZSA9ICQoJyNuZXdMaXN0TmFtZScpLnZhbCgpXG4gICAgaWYobmV3TGlzdE5hbWUudHJpbSgpICE9IFwiXCIpXG4gICAgICB0aGlzLnByb3BzLnJlbmFtZUxpc3QobmV3TGlzdE5hbWUpXG4gICAgLy8gRGlzYWJsZSBNb2RhbFxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwgZmFkZSBicy1yZW5hbWVMaXN0LW1vZGFsLXNtXCIsIHRhYkluZGV4OiBcIi0xXCIsIHJvbGU6IFwiZGlhbG9nXCIsICdhcmlhLWxhYmVsbGVkYnknOiBcIm15U21hbGxNb2RhbExhYmVsXCIsICdhcmlhLWhpZGRlbic6IFwidHJ1ZVwiLCBpZDogXCJjcmVhdGVMaXN0TW9kYWxcIiwgc3R5bGU6IHt0b3A6JzIwMHB4J319LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1kaWFsb2cgbW9kYWwtc21cIn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtY29udGVudFwifSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWhlYWRlclwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiY2xvc2VcIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFJlYWN0LkRPTS5zcGFuKHsnYXJpYS1oaWRkZW4nOiBcInRydWVcIn0sIFwiw5dcIiksIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcInNyLW9ubHlcIn0sIFwiQ2xvc2VcIikpLCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5oNCh7Y2xhc3NOYW1lOiBcIm1vZGFsLXRpdGxlXCIsIGlkOiBcIm15TW9kYWxMYWJlbFwifSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtbGlzdFwifSksIFwiIMKgUmVuYW1lIExpc3RcIilcbiAgICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtYm9keVwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uZm9ybSh7b25TdWJtaXQ6IHRoaXMucmVuYW1lTGlzdH0sIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaW5wdXQoe2lkOiBcIm5ld0xpc3ROYW1lXCIsIHR5cGU6IFwidGV4dFwiLCBwbGFjZWhvbGRlcjogXCJFbnRlciBsaXN0IHRpdGxlLi4uXCIsIGNsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIn0pLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmJyKG51bGwpLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5yZW5hbWVMaXN0LCBcbiAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1zdWNjZXNzXCIsIFxuICAgICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonYmxvY2snLCB3aWR0aDonMTAwJSd9fSwgXG4gICAgICAgICAgICAgICAgICAgICAgXCJDcmVhdGUgTGlzdFwiXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG52YXIgU2lkZU1lbnVMaXN0T3B0aW9uID0gcmVxdWlyZSgnLi91c2VyX3NpZGVfbWVudV9saXN0LmpzLm1pbi5qcycpO1xudmFyIGNyZWF0ZUxpc3RNb2RhbCA9IHJlcXVpcmUoJy4vY3JlYXRlX2xpc3RfbW9kYWwuanMubWluLmpzJylcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy9TaWRlTWVudVByb3NwZWN0c1xuICBjcmVhdGVMaXN0OiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRoaXMucHJvcHMuY3JlYXRlTGlzdChkYXRhKVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgfSxcblxuICBjaGFuZ2VMaXN0OiBmdW5jdGlvbihlKSB7XG4gICAgLypcbiAgICBjdXJyZW50TGlzdCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLy8uZGF0YSgnbGlzdCcpXG4gICAgY29uc29sZS5sb2coY3VycmVudExpc3QpXG4gICAgdGhpcy5wcm9wcy5jaGFuZ2VMaXN0KGN1cnJlbnRMaXN0Lm5hbWUsIGN1cnJlbnRMaXN0Lm9iamVjdElkKVxuICAgICovXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBcbiAgICBzdHlsZXMgPSAodGhpcy5wcm9wcy5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKSA/IHsnYmFja2dyb3VuZENvbG9yJzoncmdiKDAsIDEyMiwgMjU1KScsICdjb2xvcic6J3doaXRlJ30gOiB7fVxuXG4gICAgbGlzdHMgID0gWyBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBvbkNsaWNrOiB0aGlzLnByb3BzLmNoYW5nZUxpc3QsIHN0eWxlOiBzdHlsZXMsIGNsYXNzTmFtZTogXCJsaXN0LW5hbWVzIGJ0biBidG4tZGVmYXVsdCBhbGxcIn0sICdBbGwnLCBcbiAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2Zsb2F0OidyaWdodCcsbWFyZ2luVG9wOicxcHgnLCBiYWNrZ3JvdW5kQ29sb3I6JyM5OTknfSwgY2xhc3NOYW1lOiBcImJhZGdlIGJhZGdlLWRlZmF1bHRcIn0sIHRoaXMucHJvcHMuY291bnQpKSxcbiAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIG9uQ2xpY2s6IHRoaXMucHJvcHMuY2hhbmdlTGlzdCwgc3R5bGU6IHN0eWxlcywgY2xhc3NOYW1lOiBcImxpc3QtbmFtZXMgYnRuIGJ0bi1kZWZhdWx0IGFsbFwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJjaGl2ZVwifSksIFwiwqDCoFwiLCBcbiAgICAgICAgJ0FyY2hpdmVkJywgXCIgXCIsIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2Zsb2F0OidyaWdodCcsbWFyZ2luVG9wOicxcHgnLCBiYWNrZ3JvdW5kQ29sb3I6JyM5OTknfSwgY2xhc3NOYW1lOiBcImJhZGdlIGJhZGdlLWRlZmF1bHRcIn0sIHRoaXMucHJvcHMuY291bnQpKSBdXG4gIFxuICAgIGZvcihpPTA7aTx0aGlzLnByb3BzLmxpc3RzLmxlbmd0aDtpKyspe1xuICAgICAgbGlzdCA9IHRoaXMucHJvcHMubGlzdHNbaV1cbiAgICAgIGxpc3RzLnB1c2goXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIG9uQ2xpY2s6IHRoaXMucHJvcHMuY2hhbmdlTGlzdCwgJ2RhdGEtbGlzdCc6IEpTT04uc3RyaW5naWZ5KGxpc3QpLCBjbGFzc05hbWU6IFwibGlzdC1uYW1lcyBidG4gYnRuLWRlZmF1bHRcIn0sIGxpc3QubmFtZSwgUmVhY3QuRE9NLnNwYW4oe3N0eWxlOiB7YmFja2dyb3VuZENvbG9yOicjOTk5JyxmbG9hdDoncmlnaHQnLG1hcmdpblRvcDonMXB4J30sIGNsYXNzTmFtZTogXCJiYWRnZSBiYWRnZS1kZWZhdWx0XCJ9LCBsaXN0LmNvdW50KSwgXCIgICAgICBcIilcbiAgICAgIClcbiAgICB9XG4gICAgbGlzdHMgPSBbU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiB7bmFtZTogJ0FsbCcsY291bnQ6IHRoaXMucHJvcHMudG90YWxDb3VudH0sIFxuICAgICAgICAgICAgICAgIGljb25UeXBlOiAndXNlcnMnLCBcbiAgICAgICAgICAgICAgICBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KSwgU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiB7bmFtZTogJ0FyY2hpdmVkJywgY291bnQ6ICd+J30sIGljb25UeXBlOiAnYXJjaGl2ZScsIGNoYW5nZUxpc3Q6IHRoaXMucHJvcHMuY2hhbmdlTGlzdCwgaGlkZUNvdW50OiB0cnVlfSldXG4gICAgZm9yKGk9MDtpPHRoaXMucHJvcHMubGlzdHMubGVuZ3RoO2krKyl7XG4gICAgICBsaXN0ID0gdGhpcy5wcm9wcy5saXN0c1tpXVxuICAgICAgbGlzdHMucHVzaChcbiAgICAgICAgU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiBsaXN0LCBjaGFuZ2VMaXN0OiB0aGlzLnByb3BzLmNoYW5nZUxpc3R9KVxuICAgICAgKVxuICAgIH1cblxuICAgIFxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY29sLW1kLTJcIiwgc3R5bGU6IHtwYWRkaW5nOicwJyxoZWlnaHQ6JzQzOHB4JyxiYWNrZ3JvdW5kQ29sb3I6JyNlMGU5ZWUnLGJvcmRlclJpZ2h0OicxcHggc29saWQgI2IwYjhiZicsdGV4dEFsaWduOidjZW50ZXInfX0sIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwicHJvc3BlY3QtbGlzdC1oZWFkZXJcIn0sIFxuICAgICAgICAgIFwiTGlzdHNcIlxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImJ0bi1ncm91cC12ZXJ0aWNhbFwiLCBzdHlsZToge3dpZHRoOicxMDAlJywgaGVpZ2h0OiAnMzIwcHgnLCBvdmVyZmxvdzogJ2F1dG8nfX0sIFxuICAgICAgICAgIGxpc3RzXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uYnIobnVsbCksIFxuICAgICAgICBSZWFjdC5ET00uYnIobnVsbCksIFxuICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IG5ldy1saXN0LWJ0blwiLCBcbiAgICAgICAgICAgICAgJ2RhdGEtdG9nZ2xlJzogXCJtb2RhbFwiLCAnZGF0YS10YXJnZXQnOiBcIi5icy1leGFtcGxlLW1vZGFsLXNtXCIsIFxuICAgICAgICAgICAgICBzdHlsZTogeyBiYWNrZ3JvdW5kSW1hZ2U6ICdsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjMDA5NmZmIDAlLCAjMDA1ZGZmIDEwMCUpJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXBsdXMtY2lyY2xlXCJ9KSwgXCLCoMKgTmV3IExpc3RcIlxuICAgICAgICApLCBcbiAgICAgICAgY3JlYXRlTGlzdE1vZGFsKHtjcmVhdGVMaXN0OiB0aGlzLmNyZWF0ZUxpc3R9KSwgXG4gICAgICAgIFJlYWN0LkRPTS5icihudWxsKVxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIFVzZXJQcm9zcGVjdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7IH1cbiAgfSxcblxuICBjbGlja0NoZWNrOiBmdW5jdGlvbigpIHtcbiAgICBkb21Ob2RlID0gdGhpcy5nZXRET01Ob2RlKClcbiAgICBpc0NoZWNrZWQgPSAkKCQoZG9tTm9kZSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLnByb3AoJ2NoZWNrZWQnKVxuICAgIC8vY29uc29sZS5sb2coaXNDaGVja2VkKVxuICAgIHRoaXMuc2V0U3RhdGUoe2NoZWNrZWQ6IGlzQ2hlY2tlZH0pXG4gICAgdGhpcy5wcm9wcy5jaGVja2JveEFjdGlvbihpc0NoZWNrZWQsIHRoaXMucHJvcHMucHJvc3BlY3Qub2JqZWN0SWQpXG4gIH0sXG5cbiAgcm93Q2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICQoJCh0aGlzLmdldERPTU5vZGUoKSkuZmluZCgnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdJylbMF0pLmNsaWNrKClcbiAgfSxcblxuICBrZXlib2FyZENsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAkKCQoJy5rZXlTZWxlY3QnKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkuY2xpY2soKVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHsgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIGtleWJvYXJkU2VsZWN0ZWQgPSB7Ym9yZGVyTGVmdDonN3B4IHNvbGlkIHJnYmEoMCwwLDAsMCknfVxuICAgIHRoaXNzc3MgPSB0aGlzXG4gICAgaWYodGhpcy5wcm9wcy5rZXlib2FyZFNlbGVjdGVkKSB7XG4gICAgICAvLyBBZGp1c3QgU2Nyb2xsIGRlcGVuZGluZyBvbiB3aGVyZSB0aGUgcHJvc3BlY3QgaXNcbiAgICAgIGtleWJvYXJkU2VsZWN0ZWQgPSB7Ym9yZGVyTGVmdDonN3B4IHNvbGlkICMwMDk2ZmYgIWltcG9ydGFudCd9XG4gICAgICBNb3VzZXRyYXAudW5iaW5kKCd4JylcbiAgICAgIE1vdXNldHJhcC5iaW5kKCd4JywgZnVuY3Rpb24oKSB7IFxuICAgICAgICB0aGlzc3NzLmtleWJvYXJkQ2xpY2soKVxuICAgICAgICBpZih0aGlzc3NzLnN0YXRlLmNoZWNrZWQpXG4gICAgICAgICAgY29uc29sZS5sb2coXCJsbWFvXCIpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm9zcGVjdCA9IHRoaXMucHJvcHMucHJvc3BlY3RcblxuICAgIGlmKHRoaXMucHJvcHMubWFzdGVyQ2hlY2tib3hDaGVja2VkICYmIHRoaXMuc3RhdGUuY2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZSBpZih0aGlzLnByb3BzLmFscmVhZHlDaGVja2VkKVxuICAgICAgY2hlY2tlZCA9IHRydWVcbiAgICBlbHNlIGlmKHRoaXMuc3RhdGUuY2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZSBpZih0aGlzLnByb3BzLm1hc3RlckNoZWNrYm94Q2hlY2tlZCB8fCB0aGlzLnN0YXRlLmNoZWNrZWQpXG4gICAgICBjaGVja2VkID0gdHJ1ZVxuICAgIGVsc2VcbiAgICAgIGNoZWNrZWQgPSBmYWxzZVxuXG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnN0YXRlLmNoZWNrZWQpXG4gICAgLy9jb25zb2xlLmxvZyhjaGVja2VkKVxuICAgIC8ve3Byb3NwZWN0LmVtcGxveWVlQ291bnRSYW5nZS5uYW1lICsgXCIgZW1wbG95ZWVzXCIgfVxuICAgIFxuICAgIGNvbG9yID0ge31cbiAgICBpZih0aGlzLnN0YXRlLmNoZWNrZWQgfHwgdGhpcy5wcm9wcy5hbHJlYWR5Q2hlY2tlZClcbiAgICAgIGNvbG9yID0ge2JhY2tncm91bmRDb2xvcjogJyNlZWY4ZmYnfVxuICAgICAgXG4gICAgcm93Q2wgPSAodGhpcy5wcm9wcy5rZXlib2FyZFNlbGVjdGVkKSA/IFwicHJvc3BlY3RzLXRyIGtleVNlbGVjdFwiIDogXCJwcm9zcGVjdHMtdHJcIlxuICAgIHdlYnNpdGVCdG4gPSAocHJvc3BlY3Qud2Vic2l0ZVVybCkgPyAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiaHR0cDovL1wiK3Byb3NwZWN0LndlYnNpdGVVcmwucmVwbGFjZSgnaHR0cDovLycsJycpfSwgXCIgXCIsIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtZ2xvYmVcIn0pLCBcIiBcIikgOiBcIlwiXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS50cih7Y2xhc3NOYW1lOiByb3dDbCwgXG4gICAgICAgICAgb25DbGljazogdGhpcy5yb3dDbGljaywgXG4gICAgICAgICAgc3R5bGU6IGtleWJvYXJkU2VsZWN0ZWR9LCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvcn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaW5wdXQoe3R5cGU6IFwiY2hlY2tib3hcIiwgXG4gICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZTogdGhpcy5jbGlja0NoZWNrLCBcbiAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGNoZWNrZWR9KVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yLCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIHByb3NwZWN0Lm5hbWUpLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtmb250V2VpZ2h0Oic0MDAnLG1hcmdpbjonMHB4J319LCBcbiAgICAgICAgICAgICAgKHByb3NwZWN0LnBvcykgPyBwcm9zcGVjdC5wb3MudHJpbSgpIDogXCJcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yLCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIFxuICAgICAgICAgICAgICBwcm9zcGVjdC5jb21wYW55X25hbWVcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmg2KHtzdHlsZToge2ZvbnRXZWlnaHQ6JzQwMCcsbWFyZ2luOicwcHgnfX0sIFxuICAgICAgICAgICAgICAocHJvc3BlY3QuZW1wbG95ZWVDb3VudFJhbmdlKSA/IHByb3NwZWN0LmVtcGxveWVlQ291bnRSYW5nZS5uYW1lICsgXCIgZW1wbG95ZWVzXCIgOiBcIlwiXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSwgXG5cbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvcn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmg2KHtzdHlsZToge21hcmdpbjonMHB4J319LCBwcm9zcGVjdC5jaXR5KSksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yfSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJtYWlsdG86XCIrcHJvc3BlY3QuZW1haWwsIFxuICAgICAgICAgICAgICAgc3R5bGU6IHttYXJnaW46JzBweCd9fSwgXG4gICAgICAgICAgICAocHJvc3BlY3QuZW1haWwpID8gcHJvc3BlY3QuZW1haWwudG9Mb3dlckNhc2UoKSA6IFwiXCJcbiAgICAgICAgICApKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY29sb3J9LCB0aGlzLnByb3BzLmxpLCBcIsKgXCIsIHRoaXMucHJvcHMubGluayksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yfSwgXG4gICAgICAgICAgICB3ZWJzaXRlQnRuXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgKTtcbiAgfSxcblxuICBkZWxldGVQcm9zcGVjdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5kZWxldGVQcm9zcGVjdCh0aGlzLnByb3BzLnByb3NwZWN0Lm9iamVjdElkLCAnUHJvc3BlY3QnKVxuICB9XG59KTtcblxuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIGNoZWNrYm94QWN0aW9uOiBmdW5jdGlvbihlKSB7XG4gICAgY2hlY2tib3hWYWwgPSAkKGUudGFyZ2V0KS5pcygnOmNoZWNrZWQnKVxuICAgIHRoaXMucHJvcHMubWFzdGVyQ2hlY2tib3hDaGFuZ2VkKGNoZWNrYm94VmFsKVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcblxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgICAgIFJlYWN0LkRPTS50cihudWxsLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKG51bGwsIFJlYWN0LkRPTS5pbnB1dCh7dHlwZTogXCJjaGVja2JveFwiLCBvbkNoYW5nZTogdGhpcy5jaGVja2JveEFjdGlvbn0pKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIk5hbWVcIiksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCJDb21wYW55XCIpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKHtzdHlsZToge3dpZHRoOicxNzBweCd9fSwgXCJDaXR5XCIpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKG51bGwsIFwiRW1haWxcIiksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCLCoFwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIsKgXCIpXG4gICAgICAgICAgICApXG4gICAgKTtcbiAgfVxufSk7XG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxuLy9TaWRlTWVudUxpc3RPcHRpb25cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHtjb3VudDogJ34nfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAvLyBtYWtlIGFqYXggcmVxdWVzdCB0byBnZXQgZWFjaCByZXF1ZXN0cyBcbiAgICAvKlxuICAgIGxpc3QgPSB7XG4gICAgICAnX190eXBlJyAgICA6ICdQb2ludGVyJyxcbiAgICAgICdvYmplY3RJZCcgIDogdGhpcy5wcm9wcy5saXN0Lm9iamVjdElkLFxuICAgICAgJ2NsYXNzTmFtZScgOiAnUHJvc3BlY3RMaXN0JywgXG4gICAgfVxuXG4gICAgcGFyc2VfaGVhZGVycyA9IHtcbiAgICAgICdYLVBhcnNlLUFwcGxpY2F0aW9uLUlkJyAgOiAnTjg1UU9rdGVFRVFrdVpWSktBdnQ4TVZlczBzakc2cU5wRUdxUUZWSicsIFxuICAgICAgJ1gtUGFyc2UtUkVTVC1BUEktS2V5JyAgICA6ICdWTjZFd1Z5Qlp3TzF1cGhzQlBzYXU4dDdKUVJwMDBVTTNLWXNpaVFiJyxcbiAgICB9XG5cbiAgICB0aGlzcyA9IHRoaXM7XG5cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMubGlzdC5uYW1lKVxuICAgICQuYWpheCh7XG4gICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3RzJyxcbiAgICAgIHR5cGU6J0dFVCcsXG4gICAgICBoZWFkZXJzOnBhcnNlX2hlYWRlcnMsXG4gICAgICBkYXRhOiAnd2hlcmU9e1wibGlzdHNcIjonK0pTT04uc3RyaW5naWZ5KGxpc3QpKyd9JmNvdW50PTEnLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIHRoaXNzLnNldFN0YXRlKHtjb3VudDogcmVzLmNvdW50fSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgIH1cbiAgICB9KVxuICAgICovXG4gIH0sXG5cbiAgY2hhbmdlTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5jaGFuZ2VMaXN0KHRoaXMucHJvcHMubGlzdC5uYW1lLCB0aGlzLnByb3BzLmxpc3Qub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0TmFtZSA9IHRoaXMucHJvcHMubGlzdC5uYW1lXG4gICAgcHJvcHNDb3VudCA9IHRoaXMucHJvcHMuY291bnRcbiAgICBjb3VudCA9ICh0eXBlb2YocHJvcHNDb3VudCk9PSBcInVuZGVmaW5lZFwiKSA/IHRoaXMuc3RhdGUuY291bnQgOiBwcm9wc0NvdW50XG5cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuaWNvblR5cGUpXG4gICAgaWNvbiA9IFwiXCJcbiAgICBpZih0aGlzLnByb3BzLmljb25UeXBlID09IFwiYXJjaGl2ZVwiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFyY2hpdmVcIn0pXG4gICAgfSBlbHNlIGlmKHRoaXMucHJvcHMuaWNvblR5cGUgPT0gXCJ1c2Vyc1wiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXVzZXJcIn0pXG4gICAgfVxuXG5cbiAgICBjb3VudFN0eWxlID0gKHRoaXMucHJvcHMuaGlkZUNvdW50KSA/IHsnZGlzcGxheSc6J25vbmUnfSA6IHtiYWNrZ3JvdW5kQ29sb3I6JyM5OTknLGZsb2F0OidyaWdodCcsbWFyZ2luVG9wOicxcHgnfVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBcbiAgICAgICAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VMaXN0LCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImxpc3QtbmFtZXMgYnRuIGJ0bi1kZWZhdWx0XCJ9LCBcbiAgICAgICAgICAgICAgaWNvbiwgXG4gICAgICAgICAgICAgIFwiwqBcIiwgXG4gICAgICAgICAgICAgIGxpc3ROYW1lLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe3N0eWxlOiBjb3VudFN0eWxlLCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYmFkZ2UgYmFkZ2UtZGVmYXVsdFwifSwgdGhpcy5wcm9wcy5saXN0LmNvdW50KVxuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG4iXX0=
