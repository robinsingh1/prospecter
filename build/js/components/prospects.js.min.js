(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    currentUser = JSON.parse(localStorage.currentUser)
    _id = Date.now()
    data =  {
      name : $('#listTitle').val().trim(),
      user : appConfig.pointer('_User', currentUser.objectId),
      user_company: Parse._user_company,
      count: 0,
      tmp: _id
    }
    console.log(data)

    thiss = this;
    listClassName = (this.props.listClassName) ? this.props.listClassName : 'ProspectList'
    var _this = this;
    $.ajax({
      url:'https://api.parse.com/1/classes/'+listClassName,
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) { 
        console.log(res) 
        console.log("should be updating")
        _this.props.updateList(_id, res.objectId)
      },
      error: function(err) { console.log(err) }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-example-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Create List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.createMiningJob}, 
                    React.DOM.input({id: "listTitle", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", onClick: this.createListButtonClick, placeholder: "Enter City Area...", className: "btn btn-success", style: {display:'block', width:'100%'}}, "Create List")
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],2:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // DataRow
  getInitialState: function() {
    return { }
  },

  clickCheck: function() {
    domNode = this.getDOMNode()
    isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    //console.log(isChecked)
    this.setState({checked: isChecked})
    this.props.checkboxAction(isChecked, this.props.prospect.objectId)
  },

  rowClick: function() {
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
  },

  keyboardClick: function() {
    $($('.keySelect').find('input[type="checkbox"]')[0]).click()
  },

  componentDidMount: function() { },

  render: function() {
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
    thissss = this
    if(this.props.keyboardSelected) {
      // Adjust Scroll depending on where the prospect is
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
      Mousetrap.unbind('x')
      Mousetrap.bind('x', function() { 
        thissss.keyboardClick()
        if(thissss.state.checked)
          console.log("lmao")
      });
    }

    prospect = this.props.prospect
    company = (prospect.company) ? prospect.company : prospect.company_info
    company = (company) ? company : {}
    console.log(prospect)

    if(this.props.masterCheckboxChecked && this.state.checked)
      checked = true
    else if(this.props.alreadyChecked)
      checked = true
    else if(this.state.checked)
      checked = true
    else if(this.props.masterCheckboxChecked || this.state.checked)
      checked = true
    else
      checked = false

    // console.log(this.state.checked)
    // console.log(checked)
    // {prospect.employeeCountRange.name + " employees" }
    // Today
    
    color = {}
    if(this.state.checked || this.props.alreadyChecked)
      color = {backgroundColor: '#eef8ff'}
      
    rowCl = (this.props.keyboardSelected) ? "prospects-tr keySelect" : "prospects-tr"
    websiteBtn = (prospect.website) ?  React.DOM.a({href: "http://"+prospect.website.replace('http://',''), className: "btn btn-xs btn-primary btn-gradient", style: {float:'right',marginLeft:5}}, " ", React.DOM.i({className: "fa fa-globe"}), " ") : ""
    //if(parseInt(prospect.linkedin_url.split('/').pop())){
    if(company.linkedin_url){
      btnClass = "btn btn-primary btn-xs btn-gradient"
    } else {
      btnClass = "btn btn-primary btn-xs btn-gradient disabled"
    }
    if(company.logo)
      logo = company.logo

    return (
      React.DOM.tr({className: rowCl, 
          onClick: this.rowClick, 
          style: keyboardSelected}, 
          React.DOM.td({style: color}, 
              React.DOM.input({type: "checkbox", 
                     onChange: this.clickCheck, 
                     checked: checked})
          ), 
          React.DOM.td({style: color}, 
              React.DOM.div({style: {backgroundImage: "url("+company.logo+")"}, 
              className: "company-img-thumbnail"})
          ), 

          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold',fontSize:15}}, company.company_name), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px',fontSize:11}}, 
              company.headcount)
          ), 


          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.h6({style: {margin:'0px',fontSize:13}}, company.industry), 
            React.DOM.h6({style: {margin:'0px',fontStyle:'italic',marginTop:5,fontSize:11}}, 
              company.city)
          ), 

          React.DOM.td({style: color}, 
            "   ", 
            React.DOM.div({style: {width:290,marginTop:-15}}, 
            React.DOM.a({href: "javascript:", className: btnClass, 
              onClick: this.openLinkedinCompanyProfile}, 
              React.DOM.i({className: "fa fa-search"}), "  " + ' ' +
              "Search Profiles"
            ), 
            "   ", 
            React.DOM.a({href: "javascript:", className: btnClass, 
              onClick: this.openSimilarCompanies}, 
              React.DOM.i({className: "fa fa-copy"}), "  " + ' ' +
              "Find Similar Companies"
            )
            )
          ), 
          React.DOM.td({style: color, 
              className: "fixed-data-column"}, 
            React.DOM.h6({style: {margin:'0px',fontSize:11,paddingTop:5}}, moment(company.createdAt).fromNow())
          ), 

          React.DOM.td({style: color}, " ", React.DOM.h6({style: {margin:'0px'}}, ""), " "), 

          React.DOM.td({style: color}, 
            React.DOM.div({style: {width:92, paddingTop:5}}, 
              this.props.li, " ", 
              websiteBtn
            )
          )
        )
    );
  },

  openLinkedinCompanyProfile: function(e) {
    console.log(this.props.prospect.linkedin_url)
    cid = this.props.prospect.company_info.linkedin_url.split('?')[0].split('/company/')[1]
    console.log(cid)
    window.open("https://www.linkedin.com/vsearch/p?f_CC="+cid)
    e.stopPropagation()
  },

  openSimilarCompanies: function(e) {
    cid = this.props.prospect.company_info.linkedin_url.split('?')[0].split('/company/')[1]
    //window.open("https://www.linkedin.com/vsearch/c?rsid=526440371409184768175&pivotType=sim&pid="+cid+"&trk=sim_companies_res_sim&trkInfo=VSRPsearchId%3A526440371409184768175%2CVSRPtargetId%3A1025%2CVSRPcmpt%3Aprimary")
    window.open("https://www.linkedin.com/vsearch/c?rsid=526440371409184768175&pivotType=sim&pid="+cid+"&trk=sim_companies_res_sim&trkInfo=VSRPsearchId%3A526440371409184768175%2CVSRPtargetId%3A1025%2CVSRPcmpt%3Aprimary")
    e.stopPropagation()
  },

  deleteProspect: function() {
    this.props.deleteProspect(this.props.prospect.objectId, 'Prospect')
  }
});


},{}]},{},[1])


},{}],3:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  createListButtonClick: function() {
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  createMiningJob: function(e) {
    e.preventDefault()
    console.log('lmao')
    if($('#listTitle').val().trim() != "")
      this.createList()
  },

  deleteList: function() {
    this.props.deleteList()
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-deleteList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-trash-o"}), "  Delete List?")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({className: "deleteForm", onSubmit: this.deleteList}, 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-danger", 
                      style: {display:'block', width:'100%'}}, 
                      "Delete"
                    ), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.deleteList, 
                      className: "btn btn-default", 
                      style: {display:'block', width:'100%'}}, 
                      "Cancel"
                    )
                  )

                )
              )
            )
          )
    );
  }
});


},{}]},{},[1])


},{}],4:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Spinner
  render: function() {
    return (
      React.DOM.div({className: "horizantal-spinner"}, 
        React.DOM.div({className: "hoz-bounce1"}), 
        React.DOM.div({className: "hoz-bounce2"}), 
        React.DOM.div({className: "hoz-bounce3"})
      )
    )
  }
})

},{}]},{},[1])


},{}],5:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // LoadingSpinner
  render: function() {
    return (
    React.DOM.div({className: "spinner", style: {marginTop:'180px'}}, 
      React.DOM.div({className: "spinner-container container1"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container2"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      ), 
      React.DOM.div({className: "spinner-container container3"}, 
        React.DOM.div({className: "circle circle1"}), 
        React.DOM.div({className: "circle circle2"}), 
        React.DOM.div({className: "circle circle3"}), 
        React.DOM.div({className: "circle circle4"})
      )
    )
    )
  }
});

},{}]},{},[1])


},{}],6:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  //Messenger
  render: function() {
    return (
        React.DOM.div({className: "alert alert-success", 
             'data-alert': "alert", 
             style: {position:'absolute',
                     top: 31, 
                     right:30, 
                     display:'none',
                     width:200}}, 
                     React.DOM.a({className: "close", 
                       href: "javascript:", 
                       onClick: this.hideAlert}, "×"), 
            "Test"
        )
    );
  }
});

},{}]},{},[1])


},{}],7:[function(require,module,exports){
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Panel Footing
  paginatePrevious: function() {
    var _this = this;

    qry = {
      where: JSON.stringify({archived:{$in: [false, null]}}),
      order: '-createdAt', count: 1,
      skip: (this.props.currentPage-2)*this.props.prospectsPerPage,
      limit: this.props.prospectsPerPage,
      include: 'company'
    }
    $.ajax({
      url: 'https://api.parse.com/1/classes/'+_this.props.prospectType,
      type:'GET',
      beforeSend: function() {
        console.log('before Send')
        _this.props.setPaginate(true)
      },
      headers: appConfig.parseHeaders,
      data: qry,
      success: function(res){
        console.log(res)
        _this.props.paginate(res.results, _this.props.currentPage - 1)
        _this.props.setPaginate(false)
      },
      error: function(res){ console.log(res) }
    });
  },

  paginate: function(direction) {
    var _this=this;
    prospectsPerPage = this.props.prospectsPerPage
    qry = {count: true}
    if(direction=='previous')
      qry.skip = (this.props.currentPage - 2)*prospectsPerPage
    else if(direction=="forward")
      qry.skip = this.props.currentPage*prospectsPerPage

    Parse.get(this.props.prospectType, qry).done(function(res) {
       console.log(res)
       this.props.paginate(res.results, _this.props.currentPage + 1)
    })
  },

  paginateForward: function() {
    var _this = this;
    qry = {
      where: JSON.stringify({ archived: {$in:[false, null] }}),
      order: '-createdAt', count: 1,
      skip: this.props.currentPage*this.props.prospectsPerPage,
      limit: this.props.prospectsPerPage,
      include: 'company',
    }

    $.ajax({
      url: 'https://api.parse.com/1/classes/'+_this.props.prospectType,
      type:'GET',
      headers: appConfig.parseHeaders,
      data: qry,
      beforeSend: function() {
        _this.props.setPaginate(true)
      },
      success: function(res){
        console.log(res)
        _this.props.paginate(res.results, _this.props.currentPage + 1)
        _this.props.setPaginate(false)
      },
      error: function(res){ console.log(res); }
    });
  },

  componentDidMount: function() {
    paginateForward = this.paginateForward
    paginatePrevious = this.paginatePrevious

    Mousetrap.bind('l', function() { 
      console.log('new forward')
      paginateForward()
    });

    Mousetrap.bind('h', function() { 
      console.log('new back')
      paginatePrevious()
    });
  },

  render: function() {
    // Add Support For Current List
    // Current List
    //console.log('current page')
    //console.log(this.props.currentPage)
    //console.log(this.props.count)

    previous = (this.props.currentPage - 1) ? '' : 'disabled'

    lowerLimit = (this.props.currentPage-1)*this.props.prospectsPerPage
    upperLimit = this.props.currentPage*this.props.prospectsPerPage

    lowerLimit = (lowerLimit) ? lowerLimit : 1
    upperLimit = (upperLimit > this.props.count) ? this.props.count : upperLimit

    lastPage = this.props.currentPage == this.props.pages
    lessThanOnePage = upperLimit - lowerLimit<= this.props.prospectsPerPage - 2
    console.log(this.props.prospectsPerPage)
    forward = (lastPage || lessThanOnePage) ? 'disabled' : ''

    return (
      React.DOM.div({className: "panel-footing", 
           id: "navbar", 
           style: {height:'35px',padding:'0px', paddingTop:'7px'}}, 
          React.DOM.span({style: {float:'right',marginRight:5}}, 
            React.DOM.a({href: "javascript:", 
               style: {marginRight:'5px'}, 
               onClick: this.fastPrevious, 
               className: "blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-fast-backward"})
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginatePrevious, 
             className: "paginate-back-btn blue-gradient btn btn-primary btn-xs "+previous}, 
            React.DOM.i({className: "fa fa-chevron-left"})
          ), 
          React.DOM.span({style: {marginLeft:5, marginRight:5,display:'inline',width:'100%', textAlign:'center'}}, 
            React.DOM.span({style: (this.props.count) ? {}:{display:'none'}}, 
              lowerLimit+' - ', " "), " ", upperLimit+' of '+this.props.count
          ), 
          React.DOM.a({href: "javascript:", 
             onClick: this.paginateForward, 
             className: "paginate-forward-btn blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-chevron-right"})
          ), 
          React.DOM.a({href: "javascript:", 
             style: {marginLeft:'5px'}, 
             onClick: this.fastForward, 
             className: "blue-gradient btn btn-primary btn-xs "+forward}, 
            React.DOM.i({className: "fa fa-fast-forward"}))
          )
        )
    );
  }, 

  fastPrevious: function() {
    var thiss = this;
    qry = {
      where: JSON.stringify({ user_company: Parse.user_company, 
                              archived:{$in: [null, false]}}),
      order: '-createdAt',
      count: 1,
      limit: thiss.props.prospectsPerPage,
      include: 'company'
    }
    $.ajax({
      url:'https://api.parse.com/1/classes/'+thiss.props.prospectType,
      data: qry,
      beforeSend: function() {
        console.log('before Send')
        thiss.props.setPaginate(true)
      },
      headers: appConfig.headers,
      success: function(res){ console.log(res.results) 
        thiss.props.paginate(res.results, 1)
        thiss.props.setPaginate(false)
      },
      error: function(err) { console.log(err.responseText) }
    })
  },

  fastForward: function() {
    var thiss = this;
    console.log('fast forward')
    console.log(thiss.props.count - thiss.props.prospectsPerPage)
    _prosp = this.props.prospectsPerPage
    qry = {
      where: JSON.stringify({ user_company: Parse.user_company, 
                              archived:{$in: [null, false]}}),
      order: '-createdAt',
      count: 1,
      skip: Math.floor(thiss.props.count / _prosp)*_prosp,
      limit: thiss.props.count - thiss.props.prospectsPerPage,
      include: 'company'
    }
    $.ajax({
      url:'https://api.parse.com/1/classes/'+thiss.props.prospectType,
      data: qry,
      beforeSend: function() {
        console.log('before Send')
        thiss.props.setPaginate(true)
      },
      headers: appConfig.headers,
      success: function(res){ console.log(res.results) 
        page = Math.ceil(thiss.props.count / 50)
        thiss.props.paginate(res.results, page)
        thiss.props.setPaginate(false)
      },
      error: function(err) { console.log(err.responseText) }
    })
  }
});

},{}]},{},[1])


},{}],8:[function(require,module,exports){
/** @jsx React.DOM */

//TODO - abstract lists
//TODO - rename this
var Lists = require('./side_menu_user_prospects.js.min.js'); 

var UserProspectHeader = require('./user_prospect_header.js.min.js');
var UserProspectRow = require('./user_prospect.js.min.js');

//var CompanyProspectHeader
var CompanyProspectRow = require('./data_row.js.min.js');
var LoadingSpinner = require('./loading_spinner.js.min.js')
var Spinner = require('./spinner.js.min.js')
var Messenger = require('./messenger.js.min.js')
var PanelFooting = require('./panel_footing.js.min.js')

//var CreateProspectListFromCompanyListModal = require('./create_prospect_list_from_company_list.js.min.js')
//var CreateProspectProfileModal = require('./create_title_mining_job.js.min.js')
/*
      <CreateProspectListFromCompanyListModal 
        currentList={this.state.currentList} 
        currentListObjectId={this.state.currentListObjectId}/>
      <CreateProspectProfileModal 
        currentList={this.state.currentList} 
        currentListObjectId={this.state.currentListObjectId}/>
      <RenameListModal renameList={this.props.renameList}/>
      <DeleteListModal deleteList={this.props.deleteList}/>
*/

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {  prospects   : [],
              currentPage : 1,
              className: this.props.className,
              listClassName: this.props.listClassName,
              pages       : 1,
              currentList : 'All',
              currentListObjectId : '',
              loading: true,
              paginating: false,
              prospectsPerPage: 50,
              downloading: false,
              lists : [],
              masterCheckboxChecked: false,
              keyboardActiveProspect: 0, //first
              //selectedProspects: [],
              totalCount  : "~", 
              detailMode: false,
              detailCompany: {},
              count       : "~", }
  },

  setPaginate: function(value) { this.setState({paginating: value}) },
  setDownloading: function(value) { this.setState({downloading: value}) },
  removeProspects: function(objArray) {
    _prospects = _.map(this.state.prospects, function(prospect) {
      console.log(objArray.indexOf(prospect.objectId) == -1)
      if(objArray.indexOf(prospect.objectId) == -1){
          return prospect
      }
    })
    this.setState({prospects: _.compact(_prospects)})
  },

  archiveProspects: function(objects) {
    console.log('ARCHIVE')
    objects = (objects) ? objects : []
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    selectedProspects = selectedProspects.concat(objects)
    qry = {'archived':true}
    console.log('starting parse archive')
    Parse.batchUpdate(this.state.className, selectedProspects, qry).done(function(res) {
      console.log(res)
    })
    this.removeProspects(selectedProspects)
    totalCount = this.state.totalCount
    this.setState({totalCount : totalCount - 1})

    selected = _.map(this.state.prospects, function(prospect) {
      if(selectedProspects.indexOf(prospect.objectId) != -1)
        return prospect
    })

    selected = _.compact(selected)
    selected = _.pluck(selected, 'lists')
    selected = _.flatten(selected)
    selected = _.pluck(selected, 'objectId')
    selected = _.compact(selected)

    _.map(selected, function(list_id) {
      decrement = {count: {__op: 'Increment', amount: -1}}
      Parse.put('ProspectList/'+list_id, decrement, function(res) {
        console.log(res)
      })
    })
  },

  changeList: function(newListName, objectId) {
    localStorage.selectedProspects = JSON.stringify([])
    this.setState({
      currentList : newListName,
      currentListObjectId : objectId,
      prospects  : [],    
      count      : '~',
      pages      : 1,
      loading    : true,
      currentPage: 1,
      keyboardActiveProspect: 0
    })

    qry = {include: 'company', limit: this.state.prospectsPerPage, count: true}
    qry.where = {}
    qry.where.archived = {$in:[null, false]}
    if (newListName == 'Archived')
      qry.where.archived = true
    else if(newListName != "All")
      qry.where.lists = Parse._pointer(this.state.listClassName, objectId)
    qry.where = JSON.stringify(qry.where)
    console.log(qry)

    var _this = this;
    Parse.get(this.state.className, qry).done(function(res) {
      console.log(res)
      _this.setState({
        prospects: res.results,
        count: res.count,
        pages: Math.ceil(res.count/_this.props.prospectsPerPage),
        loading: false,
      })
    })
  },

  checkboxAction: function(checkedState, obj) {
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    if(checkedState)
      selectedProspects.push(obj)
    else
      selectedProspects = _.reject(selectedProspects,function(id){return id == obj})

    selectedProspects = _.uniq(selectedProspects)
    console.log(selectedProspects)
    localStorage.selectedProspects = JSON.stringify(selectedProspects)
    //this.setState({selectedProspects: selectedProspects})
  },

  masterCheckboxChanged: function(masterCheckboxValue) {
    this.setState({masterCheckboxChecked: masterCheckboxValue})
  },

  render: function() {
    this.startKeyboardShortcuts()
    $('body').css({overflow:'auto'})

    prospects = []
    for(i=0;i< this.state.prospects.length;i++) {
      url = this.state.prospects[i].url
      prospect = this.state.prospects[i]

      keyboardSelected = (i == this.state.keyboardActiveProspect)

      selectedProspects = JSON.parse(localStorage.selectedProspects)
      alreadyChecked=false
      for(ii=0;ii< selectedProspects.length;ii++)
        if(prospect.objectId == selectedProspects[ii])
          alreadyChecked = true

      //console.log(alreadyChecked)

      if(this.state.className == "Prospect") { 
      prospects.push(
        UserProspectRow({deleteProspect: this.deleteProspect, 
                      prospect: this.state.prospects[i], 
                      masterCheckboxChecked: this.state.masterCheckboxChecked, 
                      key: this.generate_id(), 
                      link: "", 
                      archiveProspects: this.archiveProspects, 
                      keyboardSelected: keyboardSelected, 
                      alreadyChecked: alreadyChecked, 
                      checkboxAction: this.checkboxAction}
                    )
      )
      } else { 
        prospects.push(
          CompanyProspectRow({deleteProspect: this.deleteProspect, 
                            prospect: this.state.prospects[i], 
                            masterCheckboxChecked: this.state.masterCheckboxChecked, 
                            key: this.generate_id(), 
                            link: "", 
                            keyboardSelected: keyboardSelected, 
                            alreadyChecked: alreadyChecked, 
                            checkboxAction: this.checkboxAction})
        )
      }

      $('#prospectDetailButtons').click(function(e) {
        //e.stopPropagation()
        //setTimeout(function(){ $('.dropdown').show() }, 30);
      })
    }

    if(this.state.currentList == "All"){
      listType = {display:'none'}
      listNameStyle = {display:'none'}
      listBtn = {display:'none'}
      listOptions = {display:'none'}
      copyDropdownStyle = {width:114, right:4}
    } else {
      listType = {float:'left'}
      listNameStyle = {float:'left',display:'inline-block', fontWeight: 200, marginTop: 1, paddingRight: 10, marginLeft: -10}
      listBtn = {float:'left',marginLeft:5}
      listOptions = {float:'right'}
      copyDropdownStyle = {width:114, right:36}
    }

    currentList     = this.state.currentList
    paginateOverlay = (this.state.paginating) ? PaginateOverlay(null) : ""
    downloadIcon    = (!this.state.downloading) ? React.DOM.i({className: "fa fa-download"}) : Spinner({circleStyle: {backgroundColor:'white',height:4,width:4}, spinnerStyle: {height:13, width:13,margin:0,display:'inline-block',paddingTop:2}})
    prospectTableStyle = (this.state.count == 0) ? {display:'none'} :{height:'400px',overflow:'auto'}

    header = (this.props.className == "Prospect") ? UserProspectHeader({masterCheckboxChanged: this.masterCheckboxChanged}) : CompanyProspectHeader({masterCheckboxChanged: this.masterCheckboxChanged})

    return (
        React.DOM.div(null, 
      React.DOM.div({className: "container prospects-container"}, 
        Lists({currentList: this.state.currentList, 
               count: this.state.count, 
               listClassName: this.state.listClassName, 
               currentListObjectId: this.state.currentListObjectId, 
               totalCount: this.state.totalCount, 
               removeProspects: this.removeProspects, 
               changeList: this.changeList, 
               createList: this.createList, 
               lists: this.state.lists}), 

      React.DOM.div({className: "col-lg-10 col-md-10 col-sm-10 col-xs-10", style: {padding:'0'}}, 
              paginateOverlay, 
              React.DOM.div({id: "prospectDetailButtons"}, 
                ListDetailButtons({
                  renameList: this.renameList, 
                  deleteList: this.deleteList, 
                  currentListName: this.state.currentList, 
                  currentList: this.state.currentListObjectId}), 

                React.DOM.div({className: "dropdown"}, 
                  React.DOM.a({href: "javascript:", 
                     className: "btn btn-primary btn-xs list-options", 
                     id: "", 
                     style: listOptions}, 
                    React.DOM.i({className: "fa fa-bars"})
                  )
                ), 

                React.DOM.div({className: "dropdown1 copyList", style: {display:'inline-block',float:'right'}}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     id: "copyToList", 
                     href: "javascript:", 
                     className: "drop-target btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-copy"}), "  Copy To List ", 
                     React.DOM.i({className: "fa fa-caret-down"})), 
                  CurrentListsTwo({lists: this.state.lists, 
                                   copyDropdownStyle: copyDropdownStyle, 
                               copySelectedProspects: this.copySelectedProspects})
                ), 
  
                React.DOM.div({className: "dropdown1 moveList", style: {display:'inline-block',float:'right'}}, 
                  React.DOM.a({'data-toggle': "dropdown", 
                     href: "javascript:", 
                     id: "moveToList", 
                     className: "btn btn-primary btn-xs list-options"}, 
                     React.DOM.i({className: "fa fa-share"}), "  Move To List ", 
                     React.DOM.i({className: "fa fa-caret-down"})), 
                CurrentLists({lists: this.state.lists, 
                              moveSelectedProspects: this.moveSelectedProspects})
                ), 

                React.DOM.a({onClick: this.downloadFile, 
                   href: "javascript:", 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                   downloadIcon, 
                   "  Download CSV  " 
                ), 

                React.DOM.a({href: "javascript:", 
                   onClick: this.archiveProspects, 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                   React.DOM.i({className: "fa fa-archive"}), 
                   "  Archive  " 
                ), 

                React.DOM.a({href: "javascript:", 
                   onClick: this.launchProspectProfileModal, 
                   style: {display:'none'}, 
                   id: "downloadProspects", 
                   className: "drop-target btn btn-primary btn-xs list-options"}, 
                   React.DOM.i({className: "fa fa-cloud-download"}), 
                   "  Find Prospects By Title  " 
                )
              ), 
          (this.state.count == 0) ? EmptyPeopleProspectsPanel({className: this.props.className})  : "", 
          React.DOM.div({id: "autoscroll", style: prospectTableStyle}, 
            React.DOM.table({className: "prospects-table table table-striped", 
                style: {marginBottom:'0px'}}, 
              React.DOM.thead({style: {backgroundColor:'white'}}, 
                header
              ), 
              React.DOM.tbody(null, 
                prospects
              )
            ), " ", (this.state.loading) ? LoadingSpinner(null) : ""
          )
        )
      ), 
      PanelFooting({currentPage: this.state.currentPage, 
                    count: this.state.count, 
                    totalCount: this.state.totalCount, 
                    paginate: this.paginate, 
                    prospectType: 'Prospect', 
                    prospectsPerPage: this.state.prospectsPerPage, 
                    setPaginate: this.setPaginate, 
                    pages: this.state.pages}), 
      Messenger(null)
    )
    );
  },

  launchProspectProfileModal: function(){ $('#createProspectProfileModal').modal() },

  paginate: function(newProspects, newPage) {
    this.setState({
      prospects: newProspects,
      currentPage: newPage,
      keyboardActiveProspect: 0
    })
    this.startKeyboardShortcuts()
    document.getElementById('autoscroll').scrollTop = 0
  },

  _make_email: function(name, pattern) {
    name = name.trim()
    vars = {
      first_name: _.first(name.split(' ')),
      last_name: _.last(name.split(' ')),
      first_initial: _.first(name.split(' '))[0],
      last_initial: _.last(name.split(' '))[0],
      domain: prospect.company.domain
    }
    pattern = (pattern[0]) ? pattern[0].pattern : ""
    prospect_email = Mustache.render(pattern, vars).toLowerCase()
    //console.debug('PROSPECT EMAIL')
    //console.debug(prospect_email)
    return prospect_email
  },

  downloadFile: function() {
    if(this.state.className == "Prospect")
      this.downloadProspects()
    else
      this.downloadCompanies()
  },

  downloadCompanies: function() {
    console.log('download file')
    _list = Parse._pointer('CompanyProspectList', this.state.currentListObjectId)

    var _this = this;
    results = _.map([0,1,2,3,4,5,6,7,8,9], function(num) {
      qry = { count: 1, archived: {$in:[null, false]}, limit: 1000, skip: num*1000}
      qry.include = 'company,company.email_guess'
      if(_this.state.currentList != "All")
        qry.where = JSON.stringify({lists: _list})
      return Parse.get(_this.state.className, qry)
    })

    $.when.apply(this, results).then(function (res) {
      prospects = _.flatten(_.map(arguments, function(arg) { return arg[0].results}))
      prospects = _.map(prospects, function(prospect) {
        // TODO - add email
        if(prospect.company) {
          company = prospect.company
          delete company.name
          _keys = _.keys(prospect).concat(_.keys(company))
          _values = _.values(prospect).concat(_.values(company))
          obj = _.object(_keys, _values)
          obj.address = obj.normalizedLocation

          console.log(obj)
          delete obj.company; delete obj.createdAt; delete obj.updatedAt; delete obj.objectId;
          delete obj.lists; delete obj.loading; delete obj.user; delete obj.user_company;
          delete obj.api_key; delete obj.className;
          return obj;
        } else {
          //console.log(prospect)
          return prospect
        }
      })
      prospects = [Papa.unparse(prospects)]
      var blob = new Blob(prospects, {type: "text/plain;charset=utf-8"});
      console.log(blob)
      saveAs(blob, _this.state.className+".csv");
      _this.setState({downloading: false})
    })
  },

  downloadProspects: function() {
    console.log('download file')
    _list = Parse._pointer('ProspectList', this.state.currentListObjectId)

    var _this = this;
    results = _.map([0,1,2,3,4,5,6,7,8,9], function(num) {
      qry = { count: 1, archived: {$in:[null, false]}, limit: 1000, skip: num*1000}
      qry.include = 'company,company.email_guess'
      if(_this.state.currentList != "All")
        qry.where = JSON.stringify({lists: _list})
      return Parse.get(_this.state.className, qry)
    })

    $.when.apply(this, results).then(function (res) {
      prospects = _.flatten(_.map(arguments, function(arg) { return arg[0].results}))
      prospects = _.map(prospects, function(prospect) {
        // TODO - add email
        if(prospect.company) {
          company = prospect.company
          delete company.name
          _keys = _.keys(prospect).concat(_.keys(company))
          _values = _.values(prospect).concat(_.values(company))
          obj = _.object(_keys, _values)
          obj.address = obj.normalizedLocation
          if(obj.email_pattern && !_.isEqual(obj.email_pattern, []))
            obj.email = _this._make_email(prospect.name, prospect.company.email_pattern)
          else
            obj.email = ""

          console.log(obj)
          delete obj.company; delete obj.createdAt; delete obj.updatedAt; delete obj.objectId;
          delete obj.lists; delete obj.loading; delete obj.user; delete obj.user_company;
          delete obj.api_key; delete obj.className;
          return obj;
        } else {
          //console.log(prospect)
          return prospect
        }
      })
      prospects = [Papa.unparse(prospects)]
      var blob = new Blob(prospects, {type: "text/plain;charset=utf-8"});
      console.log(blob)
      saveAs(blob, _this.state.className+".csv");
      _this.setState({downloading: false})
    })
  },


  hideAlert: function() { $('.alert').hide() },
  startKeyboardShortcuts: function() { /*KeyboardShortcuts.initialize()*/ },
  componentDidUpdate: function() { $('.dropdown').show() },

  componentDidMount: function() {
    $('.dropdown').show(); 
    localStorage.selectedProspects = JSON.stringify([]);

    qry = { lists: currentList }
    if(this.state.currentList == 'All'){
      qry = {
        count: true, order: '-createdAt',
        limit: this.state.prospectsPerPage,
        include: 'email_guesses,email_guesses.pattern,company'
      }
      qry.where = JSON.stringify({ archived: {'$in':[false, null]}, })
    }

    var _this = this;
    Parse.get(_this.state.className, {count: true,limit:0}).done(function(res) {
      console.log(res)
    })
    Parse.get(_this.state.className, qry).done(function(res) {
      console.log(res)
      res.prospects = res.results
      res.loading = false; 
      res.pages = Math.ceil(res.count/_this.props.prospectsPerPage);
      res.totalCount = res.count
      _this.setState(res)
    })

    Parse.get(this.props.listClassName, { order: '-createdAt'}).done(function(res) {
      _this.setState({lists: res.results})
    })
  },

  generate_id : function () {
    return '_' + Math.random().toString(36).substr(2,9); 
  },
});

/*  Dropdown Menus */
var ListsMenu = React.createClass({displayName: 'ListsMenu',
  render: function() {
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {
            minWidth:'inherit',
            top: '20px',
            width: '125px',
            right: '154px',
            left:'auto'
          }}, 
        React.DOM.li(null, React.DOM.a({href: "#books"}, 
          React.DOM.i({className: "fa fa-times"}), "  " + ' ' +
          "Delete List"
        )), 
        React.DOM.li(null, React.DOM.a({href: "#podcasts"}, 
          "Rename Lists"
        ))
      )
    );
  }
});

var ListDetailButtons = React.createClass({displayName: 'ListDetailButtons',
  // Rename List
  getInitialState: function() {
    return {
      editMode: false
    }
  },
  render: function() {
    //console.log(this.props.currentListObjectId)
    if(!this.state.editMode) {
      stuff = React.DOM.span({className: "", style: listNameStyle}, 
            (this.props.currentListName == "All") ? '' : React.DOM.i({className: "fa fa-bars", style: {fontSize:16, marginTop:-5}}), 
            (this.props.currentListName == "All") ? '' : "   " +this.props.currentListName
              )
    } else {
      stuff = React.DOM.input({className: "form-control", style: {width: 100, float: 'left', height: 24, marginTop: -1}})
    }
    return (

          React.DOM.div(null, 
            React.DOM.h4({style: {margin:0}}, " ", stuff, 
              React.DOM.a({href: "javascript:", 
                style: listBtn, 
                'data-toggle': "modal", 
                id: "renameListBtn", 
                'data-target': ".bs-renameList-modal-sm", 
                style: {display:'none'}, 
                className: "btn btn-xs btn-default"}, 
                React.DOM.i({className: "fa fa-pencil"})
              ), 
              React.DOM.a({href: "javascript:", 
                onClick: this.deleteList, 
                style: listBtn, 
                style: {display:'none'}, 
                className: "btn btn-xs btn-default"}, 
                React.DOM.i({className: "fa fa-trash-o"})
              )
            )

          )
      );
  },

  renameList: function(newListName) { this.props.renameList(newListName) },

  deleteList: function(){
    thiss = this;
    swal({   
      title: "Are you sure?",   
      text: "Your will not be able to recover this prospect list!",   
      type: "warning",   
      showCancelButton: true,   
      confirmButtonColor: "#DD6B55",   
      confirmButtonText: "Yes, delete it!",   
      closeOnConfirm: false }, 
      function(){   swal("Deleted!", "Your prospect list has been deleted.", "success"); 
        console.log('deleted')
        thiss.props.deleteList()
      });
  },

  toggleEdit: function() { this.setState({editMode: !this.state.editMode }) }
});

var PaginateOverlay = React.createClass({displayName: 'PaginateOverlay',
  render: function() {
    return (
        React.DOM.div({id: "paginate-overlay", style: {paddingTop:70}}, 
          Spinner({circleStyle: {backgroundColor:'white'}})
        )
    )
  }
})

var EmptyPeopleProspectsPanel = React.createClass({displayName: 'EmptyPeopleProspectsPanel',
  openLinkedinWindow: function() {
    if(this.props.className == "Prospect")
      window.open('https://www.linkedin.com/vsearch/p?type=people')
    else
      window.open('https://www.linkedin.com/vsearch/c')
  },

  render: function() {

    name = (this.props.className == "Prospect") ? "Prospects" : "Companies"
    return (
      React.DOM.div({className: "col-md-offset-3 col-md-6", style: {height:400}}, 
      React.DOM.div({className: "panel panel-default", style: {marginTop:100,height:200}}, 
        React.DOM.div({className: "panel-body"}, 
          React.DOM.h1({className: "lead", style: {textAlign:'center'}}, "Start Prospecting On Linkedin"), 
          React.DOM.a({href: "javascript:", onClick: this.openLinkedinWindow, className: "btn btn-primary", style: {backgroundImage: 'linear-gradient(180deg, #0096ff 0%, #005dff 100%) !important',display:'block',marginRight:'auto',marginLeft:'auto',width:200, marginTop:50}}, 
            React.DOM.i({className: "fa fa-search"}), "  ", 
            "Search for "+name+"!")
        )
      )
    )
    );
  }
});

var CompanyProspectHeader = React.createClass({displayName: 'CompanyProspectHeader',
  render: function() {
    return (
      React.DOM.tr(null, 
        React.DOM.th(null), 
        React.DOM.th(null), 
        React.DOM.th({style: {width:400}}, "Name"), 
        React.DOM.th({style: {width:500}}, "Industry"), 
        React.DOM.th({style: {width:137,display:'none'}}, "# of Prospects"), 
        React.DOM.th(null, "  "), 
        React.DOM.th({style: {display:'none'}}, "Signals"), 
        React.DOM.th({style: {width:100}}, "Added"), 
        React.DOM.th(null, " "), 
        React.DOM.th(null, " ")
      )
    );
  }
});

var CurrentLists = React.createClass({displayName: 'CurrentLists',
  listAction: function(e) {
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == $(e.target).text()
    });

    this.props.moveSelectedProspects(listSelect[0].objectId)
  },

  componentDidMount: function() {
    //$(this.getDOMNode().data()
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      console.log(this.props.lists[i].objectId)
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
            className: "dropdown-move-list-name dropdown-list-name", 
            href: "javascript:", 
            'data-move-objectId': "this.props.lists[i].objectId"}, 
           this.props.lists[i].name))
      )
    }
    //console.log(this.props.copyDropdownStyle)
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {right:123,top:27}}, 
        lists
      )
    );
  }
});

var CurrentListsTwo = React.createClass({displayName: 'CurrentListsTwo',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.copySelectedProspects(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
               className: "dropdown-copy-list-name dropdown-list-name", 
               href: "javascript:", 
               'data-objectId': this.props.lists[i].objectId}, 
               
          this.props.lists[i].name))
      )
    }
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {width:114,right:6,top:27}}, 
        lists
      )
    );
  }
});

},{"./data_row.js.min.js":2,"./loading_spinner.js.min.js":5,"./messenger.js.min.js":6,"./panel_footing.js.min.js":7,"./side_menu_user_prospects.js.min.js":10,"./spinner.js.min.js":11,"./user_prospect.js.min.js":12,"./user_prospect_header.js.min.js":13}],9:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // createListModal
  createList: function() {
    console.log($('#listTitle').val())

    data =  {
      'name'        : $('#listTitle').val().trim(),   //Waiting , Running
      'user'        : { '__type':'Pointer',
                      'className':'_User',
                      'objectId':'xWESiw5Smd' },
    }

    $.ajax({
      url:'https://api.parse.com/1/classes/ProspectList',
      type:'POST',
      headers: appConfig.parseHeaders,
      data: JSON.stringify(data),
      success: function(res) {
        console.log(res)
      },
      error: function(err) {
        console.log('error')
        console.log(err)
      }
    });

    data.count = 0

    this.props.createList(data)
    
    $('#createListModal').modal('hide')
    $('body').removeClass('modal-open');
    $('.modal-backdrop').remove();
    //$('button.close').click()
  },

  renameList: function(e) {
    e.preventDefault()
    //console.log($('#newListName').val())
    newListName = $('#newListName').val()
    if(newListName.trim() != "")
      this.props.renameList(newListName)
    // Disable Modal
  },

  render: function() {
    return (
          React.DOM.div({className: "modal fade bs-renameList-modal-sm", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "createListModal", style: {top:'200px'}}, 
            React.DOM.div({className: "modal-dialog modal-sm"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-list"}), "  Rename List")
                ), 
                React.DOM.div({className: "modal-body"}, 
                  React.DOM.form({onSubmit: this.renameList}, 
                    React.DOM.input({id: "newListName", type: "text", placeholder: "Enter list title...", className: "form-control"}), 
                    React.DOM.br(null), 
                    React.DOM.a({href: "javascript:", 
                      onClick: this.renameList, 
                      className: "btn btn-success", 
                      style: {display:'block', width:'100%'}}, 
                      "Create List"
                    )
                  )
                )
              )
            )
          )
    );
  }
});


},{}],10:[function(require,module,exports){
/** @jsx React.DOM */

var SideMenuListOption = require('./user_side_menu_list.js.min.js');
var CreateListModal = require('./create_list_modal.js.min.js')
var Messenger = require('./messenger.js.min.js')

var DeleteListModal = require('./delete_list_modal.js.min.js')
var RenameListModal = require('./rename_list_modal.js.min.js')
var SideMenuListOption = require('./user_side_menu_list.js.min.js');

module.exports = React.createClass({displayName: 'exports',
  //SideMenuProspects - SideList
  getInitialState: function() {
    return {
      /*
      createList: 
      renameList:
      deleteList:
      changeList:
      currentList:
      totalCount:
      lists:

      */
     lists: [],
    }
  },

  createList: function (data) {
    this.props.createList(data)
  },

  componentDidUpdate: function() {
    $('.dropdown-copy-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.copySelectedProspects(listSelect[0].objectId)
    })

    $('.dropdown-move-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('move-objectId'))
      //this.props.moveSelectedProspects(listSelect[0].objectId)
    })
  },

  componentDidMount: function() {
    var _this = this;
    Parse.get(this.props.listClassName, { order: '-createdAt'}).done(function(res) {
      _this.setState({lists: res.results})
    })

    $('.dropdown-copy-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.copySelectedProspects(listSelect[0].objectId)
    })

    $('.dropdown-move-list-name').on('click', function(e) {
      console.log(e.target)
      console.log($(e.target).data('objectId'))
      //this.props.moveSelectedProspects(listSelect[0].objectId)
    })
  },
  
  removeSelectedProspects: function() {
    // remove selected from list
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    _list = Parse._pointer(this.props.listClassName, this.state.currentListObjectId)
    body = { lists: { '__op' : 'Remove', "objects" : [_list] } }
    if(this.state.currentList == 'All'){ body = { archived: true } }
    Parse.batchUpdate('Prospect', selectedProspects, body)
    // Update List Counts
    //
  },

  moveSelectedProspects: function(_list) {
    // move to list
    // only if the current list is not all
    // remove prospects from currentList
    if(!this.props.currentListObjectId){ console.log('not supported'); return 0}
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    old_list = Parse._pointer(this.props.listClassName, this.props.currentListObjectId)
    new_list = Parse._pointer(this.props.listClassName, _list)
    this.props.removeProspects(selectedProspects)

    var _this = this;
    console.log(_list)
    console.log(this.props.currentListObjectId)
    body = { lists: { '__op' : 'Remove', "objects" : [old_list] } }
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function() {
      increment = {count: {__op: 'Increment', amount: -1*selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _this.props.currentListObjectId)
          item.count = item.count - amount
        return item
      })
      console.log(lists)
      _this.setState({lists: lists})
    })

    body = { lists: { '__op' : 'AddUnique', "objects" : [new_list] } }
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function() {
      increment = {count: {__op: 'Increment', amount: selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _list)
          item.count = (item.count) ? item.count + amount : amount
        return item
      })
      //console.log(lists)
      _this.setState({lists: lists})
    })
    // Update List Counts
  },

  copySelectedProspects: function(_list) {
    // TODO - check to see if prospect exists in the other list
    // TODO - Remove from selected prospects If prospects already exist in list do not increment
    console.log('update')
    selectedProspects = JSON.parse(localStorage.selectedProspects)
    new_list = Parse._pointer(this.props.listClassName, _list)
    body = { lists: { '__op' : 'AddUnique', "objects" : [new_list] } }
    console.log(body)

    //

    var _this = this;
    Parse.batchUpdate('Prospect', selectedProspects, body).done(function(res) {
      console.log(res)
      // if success
      increment = {count: {__op: 'Increment', amount: selectedProspects.length}}
      Parse.put(_this.props.listClassName+'/'+_list, increment, function(res) {
        console.log(res)
      })

      amount = selectedProspects.length
      var lists = _.map(_this.state.lists, function(item) {
        if(item.objectId == _list)
            item.count = (item.count) ? item.count + amount : amount
        return item
      })
      console.log(lists)
      _this.setState({lists: lists})
    })
  },

  changeList: function(e) {
    /*
    currentList = $(e.target).parent()//.data('list')
    console.log(currentList)
    this.props.changeList(currentList.name, currentList.objectId)
    */
  },

  render: function() {
    if(this.props.currentList == "All")
      styles = {'backgroundColor':'rgb(0, 122, 255)', 'color':'white'} 
    else
      styles =  {}

    lists = [SideMenuListOption({list: {name: 'All', count: this.props.totalCount}, 
                                 iconType: 'users', 
                                 changeList: this.props.changeList}), 
             SideMenuListOption({list: {name: 'Archived', count: '~'}, 
                                 iconType: 'archive', 
                                 changeList: this.props.changeList, 
                                 hideCount: true})]

    for(i=0;i< this.state.lists.length;i++){
      list = this.state.lists[i]
      if(list.list_type == "signal_list")
        iconType = "wifi"
      else if (list.list_type == "mining_job")
        iconType = "cloudDownload"
      if(list.list_type)
        lists.push(SideMenuListOption({list: list, 
                                       iconType: iconType, 
                                       changeList: this.props.changeList}))
      else 
        lists.push(SideMenuListOption({list: list, 
                                       changeList: this.props.changeList}))
    }

    return (
      React.DOM.div({className: "col-lg-2 col-md-2 col-sm-2 col-xs-2", 
           style: {padding:'0',height:'438px',backgroundColor:'#e0e9ee',
                   borderRight:'1px solid #b0b8bf',textAlign:'center'}}, 
                   React.DOM.div({className: "prospect-list-header", style: {paddingLeft:10, textAlign:'center'}}, 
                     "Lists"

                   ), 
        React.DOM.div({className: "btn-group-vertical", 
             style: {width:'100%', height: '320px', overflow: 'auto'}}, 
          lists
        ), 
        React.DOM.br(null), React.DOM.br(null), 
        React.DOM.a({href: "javascript:", className: "btn btn-primary new-list-btn", 
              'data-toggle': "modal", 'data-target': ".bs-example-modal-sm", 
              style: { backgroundImage: 'linear-gradient(180deg, #0096ff 0%, #005dff 100%)'}}, 
          React.DOM.i({className: "fa fa-plus-circle"}), "  New List"
        ), 
        CreateListModal({createList: this.createList, 
                         updateList: this.updateList, 
                         listClassName: this.props.listClassName}), " ", React.DOM.br(null)
      )
    );
  },

  createList: function(data) { 
    this.setState({ lists: [data].concat(this.state.lists) }) 
  },

  updateList: function(_id, objId) {
    updated = _.map(this.state.lists, function(list) {
      if(list.tmp == _id)
          list.objectId = objId
      return list
    })
    console.log("update broski")
    this.setState({lists: updated})
  },

  renameList: function(newListName) {
    thiss = this;
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.name == thiss.state.currentList) {
        item.name = newListName
        return item
      }
      return item
    });

    this.setState({lists : filtered, currentList: newListName})

    $('.modal').click()
    $('#newListName').val('')
    $('.modal-backdrop').click()

    Parse.update(this.props.listClassName, {'name':newListName})
  },

  deleteList: function() {
    var filtered = _.filter(this.state.lists, function(item) {
      if(item.objectId == thiss.state.currentListObjectId)
        return false
      return true
    });

    this.setState({lists: filtered, currentList: 'All'})
    this.changeList('All', '')

    appConfig.closeModal(); 
    $('#newListName').val('');
    Parse.delete(this.props.listClassName+'/'+this.state.currentListObjectId);
  },
});

var CurrentLists = React.createClass({displayName: 'CurrentLists',
  listAction: function(e) {
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == $(e.target).text()
    });

    this.props.moveSelectedProspects(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
            className: "dropdown-list-name", 
            href: "javascript:", 
            onClick: this.listAction}, this.props.lists[i].name))
      )
    }
    //console.log(this.props.copyDropdownStyle)
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {right:-23,top:27}}, 
        lists
      )
    );
  }
});

var CurrentListsTwo = React.createClass({displayName: 'CurrentListsTwo',
  listAction: function(e) {
    listName = $(e.target).text()
    
    var listSelect = _.filter(this.props.lists, function(item) {
       return item.name == listName
    });

    this.props.copySelectedProspects(listSelect[0].objectId)
  },

  render: function() {
    lists = [] 
    for(i=0;i< this.props.lists.length;i++) {
      lists.push(
        React.DOM.li(null, React.DOM.a({style: {fontWeight:'bold',fontSize:'10px'}, 
               className: "dropdown-list-name", 
               href: "javascript:", 
               onClick: this.listAction}, 
          this.props.lists[i].name))
      )
    }
    return (
      React.DOM.ul({className: "dropdown-menu drop-test", id: "dropdown", 
          style: {width:114,right:-71,top:27}}, 
        lists
      )
    );
  }
});

},{"./create_list_modal.js.min.js":1,"./delete_list_modal.js.min.js":3,"./messenger.js.min.js":6,"./rename_list_modal.js.min.js":9,"./user_side_menu_list.js.min.js":14}],11:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // Spinner
  render: function() {
    circleStyle=(this.props.circleStyle) ? this.props.circleStyle : {}
    spinnerStyle=this.props.spinnerStyle ? this.props.spinnerStyle : {}
    return (
      React.DOM.div({className: "spinner", style: spinnerStyle}, 
        React.DOM.div({className: "spinner-container container1"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        ), 
        React.DOM.div({className: "spinner-container container2"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        ), 
        React.DOM.div({className: "spinner-container container3"}, 
          React.DOM.div({className: "circle1", style: circleStyle}), 
          React.DOM.div({className: "circle2", style: circleStyle}), 
          React.DOM.div({className: "circle3", style: circleStyle}), 
          React.DOM.div({className: "circle4", style: circleStyle})
        )
      )

    )
  },
})

},{}],12:[function(require,module,exports){
/** @jsx React.DOM */
var HorizantalSpinner = require('./horizantal_spinner.js.min.js')
var LoadingSpinner = require('./loading_spinner.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    loading  = true
    if(this.props.prospect.company)
      if(this.props.prospect.company.email_pattern)
        loading  = false
    if(!this.props.prospect.company_name.length)
      loading = false
    return { 
      prospect: this.props.prospect,
      checked: false,
      initialLoading: loading,
      loading: loading,
      editMode: false,
      mouseOver: false
    }
  },

  mouseEnter: function() {
    this.setState({mouseOver: true})
  },

  mouseLeave: function() {
    this.setState({mouseOver: false})
  },

  clickCheck: function(e) {
    e.stopPropagation()
    domNode = this.getDOMNode()
    //isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    isChecked = $($(domNode).find('input[type="checkbox"]')[0]).prop('checked')
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
    //console.log(isChecked)
    this.setState({checked: isChecked})
    this.props.checkboxAction(isChecked, this.state.prospect.objectId)
  },

  rowClick: function() {
    $($(this.getDOMNode()).find('input[type="checkbox"]')[0]).click()
  },

  keyboardClick: function() {
    $($('.keySelect').find('input[type="checkbox"]')[0]).click()
  },

  componentDidUpdate: function() {
    //
  },

  _make_email: function(name, pattern) {
    name = name.trim()
    vars = {
      first_name: _.first(name.split(' ')),
      last_name: _.last(name.split(' ')),
      first_initial: _.first(name.split(' '))[0],
      last_initial: _.last(name.split(' '))[0],
      domain: prospect.company.domain
    }
    pattern = (pattern[0]) ? pattern[0].pattern : ""
    prospect_email = Mustache.render(pattern, vars).toLowerCase()
    //console.debug('PROSPECT EMAIL')
    //console.debug(prospect_email)
    return ReadOnlyForm({icon: "envelope", value: prospect_email})
  },

  realtimeCompanyInfo: function() {
    var _this = this;
    channel.bind(this.state.prospect.company_name.replace(' ','-'), function(data) {
      _prospect = _this.state.prospect; _prospect.company = data.company;
      _this.setState({prospect: _prospect})
      console.log(data.company)
      console.log('no listening for email')
      if(_prospect.company.email_pattern){
         _this.setState({loading: false}) 
      } else {
        console.log('binding for email pattern')
        console.log(data.company.domain)
        _this.realtimeEmailPattern(data.company.domain)
      }
    });
  },

  realtimeEmailPattern: function(domain) {
    var _this = this;
    channel.bind(domain, function(data) {
      // add email pattern
      console.log('got email pattern')
      console.log(data)
      console.log(_this.state.prospect)
      _prospect = _this.state.prospect
      if(_prospect.company)
        _prospect.company.email_pattern = data.email_pattern
      else
        _prospect.company= {'email_pattern': data.email_pattern}

      _this.setState({prospect: prospect})
      _this.setState({loading: false})
    })
  },

  componentDidMount: function() { 
    //TODO - start if loading is true 
    //if(this.state.loading){
      if(this.state.prospect.company)
        this.realtimeEmailPattern(this.state.prospect.company.domain)
      else
        this.realtimeCompanyInfo(this.state.prospect.company_name)
    //}
  },

  _keyboardShortcuts: function() {
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
    thissss = this
    if(this.props.keyboardSelected) {
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
      Mousetrap.unbind('x')
      Mousetrap.bind('x', function() { 
        thissss.keyboardClick()
        if(thissss.state.checked)
          console.log("lmao")
      });
    }
  },

  render: function() {
    prospect = this.state.prospect
    if(this.props.masterCheckboxChecked && this.state.checked)
      checked = true
    else if(this.props.alreadyChecked)
      checked = true
    else if(this.state.checked)
      checked = true
    else if(this.props.masterCheckboxChecked || this.state.checked)
      checked = true
    else
      checked = false

    checked        = this.state.checked || this.props.alreadyChecked
    color = (checked) ? {backgroundColor: '#eef8ff'} : {}
    infoColor = (checked) ? {backgroundColor: '#eef8ff',paddingBottom:2} : {paddingBottom:2}
    checkboxColor = (checked) ? {backgroundColor: '#eef8ff',verticalAlign:'middle'} : {verticalAlign:'middle'}
    company = (prospect.company) ? prospect.company : {}
    prospect_email = ReadOnlyForm({disabled: true, icon: "envelope", value: "No Email Found"})
    if(company.email_pattern)
      if(company.email_pattern.length)
        prospect_email = this._make_email(prospect.name, company.email_pattern)

    //console.log(prospect.name)
    if(prospect.name == "LinkedIn Member" || _.last(prospect.name) == ".")
      prospect_email = ReadOnlyForm({disabled: true, icon: "envelope", 
                                     value: "Ambiguous Name"})
    prospect_email = (this.state.loading) ? LoadingLabel(null) : prospect_email
    if(!this.props.prospect.company_name.length)
        prospect_email = ""

    if(company.phone && company.phone != "null")
      phone = React.DOM.div({style: {display:'block',paddingTop:2}}, ReadOnlyForm({icon: "phone", value: company.phone})) 
    else 
      phone = ""

    company_size   = (this.state.loading) ? LoadingLabel(null) : ""
    if(company.headcount){ 
      company_size = prospect.company.headcount+" employees" 
    }

    if(company.address)
      city = (company.address) ? company.address.normalizedLocation : prospect.locale
    else if(prospect.locale != "" && prospect.locale)
      city = prospect.locale
    else if(_.isEqual(company, {}))
      city = LoadingLabel(null)
    else
      city = ""

    company_url = (company.domain) ? ShinyButton({icon: "globe", link: "http://"+company.domain}) : ""
    position    = (prospect.title) ? prospect.title.trim() : ""

    prospect_company_name = prospect.company_name
    prospect_name = prospect.name
    if(!this.state.prospect.loading){
      if(typeof(prospect.company_name) == "undefined" || prospect.company_name == "" || prospect.company_name == "not_found")
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, formText: "Enter Company Name."}) 
      if(typeof(prospect.name) == "undefined" || prospect.name == "LinkedIn Member")
        prospect_name = UserUpdateForm({updateProspect: this.updateProspect, var: "name", formText: "Enter Full Name."}) 
      if(typeof(position) == "undefined" || position == "")
        position = UserUpdateForm({updateProspect: this.updateProspect, var: "pos", prospect: this.state.prospect, formText: "Enter Title."}) 
    }
    if(this.state.editMode){
        pcn = prospect_company_name; pn = prospect_name; pos = position;
        pcn = (pcn != "" && pcn) ? pcn : "Enter Company Name."
        pn  = (pn != "" && pn) ? pn : "Enter Full Name."
        pos = (pos != "" && pos) ? pos : "Enter Title."
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, value: pcn, single: 1}) 
        prospect_name = UserUpdateForm({updateProspect: this.updateProspect, var: "name", value: pn, single: 1}) 
        position = UserUpdateForm({updateProspect: this.updateProspect, var: "pos", prospect: this.state.prospect, value: pos, single: 1}) 
    }
    if(!this.props.prospect.company_name.length)
        prospect_company_name = UserUpdateForm({updateProspect: this.updateProspect, var: "company_name", prospect: this.state.prospect, formText: "Enter Company Name"}) 

    liProfileSimilars = (prospect.linkedin_url) ? React.DOM.a({onClick: this.openSimilars, style: {marginLeft:5, float:'right'}, href: "javascript:", className: "btn btn-xs btn-primary btn-gradient similar_link"}, " ", React.DOM.i({className: "fa fa-copy", style: {fontWeight:'bold'}})) : ""
    
    if(typeof(prospect_name) == "string")
      if(prospect_name.indexOf(".") != -1 || prospect_name == "LinkedIn Member")
        prospect_name = React.DOM.span(null, prospect_name, React.DOM.button({className: "btn btn-xs btn-default", style: {marginLeft:5,marginTop:-4,width:25,fontSize:11,lineHeight:1}, onClick: this.searchProspect}, " ", React.DOM.i({className: "fa fa-search"})))

    optionsMenu = React.DOM.div({style: {fontSize:10, cursor:'pointer',height:20,marginTop:-20}}, 
            React.DOM.a({className: "text-muted", onClick: this.toggleEditMode}, 
              React.DOM.i({className: (this.state.editMode) ? "fa fa-check" : "fa fa-pencil"})
            ), 
            React.DOM.a({className: "text-muted", onClick: this.searchProspect, style: {marginTop:5}}, 
              React.DOM.i({className: "fa fa-search"})
            ), 
            React.DOM.a({className: "text-muted", onClick: this.archiveProspects, 
              style: {marginTop:5}}, 
              React.DOM.i({className: "fa fa-archive"})
            )
            )
          
    keyboardSelected = {borderLeft:'7px solid rgba(0,0,0,0)'}
            //keyboardSelected = {}
    //
    if(this.props.keyboardSelected) {
      keyboardSelected = {borderLeft:'7px solid #0096ff !important'}
    }
    

    return (
      React.DOM.tr({className: "prospects-tr", 
          onClick: this.rowClick, 
          onMouseEnter: this.mouseEnter, 
          onMouseLeave: this.mouseLeave, 
          style: keyboardSelected}, 
          React.DOM.td({style: checkboxColor}, 
              React.DOM.input({type: "checkbox", 
                     onChange: this.clickCheck, 
                     style: {lineHeight:'normal',marginTop:-8,height:17}, 
                     checked: checked})
          ), 
          React.DOM.td({style: checkboxColor}, 
            (this.state.mouseOver) ? optionsMenu : React.DOM.div({style: {height:20}}, "   ")
          ), 
          React.DOM.td({style: checkboxColor}, 
           (this.state.loading) ? LoadingPulse(null) : "", 
           (!this.state.loading && this.state.initialLoading) ? React.DOM.i({className: "fa fa-check-circle ", style: {color:'rgb(0, 122, 265)',paddingLeft:6,}}) : ""
          ), 
          React.DOM.td({style: color, className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, prospect_name), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}}, " ", position, " ")
          ), 
          React.DOM.td({style: color, className: "fixed-data-column"}, 
            React.DOM.span({style: {fontWeight:'bold'}}, " ", prospect_company_name, " "), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px'}, className: "company-size"}, 
            company_size
            ), 
            React.DOM.h6({style: {fontWeight:'400',margin:'0px',display:'none',fontStyle:'italic'}, 
                className: "company-size"}, 
              (prospect.industry) ? prospect.industry : ""
            )
          ), 

          React.DOM.td({style: color}, 
            React.DOM.h6({style: {margin:'0px'}}, city)), 
          React.DOM.td({style: infoColor}, " ", prospect_email, " ", phone, " "), 
          React.DOM.td({style: color}, 
            React.DOM.div({style: {width:92,paddingTop:5,height:5}}, 
              React.DOM.a({href: "javascript:", 
                onClick: this.openLinkedinProfile, 
                className: "btn btn-xs btn-primary btn-gradient linkedin_link", 
                style: {float:'right',marginLeft:5}}, 
                React.DOM.i({className: "fa fa-linkedin-square"})), 
              "   ", 
              liProfileSimilars, 
              company_url
            )
          )
        )
    );
  },

  searchProspect: function(e) {
    e.preventDefault()
    e.stopPropagation()
    url = "http://www.google.com/#q="
    prospect = this.state.prospect
    name = (prospect.name != "LinkedIn Member") ? prospect.name : ""
    args = '-inurl:"/dir/" -inurl:"/find/" -inurl:"/updates"'
    if(name == "" && prospect.company_name != "not_found")
      linkedin = '"at '+prospect.company_name+'" site:linkedin.com '+args
    else
      linkedin = " site:linkedin.com/in/ OR site:linkedin.com/pub/ -site:linkedin.com/pub/dir/"
    window.open(url+name+" "+prospect.company_name+" "+prospect.title+linkedin)
  },

  archiveProspects: function() {
    console.log(this.getDOMNode())
    //$(this.getDOMNode()).click()
    this.props.archiveProspects([this.state.prospect.objectId])
  },

  toggleEditMode: function(e) {
    e.stopPropagation()
    this.setState({editMode: !this.state.editMode})
  },

  openTest: function() {
    e.stopPropagation()
  },

  openLinkedinProfile: function(e) {
    window.open(this.state.prospect.linkedin_url)
    e.stopPropagation()
  },

  emailInputClick: function(e) {e.stopPropagation() },

  openSimilars: function(e) {
    // TODO - move to backend
    console.log('similars')
    if(this.state.prospect.linkedin_url.indexOf('profile') != -1){
      urlargs = this.state.prospect.linkedin_url.split('?')[1].split('&')
      args = []
      for(i=0;i< urlargs.length; i++)
        args.push(urlargs[i].split('='))
      args = _.object(args)
    }
    window.open("https://www.linkedin.com/vsearch/p?pivotType=sim&pid="+args.id)
    e.stopPropagation()
  },

  deleteProspect: function() {
    this.props.deleteProspect(this.state.prospect.objectId, 'Prospect')
  },
  
  updateProspect: function(prop, value) {
    prospect = this.state.prospect
    prospect[prop] = value
    this.setState({prospect: prospect})
  },
  
  refresh: function(e) {
    e.preventDefault()
    e.stopPropagation()
    prospect = this.state.prospect
    console.log(prospect)

    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
      url:'http://127.0.0.1:5000/profile_detail',
      type:'GET',
      dataType:'json',
      data: prospect,
      //headers:appConfig.headers,
      success: function(res) { console.log(res)},
      error: function(err) { console.log(err.responseText) }
    })
  },
});

var UserUpdateForm = React.createClass({displayName: 'UserUpdateForm',
  getInitialState: function() {
    return {
      submitted: false,
      value: this.props.value
    }
  },

  formClick: function(e) { e.stopPropagation() },

  submitForm: function(e) {
    e.preventDefault()
    e.stopPropagation()
    this.props.updateProspect(this.props.var, $(e.target).find('input').val())
    this.setState({submitted: true})
    prospect = this.props.prospect
    prospect[this.props.var] = $(e.target).find('input').val()

    // persist
    data = {}
    varr = this.props.var
    val = $(e.target).find('input').val()
    data[varr] = val
    objectId = this.state.prospect.objectId

    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
      url:'http://127.0.0.1:5000/profile_detail',
      data: prospect,
      //headers:appConfig.headers,
      success: function(res) { console.log(res)},
      error: function(err) { console.log(err.responseText) }
    })

    /*
    $.ajax({
      url:'https://api.parse.com/1/classes/Prospect/'+objectId,
      type: 'PUT',
      data: JSON.stringify(data),
      headers: appConfig.headers,
      success: function(res) { console.log(res) 
        // sent current prospect state as data to 
        $.ajax({
          url:'https://nameless-retreat-3525.herokuapp.com/profile_detail',
          data: prospect,
          headers:appConfig.headers,
          success: function(res) { console.log(res)},
          error: function(err) { console.log(err.responseText) }
        })
      },
      error: function(err) { console.log(err.responseText) }
    })
    */
  },

  handleChange: function(event) {
    console.log(event.target.value)
    this.setState({value: event.target.value});
  },

  render: function() {
    //"Enter Website."
    btn = (this.state.submitted) ? "btn btn-xs btn-success" : "btn btn-xs btn-default"
    single = {display:'inline', width:22, marginLeft:5}
    single.display = (this.props.single) ? 'none' : 'inline'
    input = {width:'100%', display:'inline', height:24, marginBottom:6}
    input.width = (this.props.single) ? '100%' : '70%'
    return (
      React.DOM.form({onClick: this.formClick, onSubmit: this.submitForm}, 
        React.DOM.input({style: input, 
          type: "text", className: "form-control input-sm", 
          disabled: this.state.submitted, 
          onChange: this.handleChange, 
          value: this.state.value, 
          placeholder: this.props.formText}), 
        React.DOM.button({type: "submit", className: btn, 
          style: single}, 
          React.DOM.i({className: "fa fa-check"}))
      )
    )
  },

  profileSearch: function(e) {
    e.preventDefault()
    url = "http://www.google.com/#q="
    prospect = this.state.prospect
    name = (prospect.name != "LinkedIn Member") ? prospect.name : ""
    args = '-inurl:"/dir/" -inurl:"/find/" -inurl:"/updates"'
    if(name == "" && prospect.company_name != "not_found")
      linkedin = '"at '+prospect.company_name+'" site:linkedin.com '+args
    else
      linkedin = " site:linkedin.com/in/ OR site:linkedin.com/pub/ -site:linkedin.com/pub/dir/"
    window.open(url+name+" "+prospect.company_name+" "+prospect.pos+linkedin)
  },

  websiteSearch: function(e) {
    e.preventDefault()
    url = "http://www.google.com/#q="
    window.open(url+this.state.prospect.company_name+" site:linkedin.com/company")
  },

  _make_email: function(name, pattern) {
    name = name.trim()
    vars = {
      first_name: _.first(name.split(' ')),
      last_name: _.last(name.split(' ')),
      first_initial: _.first(name.split(' '))[0],
      last_initial: _.last(name.split(' '))[0],
      domain: prospect.company.domain
    }
    pattern = (pattern) ? pattern[0].pattern : ""
    prospect_email = Mustache.render(pattern, vars).toLowerCase()
    //console.debug('PROSPECT EMAIL')
    //console.debug(prospect_email)
    return ReadOnlyForm({icon: "envelope", value: prospect_email})

    if(prospect_email) {
        prospect_email = (prospect_email) ? prospect_email.toLowerCase() : ""
        prospect_email = React.DOM.input({onClick: this.emailInputClick, type: "text", value: prospect_email, className: "form-control form-sm", style: {fontSize:12, width:160, height:22, marginTop: 0}})
        prospect_email = React.DOM.div({className: "input-group input-group-xs"}, 
          React.DOM.span({className: "input-group-addon", id: "sizing-addon3", style: {paddingTop:2,paddingBottom:2}}, 
            React.DOM.i({className: "fa fa-envelope"})
          ), 
          prospect_email
        )
    }
    return email
  },
})

var ReadOnlyForm = React.createClass({displayName: 'ReadOnlyForm',
  render: function() {
    style = {fontSize:12, width:'70%', height:22, marginTop: 0, zIndex:1,cursor:'default'}

    style.fontStyle = (this.props.disabled) ? 'italic' : ''
    return (
      React.DOM.div({className: "input-group input-group-xs", style: {display:'inline-block'}}, 
        React.DOM.span({className: "input-group-addon", id: "sizing-addon3", 
          style: {paddingTop:2,paddingBottom:2,display:'inline-block',
                  height:22,width:37,float:'left',marginTop:0}}, 
          React.DOM.i({className: "fa fa-"+this.props.icon})
        ), 
          React.DOM.input({disabled: this.props.disabled, onClick: this.emailInputClick, type: "text", value: this.props.value, className: "form-control form-sm", style: style})
      )
    )
  },
  emailInputClick: function(e) {
    e.stopPropagation()
  }
})

var LoadingLabel = React.createClass({displayName: 'LoadingLabel',
  render: function() {
    return (
        React.DOM.label({className: "label label-primary", style: {backgroundColor: 'rgb(0, 122, 265)'}}, "Loading...")
    )
  }   
})

var WarningLabel = React.createClass({displayName: 'WarningLabel',
  render: function() {
    return (
        React.DOM.label({className: "label label-warning", style: {display:'block',width:'90%'}}, "Warning...")
    )
  }   
})

var ShinyButton = React.createClass({displayName: 'ShinyButton',
  openLink: function(e) {
    e.stopPropagation()
    window.open(this.props.link)
  },

  render: function() {
    return (
      React.DOM.a({href: "javascript:", 
         onClick: this.openLink, 
         className: "btn btn-xs btn-primary btn-gradient", 
         style: {marginLeft:-5, float:'right'}}, 
       React.DOM.i({className: "fa fa-globe"})
      )
    )
  }
})

var LoadingPulse = React.createClass({displayName: 'LoadingPulse',
  render: function() {
    return (
      React.DOM.div({className: "profile-loading", style: {marginTop:0}}, 
        React.DOM.div({className: "double-bounce1", style: {backgroundColor:'rgb(0, 122, 265)'}}), 
        React.DOM.div({className: "double-bounce2", style: {backgroundColor:'rgb(0, 122, 265)'}})
      )
    )
  }
})

},{"./horizantal_spinner.js.min.js":4,"./loading_spinner.js.min.js":5}],13:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  checkboxAction: function(e) {
    checkboxVal = $(e.target).is(':checked')
    checkboxes = _.rest($('body').find('input[type="checkbox"]'))
    console.log(checkboxes)
    if(checkboxVal){
      _.map(checkboxes, function(checkbox){
        if(!$(checkbox).prop('checked'))
          $(checkbox).click()
      })
      
    } else {
      _.map(checkboxes, function(checkbox){
        if($(checkbox).prop('checked'))
          $(checkbox).click()
      })
    }
  },

  componentDidMount: function() {

  },

  render: function() {
    return (
            React.DOM.tr(null, 
              React.DOM.th({style: {paddingLeft:11}}, 
                React.DOM.input({type: "checkbox", onChange: this.checkboxAction})
              ), 
              React.DOM.th({style: {width:20}}), 
              React.DOM.th(null), 
              React.DOM.th(null, "Name"), 
              React.DOM.th(null, "Company"), 
              React.DOM.th({style: {width:'170px'}}, "City"), 
              React.DOM.th({style: {width:300}}, "Email"), 
              React.DOM.th(null, " ")
            )
    );
  }
});

},{}],14:[function(require,module,exports){
/** @jsx React.DOM */
//TODO - move list
//TODO - copy list
//TODO - create new list

module.exports = React.createClass({displayName: 'exports',
  //SideMenuListOption
  getInitialState: function() {
    return {
      count: '~',
    }
  },


  componentDidMount: function() {
  },

  changeList: function() {
    this.props.changeList(this.props.list.name, this.props.list.objectId)
  },

  getIconType: function(iconType) {
    icon = ""
    if(iconType == "archive"){
      icon = React.DOM.i({className: "fa fa-archive", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "users"){
      icon = React.DOM.i({className: "fa fa-user", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "wifi"){
      icon = React.DOM.i({className: "fa fa-wifi", style: {float:'left',lineHeight:1.5,marginRight:5}})
    } else if(iconType == "cloudDownload"){
      icon = React.DOM.i({className: "fa fa-cloud-download", style: {float:'left',lineHeight:1.5,marginRight:5}})
    }
    return icon
  },

  render: function() {
    listName = this.props.list.name
    propsCount = this.props.count
    count = (typeof(propsCount)== "undefined") ? this.state.count : propsCount

    icon = ""
    listStyle=(icon == "") ? "list-name" : "icon-list-name"
    if(this.props.iconType == "users")
      listStyle = "all-list-name" 
    count = React.DOM.div({className: "badge badge-default cnt-bg"}, this.props.list.count)
    count = (this.props.hideCount) ? "" : count
    return (
      React.DOM.button({type: "button", 
              onClick: this.changeList, 
              className: "list-names btn btn-default"}, 
              icon, "   ", React.DOM.span({className: listStyle}, listName), " ", count
      )
    );
  }
});


},{}]},{},[8])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcHJvc3BlY3RzLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvcmVuYW1lX2xpc3RfbW9kYWwuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zaWRlX21lbnVfdXNlcl9wcm9zcGVjdHMuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zcGlubmVyLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9wcm9zcGVjdC5qcy5taW4uanMiLCIvVXNlcnMvcm9iaW4vUHJvamVjdHMvcHJvc3BlY3Rlci9wcm9zcGVjdGVyLXBhcnNlL2Rldi9idWlsZC9qcy9jb21wb25lbnRzL3VzZXJfcHJvc3BlY3RfaGVhZGVyLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQWpGQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUE5SkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUExRkE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBZEE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBN0JBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBckJBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDek1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN2lCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3Rocm93IG5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIil9dmFyIGY9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGYuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sZixmLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG4vL1RPRE8gLSBhYnN0cmFjdCBsaXN0c1xuLy9UT0RPIC0gcmVuYW1lIHRoaXNcbnZhciBMaXN0cyA9IHJlcXVpcmUoJy4vc2lkZV9tZW51X3VzZXJfcHJvc3BlY3RzLmpzLm1pbi5qcycpOyBcblxudmFyIFVzZXJQcm9zcGVjdEhlYWRlciA9IHJlcXVpcmUoJy4vdXNlcl9wcm9zcGVjdF9oZWFkZXIuanMubWluLmpzJyk7XG52YXIgVXNlclByb3NwZWN0Um93ID0gcmVxdWlyZSgnLi91c2VyX3Byb3NwZWN0LmpzLm1pbi5qcycpO1xuXG4vL3ZhciBDb21wYW55UHJvc3BlY3RIZWFkZXJcbnZhciBDb21wYW55UHJvc3BlY3RSb3cgPSByZXF1aXJlKCcuL2RhdGFfcm93LmpzLm1pbi5qcycpO1xudmFyIExvYWRpbmdTcGlubmVyID0gcmVxdWlyZSgnLi9sb2FkaW5nX3NwaW5uZXIuanMubWluLmpzJylcbnZhciBTcGlubmVyID0gcmVxdWlyZSgnLi9zcGlubmVyLmpzLm1pbi5qcycpXG52YXIgTWVzc2VuZ2VyID0gcmVxdWlyZSgnLi9tZXNzZW5nZXIuanMubWluLmpzJylcbnZhciBQYW5lbEZvb3RpbmcgPSByZXF1aXJlKCcuL3BhbmVsX2Zvb3RpbmcuanMubWluLmpzJylcblxuLy92YXIgQ3JlYXRlUHJvc3BlY3RMaXN0RnJvbUNvbXBhbnlMaXN0TW9kYWwgPSByZXF1aXJlKCcuL2NyZWF0ZV9wcm9zcGVjdF9saXN0X2Zyb21fY29tcGFueV9saXN0LmpzLm1pbi5qcycpXG4vL3ZhciBDcmVhdGVQcm9zcGVjdFByb2ZpbGVNb2RhbCA9IHJlcXVpcmUoJy4vY3JlYXRlX3RpdGxlX21pbmluZ19qb2IuanMubWluLmpzJylcbi8qXG4gICAgICA8Q3JlYXRlUHJvc3BlY3RMaXN0RnJvbUNvbXBhbnlMaXN0TW9kYWwgXG4gICAgICAgIGN1cnJlbnRMaXN0PXt0aGlzLnN0YXRlLmN1cnJlbnRMaXN0fSBcbiAgICAgICAgY3VycmVudExpc3RPYmplY3RJZD17dGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkfS8+XG4gICAgICA8Q3JlYXRlUHJvc3BlY3RQcm9maWxlTW9kYWwgXG4gICAgICAgIGN1cnJlbnRMaXN0PXt0aGlzLnN0YXRlLmN1cnJlbnRMaXN0fSBcbiAgICAgICAgY3VycmVudExpc3RPYmplY3RJZD17dGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkfS8+XG4gICAgICA8UmVuYW1lTGlzdE1vZGFsIHJlbmFtZUxpc3Q9e3RoaXMucHJvcHMucmVuYW1lTGlzdH0vPlxuICAgICAgPERlbGV0ZUxpc3RNb2RhbCBkZWxldGVMaXN0PXt0aGlzLnByb3BzLmRlbGV0ZUxpc3R9Lz5cbiovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHsgIHByb3NwZWN0cyAgIDogW10sXG4gICAgICAgICAgICAgIGN1cnJlbnRQYWdlIDogMSxcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZSxcbiAgICAgICAgICAgICAgbGlzdENsYXNzTmFtZTogdGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLFxuICAgICAgICAgICAgICBwYWdlcyAgICAgICA6IDEsXG4gICAgICAgICAgICAgIGN1cnJlbnRMaXN0IDogJ0FsbCcsXG4gICAgICAgICAgICAgIGN1cnJlbnRMaXN0T2JqZWN0SWQgOiAnJyxcbiAgICAgICAgICAgICAgbG9hZGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgcGFnaW5hdGluZzogZmFsc2UsXG4gICAgICAgICAgICAgIHByb3NwZWN0c1BlclBhZ2U6IDUwLFxuICAgICAgICAgICAgICBkb3dubG9hZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgIGxpc3RzIDogW10sXG4gICAgICAgICAgICAgIG1hc3RlckNoZWNrYm94Q2hlY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgIGtleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDAsIC8vZmlyc3RcbiAgICAgICAgICAgICAgLy9zZWxlY3RlZFByb3NwZWN0czogW10sXG4gICAgICAgICAgICAgIHRvdGFsQ291bnQgIDogXCJ+XCIsIFxuICAgICAgICAgICAgICBkZXRhaWxNb2RlOiBmYWxzZSxcbiAgICAgICAgICAgICAgZGV0YWlsQ29tcGFueToge30sXG4gICAgICAgICAgICAgIGNvdW50ICAgICAgIDogXCJ+XCIsIH1cbiAgfSxcblxuICBzZXRQYWdpbmF0ZTogZnVuY3Rpb24odmFsdWUpIHsgdGhpcy5zZXRTdGF0ZSh7cGFnaW5hdGluZzogdmFsdWV9KSB9LFxuICBzZXREb3dubG9hZGluZzogZnVuY3Rpb24odmFsdWUpIHsgdGhpcy5zZXRTdGF0ZSh7ZG93bmxvYWRpbmc6IHZhbHVlfSkgfSxcbiAgcmVtb3ZlUHJvc3BlY3RzOiBmdW5jdGlvbihvYmpBcnJheSkge1xuICAgIF9wcm9zcGVjdHMgPSBfLm1hcCh0aGlzLnN0YXRlLnByb3NwZWN0cywgZnVuY3Rpb24ocHJvc3BlY3QpIHtcbiAgICAgIGNvbnNvbGUubG9nKG9iakFycmF5LmluZGV4T2YocHJvc3BlY3Qub2JqZWN0SWQpID09IC0xKVxuICAgICAgaWYob2JqQXJyYXkuaW5kZXhPZihwcm9zcGVjdC5vYmplY3RJZCkgPT0gLTEpe1xuICAgICAgICAgIHJldHVybiBwcm9zcGVjdFxuICAgICAgfVxuICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7cHJvc3BlY3RzOiBfLmNvbXBhY3QoX3Byb3NwZWN0cyl9KVxuICB9LFxuXG4gIGFyY2hpdmVQcm9zcGVjdHM6IGZ1bmN0aW9uKG9iamVjdHMpIHtcbiAgICBjb25zb2xlLmxvZygnQVJDSElWRScpXG4gICAgb2JqZWN0cyA9IChvYmplY3RzKSA/IG9iamVjdHMgOiBbXVxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBzZWxlY3RlZFByb3NwZWN0cy5jb25jYXQob2JqZWN0cylcbiAgICBxcnkgPSB7J2FyY2hpdmVkJzp0cnVlfVxuICAgIGNvbnNvbGUubG9nKCdzdGFydGluZyBwYXJzZSBhcmNoaXZlJylcbiAgICBQYXJzZS5iYXRjaFVwZGF0ZSh0aGlzLnN0YXRlLmNsYXNzTmFtZSwgc2VsZWN0ZWRQcm9zcGVjdHMsIHFyeSkuZG9uZShmdW5jdGlvbihyZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICB9KVxuICAgIHRoaXMucmVtb3ZlUHJvc3BlY3RzKHNlbGVjdGVkUHJvc3BlY3RzKVxuICAgIHRvdGFsQ291bnQgPSB0aGlzLnN0YXRlLnRvdGFsQ291bnRcbiAgICB0aGlzLnNldFN0YXRlKHt0b3RhbENvdW50IDogdG90YWxDb3VudCAtIDF9KVxuXG4gICAgc2VsZWN0ZWQgPSBfLm1hcCh0aGlzLnN0YXRlLnByb3NwZWN0cywgZnVuY3Rpb24ocHJvc3BlY3QpIHtcbiAgICAgIGlmKHNlbGVjdGVkUHJvc3BlY3RzLmluZGV4T2YocHJvc3BlY3Qub2JqZWN0SWQpICE9IC0xKVxuICAgICAgICByZXR1cm4gcHJvc3BlY3RcbiAgICB9KVxuXG4gICAgc2VsZWN0ZWQgPSBfLmNvbXBhY3Qoc2VsZWN0ZWQpXG4gICAgc2VsZWN0ZWQgPSBfLnBsdWNrKHNlbGVjdGVkLCAnbGlzdHMnKVxuICAgIHNlbGVjdGVkID0gXy5mbGF0dGVuKHNlbGVjdGVkKVxuICAgIHNlbGVjdGVkID0gXy5wbHVjayhzZWxlY3RlZCwgJ29iamVjdElkJylcbiAgICBzZWxlY3RlZCA9IF8uY29tcGFjdChzZWxlY3RlZClcblxuICAgIF8ubWFwKHNlbGVjdGVkLCBmdW5jdGlvbihsaXN0X2lkKSB7XG4gICAgICBkZWNyZW1lbnQgPSB7Y291bnQ6IHtfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiAtMX19XG4gICAgICBQYXJzZS5wdXQoJ1Byb3NwZWN0TGlzdC8nK2xpc3RfaWQsIGRlY3JlbWVudCwgZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0pXG4gICAgfSlcbiAgfSxcblxuICBjaGFuZ2VMaXN0OiBmdW5jdGlvbihuZXdMaXN0TmFtZSwgb2JqZWN0SWQpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShbXSlcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGN1cnJlbnRMaXN0IDogbmV3TGlzdE5hbWUsXG4gICAgICBjdXJyZW50TGlzdE9iamVjdElkIDogb2JqZWN0SWQsXG4gICAgICBwcm9zcGVjdHMgIDogW10sICAgIFxuICAgICAgY291bnQgICAgICA6ICd+JyxcbiAgICAgIHBhZ2VzICAgICAgOiAxLFxuICAgICAgbG9hZGluZyAgICA6IHRydWUsXG4gICAgICBjdXJyZW50UGFnZTogMSxcbiAgICAgIGtleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDBcbiAgICB9KVxuXG4gICAgcXJ5ID0ge2luY2x1ZGU6ICdjb21wYW55JywgbGltaXQ6IHRoaXMuc3RhdGUucHJvc3BlY3RzUGVyUGFnZSwgY291bnQ6IHRydWV9XG4gICAgcXJ5LndoZXJlID0ge31cbiAgICBxcnkud2hlcmUuYXJjaGl2ZWQgPSB7JGluOltudWxsLCBmYWxzZV19XG4gICAgaWYgKG5ld0xpc3ROYW1lID09ICdBcmNoaXZlZCcpXG4gICAgICBxcnkud2hlcmUuYXJjaGl2ZWQgPSB0cnVlXG4gICAgZWxzZSBpZihuZXdMaXN0TmFtZSAhPSBcIkFsbFwiKVxuICAgICAgcXJ5LndoZXJlLmxpc3RzID0gUGFyc2UuX3BvaW50ZXIodGhpcy5zdGF0ZS5saXN0Q2xhc3NOYW1lLCBvYmplY3RJZClcbiAgICBxcnkud2hlcmUgPSBKU09OLnN0cmluZ2lmeShxcnkud2hlcmUpXG4gICAgY29uc29sZS5sb2cocXJ5KVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBQYXJzZS5nZXQodGhpcy5zdGF0ZS5jbGFzc05hbWUsIHFyeSkuZG9uZShmdW5jdGlvbihyZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIF90aGlzLnNldFN0YXRlKHtcbiAgICAgICAgcHJvc3BlY3RzOiByZXMucmVzdWx0cyxcbiAgICAgICAgY291bnQ6IHJlcy5jb3VudCxcbiAgICAgICAgcGFnZXM6IE1hdGguY2VpbChyZXMuY291bnQvX3RoaXMucHJvcHMucHJvc3BlY3RzUGVyUGFnZSksXG4gICAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgfSlcbiAgICB9KVxuICB9LFxuXG4gIGNoZWNrYm94QWN0aW9uOiBmdW5jdGlvbihjaGVja2VkU3RhdGUsIG9iaikge1xuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgaWYoY2hlY2tlZFN0YXRlKVxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMucHVzaChvYmopXG4gICAgZWxzZVxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBfLnJlamVjdChzZWxlY3RlZFByb3NwZWN0cyxmdW5jdGlvbihpZCl7cmV0dXJuIGlkID09IG9ian0pXG5cbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IF8udW5pcShzZWxlY3RlZFByb3NwZWN0cylcbiAgICBjb25zb2xlLmxvZyhzZWxlY3RlZFByb3NwZWN0cylcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnN0cmluZ2lmeShzZWxlY3RlZFByb3NwZWN0cylcbiAgICAvL3RoaXMuc2V0U3RhdGUoe3NlbGVjdGVkUHJvc3BlY3RzOiBzZWxlY3RlZFByb3NwZWN0c30pXG4gIH0sXG5cbiAgbWFzdGVyQ2hlY2tib3hDaGFuZ2VkOiBmdW5jdGlvbihtYXN0ZXJDaGVja2JveFZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7bWFzdGVyQ2hlY2tib3hDaGVja2VkOiBtYXN0ZXJDaGVja2JveFZhbHVlfSlcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3RhcnRLZXlib2FyZFNob3J0Y3V0cygpXG4gICAgJCgnYm9keScpLmNzcyh7b3ZlcmZsb3c6J2F1dG8nfSlcblxuICAgIHByb3NwZWN0cyA9IFtdXG4gICAgZm9yKGk9MDtpPCB0aGlzLnN0YXRlLnByb3NwZWN0cy5sZW5ndGg7aSsrKSB7XG4gICAgICB1cmwgPSB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXS51cmxcbiAgICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdHNbaV1cblxuICAgICAga2V5Ym9hcmRTZWxlY3RlZCA9IChpID09IHRoaXMuc3RhdGUua2V5Ym9hcmRBY3RpdmVQcm9zcGVjdClcblxuICAgICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICAgIGFscmVhZHlDaGVja2VkPWZhbHNlXG4gICAgICBmb3IoaWk9MDtpaTwgc2VsZWN0ZWRQcm9zcGVjdHMubGVuZ3RoO2lpKyspXG4gICAgICAgIGlmKHByb3NwZWN0Lm9iamVjdElkID09IHNlbGVjdGVkUHJvc3BlY3RzW2lpXSlcbiAgICAgICAgICBhbHJlYWR5Q2hlY2tlZCA9IHRydWVcblxuICAgICAgLy9jb25zb2xlLmxvZyhhbHJlYWR5Q2hlY2tlZClcblxuICAgICAgaWYodGhpcy5zdGF0ZS5jbGFzc05hbWUgPT0gXCJQcm9zcGVjdFwiKSB7IFxuICAgICAgcHJvc3BlY3RzLnB1c2goXG4gICAgICAgIFVzZXJQcm9zcGVjdFJvdyh7ZGVsZXRlUHJvc3BlY3Q6IHRoaXMuZGVsZXRlUHJvc3BlY3QsIFxuICAgICAgICAgICAgICAgICAgICAgIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXSwgXG4gICAgICAgICAgICAgICAgICAgICAgbWFzdGVyQ2hlY2tib3hDaGVja2VkOiB0aGlzLnN0YXRlLm1hc3RlckNoZWNrYm94Q2hlY2tlZCwgXG4gICAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLmdlbmVyYXRlX2lkKCksIFxuICAgICAgICAgICAgICAgICAgICAgIGxpbms6IFwiXCIsIFxuICAgICAgICAgICAgICAgICAgICAgIGFyY2hpdmVQcm9zcGVjdHM6IHRoaXMuYXJjaGl2ZVByb3NwZWN0cywgXG4gICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmRTZWxlY3RlZDoga2V5Ym9hcmRTZWxlY3RlZCwgXG4gICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeUNoZWNrZWQ6IGFscmVhZHlDaGVja2VkLCBcbiAgICAgICAgICAgICAgICAgICAgICBjaGVja2JveEFjdGlvbjogdGhpcy5jaGVja2JveEFjdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgKVxuICAgICAgfSBlbHNlIHsgXG4gICAgICAgIHByb3NwZWN0cy5wdXNoKFxuICAgICAgICAgIENvbXBhbnlQcm9zcGVjdFJvdyh7ZGVsZXRlUHJvc3BlY3Q6IHRoaXMuZGVsZXRlUHJvc3BlY3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0c1tpXSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyQ2hlY2tib3hDaGVja2VkOiB0aGlzLnN0YXRlLm1hc3RlckNoZWNrYm94Q2hlY2tlZCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5OiB0aGlzLmdlbmVyYXRlX2lkKCksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms6IFwiXCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkU2VsZWN0ZWQ6IGtleWJvYXJkU2VsZWN0ZWQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscmVhZHlDaGVja2VkOiBhbHJlYWR5Q2hlY2tlZCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hBY3Rpb246IHRoaXMuY2hlY2tib3hBY3Rpb259KVxuICAgICAgICApXG4gICAgICB9XG5cbiAgICAgICQoJyNwcm9zcGVjdERldGFpbEJ1dHRvbnMnKS5jbGljayhmdW5jdGlvbihlKSB7XG4gICAgICAgIC8vZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAvL3NldFRpbWVvdXQoZnVuY3Rpb24oKXsgJCgnLmRyb3Bkb3duJykuc2hvdygpIH0sIDMwKTtcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYodGhpcy5zdGF0ZS5jdXJyZW50TGlzdCA9PSBcIkFsbFwiKXtcbiAgICAgIGxpc3RUeXBlID0ge2Rpc3BsYXk6J25vbmUnfVxuICAgICAgbGlzdE5hbWVTdHlsZSA9IHtkaXNwbGF5Oidub25lJ31cbiAgICAgIGxpc3RCdG4gPSB7ZGlzcGxheTonbm9uZSd9XG4gICAgICBsaXN0T3B0aW9ucyA9IHtkaXNwbGF5Oidub25lJ31cbiAgICAgIGNvcHlEcm9wZG93blN0eWxlID0ge3dpZHRoOjExNCwgcmlnaHQ6NH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGlzdFR5cGUgPSB7ZmxvYXQ6J2xlZnQnfVxuICAgICAgbGlzdE5hbWVTdHlsZSA9IHtmbG9hdDonbGVmdCcsZGlzcGxheTonaW5saW5lLWJsb2NrJywgZm9udFdlaWdodDogMjAwLCBtYXJnaW5Ub3A6IDEsIHBhZGRpbmdSaWdodDogMTAsIG1hcmdpbkxlZnQ6IC0xMH1cbiAgICAgIGxpc3RCdG4gPSB7ZmxvYXQ6J2xlZnQnLG1hcmdpbkxlZnQ6NX1cbiAgICAgIGxpc3RPcHRpb25zID0ge2Zsb2F0OidyaWdodCd9XG4gICAgICBjb3B5RHJvcGRvd25TdHlsZSA9IHt3aWR0aDoxMTQsIHJpZ2h0OjM2fVxuICAgIH1cblxuICAgIGN1cnJlbnRMaXN0ICAgICA9IHRoaXMuc3RhdGUuY3VycmVudExpc3RcbiAgICBwYWdpbmF0ZU92ZXJsYXkgPSAodGhpcy5zdGF0ZS5wYWdpbmF0aW5nKSA/IFBhZ2luYXRlT3ZlcmxheShudWxsKSA6IFwiXCJcbiAgICBkb3dubG9hZEljb24gICAgPSAoIXRoaXMuc3RhdGUuZG93bmxvYWRpbmcpID8gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1kb3dubG9hZFwifSkgOiBTcGlubmVyKHtjaXJjbGVTdHlsZToge2JhY2tncm91bmRDb2xvcjond2hpdGUnLGhlaWdodDo0LHdpZHRoOjR9LCBzcGlubmVyU3R5bGU6IHtoZWlnaHQ6MTMsIHdpZHRoOjEzLG1hcmdpbjowLGRpc3BsYXk6J2lubGluZS1ibG9jaycscGFkZGluZ1RvcDoyfX0pXG4gICAgcHJvc3BlY3RUYWJsZVN0eWxlID0gKHRoaXMuc3RhdGUuY291bnQgPT0gMCkgPyB7ZGlzcGxheTonbm9uZSd9IDp7aGVpZ2h0Oic0MDBweCcsb3ZlcmZsb3c6J2F1dG8nfVxuXG4gICAgaGVhZGVyID0gKHRoaXMucHJvcHMuY2xhc3NOYW1lID09IFwiUHJvc3BlY3RcIikgPyBVc2VyUHJvc3BlY3RIZWFkZXIoe21hc3RlckNoZWNrYm94Q2hhbmdlZDogdGhpcy5tYXN0ZXJDaGVja2JveENoYW5nZWR9KSA6IENvbXBhbnlQcm9zcGVjdEhlYWRlcih7bWFzdGVyQ2hlY2tib3hDaGFuZ2VkOiB0aGlzLm1hc3RlckNoZWNrYm94Q2hhbmdlZH0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbnRhaW5lciBwcm9zcGVjdHMtY29udGFpbmVyXCJ9LCBcbiAgICAgICAgTGlzdHMoe2N1cnJlbnRMaXN0OiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0LCBcbiAgICAgICAgICAgICAgIGNvdW50OiB0aGlzLnN0YXRlLmNvdW50LCBcbiAgICAgICAgICAgICAgIGxpc3RDbGFzc05hbWU6IHRoaXMuc3RhdGUubGlzdENsYXNzTmFtZSwgXG4gICAgICAgICAgICAgICBjdXJyZW50TGlzdE9iamVjdElkOiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWQsIFxuICAgICAgICAgICAgICAgdG90YWxDb3VudDogdGhpcy5zdGF0ZS50b3RhbENvdW50LCBcbiAgICAgICAgICAgICAgIHJlbW92ZVByb3NwZWN0czogdGhpcy5yZW1vdmVQcm9zcGVjdHMsIFxuICAgICAgICAgICAgICAgY2hhbmdlTGlzdDogdGhpcy5jaGFuZ2VMaXN0LCBcbiAgICAgICAgICAgICAgIGNyZWF0ZUxpc3Q6IHRoaXMuY3JlYXRlTGlzdCwgXG4gICAgICAgICAgICAgICBsaXN0czogdGhpcy5zdGF0ZS5saXN0c30pLCBcblxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNvbC1sZy0xMCBjb2wtbWQtMTAgY29sLXNtLTEwIGNvbC14cy0xMFwiLCBzdHlsZToge3BhZGRpbmc6JzAnfX0sIFxuICAgICAgICAgICAgICBwYWdpbmF0ZU92ZXJsYXksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtpZDogXCJwcm9zcGVjdERldGFpbEJ1dHRvbnNcIn0sIFxuICAgICAgICAgICAgICAgIExpc3REZXRhaWxCdXR0b25zKHtcbiAgICAgICAgICAgICAgICAgIHJlbmFtZUxpc3Q6IHRoaXMucmVuYW1lTGlzdCwgXG4gICAgICAgICAgICAgICAgICBkZWxldGVMaXN0OiB0aGlzLmRlbGV0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgY3VycmVudExpc3ROYW1lOiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0LCBcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaXN0OiB0aGlzLnN0YXRlLmN1cnJlbnRMaXN0T2JqZWN0SWR9KSwgXG5cbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZHJvcGRvd25cIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIiwgXG4gICAgICAgICAgICAgICAgICAgICBpZDogXCJcIiwgXG4gICAgICAgICAgICAgICAgICAgICBzdHlsZTogbGlzdE9wdGlvbnN9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1iYXJzXCJ9KVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRyb3Bkb3duMSBjb3B5TGlzdFwiLCBzdHlsZToge2Rpc3BsYXk6J2lubGluZS1ibG9jaycsZmxvYXQ6J3JpZ2h0J319LCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHsnZGF0YS10b2dnbGUnOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiY29weVRvTGlzdFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcC10YXJnZXQgYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIn0sIFxuICAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jb3B5XCJ9KSwgXCIgwqBDb3B5IFRvIExpc3TCoFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2FyZXQtZG93blwifSkpLCBcbiAgICAgICAgICAgICAgICAgIEN1cnJlbnRMaXN0c1R3byh7bGlzdHM6IHRoaXMuc3RhdGUubGlzdHMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3B5RHJvcGRvd25TdHlsZTogY29weURyb3Bkb3duU3R5bGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvcHlTZWxlY3RlZFByb3NwZWN0czogdGhpcy5jb3B5U2VsZWN0ZWRQcm9zcGVjdHN9KVxuICAgICAgICAgICAgICAgICksIFxuICBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZHJvcGRvd24xIG1vdmVMaXN0XCIsIHN0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJyxmbG9hdDoncmlnaHQnfX0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoeydkYXRhLXRvZ2dsZSc6IFwiZHJvcGRvd25cIiwgXG4gICAgICAgICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgaWQ6IFwibW92ZVRvTGlzdFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnkgYnRuLXhzIGxpc3Qtb3B0aW9uc1wifSwgXG4gICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXNoYXJlXCJ9KSwgXCIgwqBNb3ZlIFRvIExpc3TCoFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2FyZXQtZG93blwifSkpLCBcbiAgICAgICAgICAgICAgICBDdXJyZW50TGlzdHMoe2xpc3RzOiB0aGlzLnN0YXRlLmxpc3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVTZWxlY3RlZFByb3NwZWN0czogdGhpcy5tb3ZlU2VsZWN0ZWRQcm9zcGVjdHN9KVxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe29uQ2xpY2s6IHRoaXMuZG93bmxvYWRGaWxlLCBcbiAgICAgICAgICAgICAgICAgICBocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgIGlkOiBcImRvd25sb2FkUHJvc3BlY3RzXCIsIFxuICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJkcm9wLXRhcmdldCBidG4gYnRuLXByaW1hcnkgYnRuLXhzIGxpc3Qtb3B0aW9uc1wifSwgXG4gICAgICAgICAgICAgICAgICAgZG93bmxvYWRJY29uLCBcbiAgICAgICAgICAgICAgICAgICBcIsKgIERvd25sb2FkIENTViDCoFwiIFxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5hcmNoaXZlUHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICBpZDogXCJkb3dubG9hZFByb3NwZWN0c1wiLCBcbiAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcC10YXJnZXQgYnRuIGJ0bi1wcmltYXJ5IGJ0bi14cyBsaXN0LW9wdGlvbnNcIn0sIFxuICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJjaGl2ZVwifSksIFxuICAgICAgICAgICAgICAgICAgIFwiwqAgQXJjaGl2ZSDCoFwiIFxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5sYXVuY2hQcm9zcGVjdFByb2ZpbGVNb2RhbCwgXG4gICAgICAgICAgICAgICAgICAgc3R5bGU6IHtkaXNwbGF5Oidub25lJ30sIFxuICAgICAgICAgICAgICAgICAgIGlkOiBcImRvd25sb2FkUHJvc3BlY3RzXCIsIFxuICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJkcm9wLXRhcmdldCBidG4gYnRuLXByaW1hcnkgYnRuLXhzIGxpc3Qtb3B0aW9uc1wifSwgXG4gICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jbG91ZC1kb3dubG9hZFwifSksIFxuICAgICAgICAgICAgICAgICAgIFwiwqAgRmluZCBQcm9zcGVjdHMgQnkgVGl0bGUgwqBcIiBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksIFxuICAgICAgICAgICh0aGlzLnN0YXRlLmNvdW50ID09IDApID8gRW1wdHlQZW9wbGVQcm9zcGVjdHNQYW5lbCh7Y2xhc3NOYW1lOiB0aGlzLnByb3BzLmNsYXNzTmFtZX0pICA6IFwiXCIsIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2lkOiBcImF1dG9zY3JvbGxcIiwgc3R5bGU6IHByb3NwZWN0VGFibGVTdHlsZX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLnRhYmxlKHtjbGFzc05hbWU6IFwicHJvc3BlY3RzLXRhYmxlIHRhYmxlIHRhYmxlLXN0cmlwZWRcIiwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHttYXJnaW5Cb3R0b206JzBweCd9fSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aGVhZCh7c3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6J3doaXRlJ319LCBcbiAgICAgICAgICAgICAgICBoZWFkZXJcbiAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50Ym9keShudWxsLCBcbiAgICAgICAgICAgICAgICBwcm9zcGVjdHNcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKSwgXCIgXCIsICh0aGlzLnN0YXRlLmxvYWRpbmcpID8gTG9hZGluZ1NwaW5uZXIobnVsbCkgOiBcIlwiXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApLCBcbiAgICAgIFBhbmVsRm9vdGluZyh7Y3VycmVudFBhZ2U6IHRoaXMuc3RhdGUuY3VycmVudFBhZ2UsIFxuICAgICAgICAgICAgICAgICAgICBjb3VudDogdGhpcy5zdGF0ZS5jb3VudCwgXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsQ291bnQ6IHRoaXMuc3RhdGUudG90YWxDb3VudCwgXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRlOiB0aGlzLnBhZ2luYXRlLCBcbiAgICAgICAgICAgICAgICAgICAgcHJvc3BlY3RUeXBlOiAnUHJvc3BlY3QnLCBcbiAgICAgICAgICAgICAgICAgICAgcHJvc3BlY3RzUGVyUGFnZTogdGhpcy5zdGF0ZS5wcm9zcGVjdHNQZXJQYWdlLCBcbiAgICAgICAgICAgICAgICAgICAgc2V0UGFnaW5hdGU6IHRoaXMuc2V0UGFnaW5hdGUsIFxuICAgICAgICAgICAgICAgICAgICBwYWdlczogdGhpcy5zdGF0ZS5wYWdlc30pLCBcbiAgICAgIE1lc3NlbmdlcihudWxsKVxuICAgIClcbiAgICApO1xuICB9LFxuXG4gIGxhdW5jaFByb3NwZWN0UHJvZmlsZU1vZGFsOiBmdW5jdGlvbigpeyAkKCcjY3JlYXRlUHJvc3BlY3RQcm9maWxlTW9kYWwnKS5tb2RhbCgpIH0sXG5cbiAgcGFnaW5hdGU6IGZ1bmN0aW9uKG5ld1Byb3NwZWN0cywgbmV3UGFnZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgcHJvc3BlY3RzOiBuZXdQcm9zcGVjdHMsXG4gICAgICBjdXJyZW50UGFnZTogbmV3UGFnZSxcbiAgICAgIGtleWJvYXJkQWN0aXZlUHJvc3BlY3Q6IDBcbiAgICB9KVxuICAgIHRoaXMuc3RhcnRLZXlib2FyZFNob3J0Y3V0cygpXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dG9zY3JvbGwnKS5zY3JvbGxUb3AgPSAwXG4gIH0sXG5cbiAgX21ha2VfZW1haWw6IGZ1bmN0aW9uKG5hbWUsIHBhdHRlcm4pIHtcbiAgICBuYW1lID0gbmFtZS50cmltKClcbiAgICB2YXJzID0ge1xuICAgICAgZmlyc3RfbmFtZTogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpLFxuICAgICAgbGFzdF9uYW1lOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKSxcbiAgICAgIGZpcnN0X2luaXRpYWw6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKVswXSxcbiAgICAgIGxhc3RfaW5pdGlhbDogXy5sYXN0KG5hbWUuc3BsaXQoJyAnKSlbMF0sXG4gICAgICBkb21haW46IHByb3NwZWN0LmNvbXBhbnkuZG9tYWluXG4gICAgfVxuICAgIHBhdHRlcm4gPSAocGF0dGVyblswXSkgPyBwYXR0ZXJuWzBdLnBhdHRlcm4gOiBcIlwiXG4gICAgcHJvc3BlY3RfZW1haWwgPSBNdXN0YWNoZS5yZW5kZXIocGF0dGVybiwgdmFycykudG9Mb3dlckNhc2UoKVxuICAgIC8vY29uc29sZS5kZWJ1ZygnUFJPU1BFQ1QgRU1BSUwnKVxuICAgIC8vY29uc29sZS5kZWJ1Zyhwcm9zcGVjdF9lbWFpbClcbiAgICByZXR1cm4gcHJvc3BlY3RfZW1haWxcbiAgfSxcblxuICBkb3dubG9hZEZpbGU6IGZ1bmN0aW9uKCkge1xuICAgIGlmKHRoaXMuc3RhdGUuY2xhc3NOYW1lID09IFwiUHJvc3BlY3RcIilcbiAgICAgIHRoaXMuZG93bmxvYWRQcm9zcGVjdHMoKVxuICAgIGVsc2VcbiAgICAgIHRoaXMuZG93bmxvYWRDb21wYW5pZXMoKVxuICB9LFxuXG4gIGRvd25sb2FkQ29tcGFuaWVzOiBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZygnZG93bmxvYWQgZmlsZScpXG4gICAgX2xpc3QgPSBQYXJzZS5fcG9pbnRlcignQ29tcGFueVByb3NwZWN0TGlzdCcsIHRoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgcmVzdWx0cyA9IF8ubWFwKFswLDEsMiwzLDQsNSw2LDcsOCw5XSwgZnVuY3Rpb24obnVtKSB7XG4gICAgICBxcnkgPSB7IGNvdW50OiAxLCBhcmNoaXZlZDogeyRpbjpbbnVsbCwgZmFsc2VdfSwgbGltaXQ6IDEwMDAsIHNraXA6IG51bSoxMDAwfVxuICAgICAgcXJ5LmluY2x1ZGUgPSAnY29tcGFueSxjb21wYW55LmVtYWlsX2d1ZXNzJ1xuICAgICAgaWYoX3RoaXMuc3RhdGUuY3VycmVudExpc3QgIT0gXCJBbGxcIilcbiAgICAgICAgcXJ5LndoZXJlID0gSlNPTi5zdHJpbmdpZnkoe2xpc3RzOiBfbGlzdH0pXG4gICAgICByZXR1cm4gUGFyc2UuZ2V0KF90aGlzLnN0YXRlLmNsYXNzTmFtZSwgcXJ5KVxuICAgIH0pXG5cbiAgICAkLndoZW4uYXBwbHkodGhpcywgcmVzdWx0cykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICBwcm9zcGVjdHMgPSBfLmZsYXR0ZW4oXy5tYXAoYXJndW1lbnRzLCBmdW5jdGlvbihhcmcpIHsgcmV0dXJuIGFyZ1swXS5yZXN1bHRzfSkpXG4gICAgICBwcm9zcGVjdHMgPSBfLm1hcChwcm9zcGVjdHMsIGZ1bmN0aW9uKHByb3NwZWN0KSB7XG4gICAgICAgIC8vIFRPRE8gLSBhZGQgZW1haWxcbiAgICAgICAgaWYocHJvc3BlY3QuY29tcGFueSkge1xuICAgICAgICAgIGNvbXBhbnkgPSBwcm9zcGVjdC5jb21wYW55XG4gICAgICAgICAgZGVsZXRlIGNvbXBhbnkubmFtZVxuICAgICAgICAgIF9rZXlzID0gXy5rZXlzKHByb3NwZWN0KS5jb25jYXQoXy5rZXlzKGNvbXBhbnkpKVxuICAgICAgICAgIF92YWx1ZXMgPSBfLnZhbHVlcyhwcm9zcGVjdCkuY29uY2F0KF8udmFsdWVzKGNvbXBhbnkpKVxuICAgICAgICAgIG9iaiA9IF8ub2JqZWN0KF9rZXlzLCBfdmFsdWVzKVxuICAgICAgICAgIG9iai5hZGRyZXNzID0gb2JqLm5vcm1hbGl6ZWRMb2NhdGlvblxuXG4gICAgICAgICAgY29uc29sZS5sb2cob2JqKVxuICAgICAgICAgIGRlbGV0ZSBvYmouY29tcGFueTsgZGVsZXRlIG9iai5jcmVhdGVkQXQ7IGRlbGV0ZSBvYmoudXBkYXRlZEF0OyBkZWxldGUgb2JqLm9iamVjdElkO1xuICAgICAgICAgIGRlbGV0ZSBvYmoubGlzdHM7IGRlbGV0ZSBvYmoubG9hZGluZzsgZGVsZXRlIG9iai51c2VyOyBkZWxldGUgb2JqLnVzZXJfY29tcGFueTtcbiAgICAgICAgICBkZWxldGUgb2JqLmFwaV9rZXk7IGRlbGV0ZSBvYmouY2xhc3NOYW1lO1xuICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhwcm9zcGVjdClcbiAgICAgICAgICByZXR1cm4gcHJvc3BlY3RcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHByb3NwZWN0cyA9IFtQYXBhLnVucGFyc2UocHJvc3BlY3RzKV1cbiAgICAgIHZhciBibG9iID0gbmV3IEJsb2IocHJvc3BlY3RzLCB7dHlwZTogXCJ0ZXh0L3BsYWluO2NoYXJzZXQ9dXRmLThcIn0pO1xuICAgICAgY29uc29sZS5sb2coYmxvYilcbiAgICAgIHNhdmVBcyhibG9iLCBfdGhpcy5zdGF0ZS5jbGFzc05hbWUrXCIuY3N2XCIpO1xuICAgICAgX3RoaXMuc2V0U3RhdGUoe2Rvd25sb2FkaW5nOiBmYWxzZX0pXG4gICAgfSlcbiAgfSxcblxuICBkb3dubG9hZFByb3NwZWN0czogZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coJ2Rvd25sb2FkIGZpbGUnKVxuICAgIF9saXN0ID0gUGFyc2UuX3BvaW50ZXIoJ1Byb3NwZWN0TGlzdCcsIHRoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgcmVzdWx0cyA9IF8ubWFwKFswLDEsMiwzLDQsNSw2LDcsOCw5XSwgZnVuY3Rpb24obnVtKSB7XG4gICAgICBxcnkgPSB7IGNvdW50OiAxLCBhcmNoaXZlZDogeyRpbjpbbnVsbCwgZmFsc2VdfSwgbGltaXQ6IDEwMDAsIHNraXA6IG51bSoxMDAwfVxuICAgICAgcXJ5LmluY2x1ZGUgPSAnY29tcGFueSxjb21wYW55LmVtYWlsX2d1ZXNzJ1xuICAgICAgaWYoX3RoaXMuc3RhdGUuY3VycmVudExpc3QgIT0gXCJBbGxcIilcbiAgICAgICAgcXJ5LndoZXJlID0gSlNPTi5zdHJpbmdpZnkoe2xpc3RzOiBfbGlzdH0pXG4gICAgICByZXR1cm4gUGFyc2UuZ2V0KF90aGlzLnN0YXRlLmNsYXNzTmFtZSwgcXJ5KVxuICAgIH0pXG5cbiAgICAkLndoZW4uYXBwbHkodGhpcywgcmVzdWx0cykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICBwcm9zcGVjdHMgPSBfLmZsYXR0ZW4oXy5tYXAoYXJndW1lbnRzLCBmdW5jdGlvbihhcmcpIHsgcmV0dXJuIGFyZ1swXS5yZXN1bHRzfSkpXG4gICAgICBwcm9zcGVjdHMgPSBfLm1hcChwcm9zcGVjdHMsIGZ1bmN0aW9uKHByb3NwZWN0KSB7XG4gICAgICAgIC8vIFRPRE8gLSBhZGQgZW1haWxcbiAgICAgICAgaWYocHJvc3BlY3QuY29tcGFueSkge1xuICAgICAgICAgIGNvbXBhbnkgPSBwcm9zcGVjdC5jb21wYW55XG4gICAgICAgICAgZGVsZXRlIGNvbXBhbnkubmFtZVxuICAgICAgICAgIF9rZXlzID0gXy5rZXlzKHByb3NwZWN0KS5jb25jYXQoXy5rZXlzKGNvbXBhbnkpKVxuICAgICAgICAgIF92YWx1ZXMgPSBfLnZhbHVlcyhwcm9zcGVjdCkuY29uY2F0KF8udmFsdWVzKGNvbXBhbnkpKVxuICAgICAgICAgIG9iaiA9IF8ub2JqZWN0KF9rZXlzLCBfdmFsdWVzKVxuICAgICAgICAgIG9iai5hZGRyZXNzID0gb2JqLm5vcm1hbGl6ZWRMb2NhdGlvblxuICAgICAgICAgIGlmKG9iai5lbWFpbF9wYXR0ZXJuICYmICFfLmlzRXF1YWwob2JqLmVtYWlsX3BhdHRlcm4sIFtdKSlcbiAgICAgICAgICAgIG9iai5lbWFpbCA9IF90aGlzLl9tYWtlX2VtYWlsKHByb3NwZWN0Lm5hbWUsIHByb3NwZWN0LmNvbXBhbnkuZW1haWxfcGF0dGVybilcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICBvYmouZW1haWwgPSBcIlwiXG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhvYmopXG4gICAgICAgICAgZGVsZXRlIG9iai5jb21wYW55OyBkZWxldGUgb2JqLmNyZWF0ZWRBdDsgZGVsZXRlIG9iai51cGRhdGVkQXQ7IGRlbGV0ZSBvYmoub2JqZWN0SWQ7XG4gICAgICAgICAgZGVsZXRlIG9iai5saXN0czsgZGVsZXRlIG9iai5sb2FkaW5nOyBkZWxldGUgb2JqLnVzZXI7IGRlbGV0ZSBvYmoudXNlcl9jb21wYW55O1xuICAgICAgICAgIGRlbGV0ZSBvYmouYXBpX2tleTsgZGVsZXRlIG9iai5jbGFzc05hbWU7XG4gICAgICAgICAgcmV0dXJuIG9iajtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKHByb3NwZWN0KVxuICAgICAgICAgIHJldHVybiBwcm9zcGVjdFxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcHJvc3BlY3RzID0gW1BhcGEudW5wYXJzZShwcm9zcGVjdHMpXVxuICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihwcm9zcGVjdHMsIHt0eXBlOiBcInRleHQvcGxhaW47Y2hhcnNldD11dGYtOFwifSk7XG4gICAgICBjb25zb2xlLmxvZyhibG9iKVxuICAgICAgc2F2ZUFzKGJsb2IsIF90aGlzLnN0YXRlLmNsYXNzTmFtZStcIi5jc3ZcIik7XG4gICAgICBfdGhpcy5zZXRTdGF0ZSh7ZG93bmxvYWRpbmc6IGZhbHNlfSlcbiAgICB9KVxuICB9LFxuXG5cbiAgaGlkZUFsZXJ0OiBmdW5jdGlvbigpIHsgJCgnLmFsZXJ0JykuaGlkZSgpIH0sXG4gIHN0YXJ0S2V5Ym9hcmRTaG9ydGN1dHM6IGZ1bmN0aW9uKCkgeyAvKktleWJvYXJkU2hvcnRjdXRzLmluaXRpYWxpemUoKSovIH0sXG4gIGNvbXBvbmVudERpZFVwZGF0ZTogZnVuY3Rpb24oKSB7ICQoJy5kcm9wZG93bicpLnNob3coKSB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAkKCcuZHJvcGRvd24nKS5zaG93KCk7IFxuICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cyA9IEpTT04uc3RyaW5naWZ5KFtdKTtcblxuICAgIHFyeSA9IHsgbGlzdHM6IGN1cnJlbnRMaXN0IH1cbiAgICBpZih0aGlzLnN0YXRlLmN1cnJlbnRMaXN0ID09ICdBbGwnKXtcbiAgICAgIHFyeSA9IHtcbiAgICAgICAgY291bnQ6IHRydWUsIG9yZGVyOiAnLWNyZWF0ZWRBdCcsXG4gICAgICAgIGxpbWl0OiB0aGlzLnN0YXRlLnByb3NwZWN0c1BlclBhZ2UsXG4gICAgICAgIGluY2x1ZGU6ICdlbWFpbF9ndWVzc2VzLGVtYWlsX2d1ZXNzZXMucGF0dGVybixjb21wYW55J1xuICAgICAgfVxuICAgICAgcXJ5LndoZXJlID0gSlNPTi5zdHJpbmdpZnkoeyBhcmNoaXZlZDogeyckaW4nOltmYWxzZSwgbnVsbF19LCB9KVxuICAgIH1cblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgUGFyc2UuZ2V0KF90aGlzLnN0YXRlLmNsYXNzTmFtZSwge2NvdW50OiB0cnVlLGxpbWl0OjB9KS5kb25lKGZ1bmN0aW9uKHJlcykge1xuICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgIH0pXG4gICAgUGFyc2UuZ2V0KF90aGlzLnN0YXRlLmNsYXNzTmFtZSwgcXJ5KS5kb25lKGZ1bmN0aW9uKHJlcykge1xuICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgcmVzLnByb3NwZWN0cyA9IHJlcy5yZXN1bHRzXG4gICAgICByZXMubG9hZGluZyA9IGZhbHNlOyBcbiAgICAgIHJlcy5wYWdlcyA9IE1hdGguY2VpbChyZXMuY291bnQvX3RoaXMucHJvcHMucHJvc3BlY3RzUGVyUGFnZSk7XG4gICAgICByZXMudG90YWxDb3VudCA9IHJlcy5jb3VudFxuICAgICAgX3RoaXMuc2V0U3RhdGUocmVzKVxuICAgIH0pXG5cbiAgICBQYXJzZS5nZXQodGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLCB7IG9yZGVyOiAnLWNyZWF0ZWRBdCd9KS5kb25lKGZ1bmN0aW9uKHJlcykge1xuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xpc3RzOiByZXMucmVzdWx0c30pXG4gICAgfSlcbiAgfSxcblxuICBnZW5lcmF0ZV9pZCA6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJ18nICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsOSk7IFxuICB9LFxufSk7XG5cbi8qICBEcm9wZG93biBNZW51cyAqL1xudmFyIExpc3RzTWVudSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0xpc3RzTWVudScsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBtaW5XaWR0aDonaW5oZXJpdCcsXG4gICAgICAgICAgICB0b3A6ICcyMHB4JyxcbiAgICAgICAgICAgIHdpZHRoOiAnMTI1cHgnLFxuICAgICAgICAgICAgcmlnaHQ6ICcxNTRweCcsXG4gICAgICAgICAgICBsZWZ0OidhdXRvJ1xuICAgICAgICAgIH19LCBcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtocmVmOiBcIiNib29rc1wifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10aW1lc1wifSksIFwiIMKgXCIgKyAnICcgK1xuICAgICAgICAgIFwiRGVsZXRlIExpc3RcIlxuICAgICAgICApKSwgXG4gICAgICAgIFJlYWN0LkRPTS5saShudWxsLCBSZWFjdC5ET00uYSh7aHJlZjogXCIjcG9kY2FzdHNcIn0sIFxuICAgICAgICAgIFwiUmVuYW1lIExpc3RzXCJcbiAgICAgICAgKSlcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIExpc3REZXRhaWxCdXR0b25zID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTGlzdERldGFpbEJ1dHRvbnMnLFxuICAvLyBSZW5hbWUgTGlzdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBlZGl0TW9kZTogZmFsc2VcbiAgICB9XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgaWYoIXRoaXMuc3RhdGUuZWRpdE1vZGUpIHtcbiAgICAgIHN0dWZmID0gUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJcIiwgc3R5bGU6IGxpc3ROYW1lU3R5bGV9LCBcbiAgICAgICAgICAgICh0aGlzLnByb3BzLmN1cnJlbnRMaXN0TmFtZSA9PSBcIkFsbFwiKSA/ICcnIDogUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1iYXJzXCIsIHN0eWxlOiB7Zm9udFNpemU6MTYsIG1hcmdpblRvcDotNX19KSwgXG4gICAgICAgICAgICAodGhpcy5wcm9wcy5jdXJyZW50TGlzdE5hbWUgPT0gXCJBbGxcIikgPyAnJyA6IFwiICAgXCIgK3RoaXMucHJvcHMuY3VycmVudExpc3ROYW1lXG4gICAgICAgICAgICAgIClcbiAgICB9IGVsc2Uge1xuICAgICAgc3R1ZmYgPSBSZWFjdC5ET00uaW5wdXQoe2NsYXNzTmFtZTogXCJmb3JtLWNvbnRyb2xcIiwgc3R5bGU6IHt3aWR0aDogMTAwLCBmbG9hdDogJ2xlZnQnLCBoZWlnaHQ6IDI0LCBtYXJnaW5Ub3A6IC0xfX0pXG4gICAgfVxuICAgIHJldHVybiAoXG5cbiAgICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtzdHlsZToge21hcmdpbjowfX0sIFwiIFwiLCBzdHVmZiwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiBsaXN0QnRuLCBcbiAgICAgICAgICAgICAgICAnZGF0YS10b2dnbGUnOiBcIm1vZGFsXCIsIFxuICAgICAgICAgICAgICAgIGlkOiBcInJlbmFtZUxpc3RCdG5cIiwgXG4gICAgICAgICAgICAgICAgJ2RhdGEtdGFyZ2V0JzogXCIuYnMtcmVuYW1lTGlzdC1tb2RhbC1zbVwiLCBcbiAgICAgICAgICAgICAgICBzdHlsZToge2Rpc3BsYXk6J25vbmUnfSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4teHMgYnRuLWRlZmF1bHRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGVuY2lsXCJ9KVxuICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5kZWxldGVMaXN0LCBcbiAgICAgICAgICAgICAgICBzdHlsZTogbGlzdEJ0biwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtkaXNwbGF5Oidub25lJ30sIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCJ9LCBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXRyYXNoLW9cIn0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcblxuICAgICAgICAgIClcbiAgICAgICk7XG4gIH0sXG5cbiAgcmVuYW1lTGlzdDogZnVuY3Rpb24obmV3TGlzdE5hbWUpIHsgdGhpcy5wcm9wcy5yZW5hbWVMaXN0KG5ld0xpc3ROYW1lKSB9LFxuXG4gIGRlbGV0ZUxpc3Q6IGZ1bmN0aW9uKCl7XG4gICAgdGhpc3MgPSB0aGlzO1xuICAgIHN3YWwoeyAgIFxuICAgICAgdGl0bGU6IFwiQXJlIHlvdSBzdXJlP1wiLCAgIFxuICAgICAgdGV4dDogXCJZb3VyIHdpbGwgbm90IGJlIGFibGUgdG8gcmVjb3ZlciB0aGlzIHByb3NwZWN0IGxpc3QhXCIsICAgXG4gICAgICB0eXBlOiBcIndhcm5pbmdcIiwgICBcbiAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsICAgXG4gICAgICBjb25maXJtQnV0dG9uQ29sb3I6IFwiI0RENkI1NVwiLCAgIFxuICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzLCBkZWxldGUgaXQhXCIsICAgXG4gICAgICBjbG9zZU9uQ29uZmlybTogZmFsc2UgfSwgXG4gICAgICBmdW5jdGlvbigpeyAgIHN3YWwoXCJEZWxldGVkIVwiLCBcIllvdXIgcHJvc3BlY3QgbGlzdCBoYXMgYmVlbiBkZWxldGVkLlwiLCBcInN1Y2Nlc3NcIik7IFxuICAgICAgICBjb25zb2xlLmxvZygnZGVsZXRlZCcpXG4gICAgICAgIHRoaXNzLnByb3BzLmRlbGV0ZUxpc3QoKVxuICAgICAgfSk7XG4gIH0sXG5cbiAgdG9nZ2xlRWRpdDogZnVuY3Rpb24oKSB7IHRoaXMuc2V0U3RhdGUoe2VkaXRNb2RlOiAhdGhpcy5zdGF0ZS5lZGl0TW9kZSB9KSB9XG59KTtcblxudmFyIFBhZ2luYXRlT3ZlcmxheSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1BhZ2luYXRlT3ZlcmxheScsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7aWQ6IFwicGFnaW5hdGUtb3ZlcmxheVwiLCBzdHlsZToge3BhZGRpbmdUb3A6NzB9fSwgXG4gICAgICAgICAgU3Bpbm5lcih7Y2lyY2xlU3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6J3doaXRlJ319KVxuICAgICAgICApXG4gICAgKVxuICB9XG59KVxuXG52YXIgRW1wdHlQZW9wbGVQcm9zcGVjdHNQYW5lbCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0VtcHR5UGVvcGxlUHJvc3BlY3RzUGFuZWwnLFxuICBvcGVuTGlua2VkaW5XaW5kb3c6IGZ1bmN0aW9uKCkge1xuICAgIGlmKHRoaXMucHJvcHMuY2xhc3NOYW1lID09IFwiUHJvc3BlY3RcIilcbiAgICAgIHdpbmRvdy5vcGVuKCdodHRwczovL3d3dy5saW5rZWRpbi5jb20vdnNlYXJjaC9wP3R5cGU9cGVvcGxlJylcbiAgICBlbHNlXG4gICAgICB3aW5kb3cub3BlbignaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL3ZzZWFyY2gvYycpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcblxuICAgIG5hbWUgPSAodGhpcy5wcm9wcy5jbGFzc05hbWUgPT0gXCJQcm9zcGVjdFwiKSA/IFwiUHJvc3BlY3RzXCIgOiBcIkNvbXBhbmllc1wiXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjb2wtbWQtb2Zmc2V0LTMgY29sLW1kLTZcIiwgc3R5bGU6IHtoZWlnaHQ6NDAwfX0sIFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInBhbmVsIHBhbmVsLWRlZmF1bHRcIiwgc3R5bGU6IHttYXJnaW5Ub3A6MTAwLGhlaWdodDoyMDB9fSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwYW5lbC1ib2R5XCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaDEoe2NsYXNzTmFtZTogXCJsZWFkXCIsIHN0eWxlOiB7dGV4dEFsaWduOidjZW50ZXInfX0sIFwiU3RhcnQgUHJvc3BlY3RpbmcgT24gTGlua2VkaW5cIiksIFxuICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIG9uQ2xpY2s6IHRoaXMub3BlbkxpbmtlZGluV2luZG93LCBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5XCIsIHN0eWxlOiB7YmFja2dyb3VuZEltYWdlOiAnbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzAwOTZmZiAwJSwgIzAwNWRmZiAxMDAlKSAhaW1wb3J0YW50JyxkaXNwbGF5OidibG9jaycsbWFyZ2luUmlnaHQ6J2F1dG8nLG1hcmdpbkxlZnQ6J2F1dG8nLHdpZHRoOjIwMCwgbWFyZ2luVG9wOjUwfX0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1zZWFyY2hcIn0pLCBcIiDCoFwiLCBcbiAgICAgICAgICAgIFwiU2VhcmNoIGZvciBcIituYW1lK1wiIVwiKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG52YXIgQ29tcGFueVByb3NwZWN0SGVhZGVyID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnQ29tcGFueVByb3NwZWN0SGVhZGVyJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnRyKG51bGwsIFxuICAgICAgICBSZWFjdC5ET00udGgobnVsbCksIFxuICAgICAgICBSZWFjdC5ET00udGgobnVsbCksIFxuICAgICAgICBSZWFjdC5ET00udGgoe3N0eWxlOiB7d2lkdGg6NDAwfX0sIFwiTmFtZVwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHt3aWR0aDo1MDB9fSwgXCJJbmR1c3RyeVwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHt3aWR0aDoxMzcsZGlzcGxheTonbm9uZSd9fSwgXCIjIG9mIFByb3NwZWN0c1wiKSwgXG4gICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIsKgIFwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHtkaXNwbGF5Oidub25lJ319LCBcIlNpZ25hbHNcIiksIFxuICAgICAgICBSZWFjdC5ET00udGgoe3N0eWxlOiB7d2lkdGg6MTAwfX0sIFwiQWRkZWRcIiksIFxuICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCLCoFwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIsKgXCIpXG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbnZhciBDdXJyZW50TGlzdHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdDdXJyZW50TGlzdHMnLFxuICBsaXN0QWN0aW9uOiBmdW5jdGlvbihlKSB7XG4gICAgdmFyIGxpc3RTZWxlY3QgPSBfLmZpbHRlcih0aGlzLnByb3BzLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSAkKGUudGFyZ2V0KS50ZXh0KClcbiAgICB9KTtcblxuICAgIHRoaXMucHJvcHMubW92ZVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkge1xuICAgIC8vJCh0aGlzLmdldERPTU5vZGUoKS5kYXRhKClcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIGxpc3RzID0gW10gXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLmxpc3RzLmxlbmd0aDtpKyspIHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMucHJvcHMubGlzdHNbaV0ub2JqZWN0SWQpXG4gICAgICBsaXN0cy5wdXNoKFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe3N0eWxlOiB7Zm9udFdlaWdodDonYm9sZCcsZm9udFNpemU6JzEwcHgnfSwgXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcGRvd24tbW92ZS1saXN0LW5hbWUgZHJvcGRvd24tbGlzdC1uYW1lXCIsIFxuICAgICAgICAgICAgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICdkYXRhLW1vdmUtb2JqZWN0SWQnOiBcInRoaXMucHJvcHMubGlzdHNbaV0ub2JqZWN0SWRcIn0sIFxuICAgICAgICAgICB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuY29weURyb3Bkb3duU3R5bGUpXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7cmlnaHQ6MTIzLHRvcDoyN319LCBcbiAgICAgICAgbGlzdHNcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIEN1cnJlbnRMaXN0c1R3byA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0N1cnJlbnRMaXN0c1R3bycsXG4gIGxpc3RBY3Rpb246IGZ1bmN0aW9uKGUpIHtcbiAgICBsaXN0TmFtZSA9ICQoZS50YXJnZXQpLnRleHQoKVxuICAgIFxuICAgIHZhciBsaXN0U2VsZWN0ID0gXy5maWx0ZXIodGhpcy5wcm9wcy5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbGlzdE5hbWVcbiAgICB9KTtcblxuICAgIHRoaXMucHJvcHMuY29weVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0cyA9IFtdIFxuICAgIGZvcihpPTA7aTwgdGhpcy5wcm9wcy5saXN0cy5sZW5ndGg7aSsrKSB7XG4gICAgICBsaXN0cy5wdXNoKFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe3N0eWxlOiB7Zm9udFdlaWdodDonYm9sZCcsZm9udFNpemU6JzEwcHgnfSwgXG4gICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcGRvd24tY29weS1saXN0LW5hbWUgZHJvcGRvd24tbGlzdC1uYW1lXCIsIFxuICAgICAgICAgICAgICAgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICAgICdkYXRhLW9iamVjdElkJzogdGhpcy5wcm9wcy5saXN0c1tpXS5vYmplY3RJZH0sIFxuICAgICAgICAgICAgICAgXG4gICAgICAgICAgdGhpcy5wcm9wcy5saXN0c1tpXS5uYW1lKSlcbiAgICAgIClcbiAgICB9XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7d2lkdGg6MTE0LHJpZ2h0OjYsdG9wOjI3fX0sIFxuICAgICAgICBsaXN0c1xuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIGNyZWF0ZUxpc3RNb2RhbFxuICBjcmVhdGVMaXN0OiBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZygkKCcjbGlzdFRpdGxlJykudmFsKCkpXG5cbiAgICBkYXRhID0gIHtcbiAgICAgICduYW1lJyAgICAgICAgOiAkKCcjbGlzdFRpdGxlJykudmFsKCkudHJpbSgpLCAgIC8vV2FpdGluZyAsIFJ1bm5pbmdcbiAgICAgICd1c2VyJyAgICAgICAgOiB7ICdfX3R5cGUnOidQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAnY2xhc3NOYW1lJzonX1VzZXInLFxuICAgICAgICAgICAgICAgICAgICAgICdvYmplY3RJZCc6J3hXRVNpdzVTbWQnIH0sXG4gICAgfVxuXG4gICAgJC5hamF4KHtcbiAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Qcm9zcGVjdExpc3QnLFxuICAgICAgdHlwZTonUE9TVCcsXG4gICAgICBoZWFkZXJzOiBhcHBDb25maWcucGFyc2VIZWFkZXJzLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yJylcbiAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZGF0YS5jb3VudCA9IDBcblxuICAgIHRoaXMucHJvcHMuY3JlYXRlTGlzdChkYXRhKVxuICAgIFxuICAgICQoJyNjcmVhdGVMaXN0TW9kYWwnKS5tb2RhbCgnaGlkZScpXG4gICAgJCgnYm9keScpLnJlbW92ZUNsYXNzKCdtb2RhbC1vcGVuJyk7XG4gICAgJCgnLm1vZGFsLWJhY2tkcm9wJykucmVtb3ZlKCk7XG4gICAgLy8kKCdidXR0b24uY2xvc2UnKS5jbGljaygpXG4gIH0sXG5cbiAgcmVuYW1lTGlzdDogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIC8vY29uc29sZS5sb2coJCgnI25ld0xpc3ROYW1lJykudmFsKCkpXG4gICAgbmV3TGlzdE5hbWUgPSAkKCcjbmV3TGlzdE5hbWUnKS52YWwoKVxuICAgIGlmKG5ld0xpc3ROYW1lLnRyaW0oKSAhPSBcIlwiKVxuICAgICAgdGhpcy5wcm9wcy5yZW5hbWVMaXN0KG5ld0xpc3ROYW1lKVxuICAgIC8vIERpc2FibGUgTW9kYWxcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsIGZhZGUgYnMtcmVuYW1lTGlzdC1tb2RhbC1zbVwiLCB0YWJJbmRleDogXCItMVwiLCByb2xlOiBcImRpYWxvZ1wiLCAnYXJpYS1sYWJlbGxlZGJ5JzogXCJteVNtYWxsTW9kYWxMYWJlbFwiLCAnYXJpYS1oaWRkZW4nOiBcInRydWVcIiwgaWQ6IFwiY3JlYXRlTGlzdE1vZGFsXCIsIHN0eWxlOiB7dG9wOicyMDBweCd9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtZGlhbG9nIG1vZGFsLXNtXCJ9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWNvbnRlbnRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1oZWFkZXJcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImNsb3NlXCIsICdkYXRhLWRpc21pc3MnOiBcIm1vZGFsXCJ9LCBSZWFjdC5ET00uc3Bhbih7J2FyaWEtaGlkZGVuJzogXCJ0cnVlXCJ9LCBcIsOXXCIpLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJzci1vbmx5XCJ9LCBcIkNsb3NlXCIpKSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaDQoe2NsYXNzTmFtZTogXCJtb2RhbC10aXRsZVwiLCBpZDogXCJteU1vZGFsTGFiZWxcIn0sIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWxpc3RcIn0pLCBcIiDCoFJlbmFtZSBMaXN0XCIpXG4gICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWJvZHlcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmZvcm0oe29uU3VibWl0OiB0aGlzLnJlbmFtZUxpc3R9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmlucHV0KHtpZDogXCJuZXdMaXN0TmFtZVwiLCB0eXBlOiBcInRleHRcIiwgcGxhY2Vob2xkZXI6IFwiRW50ZXIgbGlzdCB0aXRsZS4uLlwiLCBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sXCJ9KSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5icihudWxsKSwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucmVuYW1lTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tc3VjY2Vzc1wiLCBcbiAgICAgICAgICAgICAgICAgICAgICBzdHlsZToge2Rpc3BsYXk6J2Jsb2NrJywgd2lkdGg6JzEwMCUnfX0sIFxuICAgICAgICAgICAgICAgICAgICAgIFwiQ3JlYXRlIExpc3RcIlxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuXG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxudmFyIFNpZGVNZW51TGlzdE9wdGlvbiA9IHJlcXVpcmUoJy4vdXNlcl9zaWRlX21lbnVfbGlzdC5qcy5taW4uanMnKTtcbnZhciBDcmVhdGVMaXN0TW9kYWwgPSByZXF1aXJlKCcuL2NyZWF0ZV9saXN0X21vZGFsLmpzLm1pbi5qcycpXG52YXIgTWVzc2VuZ2VyID0gcmVxdWlyZSgnLi9tZXNzZW5nZXIuanMubWluLmpzJylcblxudmFyIERlbGV0ZUxpc3RNb2RhbCA9IHJlcXVpcmUoJy4vZGVsZXRlX2xpc3RfbW9kYWwuanMubWluLmpzJylcbnZhciBSZW5hbWVMaXN0TW9kYWwgPSByZXF1aXJlKCcuL3JlbmFtZV9saXN0X21vZGFsLmpzLm1pbi5qcycpXG52YXIgU2lkZU1lbnVMaXN0T3B0aW9uID0gcmVxdWlyZSgnLi91c2VyX3NpZGVfbWVudV9saXN0LmpzLm1pbi5qcycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICAvL1NpZGVNZW51UHJvc3BlY3RzIC0gU2lkZUxpc3RcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLypcbiAgICAgIGNyZWF0ZUxpc3Q6IFxuICAgICAgcmVuYW1lTGlzdDpcbiAgICAgIGRlbGV0ZUxpc3Q6XG4gICAgICBjaGFuZ2VMaXN0OlxuICAgICAgY3VycmVudExpc3Q6XG4gICAgICB0b3RhbENvdW50OlxuICAgICAgbGlzdHM6XG5cbiAgICAgICovXG4gICAgIGxpc3RzOiBbXSxcbiAgICB9XG4gIH0sXG5cbiAgY3JlYXRlTGlzdDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB0aGlzLnByb3BzLmNyZWF0ZUxpc3QoZGF0YSlcbiAgfSxcblxuICBjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgICQoJy5kcm9wZG93bi1jb3B5LWxpc3QtbmFtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KVxuICAgICAgY29uc29sZS5sb2coJChlLnRhcmdldCkuZGF0YSgnb2JqZWN0SWQnKSlcbiAgICAgIC8vdGhpcy5wcm9wcy5jb3B5U2VsZWN0ZWRQcm9zcGVjdHMobGlzdFNlbGVjdFswXS5vYmplY3RJZClcbiAgICB9KVxuXG4gICAgJCgnLmRyb3Bkb3duLW1vdmUtbGlzdC1uYW1lJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgY29uc29sZS5sb2coZS50YXJnZXQpXG4gICAgICBjb25zb2xlLmxvZygkKGUudGFyZ2V0KS5kYXRhKCdtb3ZlLW9iamVjdElkJykpXG4gICAgICAvL3RoaXMucHJvcHMubW92ZVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gICAgfSlcbiAgfSxcblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBQYXJzZS5nZXQodGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLCB7IG9yZGVyOiAnLWNyZWF0ZWRBdCd9KS5kb25lKGZ1bmN0aW9uKHJlcykge1xuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xpc3RzOiByZXMucmVzdWx0c30pXG4gICAgfSlcblxuICAgICQoJy5kcm9wZG93bi1jb3B5LWxpc3QtbmFtZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUudGFyZ2V0KVxuICAgICAgY29uc29sZS5sb2coJChlLnRhcmdldCkuZGF0YSgnb2JqZWN0SWQnKSlcbiAgICAgIC8vdGhpcy5wcm9wcy5jb3B5U2VsZWN0ZWRQcm9zcGVjdHMobGlzdFNlbGVjdFswXS5vYmplY3RJZClcbiAgICB9KVxuXG4gICAgJCgnLmRyb3Bkb3duLW1vdmUtbGlzdC1uYW1lJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgY29uc29sZS5sb2coZS50YXJnZXQpXG4gICAgICBjb25zb2xlLmxvZygkKGUudGFyZ2V0KS5kYXRhKCdvYmplY3RJZCcpKVxuICAgICAgLy90aGlzLnByb3BzLm1vdmVTZWxlY3RlZFByb3NwZWN0cyhsaXN0U2VsZWN0WzBdLm9iamVjdElkKVxuICAgIH0pXG4gIH0sXG4gIFxuICByZW1vdmVTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24oKSB7XG4gICAgLy8gcmVtb3ZlIHNlbGVjdGVkIGZyb20gbGlzdFxuICAgIHNlbGVjdGVkUHJvc3BlY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWRQcm9zcGVjdHMpXG4gICAgX2xpc3QgPSBQYXJzZS5fcG9pbnRlcih0aGlzLnByb3BzLmxpc3RDbGFzc05hbWUsIHRoaXMuc3RhdGUuY3VycmVudExpc3RPYmplY3RJZClcbiAgICBib2R5ID0geyBsaXN0czogeyAnX19vcCcgOiAnUmVtb3ZlJywgXCJvYmplY3RzXCIgOiBbX2xpc3RdIH0gfVxuICAgIGlmKHRoaXMuc3RhdGUuY3VycmVudExpc3QgPT0gJ0FsbCcpeyBib2R5ID0geyBhcmNoaXZlZDogdHJ1ZSB9IH1cbiAgICBQYXJzZS5iYXRjaFVwZGF0ZSgnUHJvc3BlY3QnLCBzZWxlY3RlZFByb3NwZWN0cywgYm9keSlcbiAgICAvLyBVcGRhdGUgTGlzdCBDb3VudHNcbiAgICAvL1xuICB9LFxuXG4gIG1vdmVTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24oX2xpc3QpIHtcbiAgICAvLyBtb3ZlIHRvIGxpc3RcbiAgICAvLyBvbmx5IGlmIHRoZSBjdXJyZW50IGxpc3QgaXMgbm90IGFsbFxuICAgIC8vIHJlbW92ZSBwcm9zcGVjdHMgZnJvbSBjdXJyZW50TGlzdFxuICAgIGlmKCF0aGlzLnByb3BzLmN1cnJlbnRMaXN0T2JqZWN0SWQpeyBjb25zb2xlLmxvZygnbm90IHN1cHBvcnRlZCcpOyByZXR1cm4gMH1cbiAgICBzZWxlY3RlZFByb3NwZWN0cyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLnNlbGVjdGVkUHJvc3BlY3RzKVxuICAgIG9sZF9saXN0ID0gUGFyc2UuX3BvaW50ZXIodGhpcy5wcm9wcy5saXN0Q2xhc3NOYW1lLCB0aGlzLnByb3BzLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgbmV3X2xpc3QgPSBQYXJzZS5fcG9pbnRlcih0aGlzLnByb3BzLmxpc3RDbGFzc05hbWUsIF9saXN0KVxuICAgIHRoaXMucHJvcHMucmVtb3ZlUHJvc3BlY3RzKHNlbGVjdGVkUHJvc3BlY3RzKVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBjb25zb2xlLmxvZyhfbGlzdClcbiAgICBjb25zb2xlLmxvZyh0aGlzLnByb3BzLmN1cnJlbnRMaXN0T2JqZWN0SWQpXG4gICAgYm9keSA9IHsgbGlzdHM6IHsgJ19fb3AnIDogJ1JlbW92ZScsIFwib2JqZWN0c1wiIDogW29sZF9saXN0XSB9IH1cbiAgICBQYXJzZS5iYXRjaFVwZGF0ZSgnUHJvc3BlY3QnLCBzZWxlY3RlZFByb3NwZWN0cywgYm9keSkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgIGluY3JlbWVudCA9IHtjb3VudDoge19fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IC0xKnNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aH19XG4gICAgICBQYXJzZS5wdXQoX3RoaXMucHJvcHMubGlzdENsYXNzTmFtZSsnLycrX2xpc3QsIGluY3JlbWVudCwgZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0pXG5cbiAgICAgIGFtb3VudCA9IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aFxuICAgICAgdmFyIGxpc3RzID0gXy5tYXAoX3RoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaWYoaXRlbS5vYmplY3RJZCA9PSBfdGhpcy5wcm9wcy5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgICAgICAgIGl0ZW0uY291bnQgPSBpdGVtLmNvdW50IC0gYW1vdW50XG4gICAgICAgIHJldHVybiBpdGVtXG4gICAgICB9KVxuICAgICAgY29uc29sZS5sb2cobGlzdHMpXG4gICAgICBfdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IGxpc3RzfSlcbiAgICB9KVxuXG4gICAgYm9keSA9IHsgbGlzdHM6IHsgJ19fb3AnIDogJ0FkZFVuaXF1ZScsIFwib2JqZWN0c1wiIDogW25ld19saXN0XSB9IH1cbiAgICBQYXJzZS5iYXRjaFVwZGF0ZSgnUHJvc3BlY3QnLCBzZWxlY3RlZFByb3NwZWN0cywgYm9keSkuZG9uZShmdW5jdGlvbigpIHtcbiAgICAgIGluY3JlbWVudCA9IHtjb3VudDoge19fb3A6ICdJbmNyZW1lbnQnLCBhbW91bnQ6IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aH19XG4gICAgICBQYXJzZS5wdXQoX3RoaXMucHJvcHMubGlzdENsYXNzTmFtZSsnLycrX2xpc3QsIGluY3JlbWVudCwgZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgIH0pXG5cbiAgICAgIGFtb3VudCA9IHNlbGVjdGVkUHJvc3BlY3RzLmxlbmd0aFxuICAgICAgdmFyIGxpc3RzID0gXy5tYXAoX3RoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgaWYoaXRlbS5vYmplY3RJZCA9PSBfbGlzdClcbiAgICAgICAgICBpdGVtLmNvdW50ID0gKGl0ZW0uY291bnQpID8gaXRlbS5jb3VudCArIGFtb3VudCA6IGFtb3VudFxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfSlcbiAgICAgIC8vY29uc29sZS5sb2cobGlzdHMpXG4gICAgICBfdGhpcy5zZXRTdGF0ZSh7bGlzdHM6IGxpc3RzfSlcbiAgICB9KVxuICAgIC8vIFVwZGF0ZSBMaXN0IENvdW50c1xuICB9LFxuXG4gIGNvcHlTZWxlY3RlZFByb3NwZWN0czogZnVuY3Rpb24oX2xpc3QpIHtcbiAgICAvLyBUT0RPIC0gY2hlY2sgdG8gc2VlIGlmIHByb3NwZWN0IGV4aXN0cyBpbiB0aGUgb3RoZXIgbGlzdFxuICAgIC8vIFRPRE8gLSBSZW1vdmUgZnJvbSBzZWxlY3RlZCBwcm9zcGVjdHMgSWYgcHJvc3BlY3RzIGFscmVhZHkgZXhpc3QgaW4gbGlzdCBkbyBub3QgaW5jcmVtZW50XG4gICAgY29uc29sZS5sb2coJ3VwZGF0ZScpXG4gICAgc2VsZWN0ZWRQcm9zcGVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZFByb3NwZWN0cylcbiAgICBuZXdfbGlzdCA9IFBhcnNlLl9wb2ludGVyKHRoaXMucHJvcHMubGlzdENsYXNzTmFtZSwgX2xpc3QpXG4gICAgYm9keSA9IHsgbGlzdHM6IHsgJ19fb3AnIDogJ0FkZFVuaXF1ZScsIFwib2JqZWN0c1wiIDogW25ld19saXN0XSB9IH1cbiAgICBjb25zb2xlLmxvZyhib2R5KVxuXG4gICAgLy9cblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgUGFyc2UuYmF0Y2hVcGRhdGUoJ1Byb3NwZWN0Jywgc2VsZWN0ZWRQcm9zcGVjdHMsIGJvZHkpLmRvbmUoZnVuY3Rpb24ocmVzKSB7XG4gICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAvLyBpZiBzdWNjZXNzXG4gICAgICBpbmNyZW1lbnQgPSB7Y291bnQ6IHtfX29wOiAnSW5jcmVtZW50JywgYW1vdW50OiBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGh9fVxuICAgICAgUGFyc2UucHV0KF90aGlzLnByb3BzLmxpc3RDbGFzc05hbWUrJy8nK19saXN0LCBpbmNyZW1lbnQsIGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICB9KVxuXG4gICAgICBhbW91bnQgPSBzZWxlY3RlZFByb3NwZWN0cy5sZW5ndGhcbiAgICAgIHZhciBsaXN0cyA9IF8ubWFwKF90aGlzLnN0YXRlLmxpc3RzLCBmdW5jdGlvbihpdGVtKSB7XG4gICAgICAgIGlmKGl0ZW0ub2JqZWN0SWQgPT0gX2xpc3QpXG4gICAgICAgICAgICBpdGVtLmNvdW50ID0gKGl0ZW0uY291bnQpID8gaXRlbS5jb3VudCArIGFtb3VudCA6IGFtb3VudFxuICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgfSlcbiAgICAgIGNvbnNvbGUubG9nKGxpc3RzKVxuICAgICAgX3RoaXMuc2V0U3RhdGUoe2xpc3RzOiBsaXN0c30pXG4gICAgfSlcbiAgfSxcblxuICBjaGFuZ2VMaXN0OiBmdW5jdGlvbihlKSB7XG4gICAgLypcbiAgICBjdXJyZW50TGlzdCA9ICQoZS50YXJnZXQpLnBhcmVudCgpLy8uZGF0YSgnbGlzdCcpXG4gICAgY29uc29sZS5sb2coY3VycmVudExpc3QpXG4gICAgdGhpcy5wcm9wcy5jaGFuZ2VMaXN0KGN1cnJlbnRMaXN0Lm5hbWUsIGN1cnJlbnRMaXN0Lm9iamVjdElkKVxuICAgICovXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBpZih0aGlzLnByb3BzLmN1cnJlbnRMaXN0ID09IFwiQWxsXCIpXG4gICAgICBzdHlsZXMgPSB7J2JhY2tncm91bmRDb2xvcic6J3JnYigwLCAxMjIsIDI1NSknLCAnY29sb3InOid3aGl0ZSd9IFxuICAgIGVsc2VcbiAgICAgIHN0eWxlcyA9ICB7fVxuXG4gICAgbGlzdHMgPSBbU2lkZU1lbnVMaXN0T3B0aW9uKHtsaXN0OiB7bmFtZTogJ0FsbCcsIGNvdW50OiB0aGlzLnByb3BzLnRvdGFsQ291bnR9LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb25UeXBlOiAndXNlcnMnLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMucHJvcHMuY2hhbmdlTGlzdH0pLCBcbiAgICAgICAgICAgICBTaWRlTWVudUxpc3RPcHRpb24oe2xpc3Q6IHtuYW1lOiAnQXJjaGl2ZWQnLCBjb3VudDogJ34nfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uVHlwZTogJ2FyY2hpdmUnLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMucHJvcHMuY2hhbmdlTGlzdCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaWRlQ291bnQ6IHRydWV9KV1cblxuICAgIGZvcihpPTA7aTwgdGhpcy5zdGF0ZS5saXN0cy5sZW5ndGg7aSsrKXtcbiAgICAgIGxpc3QgPSB0aGlzLnN0YXRlLmxpc3RzW2ldXG4gICAgICBpZihsaXN0Lmxpc3RfdHlwZSA9PSBcInNpZ25hbF9saXN0XCIpXG4gICAgICAgIGljb25UeXBlID0gXCJ3aWZpXCJcbiAgICAgIGVsc2UgaWYgKGxpc3QubGlzdF90eXBlID09IFwibWluaW5nX2pvYlwiKVxuICAgICAgICBpY29uVHlwZSA9IFwiY2xvdWREb3dubG9hZFwiXG4gICAgICBpZihsaXN0Lmxpc3RfdHlwZSlcbiAgICAgICAgbGlzdHMucHVzaChTaWRlTWVudUxpc3RPcHRpb24oe2xpc3Q6IGxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvblR5cGU6IGljb25UeXBlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUxpc3Q6IHRoaXMucHJvcHMuY2hhbmdlTGlzdH0pKVxuICAgICAgZWxzZSBcbiAgICAgICAgbGlzdHMucHVzaChTaWRlTWVudUxpc3RPcHRpb24oe2xpc3Q6IGxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlTGlzdDogdGhpcy5wcm9wcy5jaGFuZ2VMaXN0fSkpXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjb2wtbGctMiBjb2wtbWQtMiBjb2wtc20tMiBjb2wteHMtMlwiLCBcbiAgICAgICAgICAgc3R5bGU6IHtwYWRkaW5nOicwJyxoZWlnaHQ6JzQzOHB4JyxiYWNrZ3JvdW5kQ29sb3I6JyNlMGU5ZWUnLFxuICAgICAgICAgICAgICAgICAgIGJvcmRlclJpZ2h0OicxcHggc29saWQgI2IwYjhiZicsdGV4dEFsaWduOidjZW50ZXInfX0sIFxuICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwcm9zcGVjdC1saXN0LWhlYWRlclwiLCBzdHlsZToge3BhZGRpbmdMZWZ0OjEwLCB0ZXh0QWxpZ246J2NlbnRlcid9fSwgXG4gICAgICAgICAgICAgICAgICAgICBcIkxpc3RzXCJcblxuICAgICAgICAgICAgICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiYnRuLWdyb3VwLXZlcnRpY2FsXCIsIFxuICAgICAgICAgICAgIHN0eWxlOiB7d2lkdGg6JzEwMCUnLCBoZWlnaHQ6ICczMjBweCcsIG92ZXJmbG93OiAnYXV0byd9fSwgXG4gICAgICAgICAgbGlzdHNcbiAgICAgICAgKSwgXG4gICAgICAgIFJlYWN0LkRPTS5icihudWxsKSwgUmVhY3QuRE9NLmJyKG51bGwpLCBcbiAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBuZXctbGlzdC1idG5cIiwgXG4gICAgICAgICAgICAgICdkYXRhLXRvZ2dsZSc6IFwibW9kYWxcIiwgJ2RhdGEtdGFyZ2V0JzogXCIuYnMtZXhhbXBsZS1tb2RhbC1zbVwiLCBcbiAgICAgICAgICAgICAgc3R5bGU6IHsgYmFja2dyb3VuZEltYWdlOiAnbGluZWFyLWdyYWRpZW50KDE4MGRlZywgIzAwOTZmZiAwJSwgIzAwNWRmZiAxMDAlKSd9fSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1wbHVzLWNpcmNsZVwifSksIFwiwqDCoE5ldyBMaXN0XCJcbiAgICAgICAgKSwgXG4gICAgICAgIENyZWF0ZUxpc3RNb2RhbCh7Y3JlYXRlTGlzdDogdGhpcy5jcmVhdGVMaXN0LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVMaXN0OiB0aGlzLnVwZGF0ZUxpc3QsIFxuICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RDbGFzc05hbWU6IHRoaXMucHJvcHMubGlzdENsYXNzTmFtZX0pLCBcIiBcIiwgUmVhY3QuRE9NLmJyKG51bGwpXG4gICAgICApXG4gICAgKTtcbiAgfSxcblxuICBjcmVhdGVMaXN0OiBmdW5jdGlvbihkYXRhKSB7IFxuICAgIHRoaXMuc2V0U3RhdGUoeyBsaXN0czogW2RhdGFdLmNvbmNhdCh0aGlzLnN0YXRlLmxpc3RzKSB9KSBcbiAgfSxcblxuICB1cGRhdGVMaXN0OiBmdW5jdGlvbihfaWQsIG9iaklkKSB7XG4gICAgdXBkYXRlZCA9IF8ubWFwKHRoaXMuc3RhdGUubGlzdHMsIGZ1bmN0aW9uKGxpc3QpIHtcbiAgICAgIGlmKGxpc3QudG1wID09IF9pZClcbiAgICAgICAgICBsaXN0Lm9iamVjdElkID0gb2JqSWRcbiAgICAgIHJldHVybiBsaXN0XG4gICAgfSlcbiAgICBjb25zb2xlLmxvZyhcInVwZGF0ZSBicm9za2lcIilcbiAgICB0aGlzLnNldFN0YXRlKHtsaXN0czogdXBkYXRlZH0pXG4gIH0sXG5cbiAgcmVuYW1lTGlzdDogZnVuY3Rpb24obmV3TGlzdE5hbWUpIHtcbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgdmFyIGZpbHRlcmVkID0gXy5maWx0ZXIodGhpcy5zdGF0ZS5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaWYoaXRlbS5uYW1lID09IHRoaXNzLnN0YXRlLmN1cnJlbnRMaXN0KSB7XG4gICAgICAgIGl0ZW0ubmFtZSA9IG5ld0xpc3ROYW1lXG4gICAgICAgIHJldHVybiBpdGVtXG4gICAgICB9XG4gICAgICByZXR1cm4gaXRlbVxuICAgIH0pO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7bGlzdHMgOiBmaWx0ZXJlZCwgY3VycmVudExpc3Q6IG5ld0xpc3ROYW1lfSlcblxuICAgICQoJy5tb2RhbCcpLmNsaWNrKClcbiAgICAkKCcjbmV3TGlzdE5hbWUnKS52YWwoJycpXG4gICAgJCgnLm1vZGFsLWJhY2tkcm9wJykuY2xpY2soKVxuXG4gICAgUGFyc2UudXBkYXRlKHRoaXMucHJvcHMubGlzdENsYXNzTmFtZSwgeyduYW1lJzpuZXdMaXN0TmFtZX0pXG4gIH0sXG5cbiAgZGVsZXRlTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZpbHRlcmVkID0gXy5maWx0ZXIodGhpcy5zdGF0ZS5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaWYoaXRlbS5vYmplY3RJZCA9PSB0aGlzcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkKVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtsaXN0czogZmlsdGVyZWQsIGN1cnJlbnRMaXN0OiAnQWxsJ30pXG4gICAgdGhpcy5jaGFuZ2VMaXN0KCdBbGwnLCAnJylcblxuICAgIGFwcENvbmZpZy5jbG9zZU1vZGFsKCk7IFxuICAgICQoJyNuZXdMaXN0TmFtZScpLnZhbCgnJyk7XG4gICAgUGFyc2UuZGVsZXRlKHRoaXMucHJvcHMubGlzdENsYXNzTmFtZSsnLycrdGhpcy5zdGF0ZS5jdXJyZW50TGlzdE9iamVjdElkKTtcbiAgfSxcbn0pO1xuXG52YXIgQ3VycmVudExpc3RzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnQ3VycmVudExpc3RzJyxcbiAgbGlzdEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIHZhciBsaXN0U2VsZWN0ID0gXy5maWx0ZXIodGhpcy5wcm9wcy5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gJChlLnRhcmdldCkudGV4dCgpXG4gICAgfSk7XG5cbiAgICB0aGlzLnByb3BzLm1vdmVTZWxlY3RlZFByb3NwZWN0cyhsaXN0U2VsZWN0WzBdLm9iamVjdElkKVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgbGlzdHMgPSBbXSBcbiAgICBmb3IoaT0wO2k8IHRoaXMucHJvcHMubGlzdHMubGVuZ3RoO2krKykge1xuICAgICAgbGlzdHMucHVzaChcbiAgICAgICAgUmVhY3QuRE9NLmxpKG51bGwsIFJlYWN0LkRPTS5hKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnLGZvbnRTaXplOicxMHB4J30sIFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcImRyb3Bkb3duLWxpc3QtbmFtZVwiLCBcbiAgICAgICAgICAgIGhyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICBvbkNsaWNrOiB0aGlzLmxpc3RBY3Rpb259LCB0aGlzLnByb3BzLmxpc3RzW2ldLm5hbWUpKVxuICAgICAgKVxuICAgIH1cbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuY29weURyb3Bkb3duU3R5bGUpXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImRyb3Bkb3duLW1lbnUgZHJvcC10ZXN0XCIsIGlkOiBcImRyb3Bkb3duXCIsIFxuICAgICAgICAgIHN0eWxlOiB7cmlnaHQ6LTIzLHRvcDoyN319LCBcbiAgICAgICAgbGlzdHNcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIEN1cnJlbnRMaXN0c1R3byA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0N1cnJlbnRMaXN0c1R3bycsXG4gIGxpc3RBY3Rpb246IGZ1bmN0aW9uKGUpIHtcbiAgICBsaXN0TmFtZSA9ICQoZS50YXJnZXQpLnRleHQoKVxuICAgIFxuICAgIHZhciBsaXN0U2VsZWN0ID0gXy5maWx0ZXIodGhpcy5wcm9wcy5saXN0cywgZnVuY3Rpb24oaXRlbSkge1xuICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbGlzdE5hbWVcbiAgICB9KTtcblxuICAgIHRoaXMucHJvcHMuY29weVNlbGVjdGVkUHJvc3BlY3RzKGxpc3RTZWxlY3RbMF0ub2JqZWN0SWQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBsaXN0cyA9IFtdIFxuICAgIGZvcihpPTA7aTwgdGhpcy5wcm9wcy5saXN0cy5sZW5ndGg7aSsrKSB7XG4gICAgICBsaXN0cy5wdXNoKFxuICAgICAgICBSZWFjdC5ET00ubGkobnVsbCwgUmVhY3QuRE9NLmEoe3N0eWxlOiB7Zm9udFdlaWdodDonYm9sZCcsZm9udFNpemU6JzEwcHgnfSwgXG4gICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiZHJvcGRvd24tbGlzdC1uYW1lXCIsIFxuICAgICAgICAgICAgICAgaHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMubGlzdEFjdGlvbn0sIFxuICAgICAgICAgIHRoaXMucHJvcHMubGlzdHNbaV0ubmFtZSkpXG4gICAgICApXG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00udWwoe2NsYXNzTmFtZTogXCJkcm9wZG93bi1tZW51IGRyb3AtdGVzdFwiLCBpZDogXCJkcm9wZG93blwiLCBcbiAgICAgICAgICBzdHlsZToge3dpZHRoOjExNCxyaWdodDotNzEsdG9wOjI3fX0sIFxuICAgICAgICBsaXN0c1xuICAgICAgKVxuICAgICk7XG4gIH1cbn0pO1xuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIFNwaW5uZXJcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBjaXJjbGVTdHlsZT0odGhpcy5wcm9wcy5jaXJjbGVTdHlsZSkgPyB0aGlzLnByb3BzLmNpcmNsZVN0eWxlIDoge31cbiAgICBzcGlubmVyU3R5bGU9dGhpcy5wcm9wcy5zcGlubmVyU3R5bGUgPyB0aGlzLnByb3BzLnNwaW5uZXJTdHlsZSA6IHt9XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJzcGlubmVyXCIsIHN0eWxlOiBzcGlubmVyU3R5bGV9LCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInNwaW5uZXItY29udGFpbmVyIGNvbnRhaW5lcjFcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUxXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlMlwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTNcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGU0XCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwic3Bpbm5lci1jb250YWluZXIgY29udGFpbmVyMlwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTFcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUyXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlM1wiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTRcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSlcbiAgICAgICAgKSwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJzcGlubmVyLWNvbnRhaW5lciBjb250YWluZXIzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlMVwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImNpcmNsZTJcIiwgc3R5bGU6IGNpcmNsZVN0eWxlfSksIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJjaXJjbGUzXCIsIHN0eWxlOiBjaXJjbGVTdHlsZX0pLCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiY2lyY2xlNFwiLCBzdHlsZTogY2lyY2xlU3R5bGV9KVxuICAgICAgICApXG4gICAgICApXG5cbiAgICApXG4gIH0sXG59KVxuIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG52YXIgSG9yaXphbnRhbFNwaW5uZXIgPSByZXF1aXJlKCcuL2hvcml6YW50YWxfc3Bpbm5lci5qcy5taW4uanMnKVxudmFyIExvYWRpbmdTcGlubmVyID0gcmVxdWlyZSgnLi9sb2FkaW5nX3NwaW5uZXIuanMubWluLmpzJylcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICBsb2FkaW5nICA9IHRydWVcbiAgICBpZih0aGlzLnByb3BzLnByb3NwZWN0LmNvbXBhbnkpXG4gICAgICBpZih0aGlzLnByb3BzLnByb3NwZWN0LmNvbXBhbnkuZW1haWxfcGF0dGVybilcbiAgICAgICAgbG9hZGluZyAgPSBmYWxzZVxuICAgIGlmKCF0aGlzLnByb3BzLnByb3NwZWN0LmNvbXBhbnlfbmFtZS5sZW5ndGgpXG4gICAgICBsb2FkaW5nID0gZmFsc2VcbiAgICByZXR1cm4geyBcbiAgICAgIHByb3NwZWN0OiB0aGlzLnByb3BzLnByb3NwZWN0LFxuICAgICAgY2hlY2tlZDogZmFsc2UsXG4gICAgICBpbml0aWFsTG9hZGluZzogbG9hZGluZyxcbiAgICAgIGxvYWRpbmc6IGxvYWRpbmcsXG4gICAgICBlZGl0TW9kZTogZmFsc2UsXG4gICAgICBtb3VzZU92ZXI6IGZhbHNlXG4gICAgfVxuICB9LFxuXG4gIG1vdXNlRW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe21vdXNlT3ZlcjogdHJ1ZX0pXG4gIH0sXG5cbiAgbW91c2VMZWF2ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7bW91c2VPdmVyOiBmYWxzZX0pXG4gIH0sXG5cbiAgY2xpY2tDaGVjazogZnVuY3Rpb24oZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICBkb21Ob2RlID0gdGhpcy5nZXRET01Ob2RlKClcbiAgICAvL2lzQ2hlY2tlZCA9ICQoJChkb21Ob2RlKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkucHJvcCgnY2hlY2tlZCcpXG4gICAgaXNDaGVja2VkID0gJCgkKGRvbU5vZGUpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpWzBdKS5wcm9wKCdjaGVja2VkJylcbiAgICAkKCQodGhpcy5nZXRET01Ob2RlKCkpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpWzBdKS5jbGljaygpXG4gICAgLy9jb25zb2xlLmxvZyhpc0NoZWNrZWQpXG4gICAgdGhpcy5zZXRTdGF0ZSh7Y2hlY2tlZDogaXNDaGVja2VkfSlcbiAgICB0aGlzLnByb3BzLmNoZWNrYm94QWN0aW9uKGlzQ2hlY2tlZCwgdGhpcy5zdGF0ZS5wcm9zcGVjdC5vYmplY3RJZClcbiAgfSxcblxuICByb3dDbGljazogZnVuY3Rpb24oKSB7XG4gICAgJCgkKHRoaXMuZ2V0RE9NTm9kZSgpKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKVswXSkuY2xpY2soKVxuICB9LFxuXG4gIGtleWJvYXJkQ2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICQoJCgnLmtleVNlbGVjdCcpLmZpbmQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpWzBdKS5jbGljaygpXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAvL1xuICB9LFxuXG4gIF9tYWtlX2VtYWlsOiBmdW5jdGlvbihuYW1lLCBwYXR0ZXJuKSB7XG4gICAgbmFtZSA9IG5hbWUudHJpbSgpXG4gICAgdmFycyA9IHtcbiAgICAgIGZpcnN0X25hbWU6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKSxcbiAgICAgIGxhc3RfbmFtZTogXy5sYXN0KG5hbWUuc3BsaXQoJyAnKSksXG4gICAgICBmaXJzdF9pbml0aWFsOiBfLmZpcnN0KG5hbWUuc3BsaXQoJyAnKSlbMF0sXG4gICAgICBsYXN0X2luaXRpYWw6IF8ubGFzdChuYW1lLnNwbGl0KCcgJykpWzBdLFxuICAgICAgZG9tYWluOiBwcm9zcGVjdC5jb21wYW55LmRvbWFpblxuICAgIH1cbiAgICBwYXR0ZXJuID0gKHBhdHRlcm5bMF0pID8gcGF0dGVyblswXS5wYXR0ZXJuIDogXCJcIlxuICAgIHByb3NwZWN0X2VtYWlsID0gTXVzdGFjaGUucmVuZGVyKHBhdHRlcm4sIHZhcnMpLnRvTG93ZXJDYXNlKClcbiAgICAvL2NvbnNvbGUuZGVidWcoJ1BST1NQRUNUIEVNQUlMJylcbiAgICAvL2NvbnNvbGUuZGVidWcocHJvc3BlY3RfZW1haWwpXG4gICAgcmV0dXJuIFJlYWRPbmx5Rm9ybSh7aWNvbjogXCJlbnZlbG9wZVwiLCB2YWx1ZTogcHJvc3BlY3RfZW1haWx9KVxuICB9LFxuXG4gIHJlYWx0aW1lQ29tcGFueUluZm86IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgY2hhbm5lbC5iaW5kKHRoaXMuc3RhdGUucHJvc3BlY3QuY29tcGFueV9uYW1lLnJlcGxhY2UoJyAnLCctJyksIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIF9wcm9zcGVjdCA9IF90aGlzLnN0YXRlLnByb3NwZWN0OyBfcHJvc3BlY3QuY29tcGFueSA9IGRhdGEuY29tcGFueTtcbiAgICAgIF90aGlzLnNldFN0YXRlKHtwcm9zcGVjdDogX3Byb3NwZWN0fSlcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEuY29tcGFueSlcbiAgICAgIGNvbnNvbGUubG9nKCdubyBsaXN0ZW5pbmcgZm9yIGVtYWlsJylcbiAgICAgIGlmKF9wcm9zcGVjdC5jb21wYW55LmVtYWlsX3BhdHRlcm4pe1xuICAgICAgICAgX3RoaXMuc2V0U3RhdGUoe2xvYWRpbmc6IGZhbHNlfSkgXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygnYmluZGluZyBmb3IgZW1haWwgcGF0dGVybicpXG4gICAgICAgIGNvbnNvbGUubG9nKGRhdGEuY29tcGFueS5kb21haW4pXG4gICAgICAgIF90aGlzLnJlYWx0aW1lRW1haWxQYXR0ZXJuKGRhdGEuY29tcGFueS5kb21haW4pXG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgcmVhbHRpbWVFbWFpbFBhdHRlcm46IGZ1bmN0aW9uKGRvbWFpbikge1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgY2hhbm5lbC5iaW5kKGRvbWFpbiwgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgLy8gYWRkIGVtYWlsIHBhdHRlcm5cbiAgICAgIGNvbnNvbGUubG9nKCdnb3QgZW1haWwgcGF0dGVybicpXG4gICAgICBjb25zb2xlLmxvZyhkYXRhKVxuICAgICAgY29uc29sZS5sb2coX3RoaXMuc3RhdGUucHJvc3BlY3QpXG4gICAgICBfcHJvc3BlY3QgPSBfdGhpcy5zdGF0ZS5wcm9zcGVjdFxuICAgICAgaWYoX3Byb3NwZWN0LmNvbXBhbnkpXG4gICAgICAgIF9wcm9zcGVjdC5jb21wYW55LmVtYWlsX3BhdHRlcm4gPSBkYXRhLmVtYWlsX3BhdHRlcm5cbiAgICAgIGVsc2VcbiAgICAgICAgX3Byb3NwZWN0LmNvbXBhbnk9IHsnZW1haWxfcGF0dGVybic6IGRhdGEuZW1haWxfcGF0dGVybn1cblxuICAgICAgX3RoaXMuc2V0U3RhdGUoe3Byb3NwZWN0OiBwcm9zcGVjdH0pXG4gICAgICBfdGhpcy5zZXRTdGF0ZSh7bG9hZGluZzogZmFsc2V9KVxuICAgIH0pXG4gIH0sXG5cbiAgY29tcG9uZW50RGlkTW91bnQ6IGZ1bmN0aW9uKCkgeyBcbiAgICAvL1RPRE8gLSBzdGFydCBpZiBsb2FkaW5nIGlzIHRydWUgXG4gICAgLy9pZih0aGlzLnN0YXRlLmxvYWRpbmcpe1xuICAgICAgaWYodGhpcy5zdGF0ZS5wcm9zcGVjdC5jb21wYW55KVxuICAgICAgICB0aGlzLnJlYWx0aW1lRW1haWxQYXR0ZXJuKHRoaXMuc3RhdGUucHJvc3BlY3QuY29tcGFueS5kb21haW4pXG4gICAgICBlbHNlXG4gICAgICAgIHRoaXMucmVhbHRpbWVDb21wYW55SW5mbyh0aGlzLnN0YXRlLnByb3NwZWN0LmNvbXBhbnlfbmFtZSlcbiAgICAvL31cbiAgfSxcblxuICBfa2V5Ym9hcmRTaG9ydGN1dHM6IGZ1bmN0aW9uKCkge1xuICAgIGtleWJvYXJkU2VsZWN0ZWQgPSB7Ym9yZGVyTGVmdDonN3B4IHNvbGlkIHJnYmEoMCwwLDAsMCknfVxuICAgIHRoaXNzc3MgPSB0aGlzXG4gICAgaWYodGhpcy5wcm9wcy5rZXlib2FyZFNlbGVjdGVkKSB7XG4gICAgICBrZXlib2FyZFNlbGVjdGVkID0ge2JvcmRlckxlZnQ6JzdweCBzb2xpZCAjMDA5NmZmICFpbXBvcnRhbnQnfVxuICAgICAgTW91c2V0cmFwLnVuYmluZCgneCcpXG4gICAgICBNb3VzZXRyYXAuYmluZCgneCcsIGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgdGhpc3Nzcy5rZXlib2FyZENsaWNrKClcbiAgICAgICAgaWYodGhpc3Nzcy5zdGF0ZS5jaGVja2VkKVxuICAgICAgICAgIGNvbnNvbGUubG9nKFwibG1hb1wiKVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcHJvc3BlY3QgPSB0aGlzLnN0YXRlLnByb3NwZWN0XG4gICAgaWYodGhpcy5wcm9wcy5tYXN0ZXJDaGVja2JveENoZWNrZWQgJiYgdGhpcy5zdGF0ZS5jaGVja2VkKVxuICAgICAgY2hlY2tlZCA9IHRydWVcbiAgICBlbHNlIGlmKHRoaXMucHJvcHMuYWxyZWFkeUNoZWNrZWQpXG4gICAgICBjaGVja2VkID0gdHJ1ZVxuICAgIGVsc2UgaWYodGhpcy5zdGF0ZS5jaGVja2VkKVxuICAgICAgY2hlY2tlZCA9IHRydWVcbiAgICBlbHNlIGlmKHRoaXMucHJvcHMubWFzdGVyQ2hlY2tib3hDaGVja2VkIHx8IHRoaXMuc3RhdGUuY2hlY2tlZClcbiAgICAgIGNoZWNrZWQgPSB0cnVlXG4gICAgZWxzZVxuICAgICAgY2hlY2tlZCA9IGZhbHNlXG5cbiAgICBjaGVja2VkICAgICAgICA9IHRoaXMuc3RhdGUuY2hlY2tlZCB8fCB0aGlzLnByb3BzLmFscmVhZHlDaGVja2VkXG4gICAgY29sb3IgPSAoY2hlY2tlZCkgPyB7YmFja2dyb3VuZENvbG9yOiAnI2VlZjhmZid9IDoge31cbiAgICBpbmZvQ29sb3IgPSAoY2hlY2tlZCkgPyB7YmFja2dyb3VuZENvbG9yOiAnI2VlZjhmZicscGFkZGluZ0JvdHRvbToyfSA6IHtwYWRkaW5nQm90dG9tOjJ9XG4gICAgY2hlY2tib3hDb2xvciA9IChjaGVja2VkKSA/IHtiYWNrZ3JvdW5kQ29sb3I6ICcjZWVmOGZmJyx2ZXJ0aWNhbEFsaWduOidtaWRkbGUnfSA6IHt2ZXJ0aWNhbEFsaWduOidtaWRkbGUnfVxuICAgIGNvbXBhbnkgPSAocHJvc3BlY3QuY29tcGFueSkgPyBwcm9zcGVjdC5jb21wYW55IDoge31cbiAgICBwcm9zcGVjdF9lbWFpbCA9IFJlYWRPbmx5Rm9ybSh7ZGlzYWJsZWQ6IHRydWUsIGljb246IFwiZW52ZWxvcGVcIiwgdmFsdWU6IFwiTm8gRW1haWwgRm91bmRcIn0pXG4gICAgaWYoY29tcGFueS5lbWFpbF9wYXR0ZXJuKVxuICAgICAgaWYoY29tcGFueS5lbWFpbF9wYXR0ZXJuLmxlbmd0aClcbiAgICAgICAgcHJvc3BlY3RfZW1haWwgPSB0aGlzLl9tYWtlX2VtYWlsKHByb3NwZWN0Lm5hbWUsIGNvbXBhbnkuZW1haWxfcGF0dGVybilcblxuICAgIC8vY29uc29sZS5sb2cocHJvc3BlY3QubmFtZSlcbiAgICBpZihwcm9zcGVjdC5uYW1lID09IFwiTGlua2VkSW4gTWVtYmVyXCIgfHwgXy5sYXN0KHByb3NwZWN0Lm5hbWUpID09IFwiLlwiKVxuICAgICAgcHJvc3BlY3RfZW1haWwgPSBSZWFkT25seUZvcm0oe2Rpc2FibGVkOiB0cnVlLCBpY29uOiBcImVudmVsb3BlXCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIkFtYmlndW91cyBOYW1lXCJ9KVxuICAgIHByb3NwZWN0X2VtYWlsID0gKHRoaXMuc3RhdGUubG9hZGluZykgPyBMb2FkaW5nTGFiZWwobnVsbCkgOiBwcm9zcGVjdF9lbWFpbFxuICAgIGlmKCF0aGlzLnByb3BzLnByb3NwZWN0LmNvbXBhbnlfbmFtZS5sZW5ndGgpXG4gICAgICAgIHByb3NwZWN0X2VtYWlsID0gXCJcIlxuXG4gICAgaWYoY29tcGFueS5waG9uZSAmJiBjb21wYW55LnBob25lICE9IFwibnVsbFwiKVxuICAgICAgcGhvbmUgPSBSZWFjdC5ET00uZGl2KHtzdHlsZToge2Rpc3BsYXk6J2Jsb2NrJyxwYWRkaW5nVG9wOjJ9fSwgUmVhZE9ubHlGb3JtKHtpY29uOiBcInBob25lXCIsIHZhbHVlOiBjb21wYW55LnBob25lfSkpIFxuICAgIGVsc2UgXG4gICAgICBwaG9uZSA9IFwiXCJcblxuICAgIGNvbXBhbnlfc2l6ZSAgID0gKHRoaXMuc3RhdGUubG9hZGluZykgPyBMb2FkaW5nTGFiZWwobnVsbCkgOiBcIlwiXG4gICAgaWYoY29tcGFueS5oZWFkY291bnQpeyBcbiAgICAgIGNvbXBhbnlfc2l6ZSA9IHByb3NwZWN0LmNvbXBhbnkuaGVhZGNvdW50K1wiIGVtcGxveWVlc1wiIFxuICAgIH1cblxuICAgIGlmKGNvbXBhbnkuYWRkcmVzcylcbiAgICAgIGNpdHkgPSAoY29tcGFueS5hZGRyZXNzKSA/IGNvbXBhbnkuYWRkcmVzcy5ub3JtYWxpemVkTG9jYXRpb24gOiBwcm9zcGVjdC5sb2NhbGVcbiAgICBlbHNlIGlmKHByb3NwZWN0LmxvY2FsZSAhPSBcIlwiICYmIHByb3NwZWN0LmxvY2FsZSlcbiAgICAgIGNpdHkgPSBwcm9zcGVjdC5sb2NhbGVcbiAgICBlbHNlIGlmKF8uaXNFcXVhbChjb21wYW55LCB7fSkpXG4gICAgICBjaXR5ID0gTG9hZGluZ0xhYmVsKG51bGwpXG4gICAgZWxzZVxuICAgICAgY2l0eSA9IFwiXCJcblxuICAgIGNvbXBhbnlfdXJsID0gKGNvbXBhbnkuZG9tYWluKSA/IFNoaW55QnV0dG9uKHtpY29uOiBcImdsb2JlXCIsIGxpbms6IFwiaHR0cDovL1wiK2NvbXBhbnkuZG9tYWlufSkgOiBcIlwiXG4gICAgcG9zaXRpb24gICAgPSAocHJvc3BlY3QudGl0bGUpID8gcHJvc3BlY3QudGl0bGUudHJpbSgpIDogXCJcIlxuXG4gICAgcHJvc3BlY3RfY29tcGFueV9uYW1lID0gcHJvc3BlY3QuY29tcGFueV9uYW1lXG4gICAgcHJvc3BlY3RfbmFtZSA9IHByb3NwZWN0Lm5hbWVcbiAgICBpZighdGhpcy5zdGF0ZS5wcm9zcGVjdC5sb2FkaW5nKXtcbiAgICAgIGlmKHR5cGVvZihwcm9zcGVjdC5jb21wYW55X25hbWUpID09IFwidW5kZWZpbmVkXCIgfHwgcHJvc3BlY3QuY29tcGFueV9uYW1lID09IFwiXCIgfHwgcHJvc3BlY3QuY29tcGFueV9uYW1lID09IFwibm90X2ZvdW5kXCIpXG4gICAgICAgIHByb3NwZWN0X2NvbXBhbnlfbmFtZSA9IFVzZXJVcGRhdGVGb3JtKHt1cGRhdGVQcm9zcGVjdDogdGhpcy51cGRhdGVQcm9zcGVjdCwgdmFyOiBcImNvbXBhbnlfbmFtZVwiLCBwcm9zcGVjdDogdGhpcy5zdGF0ZS5wcm9zcGVjdCwgZm9ybVRleHQ6IFwiRW50ZXIgQ29tcGFueSBOYW1lLlwifSkgXG4gICAgICBpZih0eXBlb2YocHJvc3BlY3QubmFtZSkgPT0gXCJ1bmRlZmluZWRcIiB8fCBwcm9zcGVjdC5uYW1lID09IFwiTGlua2VkSW4gTWVtYmVyXCIpXG4gICAgICAgIHByb3NwZWN0X25hbWUgPSBVc2VyVXBkYXRlRm9ybSh7dXBkYXRlUHJvc3BlY3Q6IHRoaXMudXBkYXRlUHJvc3BlY3QsIHZhcjogXCJuYW1lXCIsIGZvcm1UZXh0OiBcIkVudGVyIEZ1bGwgTmFtZS5cIn0pIFxuICAgICAgaWYodHlwZW9mKHBvc2l0aW9uKSA9PSBcInVuZGVmaW5lZFwiIHx8IHBvc2l0aW9uID09IFwiXCIpXG4gICAgICAgIHBvc2l0aW9uID0gVXNlclVwZGF0ZUZvcm0oe3VwZGF0ZVByb3NwZWN0OiB0aGlzLnVwZGF0ZVByb3NwZWN0LCB2YXI6IFwicG9zXCIsIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0LCBmb3JtVGV4dDogXCJFbnRlciBUaXRsZS5cIn0pIFxuICAgIH1cbiAgICBpZih0aGlzLnN0YXRlLmVkaXRNb2RlKXtcbiAgICAgICAgcGNuID0gcHJvc3BlY3RfY29tcGFueV9uYW1lOyBwbiA9IHByb3NwZWN0X25hbWU7IHBvcyA9IHBvc2l0aW9uO1xuICAgICAgICBwY24gPSAocGNuICE9IFwiXCIgJiYgcGNuKSA/IHBjbiA6IFwiRW50ZXIgQ29tcGFueSBOYW1lLlwiXG4gICAgICAgIHBuICA9IChwbiAhPSBcIlwiICYmIHBuKSA/IHBuIDogXCJFbnRlciBGdWxsIE5hbWUuXCJcbiAgICAgICAgcG9zID0gKHBvcyAhPSBcIlwiICYmIHBvcykgPyBwb3MgOiBcIkVudGVyIFRpdGxlLlwiXG4gICAgICAgIHByb3NwZWN0X2NvbXBhbnlfbmFtZSA9IFVzZXJVcGRhdGVGb3JtKHt1cGRhdGVQcm9zcGVjdDogdGhpcy51cGRhdGVQcm9zcGVjdCwgdmFyOiBcImNvbXBhbnlfbmFtZVwiLCBwcm9zcGVjdDogdGhpcy5zdGF0ZS5wcm9zcGVjdCwgdmFsdWU6IHBjbiwgc2luZ2xlOiAxfSkgXG4gICAgICAgIHByb3NwZWN0X25hbWUgPSBVc2VyVXBkYXRlRm9ybSh7dXBkYXRlUHJvc3BlY3Q6IHRoaXMudXBkYXRlUHJvc3BlY3QsIHZhcjogXCJuYW1lXCIsIHZhbHVlOiBwbiwgc2luZ2xlOiAxfSkgXG4gICAgICAgIHBvc2l0aW9uID0gVXNlclVwZGF0ZUZvcm0oe3VwZGF0ZVByb3NwZWN0OiB0aGlzLnVwZGF0ZVByb3NwZWN0LCB2YXI6IFwicG9zXCIsIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0LCB2YWx1ZTogcG9zLCBzaW5nbGU6IDF9KSBcbiAgICB9XG4gICAgaWYoIXRoaXMucHJvcHMucHJvc3BlY3QuY29tcGFueV9uYW1lLmxlbmd0aClcbiAgICAgICAgcHJvc3BlY3RfY29tcGFueV9uYW1lID0gVXNlclVwZGF0ZUZvcm0oe3VwZGF0ZVByb3NwZWN0OiB0aGlzLnVwZGF0ZVByb3NwZWN0LCB2YXI6IFwiY29tcGFueV9uYW1lXCIsIHByb3NwZWN0OiB0aGlzLnN0YXRlLnByb3NwZWN0LCBmb3JtVGV4dDogXCJFbnRlciBDb21wYW55IE5hbWVcIn0pIFxuXG4gICAgbGlQcm9maWxlU2ltaWxhcnMgPSAocHJvc3BlY3QubGlua2VkaW5fdXJsKSA/IFJlYWN0LkRPTS5hKHtvbkNsaWNrOiB0aGlzLm9wZW5TaW1pbGFycywgc3R5bGU6IHttYXJnaW5MZWZ0OjUsIGZsb2F0OidyaWdodCd9LCBocmVmOiBcImphdmFzY3JpcHQ6XCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXhzIGJ0bi1wcmltYXJ5IGJ0bi1ncmFkaWVudCBzaW1pbGFyX2xpbmtcIn0sIFwiIFwiLCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNvcHlcIiwgc3R5bGU6IHtmb250V2VpZ2h0Oidib2xkJ319KSkgOiBcIlwiXG4gICAgXG4gICAgaWYodHlwZW9mKHByb3NwZWN0X25hbWUpID09IFwic3RyaW5nXCIpXG4gICAgICBpZihwcm9zcGVjdF9uYW1lLmluZGV4T2YoXCIuXCIpICE9IC0xIHx8IHByb3NwZWN0X25hbWUgPT0gXCJMaW5rZWRJbiBNZW1iZXJcIilcbiAgICAgICAgcHJvc3BlY3RfbmFtZSA9IFJlYWN0LkRPTS5zcGFuKG51bGwsIHByb3NwZWN0X25hbWUsIFJlYWN0LkRPTS5idXR0b24oe2NsYXNzTmFtZTogXCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCIsIHN0eWxlOiB7bWFyZ2luTGVmdDo1LG1hcmdpblRvcDotNCx3aWR0aDoyNSxmb250U2l6ZToxMSxsaW5lSGVpZ2h0OjF9LCBvbkNsaWNrOiB0aGlzLnNlYXJjaFByb3NwZWN0fSwgXCIgXCIsIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtc2VhcmNoXCJ9KSkpXG5cbiAgICBvcHRpb25zTWVudSA9IFJlYWN0LkRPTS5kaXYoe3N0eWxlOiB7Zm9udFNpemU6MTAsIGN1cnNvcjoncG9pbnRlcicsaGVpZ2h0OjIwLG1hcmdpblRvcDotMjB9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uYSh7Y2xhc3NOYW1lOiBcInRleHQtbXV0ZWRcIiwgb25DbGljazogdGhpcy50b2dnbGVFZGl0TW9kZX0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiAodGhpcy5zdGF0ZS5lZGl0TW9kZSkgPyBcImZhIGZhLWNoZWNrXCIgOiBcImZhIGZhLXBlbmNpbFwifSlcbiAgICAgICAgICAgICksIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2NsYXNzTmFtZTogXCJ0ZXh0LW11dGVkXCIsIG9uQ2xpY2s6IHRoaXMuc2VhcmNoUHJvc3BlY3QsIHN0eWxlOiB7bWFyZ2luVG9wOjV9fSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtc2VhcmNoXCJ9KVxuICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uYSh7Y2xhc3NOYW1lOiBcInRleHQtbXV0ZWRcIiwgb25DbGljazogdGhpcy5hcmNoaXZlUHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgc3R5bGU6IHttYXJnaW5Ub3A6NX19LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1hcmNoaXZlXCJ9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIFxuICAgIGtleWJvYXJkU2VsZWN0ZWQgPSB7Ym9yZGVyTGVmdDonN3B4IHNvbGlkIHJnYmEoMCwwLDAsMCknfVxuICAgICAgICAgICAgLy9rZXlib2FyZFNlbGVjdGVkID0ge31cbiAgICAvL1xuICAgIGlmKHRoaXMucHJvcHMua2V5Ym9hcmRTZWxlY3RlZCkge1xuICAgICAga2V5Ym9hcmRTZWxlY3RlZCA9IHtib3JkZXJMZWZ0Oic3cHggc29saWQgIzAwOTZmZiAhaW1wb3J0YW50J31cbiAgICB9XG4gICAgXG5cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLnRyKHtjbGFzc05hbWU6IFwicHJvc3BlY3RzLXRyXCIsIFxuICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucm93Q2xpY2ssIFxuICAgICAgICAgIG9uTW91c2VFbnRlcjogdGhpcy5tb3VzZUVudGVyLCBcbiAgICAgICAgICBvbk1vdXNlTGVhdmU6IHRoaXMubW91c2VMZWF2ZSwgXG4gICAgICAgICAgc3R5bGU6IGtleWJvYXJkU2VsZWN0ZWR9LCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjaGVja2JveENvbG9yfSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5pbnB1dCh7dHlwZTogXCJjaGVja2JveFwiLCBcbiAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiB0aGlzLmNsaWNrQ2hlY2ssIFxuICAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHtsaW5lSGVpZ2h0Oidub3JtYWwnLG1hcmdpblRvcDotOCxoZWlnaHQ6MTd9LCBcbiAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGNoZWNrZWR9KVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNoZWNrYm94Q29sb3J9LCBcbiAgICAgICAgICAgICh0aGlzLnN0YXRlLm1vdXNlT3ZlcikgPyBvcHRpb25zTWVudSA6IFJlYWN0LkRPTS5kaXYoe3N0eWxlOiB7aGVpZ2h0OjIwfX0sIFwiwqDCoMKgXCIpXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY2hlY2tib3hDb2xvcn0sIFxuICAgICAgICAgICAodGhpcy5zdGF0ZS5sb2FkaW5nKSA/IExvYWRpbmdQdWxzZShudWxsKSA6IFwiXCIsIFxuICAgICAgICAgICAoIXRoaXMuc3RhdGUubG9hZGluZyAmJiB0aGlzLnN0YXRlLmluaXRpYWxMb2FkaW5nKSA/IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2hlY2stY2lyY2xlIFwiLCBzdHlsZToge2NvbG9yOidyZ2IoMCwgMTIyLCAyNjUpJyxwYWRkaW5nTGVmdDo2LH19KSA6IFwiXCJcbiAgICAgICAgICApLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvciwgY2xhc3NOYW1lOiBcImZpeGVkLWRhdGEtY29sdW1uXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtzdHlsZToge2ZvbnRXZWlnaHQ6J2JvbGQnfX0sIHByb3NwZWN0X25hbWUpLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtmb250V2VpZ2h0Oic0MDAnLG1hcmdpbjonMHB4J319LCBcIiBcIiwgcG9zaXRpb24sIFwiIFwiKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS50ZCh7c3R5bGU6IGNvbG9yLCBjbGFzc05hbWU6IFwiZml4ZWQtZGF0YS1jb2x1bW5cIn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe3N0eWxlOiB7Zm9udFdlaWdodDonYm9sZCd9fSwgXCIgXCIsIHByb3NwZWN0X2NvbXBhbnlfbmFtZSwgXCIgXCIpLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtmb250V2VpZ2h0Oic0MDAnLG1hcmdpbjonMHB4J30sIGNsYXNzTmFtZTogXCJjb21wYW55LXNpemVcIn0sIFxuICAgICAgICAgICAgY29tcGFueV9zaXplXG4gICAgICAgICAgICApLCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtmb250V2VpZ2h0Oic0MDAnLG1hcmdpbjonMHB4JyxkaXNwbGF5Oidub25lJyxmb250U3R5bGU6J2l0YWxpYyd9LCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiY29tcGFueS1zaXplXCJ9LCBcbiAgICAgICAgICAgICAgKHByb3NwZWN0LmluZHVzdHJ5KSA/IHByb3NwZWN0LmluZHVzdHJ5IDogXCJcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICksIFxuXG4gICAgICAgICAgUmVhY3QuRE9NLnRkKHtzdHlsZTogY29sb3J9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHttYXJnaW46JzBweCd9fSwgY2l0eSkpLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBpbmZvQ29sb3J9LCBcIiBcIiwgcHJvc3BlY3RfZW1haWwsIFwiIFwiLCBwaG9uZSwgXCIgXCIpLCBcbiAgICAgICAgICBSZWFjdC5ET00udGQoe3N0eWxlOiBjb2xvcn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7c3R5bGU6IHt3aWR0aDo5MixwYWRkaW5nVG9wOjUsaGVpZ2h0OjV9fSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMub3BlbkxpbmtlZGluUHJvZmlsZSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4teHMgYnRuLXByaW1hcnkgYnRuLWdyYWRpZW50IGxpbmtlZGluX2xpbmtcIiwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtmbG9hdDoncmlnaHQnLG1hcmdpbkxlZnQ6NX19LCBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWxpbmtlZGluLXNxdWFyZVwifSkpLCBcbiAgICAgICAgICAgICAgXCLCoCDCoFwiLCBcbiAgICAgICAgICAgICAgbGlQcm9maWxlU2ltaWxhcnMsIFxuICAgICAgICAgICAgICBjb21wYW55X3VybFxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgc2VhcmNoUHJvc3BlY3Q6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgdXJsID0gXCJodHRwOi8vd3d3Lmdvb2dsZS5jb20vI3E9XCJcbiAgICBwcm9zcGVjdCA9IHRoaXMuc3RhdGUucHJvc3BlY3RcbiAgICBuYW1lID0gKHByb3NwZWN0Lm5hbWUgIT0gXCJMaW5rZWRJbiBNZW1iZXJcIikgPyBwcm9zcGVjdC5uYW1lIDogXCJcIlxuICAgIGFyZ3MgPSAnLWludXJsOlwiL2Rpci9cIiAtaW51cmw6XCIvZmluZC9cIiAtaW51cmw6XCIvdXBkYXRlc1wiJ1xuICAgIGlmKG5hbWUgPT0gXCJcIiAmJiBwcm9zcGVjdC5jb21wYW55X25hbWUgIT0gXCJub3RfZm91bmRcIilcbiAgICAgIGxpbmtlZGluID0gJ1wiYXQgJytwcm9zcGVjdC5jb21wYW55X25hbWUrJ1wiIHNpdGU6bGlua2VkaW4uY29tICcrYXJnc1xuICAgIGVsc2VcbiAgICAgIGxpbmtlZGluID0gXCIgc2l0ZTpsaW5rZWRpbi5jb20vaW4vIE9SIHNpdGU6bGlua2VkaW4uY29tL3B1Yi8gLXNpdGU6bGlua2VkaW4uY29tL3B1Yi9kaXIvXCJcbiAgICB3aW5kb3cub3Blbih1cmwrbmFtZStcIiBcIitwcm9zcGVjdC5jb21wYW55X25hbWUrXCIgXCIrcHJvc3BlY3QudGl0bGUrbGlua2VkaW4pXG4gIH0sXG5cbiAgYXJjaGl2ZVByb3NwZWN0czogZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2codGhpcy5nZXRET01Ob2RlKCkpXG4gICAgLy8kKHRoaXMuZ2V0RE9NTm9kZSgpKS5jbGljaygpXG4gICAgdGhpcy5wcm9wcy5hcmNoaXZlUHJvc3BlY3RzKFt0aGlzLnN0YXRlLnByb3NwZWN0Lm9iamVjdElkXSlcbiAgfSxcblxuICB0b2dnbGVFZGl0TW9kZTogZnVuY3Rpb24oZSkge1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgICB0aGlzLnNldFN0YXRlKHtlZGl0TW9kZTogIXRoaXMuc3RhdGUuZWRpdE1vZGV9KVxuICB9LFxuXG4gIG9wZW5UZXN0OiBmdW5jdGlvbigpIHtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gIH0sXG5cbiAgb3BlbkxpbmtlZGluUHJvZmlsZTogZnVuY3Rpb24oZSkge1xuICAgIHdpbmRvdy5vcGVuKHRoaXMuc3RhdGUucHJvc3BlY3QubGlua2VkaW5fdXJsKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgfSxcblxuICBlbWFpbElucHV0Q2xpY2s6IGZ1bmN0aW9uKGUpIHtlLnN0b3BQcm9wYWdhdGlvbigpIH0sXG5cbiAgb3BlblNpbWlsYXJzOiBmdW5jdGlvbihlKSB7XG4gICAgLy8gVE9ETyAtIG1vdmUgdG8gYmFja2VuZFxuICAgIGNvbnNvbGUubG9nKCdzaW1pbGFycycpXG4gICAgaWYodGhpcy5zdGF0ZS5wcm9zcGVjdC5saW5rZWRpbl91cmwuaW5kZXhPZigncHJvZmlsZScpICE9IC0xKXtcbiAgICAgIHVybGFyZ3MgPSB0aGlzLnN0YXRlLnByb3NwZWN0LmxpbmtlZGluX3VybC5zcGxpdCgnPycpWzFdLnNwbGl0KCcmJylcbiAgICAgIGFyZ3MgPSBbXVxuICAgICAgZm9yKGk9MDtpPCB1cmxhcmdzLmxlbmd0aDsgaSsrKVxuICAgICAgICBhcmdzLnB1c2godXJsYXJnc1tpXS5zcGxpdCgnPScpKVxuICAgICAgYXJncyA9IF8ub2JqZWN0KGFyZ3MpXG4gICAgfVxuICAgIHdpbmRvdy5vcGVuKFwiaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL3ZzZWFyY2gvcD9waXZvdFR5cGU9c2ltJnBpZD1cIithcmdzLmlkKVxuICAgIGUuc3RvcFByb3BhZ2F0aW9uKClcbiAgfSxcblxuICBkZWxldGVQcm9zcGVjdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5kZWxldGVQcm9zcGVjdCh0aGlzLnN0YXRlLnByb3NwZWN0Lm9iamVjdElkLCAnUHJvc3BlY3QnKVxuICB9LFxuICBcbiAgdXBkYXRlUHJvc3BlY3Q6IGZ1bmN0aW9uKHByb3AsIHZhbHVlKSB7XG4gICAgcHJvc3BlY3QgPSB0aGlzLnN0YXRlLnByb3NwZWN0XG4gICAgcHJvc3BlY3RbcHJvcF0gPSB2YWx1ZVxuICAgIHRoaXMuc2V0U3RhdGUoe3Byb3NwZWN0OiBwcm9zcGVjdH0pXG4gIH0sXG4gIFxuICByZWZyZXNoOiBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdFxuICAgIGNvbnNvbGUubG9nKHByb3NwZWN0KVxuXG4gICAgJC5hamF4KHtcbiAgICAgIC8vdXJsOidodHRwczovL25hbWVsZXNzLXJldHJlYXQtMzUyNS5oZXJva3VhcHAuY29tL3Byb2ZpbGVfZGV0YWlsJyxcbiAgICAgIHVybDonaHR0cDovLzEyNy4wLjAuMTo1MDAwL3Byb2ZpbGVfZGV0YWlsJyxcbiAgICAgIHR5cGU6J0dFVCcsXG4gICAgICBkYXRhVHlwZTonanNvbicsXG4gICAgICBkYXRhOiBwcm9zcGVjdCxcbiAgICAgIC8vaGVhZGVyczphcHBDb25maWcuaGVhZGVycyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyLnJlc3BvbnNlVGV4dCkgfVxuICAgIH0pXG4gIH0sXG59KTtcblxudmFyIFVzZXJVcGRhdGVGb3JtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnVXNlclVwZGF0ZUZvcm0nLFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdWJtaXR0ZWQ6IGZhbHNlLFxuICAgICAgdmFsdWU6IHRoaXMucHJvcHMudmFsdWVcbiAgICB9XG4gIH0sXG5cbiAgZm9ybUNsaWNrOiBmdW5jdGlvbihlKSB7IGUuc3RvcFByb3BhZ2F0aW9uKCkgfSxcblxuICBzdWJtaXRGb3JtOiBmdW5jdGlvbihlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHRoaXMucHJvcHMudXBkYXRlUHJvc3BlY3QodGhpcy5wcm9wcy52YXIsICQoZS50YXJnZXQpLmZpbmQoJ2lucHV0JykudmFsKCkpXG4gICAgdGhpcy5zZXRTdGF0ZSh7c3VibWl0dGVkOiB0cnVlfSlcbiAgICBwcm9zcGVjdCA9IHRoaXMucHJvcHMucHJvc3BlY3RcbiAgICBwcm9zcGVjdFt0aGlzLnByb3BzLnZhcl0gPSAkKGUudGFyZ2V0KS5maW5kKCdpbnB1dCcpLnZhbCgpXG5cbiAgICAvLyBwZXJzaXN0XG4gICAgZGF0YSA9IHt9XG4gICAgdmFyciA9IHRoaXMucHJvcHMudmFyXG4gICAgdmFsID0gJChlLnRhcmdldCkuZmluZCgnaW5wdXQnKS52YWwoKVxuICAgIGRhdGFbdmFycl0gPSB2YWxcbiAgICBvYmplY3RJZCA9IHRoaXMuc3RhdGUucHJvc3BlY3Qub2JqZWN0SWRcblxuICAgICQuYWpheCh7XG4gICAgICAvL3VybDonaHR0cHM6Ly9uYW1lbGVzcy1yZXRyZWF0LTM1MjUuaGVyb2t1YXBwLmNvbS9wcm9maWxlX2RldGFpbCcsXG4gICAgICB1cmw6J2h0dHA6Ly8xMjcuMC4wLjE6NTAwMC9wcm9maWxlX2RldGFpbCcsXG4gICAgICBkYXRhOiBwcm9zcGVjdCxcbiAgICAgIC8vaGVhZGVyczphcHBDb25maWcuaGVhZGVycyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyLnJlc3BvbnNlVGV4dCkgfVxuICAgIH0pXG5cbiAgICAvKlxuICAgICQuYWpheCh7XG4gICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvUHJvc3BlY3QvJytvYmplY3RJZCxcbiAgICAgIHR5cGU6ICdQVVQnLFxuICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICBoZWFkZXJzOiBhcHBDb25maWcuaGVhZGVycyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpIFxuICAgICAgICAvLyBzZW50IGN1cnJlbnQgcHJvc3BlY3Qgc3RhdGUgYXMgZGF0YSB0byBcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICB1cmw6J2h0dHBzOi8vbmFtZWxlc3MtcmV0cmVhdC0zNTI1Lmhlcm9rdWFwcC5jb20vcHJvZmlsZV9kZXRhaWwnLFxuICAgICAgICAgIGRhdGE6IHByb3NwZWN0LFxuICAgICAgICAgIGhlYWRlcnM6YXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7IGNvbnNvbGUubG9nKHJlcyl9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyLnJlc3BvbnNlVGV4dCkgfVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyLnJlc3BvbnNlVGV4dCkgfVxuICAgIH0pXG4gICAgKi9cbiAgfSxcblxuICBoYW5kbGVDaGFuZ2U6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgY29uc29sZS5sb2coZXZlbnQudGFyZ2V0LnZhbHVlKVxuICAgIHRoaXMuc2V0U3RhdGUoe3ZhbHVlOiBldmVudC50YXJnZXQudmFsdWV9KTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vXCJFbnRlciBXZWJzaXRlLlwiXG4gICAgYnRuID0gKHRoaXMuc3RhdGUuc3VibWl0dGVkKSA/IFwiYnRuIGJ0bi14cyBidG4tc3VjY2Vzc1wiIDogXCJidG4gYnRuLXhzIGJ0bi1kZWZhdWx0XCJcbiAgICBzaW5nbGUgPSB7ZGlzcGxheTonaW5saW5lJywgd2lkdGg6MjIsIG1hcmdpbkxlZnQ6NX1cbiAgICBzaW5nbGUuZGlzcGxheSA9ICh0aGlzLnByb3BzLnNpbmdsZSkgPyAnbm9uZScgOiAnaW5saW5lJ1xuICAgIGlucHV0ID0ge3dpZHRoOicxMDAlJywgZGlzcGxheTonaW5saW5lJywgaGVpZ2h0OjI0LCBtYXJnaW5Cb3R0b206Nn1cbiAgICBpbnB1dC53aWR0aCA9ICh0aGlzLnByb3BzLnNpbmdsZSkgPyAnMTAwJScgOiAnNzAlJ1xuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZm9ybSh7b25DbGljazogdGhpcy5mb3JtQ2xpY2ssIG9uU3VibWl0OiB0aGlzLnN1Ym1pdEZvcm19LCBcbiAgICAgICAgUmVhY3QuRE9NLmlucHV0KHtzdHlsZTogaW5wdXQsIFxuICAgICAgICAgIHR5cGU6IFwidGV4dFwiLCBjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIsIFxuICAgICAgICAgIGRpc2FibGVkOiB0aGlzLnN0YXRlLnN1Ym1pdHRlZCwgXG4gICAgICAgICAgb25DaGFuZ2U6IHRoaXMuaGFuZGxlQ2hhbmdlLCBcbiAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS52YWx1ZSwgXG4gICAgICAgICAgcGxhY2Vob2xkZXI6IHRoaXMucHJvcHMuZm9ybVRleHR9KSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwic3VibWl0XCIsIGNsYXNzTmFtZTogYnRuLCBcbiAgICAgICAgICBzdHlsZTogc2luZ2xlfSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1jaGVja1wifSkpXG4gICAgICApXG4gICAgKVxuICB9LFxuXG4gIHByb2ZpbGVTZWFyY2g6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICB1cmwgPSBcImh0dHA6Ly93d3cuZ29vZ2xlLmNvbS8jcT1cIlxuICAgIHByb3NwZWN0ID0gdGhpcy5zdGF0ZS5wcm9zcGVjdFxuICAgIG5hbWUgPSAocHJvc3BlY3QubmFtZSAhPSBcIkxpbmtlZEluIE1lbWJlclwiKSA/IHByb3NwZWN0Lm5hbWUgOiBcIlwiXG4gICAgYXJncyA9ICctaW51cmw6XCIvZGlyL1wiIC1pbnVybDpcIi9maW5kL1wiIC1pbnVybDpcIi91cGRhdGVzXCInXG4gICAgaWYobmFtZSA9PSBcIlwiICYmIHByb3NwZWN0LmNvbXBhbnlfbmFtZSAhPSBcIm5vdF9mb3VuZFwiKVxuICAgICAgbGlua2VkaW4gPSAnXCJhdCAnK3Byb3NwZWN0LmNvbXBhbnlfbmFtZSsnXCIgc2l0ZTpsaW5rZWRpbi5jb20gJythcmdzXG4gICAgZWxzZVxuICAgICAgbGlua2VkaW4gPSBcIiBzaXRlOmxpbmtlZGluLmNvbS9pbi8gT1Igc2l0ZTpsaW5rZWRpbi5jb20vcHViLyAtc2l0ZTpsaW5rZWRpbi5jb20vcHViL2Rpci9cIlxuICAgIHdpbmRvdy5vcGVuKHVybCtuYW1lK1wiIFwiK3Byb3NwZWN0LmNvbXBhbnlfbmFtZStcIiBcIitwcm9zcGVjdC5wb3MrbGlua2VkaW4pXG4gIH0sXG5cbiAgd2Vic2l0ZVNlYXJjaDogZnVuY3Rpb24oZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIHVybCA9IFwiaHR0cDovL3d3dy5nb29nbGUuY29tLyNxPVwiXG4gICAgd2luZG93Lm9wZW4odXJsK3RoaXMuc3RhdGUucHJvc3BlY3QuY29tcGFueV9uYW1lK1wiIHNpdGU6bGlua2VkaW4uY29tL2NvbXBhbnlcIilcbiAgfSxcblxuICBfbWFrZV9lbWFpbDogZnVuY3Rpb24obmFtZSwgcGF0dGVybikge1xuICAgIG5hbWUgPSBuYW1lLnRyaW0oKVxuICAgIHZhcnMgPSB7XG4gICAgICBmaXJzdF9uYW1lOiBfLmZpcnN0KG5hbWUuc3BsaXQoJyAnKSksXG4gICAgICBsYXN0X25hbWU6IF8ubGFzdChuYW1lLnNwbGl0KCcgJykpLFxuICAgICAgZmlyc3RfaW5pdGlhbDogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpWzBdLFxuICAgICAgbGFzdF9pbml0aWFsOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKVswXSxcbiAgICAgIGRvbWFpbjogcHJvc3BlY3QuY29tcGFueS5kb21haW5cbiAgICB9XG4gICAgcGF0dGVybiA9IChwYXR0ZXJuKSA/IHBhdHRlcm5bMF0ucGF0dGVybiA6IFwiXCJcbiAgICBwcm9zcGVjdF9lbWFpbCA9IE11c3RhY2hlLnJlbmRlcihwYXR0ZXJuLCB2YXJzKS50b0xvd2VyQ2FzZSgpXG4gICAgLy9jb25zb2xlLmRlYnVnKCdQUk9TUEVDVCBFTUFJTCcpXG4gICAgLy9jb25zb2xlLmRlYnVnKHByb3NwZWN0X2VtYWlsKVxuICAgIHJldHVybiBSZWFkT25seUZvcm0oe2ljb246IFwiZW52ZWxvcGVcIiwgdmFsdWU6IHByb3NwZWN0X2VtYWlsfSlcblxuICAgIGlmKHByb3NwZWN0X2VtYWlsKSB7XG4gICAgICAgIHByb3NwZWN0X2VtYWlsID0gKHByb3NwZWN0X2VtYWlsKSA/IHByb3NwZWN0X2VtYWlsLnRvTG93ZXJDYXNlKCkgOiBcIlwiXG4gICAgICAgIHByb3NwZWN0X2VtYWlsID0gUmVhY3QuRE9NLmlucHV0KHtvbkNsaWNrOiB0aGlzLmVtYWlsSW5wdXRDbGljaywgdHlwZTogXCJ0ZXh0XCIsIHZhbHVlOiBwcm9zcGVjdF9lbWFpbCwgY2xhc3NOYW1lOiBcImZvcm0tY29udHJvbCBmb3JtLXNtXCIsIHN0eWxlOiB7Zm9udFNpemU6MTIsIHdpZHRoOjE2MCwgaGVpZ2h0OjIyLCBtYXJnaW5Ub3A6IDB9fSlcbiAgICAgICAgcHJvc3BlY3RfZW1haWwgPSBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiaW5wdXQtZ3JvdXAgaW5wdXQtZ3JvdXAteHNcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwiaW5wdXQtZ3JvdXAtYWRkb25cIiwgaWQ6IFwic2l6aW5nLWFkZG9uM1wiLCBzdHlsZToge3BhZGRpbmdUb3A6MixwYWRkaW5nQm90dG9tOjJ9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWVudmVsb3BlXCJ9KVxuICAgICAgICAgICksIFxuICAgICAgICAgIHByb3NwZWN0X2VtYWlsXG4gICAgICAgIClcbiAgICB9XG4gICAgcmV0dXJuIGVtYWlsXG4gIH0sXG59KVxuXG52YXIgUmVhZE9ubHlGb3JtID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnUmVhZE9ubHlGb3JtJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBzdHlsZSA9IHtmb250U2l6ZToxMiwgd2lkdGg6JzcwJScsIGhlaWdodDoyMiwgbWFyZ2luVG9wOiAwLCB6SW5kZXg6MSxjdXJzb3I6J2RlZmF1bHQnfVxuXG4gICAgc3R5bGUuZm9udFN0eWxlID0gKHRoaXMucHJvcHMuZGlzYWJsZWQpID8gJ2l0YWxpYycgOiAnJ1xuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiaW5wdXQtZ3JvdXAgaW5wdXQtZ3JvdXAteHNcIiwgc3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snfX0sIFxuICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcImlucHV0LWdyb3VwLWFkZG9uXCIsIGlkOiBcInNpemluZy1hZGRvbjNcIiwgXG4gICAgICAgICAgc3R5bGU6IHtwYWRkaW5nVG9wOjIscGFkZGluZ0JvdHRvbToyLGRpc3BsYXk6J2lubGluZS1ibG9jaycsXG4gICAgICAgICAgICAgICAgICBoZWlnaHQ6MjIsd2lkdGg6MzcsZmxvYXQ6J2xlZnQnLG1hcmdpblRvcDowfX0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtXCIrdGhpcy5wcm9wcy5pY29ufSlcbiAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmlucHV0KHtkaXNhYmxlZDogdGhpcy5wcm9wcy5kaXNhYmxlZCwgb25DbGljazogdGhpcy5lbWFpbElucHV0Q2xpY2ssIHR5cGU6IFwidGV4dFwiLCB2YWx1ZTogdGhpcy5wcm9wcy52YWx1ZSwgY2xhc3NOYW1lOiBcImZvcm0tY29udHJvbCBmb3JtLXNtXCIsIHN0eWxlOiBzdHlsZX0pXG4gICAgICApXG4gICAgKVxuICB9LFxuICBlbWFpbElucHV0Q2xpY2s6IGZ1bmN0aW9uKGUpIHtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gIH1cbn0pXG5cbnZhciBMb2FkaW5nTGFiZWwgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdMb2FkaW5nTGFiZWwnLFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICAgIFJlYWN0LkRPTS5sYWJlbCh7Y2xhc3NOYW1lOiBcImxhYmVsIGxhYmVsLXByaW1hcnlcIiwgc3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6ICdyZ2IoMCwgMTIyLCAyNjUpJ319LCBcIkxvYWRpbmcuLi5cIilcbiAgICApXG4gIH0gICBcbn0pXG5cbnZhciBXYXJuaW5nTGFiZWwgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdXYXJuaW5nTGFiZWwnLFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICAgIFJlYWN0LkRPTS5sYWJlbCh7Y2xhc3NOYW1lOiBcImxhYmVsIGxhYmVsLXdhcm5pbmdcIiwgc3R5bGU6IHtkaXNwbGF5OidibG9jaycsd2lkdGg6JzkwJSd9fSwgXCJXYXJuaW5nLi4uXCIpXG4gICAgKVxuICB9ICAgXG59KVxuXG52YXIgU2hpbnlCdXR0b24gPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdTaGlueUJ1dHRvbicsXG4gIG9wZW5MaW5rOiBmdW5jdGlvbihlKSB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgIHdpbmRvdy5vcGVuKHRoaXMucHJvcHMubGluaylcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgIG9uQ2xpY2s6IHRoaXMub3BlbkxpbmssIFxuICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4teHMgYnRuLXByaW1hcnkgYnRuLWdyYWRpZW50XCIsIFxuICAgICAgICAgc3R5bGU6IHttYXJnaW5MZWZ0Oi01LCBmbG9hdDoncmlnaHQnfX0sIFxuICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtZ2xvYmVcIn0pXG4gICAgICApXG4gICAgKVxuICB9XG59KVxuXG52YXIgTG9hZGluZ1B1bHNlID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnTG9hZGluZ1B1bHNlJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInByb2ZpbGUtbG9hZGluZ1wiLCBzdHlsZToge21hcmdpblRvcDowfX0sIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiZG91YmxlLWJvdW5jZTFcIiwgc3R5bGU6IHtiYWNrZ3JvdW5kQ29sb3I6J3JnYigwLCAxMjIsIDI2NSknfX0pLCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImRvdWJsZS1ib3VuY2UyXCIsIHN0eWxlOiB7YmFja2dyb3VuZENvbG9yOidyZ2IoMCwgMTIyLCAyNjUpJ319KVxuICAgICAgKVxuICAgIClcbiAgfVxufSlcbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICBjaGVja2JveEFjdGlvbjogZnVuY3Rpb24oZSkge1xuICAgIGNoZWNrYm94VmFsID0gJChlLnRhcmdldCkuaXMoJzpjaGVja2VkJylcbiAgICBjaGVja2JveGVzID0gXy5yZXN0KCQoJ2JvZHknKS5maW5kKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSlcbiAgICBjb25zb2xlLmxvZyhjaGVja2JveGVzKVxuICAgIGlmKGNoZWNrYm94VmFsKXtcbiAgICAgIF8ubWFwKGNoZWNrYm94ZXMsIGZ1bmN0aW9uKGNoZWNrYm94KXtcbiAgICAgICAgaWYoISQoY2hlY2tib3gpLnByb3AoJ2NoZWNrZWQnKSlcbiAgICAgICAgICAkKGNoZWNrYm94KS5jbGljaygpXG4gICAgICB9KVxuICAgICAgXG4gICAgfSBlbHNlIHtcbiAgICAgIF8ubWFwKGNoZWNrYm94ZXMsIGZ1bmN0aW9uKGNoZWNrYm94KXtcbiAgICAgICAgaWYoJChjaGVja2JveCkucHJvcCgnY2hlY2tlZCcpKVxuICAgICAgICAgICQoY2hlY2tib3gpLmNsaWNrKClcbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcblxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgICAgIFJlYWN0LkRPTS50cihudWxsLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKHtzdHlsZToge3BhZGRpbmdMZWZ0OjExfX0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pbnB1dCh7dHlwZTogXCJjaGVja2JveFwiLCBvbkNoYW5nZTogdGhpcy5jaGVja2JveEFjdGlvbn0pXG4gICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgoe3N0eWxlOiB7d2lkdGg6MjB9fSksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCksIFxuICAgICAgICAgICAgICBSZWFjdC5ET00udGgobnVsbCwgXCJOYW1lXCIpLCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLnRoKG51bGwsIFwiQ29tcGFueVwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHt3aWR0aDonMTcwcHgnfX0sIFwiQ2l0eVwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aCh7c3R5bGU6IHt3aWR0aDozMDB9fSwgXCJFbWFpbFwiKSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS50aChudWxsLCBcIsKgXCIpXG4gICAgICAgICAgICApXG4gICAgKTtcbiAgfVxufSk7XG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cbi8vVE9ETyAtIG1vdmUgbGlzdFxuLy9UT0RPIC0gY29weSBsaXN0XG4vL1RPRE8gLSBjcmVhdGUgbmV3IGxpc3RcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy9TaWRlTWVudUxpc3RPcHRpb25cbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY291bnQ6ICd+JyxcbiAgICB9XG4gIH0sXG5cblxuICBjb21wb25lbnREaWRNb3VudDogZnVuY3Rpb24oKSB7XG4gIH0sXG5cbiAgY2hhbmdlTGlzdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5jaGFuZ2VMaXN0KHRoaXMucHJvcHMubGlzdC5uYW1lLCB0aGlzLnByb3BzLmxpc3Qub2JqZWN0SWQpXG4gIH0sXG5cbiAgZ2V0SWNvblR5cGU6IGZ1bmN0aW9uKGljb25UeXBlKSB7XG4gICAgaWNvbiA9IFwiXCJcbiAgICBpZihpY29uVHlwZSA9PSBcImFyY2hpdmVcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1hcmNoaXZlXCIsIHN0eWxlOiB7ZmxvYXQ6J2xlZnQnLGxpbmVIZWlnaHQ6MS41LG1hcmdpblJpZ2h0OjV9fSlcbiAgICB9IGVsc2UgaWYoaWNvblR5cGUgPT0gXCJ1c2Vyc1wiKXtcbiAgICAgIGljb24gPSBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXVzZXJcIiwgc3R5bGU6IHtmbG9hdDonbGVmdCcsbGluZUhlaWdodDoxLjUsbWFyZ2luUmlnaHQ6NX19KVxuICAgIH0gZWxzZSBpZihpY29uVHlwZSA9PSBcIndpZmlcIil7XG4gICAgICBpY29uID0gUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS13aWZpXCIsIHN0eWxlOiB7ZmxvYXQ6J2xlZnQnLGxpbmVIZWlnaHQ6MS41LG1hcmdpblJpZ2h0OjV9fSlcbiAgICB9IGVsc2UgaWYoaWNvblR5cGUgPT0gXCJjbG91ZERvd25sb2FkXCIpe1xuICAgICAgaWNvbiA9IFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2xvdWQtZG93bmxvYWRcIiwgc3R5bGU6IHtmbG9hdDonbGVmdCcsbGluZUhlaWdodDoxLjUsbWFyZ2luUmlnaHQ6NX19KVxuICAgIH1cbiAgICByZXR1cm4gaWNvblxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgbGlzdE5hbWUgPSB0aGlzLnByb3BzLmxpc3QubmFtZVxuICAgIHByb3BzQ291bnQgPSB0aGlzLnByb3BzLmNvdW50XG4gICAgY291bnQgPSAodHlwZW9mKHByb3BzQ291bnQpPT0gXCJ1bmRlZmluZWRcIikgPyB0aGlzLnN0YXRlLmNvdW50IDogcHJvcHNDb3VudFxuXG4gICAgaWNvbiA9IFwiXCJcbiAgICBsaXN0U3R5bGU9KGljb24gPT0gXCJcIikgPyBcImxpc3QtbmFtZVwiIDogXCJpY29uLWxpc3QtbmFtZVwiXG4gICAgaWYodGhpcy5wcm9wcy5pY29uVHlwZSA9PSBcInVzZXJzXCIpXG4gICAgICBsaXN0U3R5bGUgPSBcImFsbC1saXN0LW5hbWVcIiBcbiAgICBjb3VudCA9IFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJiYWRnZSBiYWRnZS1kZWZhdWx0IGNudC1iZ1wifSwgdGhpcy5wcm9wcy5saXN0LmNvdW50KVxuICAgIGNvdW50ID0gKHRoaXMucHJvcHMuaGlkZUNvdW50KSA/IFwiXCIgOiBjb3VudFxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBcbiAgICAgICAgICAgICAgb25DbGljazogdGhpcy5jaGFuZ2VMaXN0LCBcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImxpc3QtbmFtZXMgYnRuIGJ0bi1kZWZhdWx0XCJ9LCBcbiAgICAgICAgICAgICAgaWNvbiwgXCIgwqAgXCIsIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IGxpc3RTdHlsZX0sIGxpc3ROYW1lKSwgXCIgXCIsIGNvdW50XG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbiJdfQ==
