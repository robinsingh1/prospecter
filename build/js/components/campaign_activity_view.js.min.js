/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // FollowupFeed
  getInitialState: function() {
    return {
      activities: []
    }
  },

  componentDidMount: function() {
    var thiss = this;
    $.ajax({
      url: 'https://api.parse.com/1/classes/EmailEvent',
      data: {include: 'prospect,sent_email', order:'-createdAt', limit:1000},
      headers: appConfig.headers,
      success: function(res) { 
        console.log(res.results)
        thiss.setState({activities: res.results}) 
      },
      error: function() {}
    })
  },

  render: function() {
    activities = _.map(this.state.activities, function(activity) {
      return EmailActivities({activity: activity})
    })

    return (
      React.DOM.div({style: {overflow:'auto',height:417}}, 
        React.DOM.table({className: "table", style: {marginBottom:0}}, 
          React.DOM.thead(null, 
            React.DOM.th(null), 
            React.DOM.th(null, "Sent "), 
            React.DOM.th(null, "Prospect "), 
            React.DOM.th(null, "Email "), 
            React.DOM.th(null, "Events "), 
            React.DOM.th({style: {textAlign:'center'}}, "Action Buttons"), 
            React.DOM.th(null, "Social")
          ), 
          React.DOM.tbody(null, 
            activities
          )
        )
      )
    )
  }
})

var Event = React.createClass({displayName: 'Event',
  render: function() {
    event = this.props.event
    if(event == "delivered"){
      iconType = "fa fa-paper-plane"; eventName = "Delivered";
    }else if(event == "failed") {
      iconType = "fa fa-exclamation-circle"; eventName="Failed"
    }else if(event == "opened"){
      iconType = "fa fa-eye"; eventName="Opened"
    }else if(event == "replied"){
      iconType = "fa fa-mail-reply";  eventName = "Replied"
    }else if(event == "visited"){
      iconType = "fa fa-home";  eventName="Visited"
    }

    return (
      React.DOM.ul({className: "list-group email-events", style: {marginBottom:0}}, 
        React.DOM.li({className: "list-group-item list-group-item-info", style: {paddingTop:16, height:49,textAlign:'center'}}, 
          React.DOM.i({className: iconType}), " ", React.DOM.span({style: {fontWeight:'bold'}}, eventName), " "
        ), 
        React.DOM.li({className: "list-group-item list-group-item-info", style: {display:'none'}}, 
          React.DOM.i({className: "fa fa-home"}), " ", React.DOM.span({style: {fontWeight:'bold'}}, "Visited"), " ", 
          React.DOM.a({href: "javascript:"}, "customerohq.com/resources"), "  "
        ), 
        React.DOM.li({className: "list-group-item list-group-item-info", style: {display:'none'}}, 
          React.DOM.i({className: "fa fa-external-link-square"}), " ", 
          React.DOM.span(null, "2:19 pm"), " ", 
          React.DOM.span({style: {fontWeight:'bold'}}, "clicked "), 
          React.DOM.a({href: "javascript:"}, "customerohq.com")
        )
      )
    )
  }
})

var EmailActivities = React.createClass({displayName: 'EmailActivities',
  render: function() {
    activity = this.props.activity
    prospect = (activity.prospect) ? activity.prospect : {}
    return (
      React.DOM.tr(null, 
          React.DOM.td(null), 
          React.DOM.td(null, 
            React.DOM.h6(null, 
              React.DOM.i({className: "fa fa-clock"}), " ", 
              moment(activity.createdAt).fromNow()
            )
          ), 
          React.DOM.td(null, React.DOM.h6(null, prospect.name)), 
          React.DOM.td(null, React.DOM.h6(null, activity.sent_email.subject)), 
          React.DOM.td({style: {padding:0, fontSize:12}}, 
            Event({event: activity.event_type})
          ), 
          React.DOM.td({style: {textAlign:'center'}}, 
            React.DOM.div({style: {display:'none'}}, 
            React.DOM.a({href: "javascript:", className: "btn btn-success btn-xs", style: {width:70,fontWeight:'bold',marginBottom:2}}, "Email"), React.DOM.br(null), 
            React.DOM.a({href: "javascript:", className: "btn btn-success btn-xs", style: {width:70,fontWeight:'bold',marginBottom:2}}, React.DOM.i({className: "fa fa-cloud-upload"}), " CRM"), React.DOM.br(null), 
            React.DOM.a({href: "javascript:", className: "btn btn-success btn-xs", style: {width:70,fontWeight:'bold',marginBottom:2}}, "Call")
          )
          ), 
          React.DOM.td(null, 
            "lol"
          )
      )
    )
  }
})
