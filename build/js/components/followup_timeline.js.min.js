(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */
var SendEmailModal = require('./send_email_modal.js.min.js')
var TimelineDayElement = require('./timeline_day_element.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  // FollowupTimeline
  getInitialState: function() {
    initialFollowups = this.props.initialFollowups
    initialFollowups = (initialFollowups) ? initialFollowups : []
    batches = this.props.selectedCampaign.batches
    batches = (batches) ? batches : []
    return {
      followups: _.compact(initialFollowups),
      loading: false,
      currentTemplate:'',
      currentBatch: '',
      batches : batches
    }
  },

  componentDidMount: function() {
    thiss = this;
    $('.day').tooltip({
      placement: 'right',
      title:'+ Add a follow-up'
    })

    console.log(this.props.selectedCampaign)
     company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
     currentCampaign = appConfig.pointer('Campaign', this.props.selectedCampaign.objectId)
     $.ajax({
       url:'https://api.parse.com/1/classes/Followup',
       type:'GET',
       headers: appConfig.headers,
       data: {
         where: JSON.stringify({
           campaign: currentCampaign,
           company: appConfig.company
         }),
         include:'template',
       },
       success: function(res) {
         console.log('followup timeline')
         console.log(res.results)
       },
       error: function(err) {
         console.log('error')
         console.log(err)
       }
     })
  },

  addFollowupSentToBatch: function(batch, followup) {
    batches = _.map(this.state.batches, function(_batch) {
                  if(_batch.objectId == batch.objectId) {
                    if(_batch.followups)
                      _batch.followups.push(followup)
                    else
                      _batch.followups = [followup]
                  }
                  return _batch
              })
    // Persist
  },
  
  render: function() {
    timelineElements = []
    followups = this.state.followups

    batches = _.map(this.state.batches, function(batch) {
      if(batch){
        now = moment().startOf('day').valueOf()
        batch.currentDay = moment(batch.started).diff(moment(now),  'days') * -1
        return batch
      }
    })
    batches = _.compact(batches)

    for(i=0;i< 31;i++){
      followup = _.findWhere(this.state.followups, {day: i})
      var elementType = (followup) ? true : false
      var currentTemplate = (followup) ? followup.template : false
      var addTemplateMode = (followup) ? followup.addTemplateMode : true
      campaign = this.props.selectedCampaign

      currentBatch = {}
      batch_started_today = false
      alreadySent = false
      batchCount = undefined
      if(i == 0) {
        batchCount = (batches) ? this.props.newProspects.length : this.props.prospects.length
      } else {
        batch = _.findWhere(batches, {currentDay: i})
        if(batch) {
          currentBatch = batch.objectId
          console.debug(batch.objectId)
          batchCount = "~"
          if(followup) {
            _batches = followup.batches
            alreadySent = _.findWhere(_batches, _.pick(batch,'objectId'))
          }
        }
      }

      timelineElements.push(React.DOM.div(null, TimelineDayElement({
                                    dayCount: i, 
                                    elementType: !elementType, 
                                    currentTemplate: currentTemplate, 
                                    batchCount: batchCount, 
                                    currentBatch: currentBatch, 
                                    alreadySent: alreadySent, 
                                    addTemplateMode: addTemplateMode, 
                                    templates: this.props.templates, 
                                    newProspects: this.props.newProspects, 
                                    addFollowup: this.addFollowup, 
                                    editFollowup: this.editFollowup, 
                                    saveFollowup: this.saveFollowup, 
                                    removeFollowup: this.removeFollowup, 
                                 addFollowupSentToBatch: this.addFollowupSentToBatch, 
                                    batches: this.props.selectedCampaign.batches, 
                                    prospectListCount: this.props.prospectListCount, 
                                    setCurrentBatch: this.setCurrentBatch, 
                                    setCurrentTemplate: this.setCurrentTemplate})
                                  ))

      if(i == 0 && _.findWhere(batches, {currentDay: 0})){
          currentBatch = _.findWhere(batches, {currentDay: 0}).objectId
          console.debug('0.5')
          console.debug(currentBatch)
          batchCount = "~"
          timelineElements.push(React.DOM.div(null, TimelineDayElement({
                                  dayCount: 0.5, 
                                  batchCount: batchCount, 
                                  currentBatch: currentBatch, 
                                  newProspects: this.props.newProspects, 
                                  elementType: true, 
                                  batches: this.props.selectedCampaign.batches, 
                                  prospectListCount: this.props.prospectListCount, 
                                  setCurrentBatch: this.setCurrentBatch})
                                ))
      }
    }
    return (
      React.DOM.div(null, 
        React.DOM.div({className: "timeline", 
             style: {height:'100%',backgroundColor:'rgb(90, 107, 119)', width:5,marginTop:-35}}, 
             timelineElements
        ), 
        SendEmailModal({prospects: this.props.prospects, 
                        selectedCampaign: this.props.selectedCampaign, 
                        newProspects: this.props.newProspects, 
                        addFollowupSentToBatch: this.addFollowupSentToBatch, 
                        currentBatch: this.state.currentBatch, 
                        currentTemplate: this.state.currentTemplate})
      )
    );
  },

  createFollowup: function() {
    //
  },         

  addFollowup: function(day) {
    //console.log('called template edit menu')
    followups = this.state.followups
    followups.push({addTemplateMode: true, day: day})
    this.setState({ followups: followups })
  },

  editFollowup: function(day) {
    // find template set editmode is false
    followups = _.map(this.state.followups, function(followup) {
      if(followup.day == day){ followup.addTemplateMode = true }
      return followup
    })
    this.setState({followups: followups})
  },

  saveFollowup: function(day, chosenTemplate) {
    new_followups = _.map(this.state.followups, function(followup) {
      if(followup.day == day){
        followup.addTemplateMode = false
        followup.template = chosenTemplate
      }
      return followup
    })
    this.setState({followups: new_followups})
    followup = _.findWhere(new_followups, {day: day})

      if(followup.objectId){
        url = "/"+followup.objectId; type="PUT"
        data = {template: appConfig.pointer('Template', chosenTemplate.objectId)}
      } else {
        url = ""; type="POST";

          data = {
            day: day,
            campaign : appConfig.pointer('Campaign', 
                                         this.props.selectedCampaign.objectId),
            template: appConfig.pointer('Template', chosenTemplate.objectId),
          }
      }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/classes/Followup'+url,
      type:type,
      data:JSON.stringify(data),
      headers:appConfig.headers,
      success: function(res) {
        new_followups = _.map(new_followups, function(followup) {
          if(followup.day == day) { followup.objectId = false }
          return followup
        })
        thiss.setState({followups: new_followups})

        console.log(res)
        $.ajax({
          url:'https://api.parse.com/1/classes/Campaign/'+thiss.props.selectedCampaign.objectId,
          type:'PUT',
          data:JSON.stringify({followups: {
            __op: 'AddUnique',
            objects:[appConfig.pointer('Followup', res.objectId)]
          }}),
          headers:appConfig.headers,
          success: function() { },
          error: function() { }
        })
      },
      error: function() { },
    })
  },

  removeFollowup: function(day) {
    followups = []
    for(i=0;i< this.state.followups.length;i++)
      if(this.state.followups[i].day != day)
        followups.push(this.state.followups[i])
      
    for(i=0;i< this.state.followups.length;i++)
      if(this.state.followups[i].day == day)
        break
    
    this.setState({followups: followups}) 
    id = this.state.followups[i]

    thiss = this;
    if(id) {
      id = id.objectId
      $.ajax({
        url:'https://api.parse.com/1/classes/Followup/'+id,
        headers:appConfig.headers,
        type:'DELETE',
        success: function(res) { console.log(res) }
      })

     console.log('REMOVE ARRAY')
      $.ajax({
        url:'https://api.parse.com/1/classes/Campaign/'+thiss.props.selectedCampaign.objectId,
        headers:appConfig.headers,
        type:'PUT',
        data: JSON.stringify({
          followups: {
            __op : 'Remove',
            objects: [appConfig.pointer('Followup', id)]
          }
        }),
        success: function(res){ console.log(res) },
        error: function() { }
      })
    }
  },

  setCurrentBatch: function(currentBatch) {
    this.setState({currentBatch: currentBatch})
  },

  setCurrentTemplate: function(template) {
    this.setState({currentTemplate: template })
  }
});

},{"./send_email_modal.js.min.js":2,"./timeline_day_element.js.min.js":3}],2:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {
      currentProspect: 0,
    }
  },

  sendEmails: function() {
    selectedCampaign = this.props.selectedCampaign
    campaign_id = selectedCampaign.objectId
    prospectlist_id = selectedCampaign.prospect_list.objectId
    template_id = this.props.currentTemplate.objectId
    
    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/send_email',
      url:'http://127.0.0.1:5000/v1/campaign/email',
      data: {
        template : template_id,
        campaign : campaign_id,
        //batch: batch_id
      },
      success: function(res) { console.log(res.results) },
      error: function(err) { console.log(err) }
    })

    /* */
    // Update Followup
    // Persist Followup
    // close modal
  },

  render: function() {
    prospect = this.props.prospects[this.state.currentProspect]
    prospect = (prospect) ? prospect : {'name':'','email':''}

    var thiss = this;
    console.debug('SEND EMAIL BATCH')
    console.debug(this.props.currentBatch)
    newBatch = _.isEqual(this.props.currentBatch, {})
    prospects = (newBatch) ? this.props.newProspects : this.props.prospects
    if(newBatch){
      prospects = _.map(this.props.newProspects, function(prospect) {
          return UserPlaceHolder({prospect: prospect})
      })
    } else {
      prospects = _.map(this.props.prospects, function(prospect) {
        if(_.findWhere(prospect.batches, {objectId: thiss.props.currentBatch}))
          return UserPlaceHolder({prospect: prospect})
      })
    }
    prospects = _.compact(prospects)
    console.debug(prospects)
    console.debug(prospects.length)
    prospectCount = prospects.length
    email = (prospect.email) ? prospect.email : ""
    if(email == "no_email" || email == "") {
      console.log('GUESSING')
      if(prospect.email_guesses) {
        console.log('GUESSING EMAIL')
        guess = _.findWhere(prospect.email_guesses, {tried: false})
        name = _.title(prospect.name.trim())

        vars = {
          first: _.first(name.split(' ')).replace(/\W/g, ''),
          last: _.last(name.split(' ')).replace(/\W/g, ''),
          fi: _.first(name.split(' '))[0].replace(/\W/g, ''),
          li: _.last(name.split(' '))[0].replace(/\W/g, '')
        }
        if(guess){
          console.log(guess.pattern.pattern)
          email = Mustache.render(guess.pattern.pattern, vars)
          email = email+"@"+prospect.domain
        }
      } else {
        console.log('NO GUESSES FOUND')
      }
    }
    email = email.toLowerCase()
    email = email
    return (
      React.DOM.div({className: "modal fade bs-sendEmail-modal-lg", tabIndex: "-1", 
           role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", 
           id: "sendEmailModal", style: {top:'10px'}}, 
            React.DOM.div({className: "modal-dialog modal-lg"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
        React.DOM.button({type: "button", 
                onClick: this.sendEmails, 
                style: {float:'right'}, 
                className: "btn btn-primary btn-sm"}, 
                React.DOM.i({className: "fa fa-paper-plane"}), "  Send Email"), 
        React.DOM.button({type: "button", style: {marginRight:10, float:'right'}, 
                className: "btn btn-default btn-sm", 'data-dismiss': "modal"}, "Close"), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-envelope"}), "  Send Email" + ' ' +
                    "  ", 
                    React.DOM.small(null, "("+prospectCount+")")
                  )
                ), 
                React.DOM.div({className: "modal-body", style: {paddingTop:5}}, 
                  React.DOM.h4(null, "People"), 
                  
                  React.DOM.div({className: "prospect-container"}, 
                    prospects
                  ), 
                  React.DOM.br(null), 
                  React.DOM.h4({style: {display:'inline-block'}}, "Emails    ", 
                  React.DOM.a({href: "javascript:", 
              className: (this.state.currentProspect == 0 ) ? "badge btn disabled" : "badge btn", 
                    onClick: this.previousProspect}, React.DOM.i({className: "fa fa-arrow-left"})), "  ", 
                    React.DOM.small(null, (this.state.currentProspect+1)+' of '+prospectCount
                  )), 
                  "   ", 
                  React.DOM.a({href: "javascript:", 
            className: (this.state.currentProspect ==  this.props.prospects.length-1) ? "btn disabled badge" : "btn badge", 
                    onClick: this.nextProspect}, React.DOM.i({className: "fa fa-arrow-right"})), 

                  React.DOM.div(null, 

React.DOM.ul({className: "list-group email-holder", style: {borderTop:'solid 1px #eee'}}, 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "To:  "), 
    
    React.DOM.span({className: "label label-primary"}, email)
  ), 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "Subject:  "), " ", React.DOM.span({className: "label label-primary"}, this.props.currentTemplate.subject)
  ), 
  React.DOM.li({className: "list-group-item body"})
)
  
                  )

                ), 

      React.DOM.div({className: "modal-footer", style: {display:'none'}}, 
        React.DOM.button({type: "button", 
                className: "btn btn-default", 'data-dismiss': "modal"}, "Close"), 
        React.DOM.button({type: "button", 
                className: "btn btn-primary"}, "Send Email")
      )
              )
            )
          )
    );
  },

  previousProspect: function() {
    this.setState({currentProspect: this.state.currentProspect-1 })
  },

  nextProspect: function() {
    this.setState({currentProspect: this.state.currentProspect+1 })
  },

  parseTemplate: function(templateBody) {
    first_name = prospect.name.split(' ')[0]
    //hiring_signal = prospect.signals

    signals = (prospect.signals) ? prospect.signals[0] : ""
    templateBody = Mustache.render(templateBody, {
      hiring_signal: signals,
      first_name: _.title(prospect.name.split(' ')[0])
    })

    //console.log(templateBody)
      
    return templateBody
  },

  componentDidUpdate: function() {
    //console.log(this.props.currentTemplate)
    parsedTemplate = this.parseTemplate(this.props.currentTemplate.body)
    
    //$('.body').html(this.props.currentTemplate.body)
    $('.body').html(parsedTemplate)
  }
});

var UserPlaceHolder = React.createClass({displayName: 'UserPlaceHolder',
  render: function() {
    return (
        React.DOM.div({className: "btn-group", style: {marginRight:5,marginBottom:5}}, 
          React.DOM.div({className: "btn-group"}, 
            React.DOM.button({type: "button", 
                    className: "btn btn-success btn-sm"}, 
              React.DOM.i({className: "fa fa-user"}), "  ", 
              (this.props.prospect) ? _.title(this.props.prospect.name) : ""
            )
          ), 
          React.DOM.button({type: "button", className: "btn btn-success btn-sm"}, 
            React.DOM.i({className: "fa fa-trash-o"})
          )
        )
    )
  }
});

},{}],3:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // TimelineDayElement
  // TODO
  // - add prospect list progression
  // - add scheduled followup
  //
  getInitialState: function() {
    // 
    return {
      followupCompleted: 0,
    }
  },

  addFollowup: function() {
    this.props.addFollowup(this.props.dayCount)
  },

  render: function() {
    if(this.props.addTemplateMode) {
      mode = EditTemplate({addFollowup: this.props.addFollowup, 
                           saveFollowup: this.props.saveFollowup, 
                           removeFollowup: this.props.removeFollowup, 
                           dayCount: this.props.dayCount, 
                           templates: this.props.templates})
    } else {
      mode = TemplateFollowup({currentTemplate: this.props.currentTemplate, 
                               editFollowup: this.props.editFollowup, 
                               dayCount: this.props.dayCount, 
                               currentBatch: this.props.currentBatch, 
                               hasBatch: typeof(this.props.batchCount) != "undefined" && this.props.batchCount > 0, 
                               setCurrentBatch: this.props.setCurrentBatch, 
                               dayCount: this.props.dayCount, 
                               removeFollowup: this.props.removeFollowup, 
                               setCurrentTemplate: this.props.setCurrentTemplate})
    }
    if(this.props.alreadySent) {
      mode = FollowupCompleted({currentTemplate: this.props.currentTemplate})
    }

    mode = (this.props.elementType) ? "" : mode
    addFollowup = (this.props.elementType) ? this.addFollowup : ""
    if(typeof(this.props.batchCount) != "undefined")
      batchStage = BatchStage({currentBatch: this.props.currentBatch, 
                               newProspects: this.props.newProspects, 
                               prospectListCount: this.props.prospectListCount, 
                               batchCount: this.props.batchCount, 
                               hasScheduledEmail: mode != "", 
                               dayCount: this.props.dayCount})
    else
      batchStage = ""

    dayCount = (this.props.dayCount != 0.5) ? "D"+this.props.dayCount : ""

    return (
      React.DOM.div(null, 
        React.DOM.div({onClick: addFollowup, className: "day", 'data-trigger': "manual"}, 
          dayCount
        ), 
        mode, batchStage
      )
    )
  },

  setCurrentTemplate: function(template) {
    this.props.setCurrentTemplate(template)
  }
});

var FollowupCompleted = React.createClass({displayName: 'FollowupCompleted',
  render: function() {
    return (
      React.DOM.div({className: "followup-placement arrow_box_1 tmp_2"}, 
        React.DOM.h6({style: {width:130,display:'inline-block'}}, 
          React.DOM.i({className: "fa fa-file-text-o"}), "  ", 
          (this.props.currentTemplate) ? this.props.currentTemplate.name : ""
        ), 
        React.DOM.button({className: "win-btn btn btn-success btn-xs disabled", 
                'data-target': ".bs-sendEmail-modal-lg", 
                onClick: this.setCurrentTemplate, 
                'data-toggle': "modal"}, 
          React.DOM.i({className: "fa fa-check"}), " Sent"), " ", 
        React.DOM.button({onClick: this.editFollowup, 
                className: "win-btn btn btn-default btn-xs disabled"}, 
          React.DOM.i({className: "fa fa-pencil"})), " ", 
        React.DOM.button({onClick: this.removeFollowup, 
                className: "win-btn btn btn-default btn-xs disabled"}, 
          React.DOM.i({className: "fa fa-trash-o"}))
      )
                                         )
  }
})

var TemplateFollowup = React.createClass({displayName: 'TemplateFollowup',
  // EditMode False

  setCurrentTemplate: function() {
    this.props.setCurrentTemplate(this.props.currentTemplate)
    // setCurrentBatch
    this.props.setCurrentBatch(this.props.currentBatch)
    $('.bs-sendEmail-modal-lg').modal()
  },

  waitForBatch: function() {
    alertify.log("You must wait for a batch!");
  },

  render: function() {
    trash = (this.props.dayCount == 0) ?  React.DOM.button({onClick: this.removeFollowup, 
                className: "win-btn btn btn-default btn-xs disabled"}, 
          React.DOM.i({className: "fa fa-trash-o"})) : React.DOM.button({onClick: this.removeFollowup, className: "win-btn btn btn-default btn-xs"}, 
          React.DOM.i({className: "fa fa-trash-o"})) 
    return (
      React.DOM.div({className: "followup-placement arrow_box_1 tmp_2"}, 
        React.DOM.h6({style: {width:130,display:'inline-block'}}, 
          React.DOM.i({className: "fa fa-file-text-o"}), "  ", 
          (this.props.currentTemplate) ? this.props.currentTemplate.name : ""
        ), 
        React.DOM.button({className: "win-btn btn btn-success btn-xs", 
          onClick: (this.props.hasBatch) ? this.setCurrentTemplate : this.waitForBatch, 
                'data-toggle': "modal"}, 
          React.DOM.i({className: "fa fa-paper-plane"}), " Send"), " ", 
        React.DOM.button({onClick: this.editFollowup, 
                className: "win-btn btn btn-default btn-xs"}, 
          React.DOM.i({className: "fa fa-pencil"})), " ", 
        trash
      )
    );
  },

  editFollowup: function(e) { 
    e.preventDefault()
    console.log(this.props.dayCount)
    this.props.editFollowup(this.props.dayCount)
  },

  removeFollowup: function() {
    console.log('remove')
    this.props.removeFollowup(this.props.dayCount)
  }
});

var BatchStage = React.createClass({displayName: 'BatchStage',
  // Different Stages of People Added to Prospect List
  getInitialState: function() {
    return {
      initialBatchCount: this.props.batchCount
    }
  },

  componentDidMount: function() {
    // state
    //console.debug('INSIDE BATCH '+this.props.dayCount)
    console.debug(this.props.currentBatch)
    _batches = appConfig.pointer('ProspectBatch', this.props.currentBatch)
    if(this.props.batchCount == "~") {
      // Why doesnt this work 
      var thissss = this;
      console.debug('INSIDE BATCH '+thiss.props.dayCount)
      console.debug(_batches)
      $.ajax({
        url:'https://api.parse.com/1/classes/Prospect',
        batches: _batches,
        data: {
          where: JSON.stringify({
            batches: _batches
          }),
          count: true,
          limit:1000,
        },
        headers: appConfig.headers,
        success: function(res) { 
          //console.debug('SUCCESS GET COUNT ' + res.count)
          //console.debug(res.results) 
          thissss.setState({initialBatchCount: res.count})
        },
        error: function(err) { 
          thissss.setState({initialBatchCount: 0 })
        }
      })
    }
  },

  componentWillReceiveProps: function(nextProps) {
    if(this.props.dayCount == 0)
      this.setState({ initialBatchCount: nextProps.batchCount })
  },


  render: function() {
    if(this.props.hasScheduledEmail)
      batchStageStyle = {top:-42, left:6}
    else
      batchStageStyle = {}

    if(this.props.dayCount == 0.5)
      batchStageStyle.left = 7

    //console.log('BATCH STAGE')
    //console.log(this.props)
    //console.debug(this.props.currentBatch)                                                           

    return (
      React.DOM.div({className: "followup-placement arrow_box tmp", style: batchStageStyle}, 
        React.DOM.span({className: "label label-primary"}, 
          React.DOM.i({className: "fa fa-user"}), " ", 
          this.state.initialBatchCount
        ), " ", 
        React.DOM.h6({style: {display:'inline-block'}}, 
          "prospects in the sales cycle.")
      )
    );
  }
});

var EditTemplate = React.createClass({displayName: 'EditTemplate',
  // Edit Mode - True
  render: function() {
    options = []
    for(i=0;i< this.props.templates.length; i++) {
      options.push( React.DOM.option(null, this.props.templates[i].name))
    }
    trash = (this.props.dayCount == 0) ?  React.DOM.button({onClick: this.removeFollowup, 
                className: "win-btn btn btn-default btn-xs disabled"}, 
          React.DOM.i({className: "fa fa-trash-o"})) : React.DOM.button({onClick: this.removeFollowup, className: "win-btn btn btn-default btn-xs"}, " ", React.DOM.i({className: "fa fa-trash-o"})) 
    return (
      React.DOM.div({className: "followup-placement arrow_box_1 tmp_2"}, 
        React.DOM.h6({style: {width:55,display:'inline-block'}, 
            className: "text-muted"}, 
          "Choose :"
        ), 
        React.DOM.select({className: "form-control input-sm", 
                id: "chooseTemplateForFollowup", 
                style: {display:'inline-block',width:127,marginRight:5}}, 
          options
        ), 

        React.DOM.button({className: "win-btn btn btn-success btn-xs", 
                onClick: this.saveFollowup, 
                style: {marginRight:5}}, 
          React.DOM.i({className: "fa fa-check"})), 
        trash
      )
    )
  },

  saveFollowup: function(e) {
    //get template from currentTemplate
    e.preventDefault()
    chosenTemplate = $('#chooseTemplateForFollowup').val()
    console.log(chosenTemplate)
    for(i=0;i< this.props.templates.length; i++){
      if(this.props.templates[i].name == chosenTemplate){
        chosenTemplate = this.props.templates[i]
        break
      }
    }
    console.log(chosenTemplate)
    
    this.props.saveFollowup(this.props.dayCount, chosenTemplate)
  },

  removeFollowup: function(day) {
    this.props.removeFollowup(this.props.dayCount)
  },
});


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvZm9sbG93dXBfdGltZWxpbmUuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zZW5kX2VtYWlsX21vZGFsLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdGltZWxpbmVfZGF5X2VsZW1lbnQuanMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cbnZhciBTZW5kRW1haWxNb2RhbCA9IHJlcXVpcmUoJy4vc2VuZF9lbWFpbF9tb2RhbC5qcy5taW4uanMnKVxudmFyIFRpbWVsaW5lRGF5RWxlbWVudCA9IHJlcXVpcmUoJy4vdGltZWxpbmVfZGF5X2VsZW1lbnQuanMubWluLmpzJylcblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy8gRm9sbG93dXBUaW1lbGluZVxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIGluaXRpYWxGb2xsb3d1cHMgPSB0aGlzLnByb3BzLmluaXRpYWxGb2xsb3d1cHNcbiAgICBpbml0aWFsRm9sbG93dXBzID0gKGluaXRpYWxGb2xsb3d1cHMpID8gaW5pdGlhbEZvbGxvd3VwcyA6IFtdXG4gICAgYmF0Y2hlcyA9IHRoaXMucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbi5iYXRjaGVzXG4gICAgYmF0Y2hlcyA9IChiYXRjaGVzKSA/IGJhdGNoZXMgOiBbXVxuICAgIHJldHVybiB7XG4gICAgICBmb2xsb3d1cHM6IF8uY29tcGFjdChpbml0aWFsRm9sbG93dXBzKSxcbiAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgY3VycmVudFRlbXBsYXRlOicnLFxuICAgICAgY3VycmVudEJhdGNoOiAnJyxcbiAgICAgIGJhdGNoZXMgOiBiYXRjaGVzXG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgJCgnLmRheScpLnRvb2x0aXAoe1xuICAgICAgcGxhY2VtZW50OiAncmlnaHQnLFxuICAgICAgdGl0bGU6JysgQWRkIGEgZm9sbG93LXVwJ1xuICAgIH0pXG5cbiAgICBjb25zb2xlLmxvZyh0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ24pXG4gICAgIGNvbXBhbnkgPSBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikuY29tcGFueSlcbiAgICAgY3VycmVudENhbXBhaWduID0gYXBwQ29uZmlnLnBvaW50ZXIoJ0NhbXBhaWduJywgdGhpcy5wcm9wcy5zZWxlY3RlZENhbXBhaWduLm9iamVjdElkKVxuICAgICAkLmFqYXgoe1xuICAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Gb2xsb3d1cCcsXG4gICAgICAgdHlwZTonR0VUJyxcbiAgICAgICBoZWFkZXJzOiBhcHBDb25maWcuaGVhZGVycyxcbiAgICAgICBkYXRhOiB7XG4gICAgICAgICB3aGVyZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICBjYW1wYWlnbjogY3VycmVudENhbXBhaWduLFxuICAgICAgICAgICBjb21wYW55OiBhcHBDb25maWcuY29tcGFueVxuICAgICAgICAgfSksXG4gICAgICAgICBpbmNsdWRlOid0ZW1wbGF0ZScsXG4gICAgICAgfSxcbiAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKCdmb2xsb3d1cCB0aW1lbGluZScpXG4gICAgICAgICBjb25zb2xlLmxvZyhyZXMucmVzdWx0cylcbiAgICAgICB9LFxuICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgfVxuICAgICB9KVxuICB9LFxuXG4gIGFkZEZvbGxvd3VwU2VudFRvQmF0Y2g6IGZ1bmN0aW9uKGJhdGNoLCBmb2xsb3d1cCkge1xuICAgIGJhdGNoZXMgPSBfLm1hcCh0aGlzLnN0YXRlLmJhdGNoZXMsIGZ1bmN0aW9uKF9iYXRjaCkge1xuICAgICAgICAgICAgICAgICAgaWYoX2JhdGNoLm9iamVjdElkID09IGJhdGNoLm9iamVjdElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKF9iYXRjaC5mb2xsb3d1cHMpXG4gICAgICAgICAgICAgICAgICAgICAgX2JhdGNoLmZvbGxvd3Vwcy5wdXNoKGZvbGxvd3VwKVxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgX2JhdGNoLmZvbGxvd3VwcyA9IFtmb2xsb3d1cF1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJldHVybiBfYmF0Y2hcbiAgICAgICAgICAgICAgfSlcbiAgICAvLyBQZXJzaXN0XG4gIH0sXG4gIFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRpbWVsaW5lRWxlbWVudHMgPSBbXVxuICAgIGZvbGxvd3VwcyA9IHRoaXMuc3RhdGUuZm9sbG93dXBzXG5cbiAgICBiYXRjaGVzID0gXy5tYXAodGhpcy5zdGF0ZS5iYXRjaGVzLCBmdW5jdGlvbihiYXRjaCkge1xuICAgICAgaWYoYmF0Y2gpe1xuICAgICAgICBub3cgPSBtb21lbnQoKS5zdGFydE9mKCdkYXknKS52YWx1ZU9mKClcbiAgICAgICAgYmF0Y2guY3VycmVudERheSA9IG1vbWVudChiYXRjaC5zdGFydGVkKS5kaWZmKG1vbWVudChub3cpLCAgJ2RheXMnKSAqIC0xXG4gICAgICAgIHJldHVybiBiYXRjaFxuICAgICAgfVxuICAgIH0pXG4gICAgYmF0Y2hlcyA9IF8uY29tcGFjdChiYXRjaGVzKVxuXG4gICAgZm9yKGk9MDtpPCAzMTtpKyspe1xuICAgICAgZm9sbG93dXAgPSBfLmZpbmRXaGVyZSh0aGlzLnN0YXRlLmZvbGxvd3Vwcywge2RheTogaX0pXG4gICAgICB2YXIgZWxlbWVudFR5cGUgPSAoZm9sbG93dXApID8gdHJ1ZSA6IGZhbHNlXG4gICAgICB2YXIgY3VycmVudFRlbXBsYXRlID0gKGZvbGxvd3VwKSA/IGZvbGxvd3VwLnRlbXBsYXRlIDogZmFsc2VcbiAgICAgIHZhciBhZGRUZW1wbGF0ZU1vZGUgPSAoZm9sbG93dXApID8gZm9sbG93dXAuYWRkVGVtcGxhdGVNb2RlIDogdHJ1ZVxuICAgICAgY2FtcGFpZ24gPSB0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ25cblxuICAgICAgY3VycmVudEJhdGNoID0ge31cbiAgICAgIGJhdGNoX3N0YXJ0ZWRfdG9kYXkgPSBmYWxzZVxuICAgICAgYWxyZWFkeVNlbnQgPSBmYWxzZVxuICAgICAgYmF0Y2hDb3VudCA9IHVuZGVmaW5lZFxuICAgICAgaWYoaSA9PSAwKSB7XG4gICAgICAgIGJhdGNoQ291bnQgPSAoYmF0Y2hlcykgPyB0aGlzLnByb3BzLm5ld1Byb3NwZWN0cy5sZW5ndGggOiB0aGlzLnByb3BzLnByb3NwZWN0cy5sZW5ndGhcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJhdGNoID0gXy5maW5kV2hlcmUoYmF0Y2hlcywge2N1cnJlbnREYXk6IGl9KVxuICAgICAgICBpZihiYXRjaCkge1xuICAgICAgICAgIGN1cnJlbnRCYXRjaCA9IGJhdGNoLm9iamVjdElkXG4gICAgICAgICAgY29uc29sZS5kZWJ1ZyhiYXRjaC5vYmplY3RJZClcbiAgICAgICAgICBiYXRjaENvdW50ID0gXCJ+XCJcbiAgICAgICAgICBpZihmb2xsb3d1cCkge1xuICAgICAgICAgICAgX2JhdGNoZXMgPSBmb2xsb3d1cC5iYXRjaGVzXG4gICAgICAgICAgICBhbHJlYWR5U2VudCA9IF8uZmluZFdoZXJlKF9iYXRjaGVzLCBfLnBpY2soYmF0Y2gsJ29iamVjdElkJykpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRpbWVsaW5lRWxlbWVudHMucHVzaChSZWFjdC5ET00uZGl2KG51bGwsIFRpbWVsaW5lRGF5RWxlbWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlDb3VudDogaSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogIWVsZW1lbnRUeXBlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUZW1wbGF0ZTogY3VycmVudFRlbXBsYXRlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoQ291bnQ6IGJhdGNoQ291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJhdGNoOiBjdXJyZW50QmF0Y2gsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxyZWFkeVNlbnQ6IGFscmVhZHlTZW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFRlbXBsYXRlTW9kZTogYWRkVGVtcGxhdGVNb2RlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlczogdGhpcy5wcm9wcy50ZW1wbGF0ZXMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3UHJvc3BlY3RzOiB0aGlzLnByb3BzLm5ld1Byb3NwZWN0cywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRGb2xsb3d1cDogdGhpcy5hZGRGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0Rm9sbG93dXA6IHRoaXMuZWRpdEZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVGb2xsb3d1cDogdGhpcy5zYXZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRm9sbG93dXA6IHRoaXMucmVtb3ZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRm9sbG93dXBTZW50VG9CYXRjaDogdGhpcy5hZGRGb2xsb3d1cFNlbnRUb0JhdGNoLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoZXM6IHRoaXMucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbi5iYXRjaGVzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3NwZWN0TGlzdENvdW50OiB0aGlzLnByb3BzLnByb3NwZWN0TGlzdENvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEN1cnJlbnRCYXRjaDogdGhpcy5zZXRDdXJyZW50QmF0Y2gsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0Q3VycmVudFRlbXBsYXRlOiB0aGlzLnNldEN1cnJlbnRUZW1wbGF0ZX0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSlcblxuICAgICAgaWYoaSA9PSAwICYmIF8uZmluZFdoZXJlKGJhdGNoZXMsIHtjdXJyZW50RGF5OiAwfSkpe1xuICAgICAgICAgIGN1cnJlbnRCYXRjaCA9IF8uZmluZFdoZXJlKGJhdGNoZXMsIHtjdXJyZW50RGF5OiAwfSkub2JqZWN0SWRcbiAgICAgICAgICBjb25zb2xlLmRlYnVnKCcwLjUnKVxuICAgICAgICAgIGNvbnNvbGUuZGVidWcoY3VycmVudEJhdGNoKVxuICAgICAgICAgIGJhdGNoQ291bnQgPSBcIn5cIlxuICAgICAgICAgIHRpbWVsaW5lRWxlbWVudHMucHVzaChSZWFjdC5ET00uZGl2KG51bGwsIFRpbWVsaW5lRGF5RWxlbWVudCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5Q291bnQ6IDAuNSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2hDb3VudDogYmF0Y2hDb3VudCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJhdGNoOiBjdXJyZW50QmF0Y2gsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Byb3NwZWN0czogdGhpcy5wcm9wcy5uZXdQcm9zcGVjdHMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiB0cnVlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaGVzOiB0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ24uYmF0Y2hlcywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvc3BlY3RMaXN0Q291bnQ6IHRoaXMucHJvcHMucHJvc3BlY3RMaXN0Q291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEN1cnJlbnRCYXRjaDogdGhpcy5zZXRDdXJyZW50QmF0Y2h9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdihudWxsLCBcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInRpbWVsaW5lXCIsIFxuICAgICAgICAgICAgIHN0eWxlOiB7aGVpZ2h0OicxMDAlJyxiYWNrZ3JvdW5kQ29sb3I6J3JnYig5MCwgMTA3LCAxMTkpJywgd2lkdGg6NSxtYXJnaW5Ub3A6LTM1fX0sIFxuICAgICAgICAgICAgIHRpbWVsaW5lRWxlbWVudHNcbiAgICAgICAgKSwgXG4gICAgICAgIFNlbmRFbWFpbE1vZGFsKHtwcm9zcGVjdHM6IHRoaXMucHJvcHMucHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkQ2FtcGFpZ246IHRoaXMucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbiwgXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQcm9zcGVjdHM6IHRoaXMucHJvcHMubmV3UHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEZvbGxvd3VwU2VudFRvQmF0Y2g6IHRoaXMuYWRkRm9sbG93dXBTZW50VG9CYXRjaCwgXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QmF0Y2g6IHRoaXMuc3RhdGUuY3VycmVudEJhdGNoLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUZW1wbGF0ZTogdGhpcy5zdGF0ZS5jdXJyZW50VGVtcGxhdGV9KVxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgY3JlYXRlRm9sbG93dXA6IGZ1bmN0aW9uKCkge1xuICAgIC8vXG4gIH0sICAgICAgICAgXG5cbiAgYWRkRm9sbG93dXA6IGZ1bmN0aW9uKGRheSkge1xuICAgIC8vY29uc29sZS5sb2coJ2NhbGxlZCB0ZW1wbGF0ZSBlZGl0IG1lbnUnKVxuICAgIGZvbGxvd3VwcyA9IHRoaXMuc3RhdGUuZm9sbG93dXBzXG4gICAgZm9sbG93dXBzLnB1c2goe2FkZFRlbXBsYXRlTW9kZTogdHJ1ZSwgZGF5OiBkYXl9KVxuICAgIHRoaXMuc2V0U3RhdGUoeyBmb2xsb3d1cHM6IGZvbGxvd3VwcyB9KVxuICB9LFxuXG4gIGVkaXRGb2xsb3d1cDogZnVuY3Rpb24oZGF5KSB7XG4gICAgLy8gZmluZCB0ZW1wbGF0ZSBzZXQgZWRpdG1vZGUgaXMgZmFsc2VcbiAgICBmb2xsb3d1cHMgPSBfLm1hcCh0aGlzLnN0YXRlLmZvbGxvd3VwcywgZnVuY3Rpb24oZm9sbG93dXApIHtcbiAgICAgIGlmKGZvbGxvd3VwLmRheSA9PSBkYXkpeyBmb2xsb3d1cC5hZGRUZW1wbGF0ZU1vZGUgPSB0cnVlIH1cbiAgICAgIHJldHVybiBmb2xsb3d1cFxuICAgIH0pXG4gICAgdGhpcy5zZXRTdGF0ZSh7Zm9sbG93dXBzOiBmb2xsb3d1cHN9KVxuICB9LFxuXG4gIHNhdmVGb2xsb3d1cDogZnVuY3Rpb24oZGF5LCBjaG9zZW5UZW1wbGF0ZSkge1xuICAgIG5ld19mb2xsb3d1cHMgPSBfLm1hcCh0aGlzLnN0YXRlLmZvbGxvd3VwcywgZnVuY3Rpb24oZm9sbG93dXApIHtcbiAgICAgIGlmKGZvbGxvd3VwLmRheSA9PSBkYXkpe1xuICAgICAgICBmb2xsb3d1cC5hZGRUZW1wbGF0ZU1vZGUgPSBmYWxzZVxuICAgICAgICBmb2xsb3d1cC50ZW1wbGF0ZSA9IGNob3NlblRlbXBsYXRlXG4gICAgICB9XG4gICAgICByZXR1cm4gZm9sbG93dXBcbiAgICB9KVxuICAgIHRoaXMuc2V0U3RhdGUoe2ZvbGxvd3VwczogbmV3X2ZvbGxvd3Vwc30pXG4gICAgZm9sbG93dXAgPSBfLmZpbmRXaGVyZShuZXdfZm9sbG93dXBzLCB7ZGF5OiBkYXl9KVxuXG4gICAgICBpZihmb2xsb3d1cC5vYmplY3RJZCl7XG4gICAgICAgIHVybCA9IFwiL1wiK2ZvbGxvd3VwLm9iamVjdElkOyB0eXBlPVwiUFVUXCJcbiAgICAgICAgZGF0YSA9IHt0ZW1wbGF0ZTogYXBwQ29uZmlnLnBvaW50ZXIoJ1RlbXBsYXRlJywgY2hvc2VuVGVtcGxhdGUub2JqZWN0SWQpfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXJsID0gXCJcIjsgdHlwZT1cIlBPU1RcIjtcblxuICAgICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgICBkYXk6IGRheSxcbiAgICAgICAgICAgIGNhbXBhaWduIDogYXBwQ29uZmlnLnBvaW50ZXIoJ0NhbXBhaWduJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbi5vYmplY3RJZCksXG4gICAgICAgICAgICB0ZW1wbGF0ZTogYXBwQ29uZmlnLnBvaW50ZXIoJ1RlbXBsYXRlJywgY2hvc2VuVGVtcGxhdGUub2JqZWN0SWQpLFxuICAgICAgICAgIH1cbiAgICAgIH1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL0ZvbGxvd3VwJyt1cmwsXG4gICAgICB0eXBlOnR5cGUsXG4gICAgICBkYXRhOkpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgaGVhZGVyczphcHBDb25maWcuaGVhZGVycyxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykge1xuICAgICAgICBuZXdfZm9sbG93dXBzID0gXy5tYXAobmV3X2ZvbGxvd3VwcywgZnVuY3Rpb24oZm9sbG93dXApIHtcbiAgICAgICAgICBpZihmb2xsb3d1cC5kYXkgPT0gZGF5KSB7IGZvbGxvd3VwLm9iamVjdElkID0gZmFsc2UgfVxuICAgICAgICAgIHJldHVybiBmb2xsb3d1cFxuICAgICAgICB9KVxuICAgICAgICB0aGlzcy5zZXRTdGF0ZSh7Zm9sbG93dXBzOiBuZXdfZm9sbG93dXBzfSlcblxuICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL0NhbXBhaWduLycrdGhpc3MucHJvcHMuc2VsZWN0ZWRDYW1wYWlnbi5vYmplY3RJZCxcbiAgICAgICAgICB0eXBlOidQVVQnLFxuICAgICAgICAgIGRhdGE6SlNPTi5zdHJpbmdpZnkoe2ZvbGxvd3Vwczoge1xuICAgICAgICAgICAgX19vcDogJ0FkZFVuaXF1ZScsXG4gICAgICAgICAgICBvYmplY3RzOlthcHBDb25maWcucG9pbnRlcignRm9sbG93dXAnLCByZXMub2JqZWN0SWQpXVxuICAgICAgICAgIH19KSxcbiAgICAgICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkgeyB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHsgfVxuICAgICAgICB9KVxuICAgICAgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbigpIHsgfSxcbiAgICB9KVxuICB9LFxuXG4gIHJlbW92ZUZvbGxvd3VwOiBmdW5jdGlvbihkYXkpIHtcbiAgICBmb2xsb3d1cHMgPSBbXVxuICAgIGZvcihpPTA7aTwgdGhpcy5zdGF0ZS5mb2xsb3d1cHMubGVuZ3RoO2krKylcbiAgICAgIGlmKHRoaXMuc3RhdGUuZm9sbG93dXBzW2ldLmRheSAhPSBkYXkpXG4gICAgICAgIGZvbGxvd3Vwcy5wdXNoKHRoaXMuc3RhdGUuZm9sbG93dXBzW2ldKVxuICAgICAgXG4gICAgZm9yKGk9MDtpPCB0aGlzLnN0YXRlLmZvbGxvd3Vwcy5sZW5ndGg7aSsrKVxuICAgICAgaWYodGhpcy5zdGF0ZS5mb2xsb3d1cHNbaV0uZGF5ID09IGRheSlcbiAgICAgICAgYnJlYWtcbiAgICBcbiAgICB0aGlzLnNldFN0YXRlKHtmb2xsb3d1cHM6IGZvbGxvd3Vwc30pIFxuICAgIGlkID0gdGhpcy5zdGF0ZS5mb2xsb3d1cHNbaV1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICBpZihpZCkge1xuICAgICAgaWQgPSBpZC5vYmplY3RJZFxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL0ZvbGxvd3VwLycraWQsXG4gICAgICAgIGhlYWRlcnM6YXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICAgIHR5cGU6J0RFTEVURScsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMpIH1cbiAgICAgIH0pXG5cbiAgICAgY29uc29sZS5sb2coJ1JFTU9WRSBBUlJBWScpXG4gICAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvQ2FtcGFpZ24vJyt0aGlzcy5wcm9wcy5zZWxlY3RlZENhbXBhaWduLm9iamVjdElkLFxuICAgICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgICB0eXBlOidQVVQnLFxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgZm9sbG93dXBzOiB7XG4gICAgICAgICAgICBfX29wIDogJ1JlbW92ZScsXG4gICAgICAgICAgICBvYmplY3RzOiBbYXBwQ29uZmlnLnBvaW50ZXIoJ0ZvbGxvd3VwJywgaWQpXVxuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcyl7IGNvbnNvbGUubG9nKHJlcykgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkgeyB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuICBzZXRDdXJyZW50QmF0Y2g6IGZ1bmN0aW9uKGN1cnJlbnRCYXRjaCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe2N1cnJlbnRCYXRjaDogY3VycmVudEJhdGNofSlcbiAgfSxcblxuICBzZXRDdXJyZW50VGVtcGxhdGU6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudFRlbXBsYXRlOiB0ZW1wbGF0ZSB9KVxuICB9XG59KTtcbiIsIi8qKiBAanN4IFJlYWN0LkRPTSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ2V4cG9ydHMnLFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjdXJyZW50UHJvc3BlY3Q6IDAsXG4gICAgfVxuICB9LFxuXG4gIHNlbmRFbWFpbHM6IGZ1bmN0aW9uKCkge1xuICAgIHNlbGVjdGVkQ2FtcGFpZ24gPSB0aGlzLnByb3BzLnNlbGVjdGVkQ2FtcGFpZ25cbiAgICBjYW1wYWlnbl9pZCA9IHNlbGVjdGVkQ2FtcGFpZ24ub2JqZWN0SWRcbiAgICBwcm9zcGVjdGxpc3RfaWQgPSBzZWxlY3RlZENhbXBhaWduLnByb3NwZWN0X2xpc3Qub2JqZWN0SWRcbiAgICB0ZW1wbGF0ZV9pZCA9IHRoaXMucHJvcHMuY3VycmVudFRlbXBsYXRlLm9iamVjdElkXG4gICAgXG4gICAgJC5hamF4KHtcbiAgICAgIC8vdXJsOidodHRwczovL25hbWVsZXNzLXJldHJlYXQtMzUyNS5oZXJva3VhcHAuY29tL3NlbmRfZW1haWwnLFxuICAgICAgdXJsOidodHRwOi8vMTI3LjAuMC4xOjUwMDAvdjEvY2FtcGFpZ24vZW1haWwnLFxuICAgICAgZGF0YToge1xuICAgICAgICB0ZW1wbGF0ZSA6IHRlbXBsYXRlX2lkLFxuICAgICAgICBjYW1wYWlnbiA6IGNhbXBhaWduX2lkLFxuICAgICAgICAvL2JhdGNoOiBiYXRjaF9pZFxuICAgICAgfSxcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlcykgeyBjb25zb2xlLmxvZyhyZXMucmVzdWx0cykgfSxcbiAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHsgY29uc29sZS5sb2coZXJyKSB9XG4gICAgfSlcblxuICAgIC8qICovXG4gICAgLy8gVXBkYXRlIEZvbGxvd3VwXG4gICAgLy8gUGVyc2lzdCBGb2xsb3d1cFxuICAgIC8vIGNsb3NlIG1vZGFsXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBwcm9zcGVjdCA9IHRoaXMucHJvcHMucHJvc3BlY3RzW3RoaXMuc3RhdGUuY3VycmVudFByb3NwZWN0XVxuICAgIHByb3NwZWN0ID0gKHByb3NwZWN0KSA/IHByb3NwZWN0IDogeyduYW1lJzonJywnZW1haWwnOicnfVxuXG4gICAgdmFyIHRoaXNzID0gdGhpcztcbiAgICBjb25zb2xlLmRlYnVnKCdTRU5EIEVNQUlMIEJBVENIJylcbiAgICBjb25zb2xlLmRlYnVnKHRoaXMucHJvcHMuY3VycmVudEJhdGNoKVxuICAgIG5ld0JhdGNoID0gXy5pc0VxdWFsKHRoaXMucHJvcHMuY3VycmVudEJhdGNoLCB7fSlcbiAgICBwcm9zcGVjdHMgPSAobmV3QmF0Y2gpID8gdGhpcy5wcm9wcy5uZXdQcm9zcGVjdHMgOiB0aGlzLnByb3BzLnByb3NwZWN0c1xuICAgIGlmKG5ld0JhdGNoKXtcbiAgICAgIHByb3NwZWN0cyA9IF8ubWFwKHRoaXMucHJvcHMubmV3UHJvc3BlY3RzLCBmdW5jdGlvbihwcm9zcGVjdCkge1xuICAgICAgICAgIHJldHVybiBVc2VyUGxhY2VIb2xkZXIoe3Byb3NwZWN0OiBwcm9zcGVjdH0pXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBwcm9zcGVjdHMgPSBfLm1hcCh0aGlzLnByb3BzLnByb3NwZWN0cywgZnVuY3Rpb24ocHJvc3BlY3QpIHtcbiAgICAgICAgaWYoXy5maW5kV2hlcmUocHJvc3BlY3QuYmF0Y2hlcywge29iamVjdElkOiB0aGlzcy5wcm9wcy5jdXJyZW50QmF0Y2h9KSlcbiAgICAgICAgICByZXR1cm4gVXNlclBsYWNlSG9sZGVyKHtwcm9zcGVjdDogcHJvc3BlY3R9KVxuICAgICAgfSlcbiAgICB9XG4gICAgcHJvc3BlY3RzID0gXy5jb21wYWN0KHByb3NwZWN0cylcbiAgICBjb25zb2xlLmRlYnVnKHByb3NwZWN0cylcbiAgICBjb25zb2xlLmRlYnVnKHByb3NwZWN0cy5sZW5ndGgpXG4gICAgcHJvc3BlY3RDb3VudCA9IHByb3NwZWN0cy5sZW5ndGhcbiAgICBlbWFpbCA9IChwcm9zcGVjdC5lbWFpbCkgPyBwcm9zcGVjdC5lbWFpbCA6IFwiXCJcbiAgICBpZihlbWFpbCA9PSBcIm5vX2VtYWlsXCIgfHwgZW1haWwgPT0gXCJcIikge1xuICAgICAgY29uc29sZS5sb2coJ0dVRVNTSU5HJylcbiAgICAgIGlmKHByb3NwZWN0LmVtYWlsX2d1ZXNzZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0dVRVNTSU5HIEVNQUlMJylcbiAgICAgICAgZ3Vlc3MgPSBfLmZpbmRXaGVyZShwcm9zcGVjdC5lbWFpbF9ndWVzc2VzLCB7dHJpZWQ6IGZhbHNlfSlcbiAgICAgICAgbmFtZSA9IF8udGl0bGUocHJvc3BlY3QubmFtZS50cmltKCkpXG5cbiAgICAgICAgdmFycyA9IHtcbiAgICAgICAgICBmaXJzdDogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpLnJlcGxhY2UoL1xcVy9nLCAnJyksXG4gICAgICAgICAgbGFzdDogXy5sYXN0KG5hbWUuc3BsaXQoJyAnKSkucmVwbGFjZSgvXFxXL2csICcnKSxcbiAgICAgICAgICBmaTogXy5maXJzdChuYW1lLnNwbGl0KCcgJykpWzBdLnJlcGxhY2UoL1xcVy9nLCAnJyksXG4gICAgICAgICAgbGk6IF8ubGFzdChuYW1lLnNwbGl0KCcgJykpWzBdLnJlcGxhY2UoL1xcVy9nLCAnJylcbiAgICAgICAgfVxuICAgICAgICBpZihndWVzcyl7XG4gICAgICAgICAgY29uc29sZS5sb2coZ3Vlc3MucGF0dGVybi5wYXR0ZXJuKVxuICAgICAgICAgIGVtYWlsID0gTXVzdGFjaGUucmVuZGVyKGd1ZXNzLnBhdHRlcm4ucGF0dGVybiwgdmFycylcbiAgICAgICAgICBlbWFpbCA9IGVtYWlsK1wiQFwiK3Byb3NwZWN0LmRvbWFpblxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygnTk8gR1VFU1NFUyBGT1VORCcpXG4gICAgICB9XG4gICAgfVxuICAgIGVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKVxuICAgIGVtYWlsID0gZW1haWxcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsIGZhZGUgYnMtc2VuZEVtYWlsLW1vZGFsLWxnXCIsIHRhYkluZGV4OiBcIi0xXCIsIFxuICAgICAgICAgICByb2xlOiBcImRpYWxvZ1wiLCAnYXJpYS1sYWJlbGxlZGJ5JzogXCJteVNtYWxsTW9kYWxMYWJlbFwiLCAnYXJpYS1oaWRkZW4nOiBcInRydWVcIiwgXG4gICAgICAgICAgIGlkOiBcInNlbmRFbWFpbE1vZGFsXCIsIHN0eWxlOiB7dG9wOicxMHB4J319LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1kaWFsb2cgbW9kYWwtbGdcIn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtY29udGVudFwifSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWhlYWRlclwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiY2xvc2VcIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFJlYWN0LkRPTS5zcGFuKHsnYXJpYS1oaWRkZW4nOiBcInRydWVcIn0sIFwiw5dcIiksIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcInNyLW9ubHlcIn0sIFwiQ2xvc2VcIikpLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5zZW5kRW1haWxzLCBcbiAgICAgICAgICAgICAgICBzdHlsZToge2Zsb2F0OidyaWdodCd9LCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5IGJ0bi1zbVwifSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1wYXBlci1wbGFuZVwifSksIFwiwqAgU2VuZCBFbWFpbFwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIHN0eWxlOiB7bWFyZ2luUmlnaHQ6MTAsIGZsb2F0OidyaWdodCd9LCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1kZWZhdWx0IGJ0bi1zbVwiLCAnZGF0YS1kaXNtaXNzJzogXCJtb2RhbFwifSwgXCJDbG9zZVwiKSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaDQoe2NsYXNzTmFtZTogXCJtb2RhbC10aXRsZVwiLCBpZDogXCJteU1vZGFsTGFiZWxcIn0sIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWVudmVsb3BlXCJ9KSwgXCIgwqBTZW5kIEVtYWlsXCIgKyAnICcgK1xuICAgICAgICAgICAgICAgICAgICBcIsKgwqBcIiwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5zbWFsbChudWxsLCBcIihcIitwcm9zcGVjdENvdW50K1wiKVwiKVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1ib2R5XCIsIHN0eWxlOiB7cGFkZGluZ1RvcDo1fX0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KG51bGwsIFwiUGVvcGxlXCIpLCBcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcInByb3NwZWN0LWNvbnRhaW5lclwifSwgXG4gICAgICAgICAgICAgICAgICAgIHByb3NwZWN0c1xuICAgICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYnIobnVsbCksIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtzdHlsZToge2Rpc3BsYXk6J2lubGluZS1ibG9jayd9fSwgXCJFbWFpbHMgwqDCoMKgXCIsIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICAgIGNsYXNzTmFtZTogKHRoaXMuc3RhdGUuY3VycmVudFByb3NwZWN0ID09IDAgKSA/IFwiYmFkZ2UgYnRuIGRpc2FibGVkXCIgOiBcImJhZGdlIGJ0blwiLCBcbiAgICAgICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5wcmV2aW91c1Byb3NwZWN0fSwgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1hcnJvdy1sZWZ0XCJ9KSksIFwiwqDCoFwiLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLnNtYWxsKG51bGwsICh0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdCsxKSsnIG9mICcrcHJvc3BlY3RDb3VudFxuICAgICAgICAgICAgICAgICAgKSksIFxuICAgICAgICAgICAgICAgICAgXCLCoMKgwqBcIiwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYSh7aHJlZjogXCJqYXZhc2NyaXB0OlwiLCBcbiAgICAgICAgICAgIGNsYXNzTmFtZTogKHRoaXMuc3RhdGUuY3VycmVudFByb3NwZWN0ID09ICB0aGlzLnByb3BzLnByb3NwZWN0cy5sZW5ndGgtMSkgPyBcImJ0biBkaXNhYmxlZCBiYWRnZVwiIDogXCJidG4gYmFkZ2VcIiwgXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMubmV4dFByb3NwZWN0fSwgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1hcnJvdy1yaWdodFwifSkpLCBcblxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdihudWxsLCBcblxuUmVhY3QuRE9NLnVsKHtjbGFzc05hbWU6IFwibGlzdC1ncm91cCBlbWFpbC1ob2xkZXJcIiwgc3R5bGU6IHtib3JkZXJUb3A6J3NvbGlkIDFweCAjZWVlJ319LCBcbiAgUmVhY3QuRE9NLmxpKHtjbGFzc05hbWU6IFwibGlzdC1ncm91cC1pdGVtXCJ9LCBcbiAgICBSZWFjdC5ET00uaDUoe3N0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJyxtYXJnaW5Ub3A6MCxtYXJnaW5Cb3R0b206MH19LCBcIlRvOsKgwqBcIiksIFxuICAgIFxuICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwibGFiZWwgbGFiZWwtcHJpbWFyeVwifSwgZW1haWwpXG4gICksIFxuICBSZWFjdC5ET00ubGkoe2NsYXNzTmFtZTogXCJsaXN0LWdyb3VwLWl0ZW1cIn0sIFxuICAgIFJlYWN0LkRPTS5oNSh7c3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snLG1hcmdpblRvcDowLG1hcmdpbkJvdHRvbTowfX0sIFwiU3ViamVjdDrCoMKgXCIpLCBcIiBcIiwgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJsYWJlbCBsYWJlbC1wcmltYXJ5XCJ9LCB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5zdWJqZWN0KVxuICApLCBcbiAgUmVhY3QuRE9NLmxpKHtjbGFzc05hbWU6IFwibGlzdC1ncm91cC1pdGVtIGJvZHlcIn0pXG4pXG4gIFxuICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgKSwgXG5cbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1mb290ZXJcIiwgc3R5bGU6IHtkaXNwbGF5Oidub25lJ319LCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCAnZGF0YS1kaXNtaXNzJzogXCJtb2RhbFwifSwgXCJDbG9zZVwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnlcIn0sIFwiU2VuZCBFbWFpbFwiKVxuICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgcHJldmlvdXNQcm9zcGVjdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudFByb3NwZWN0OiB0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdC0xIH0pXG4gIH0sXG5cbiAgbmV4dFByb3NwZWN0OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtjdXJyZW50UHJvc3BlY3Q6IHRoaXMuc3RhdGUuY3VycmVudFByb3NwZWN0KzEgfSlcbiAgfSxcblxuICBwYXJzZVRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZUJvZHkpIHtcbiAgICBmaXJzdF9uYW1lID0gcHJvc3BlY3QubmFtZS5zcGxpdCgnICcpWzBdXG4gICAgLy9oaXJpbmdfc2lnbmFsID0gcHJvc3BlY3Quc2lnbmFsc1xuXG4gICAgc2lnbmFscyA9IChwcm9zcGVjdC5zaWduYWxzKSA/IHByb3NwZWN0LnNpZ25hbHNbMF0gOiBcIlwiXG4gICAgdGVtcGxhdGVCb2R5ID0gTXVzdGFjaGUucmVuZGVyKHRlbXBsYXRlQm9keSwge1xuICAgICAgaGlyaW5nX3NpZ25hbDogc2lnbmFscyxcbiAgICAgIGZpcnN0X25hbWU6IF8udGl0bGUocHJvc3BlY3QubmFtZS5zcGxpdCgnICcpWzBdKVxuICAgIH0pXG5cbiAgICAvL2NvbnNvbGUubG9nKHRlbXBsYXRlQm9keSlcbiAgICAgIFxuICAgIHJldHVybiB0ZW1wbGF0ZUJvZHlcbiAgfSxcblxuICBjb21wb25lbnREaWRVcGRhdGU6IGZ1bmN0aW9uKCkge1xuICAgIC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUpXG4gICAgcGFyc2VkVGVtcGxhdGUgPSB0aGlzLnBhcnNlVGVtcGxhdGUodGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUuYm9keSlcbiAgICBcbiAgICAvLyQoJy5ib2R5JykuaHRtbCh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5ib2R5KVxuICAgICQoJy5ib2R5JykuaHRtbChwYXJzZWRUZW1wbGF0ZSlcbiAgfVxufSk7XG5cbnZhciBVc2VyUGxhY2VIb2xkZXIgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdVc2VyUGxhY2VIb2xkZXInLFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAoXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJidG4tZ3JvdXBcIiwgc3R5bGU6IHttYXJnaW5SaWdodDo1LG1hcmdpbkJvdHRvbTo1fX0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJidG4tZ3JvdXBcIn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXN1Y2Nlc3MgYnRuLXNtXCJ9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS11c2VyXCJ9KSwgXCLCoMKgXCIsIFxuICAgICAgICAgICAgICAodGhpcy5wcm9wcy5wcm9zcGVjdCkgPyBfLnRpdGxlKHRoaXMucHJvcHMucHJvc3BlY3QubmFtZSkgOiBcIlwiXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tc3VjY2VzcyBidG4tc21cIn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10cmFzaC1vXCJ9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgfVxufSk7XG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy8gVGltZWxpbmVEYXlFbGVtZW50XG4gIC8vIFRPRE9cbiAgLy8gLSBhZGQgcHJvc3BlY3QgbGlzdCBwcm9ncmVzc2lvblxuICAvLyAtIGFkZCBzY2hlZHVsZWQgZm9sbG93dXBcbiAgLy9cbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICAvLyBcbiAgICByZXR1cm4ge1xuICAgICAgZm9sbG93dXBDb21wbGV0ZWQ6IDAsXG4gICAgfVxuICB9LFxuXG4gIGFkZEZvbGxvd3VwOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnByb3BzLmFkZEZvbGxvd3VwKHRoaXMucHJvcHMuZGF5Q291bnQpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBpZih0aGlzLnByb3BzLmFkZFRlbXBsYXRlTW9kZSkge1xuICAgICAgbW9kZSA9IEVkaXRUZW1wbGF0ZSh7YWRkRm9sbG93dXA6IHRoaXMucHJvcHMuYWRkRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUZvbGxvd3VwOiB0aGlzLnByb3BzLnNhdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVGb2xsb3d1cDogdGhpcy5wcm9wcy5yZW1vdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlDb3VudDogdGhpcy5wcm9wcy5kYXlDb3VudCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZXM6IHRoaXMucHJvcHMudGVtcGxhdGVzfSlcbiAgICB9IGVsc2Uge1xuICAgICAgbW9kZSA9IFRlbXBsYXRlRm9sbG93dXAoe2N1cnJlbnRUZW1wbGF0ZTogdGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRGb2xsb3d1cDogdGhpcy5wcm9wcy5lZGl0Rm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheUNvdW50OiB0aGlzLnByb3BzLmRheUNvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QmF0Y2g6IHRoaXMucHJvcHMuY3VycmVudEJhdGNoLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNCYXRjaDogdHlwZW9mKHRoaXMucHJvcHMuYmF0Y2hDb3VudCkgIT0gXCJ1bmRlZmluZWRcIiAmJiB0aGlzLnByb3BzLmJhdGNoQ291bnQgPiAwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50QmF0Y2g6IHRoaXMucHJvcHMuc2V0Q3VycmVudEJhdGNoLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXlDb3VudDogdGhpcy5wcm9wcy5kYXlDb3VudCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRm9sbG93dXA6IHRoaXMucHJvcHMucmVtb3ZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldEN1cnJlbnRUZW1wbGF0ZTogdGhpcy5wcm9wcy5zZXRDdXJyZW50VGVtcGxhdGV9KVxuICAgIH1cbiAgICBpZih0aGlzLnByb3BzLmFscmVhZHlTZW50KSB7XG4gICAgICBtb2RlID0gRm9sbG93dXBDb21wbGV0ZWQoe2N1cnJlbnRUZW1wbGF0ZTogdGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGV9KVxuICAgIH1cblxuICAgIG1vZGUgPSAodGhpcy5wcm9wcy5lbGVtZW50VHlwZSkgPyBcIlwiIDogbW9kZVxuICAgIGFkZEZvbGxvd3VwID0gKHRoaXMucHJvcHMuZWxlbWVudFR5cGUpID8gdGhpcy5hZGRGb2xsb3d1cCA6IFwiXCJcbiAgICBpZih0eXBlb2YodGhpcy5wcm9wcy5iYXRjaENvdW50KSAhPSBcInVuZGVmaW5lZFwiKVxuICAgICAgYmF0Y2hTdGFnZSA9IEJhdGNoU3RhZ2Uoe2N1cnJlbnRCYXRjaDogdGhpcy5wcm9wcy5jdXJyZW50QmF0Y2gsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Byb3NwZWN0czogdGhpcy5wcm9wcy5uZXdQcm9zcGVjdHMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3NwZWN0TGlzdENvdW50OiB0aGlzLnByb3BzLnByb3NwZWN0TGlzdENvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXRjaENvdW50OiB0aGlzLnByb3BzLmJhdGNoQ291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc1NjaGVkdWxlZEVtYWlsOiBtb2RlICE9IFwiXCIsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheUNvdW50OiB0aGlzLnByb3BzLmRheUNvdW50fSlcbiAgICBlbHNlXG4gICAgICBiYXRjaFN0YWdlID0gXCJcIlxuXG4gICAgZGF5Q291bnQgPSAodGhpcy5wcm9wcy5kYXlDb3VudCAhPSAwLjUpID8gXCJEXCIrdGhpcy5wcm9wcy5kYXlDb3VudCA6IFwiXCJcblxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtvbkNsaWNrOiBhZGRGb2xsb3d1cCwgY2xhc3NOYW1lOiBcImRheVwiLCAnZGF0YS10cmlnZ2VyJzogXCJtYW51YWxcIn0sIFxuICAgICAgICAgIGRheUNvdW50XG4gICAgICAgICksIFxuICAgICAgICBtb2RlLCBiYXRjaFN0YWdlXG4gICAgICApXG4gICAgKVxuICB9LFxuXG4gIHNldEN1cnJlbnRUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGUpIHtcbiAgICB0aGlzLnByb3BzLnNldEN1cnJlbnRUZW1wbGF0ZSh0ZW1wbGF0ZSlcbiAgfVxufSk7XG5cbnZhciBGb2xsb3d1cENvbXBsZXRlZCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0ZvbGxvd3VwQ29tcGxldGVkJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImZvbGxvd3VwLXBsYWNlbWVudCBhcnJvd19ib3hfMSB0bXBfMlwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHt3aWR0aDoxMzAsZGlzcGxheTonaW5saW5lLWJsb2NrJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWZpbGUtdGV4dC1vXCJ9KSwgXCLCoMKgXCIsIFxuICAgICAgICAgICh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZSkgPyB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5uYW1lIDogXCJcIlxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7Y2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1zdWNjZXNzIGJ0bi14cyBkaXNhYmxlZFwiLCBcbiAgICAgICAgICAgICAgICAnZGF0YS10YXJnZXQnOiBcIi5icy1zZW5kRW1haWwtbW9kYWwtbGdcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5zZXRDdXJyZW50VGVtcGxhdGUsIFxuICAgICAgICAgICAgICAgICdkYXRhLXRvZ2dsZSc6IFwibW9kYWxcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2hlY2tcIn0pLCBcIsKgU2VudFwiKSwgXCLCoFwiLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7b25DbGljazogdGhpcy5lZGl0Rm9sbG93dXAsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHMgZGlzYWJsZWRcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGVuY2lsXCJ9KSksIFwiwqBcIiwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe29uQ2xpY2s6IHRoaXMucmVtb3ZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHMgZGlzYWJsZWRcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdHJhc2gtb1wifSkpXG4gICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgfVxufSlcblxudmFyIFRlbXBsYXRlRm9sbG93dXAgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdUZW1wbGF0ZUZvbGxvd3VwJyxcbiAgLy8gRWRpdE1vZGUgRmFsc2VcblxuICBzZXRDdXJyZW50VGVtcGxhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudFRlbXBsYXRlKHRoaXMucHJvcHMuY3VycmVudFRlbXBsYXRlKVxuICAgIC8vIHNldEN1cnJlbnRCYXRjaFxuICAgIHRoaXMucHJvcHMuc2V0Q3VycmVudEJhdGNoKHRoaXMucHJvcHMuY3VycmVudEJhdGNoKVxuICAgICQoJy5icy1zZW5kRW1haWwtbW9kYWwtbGcnKS5tb2RhbCgpXG4gIH0sXG5cbiAgd2FpdEZvckJhdGNoOiBmdW5jdGlvbigpIHtcbiAgICBhbGVydGlmeS5sb2coXCJZb3UgbXVzdCB3YWl0IGZvciBhIGJhdGNoIVwiKTtcbiAgfSxcblxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHRyYXNoID0gKHRoaXMucHJvcHMuZGF5Q291bnQgPT0gMCkgPyAgUmVhY3QuRE9NLmJ1dHRvbih7b25DbGljazogdGhpcy5yZW1vdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBkaXNhYmxlZFwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10cmFzaC1vXCJ9KSkgOiBSZWFjdC5ET00uYnV0dG9uKHtvbkNsaWNrOiB0aGlzLnJlbW92ZUZvbGxvd3VwLCBjbGFzc05hbWU6IFwid2luLWJ0biBidG4gYnRuLWRlZmF1bHQgYnRuLXhzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXRyYXNoLW9cIn0pKSBcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImZvbGxvd3VwLXBsYWNlbWVudCBhcnJvd19ib3hfMSB0bXBfMlwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHt3aWR0aDoxMzAsZGlzcGxheTonaW5saW5lLWJsb2NrJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWZpbGUtdGV4dC1vXCJ9KSwgXCLCoMKgXCIsIFxuICAgICAgICAgICh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZSkgPyB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5uYW1lIDogXCJcIlxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7Y2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1zdWNjZXNzIGJ0bi14c1wiLCBcbiAgICAgICAgICBvbkNsaWNrOiAodGhpcy5wcm9wcy5oYXNCYXRjaCkgPyB0aGlzLnNldEN1cnJlbnRUZW1wbGF0ZSA6IHRoaXMud2FpdEZvckJhdGNoLCBcbiAgICAgICAgICAgICAgICAnZGF0YS10b2dnbGUnOiBcIm1vZGFsXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXBhcGVyLXBsYW5lXCJ9KSwgXCLCoFNlbmRcIiksIFwiwqBcIiwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe29uQ2xpY2s6IHRoaXMuZWRpdEZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwid2luLWJ0biBidG4gYnRuLWRlZmF1bHQgYnRuLXhzXCJ9LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXBlbmNpbFwifSkpLCBcIsKgXCIsIFxuICAgICAgICB0cmFzaFxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgZWRpdEZvbGxvd3VwOiBmdW5jdGlvbihlKSB7IFxuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGNvbnNvbGUubG9nKHRoaXMucHJvcHMuZGF5Q291bnQpXG4gICAgdGhpcy5wcm9wcy5lZGl0Rm9sbG93dXAodGhpcy5wcm9wcy5kYXlDb3VudClcbiAgfSxcblxuICByZW1vdmVGb2xsb3d1cDogZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coJ3JlbW92ZScpXG4gICAgdGhpcy5wcm9wcy5yZW1vdmVGb2xsb3d1cCh0aGlzLnByb3BzLmRheUNvdW50KVxuICB9XG59KTtcblxudmFyIEJhdGNoU3RhZ2UgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdCYXRjaFN0YWdlJyxcbiAgLy8gRGlmZmVyZW50IFN0YWdlcyBvZiBQZW9wbGUgQWRkZWQgdG8gUHJvc3BlY3QgTGlzdFxuICBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpbml0aWFsQmF0Y2hDb3VudDogdGhpcy5wcm9wcy5iYXRjaENvdW50XG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICAvLyBzdGF0ZVxuICAgIC8vY29uc29sZS5kZWJ1ZygnSU5TSURFIEJBVENIICcrdGhpcy5wcm9wcy5kYXlDb3VudClcbiAgICBjb25zb2xlLmRlYnVnKHRoaXMucHJvcHMuY3VycmVudEJhdGNoKVxuICAgIF9iYXRjaGVzID0gYXBwQ29uZmlnLnBvaW50ZXIoJ1Byb3NwZWN0QmF0Y2gnLCB0aGlzLnByb3BzLmN1cnJlbnRCYXRjaClcbiAgICBpZih0aGlzLnByb3BzLmJhdGNoQ291bnQgPT0gXCJ+XCIpIHtcbiAgICAgIC8vIFdoeSBkb2VzbnQgdGhpcyB3b3JrIFxuICAgICAgdmFyIHRoaXNzc3MgPSB0aGlzO1xuICAgICAgY29uc29sZS5kZWJ1ZygnSU5TSURFIEJBVENIICcrdGhpc3MucHJvcHMuZGF5Q291bnQpXG4gICAgICBjb25zb2xlLmRlYnVnKF9iYXRjaGVzKVxuICAgICAgJC5hamF4KHtcbiAgICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL1Byb3NwZWN0JyxcbiAgICAgICAgYmF0Y2hlczogX2JhdGNoZXMsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB3aGVyZTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgYmF0Y2hlczogX2JhdGNoZXNcbiAgICAgICAgICB9KSxcbiAgICAgICAgICBjb3VudDogdHJ1ZSxcbiAgICAgICAgICBsaW1pdDoxMDAwLFxuICAgICAgICB9LFxuICAgICAgICBoZWFkZXJzOiBhcHBDb25maWcuaGVhZGVycyxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7IFxuICAgICAgICAgIC8vY29uc29sZS5kZWJ1ZygnU1VDQ0VTUyBHRVQgQ09VTlQgJyArIHJlcy5jb3VudClcbiAgICAgICAgICAvL2NvbnNvbGUuZGVidWcocmVzLnJlc3VsdHMpIFxuICAgICAgICAgIHRoaXNzc3Muc2V0U3RhdGUoe2luaXRpYWxCYXRjaENvdW50OiByZXMuY291bnR9KVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IFxuICAgICAgICAgIHRoaXNzc3Muc2V0U3RhdGUoe2luaXRpYWxCYXRjaENvdW50OiAwIH0pXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHM6IGZ1bmN0aW9uKG5leHRQcm9wcykge1xuICAgIGlmKHRoaXMucHJvcHMuZGF5Q291bnQgPT0gMClcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBpbml0aWFsQmF0Y2hDb3VudDogbmV4dFByb3BzLmJhdGNoQ291bnQgfSlcbiAgfSxcblxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgaWYodGhpcy5wcm9wcy5oYXNTY2hlZHVsZWRFbWFpbClcbiAgICAgIGJhdGNoU3RhZ2VTdHlsZSA9IHt0b3A6LTQyLCBsZWZ0OjZ9XG4gICAgZWxzZVxuICAgICAgYmF0Y2hTdGFnZVN0eWxlID0ge31cblxuICAgIGlmKHRoaXMucHJvcHMuZGF5Q291bnQgPT0gMC41KVxuICAgICAgYmF0Y2hTdGFnZVN0eWxlLmxlZnQgPSA3XG5cbiAgICAvL2NvbnNvbGUubG9nKCdCQVRDSCBTVEFHRScpXG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzKVxuICAgIC8vY29uc29sZS5kZWJ1Zyh0aGlzLnByb3BzLmN1cnJlbnRCYXRjaCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJmb2xsb3d1cC1wbGFjZW1lbnQgYXJyb3dfYm94IHRtcFwiLCBzdHlsZTogYmF0Y2hTdGFnZVN0eWxlfSwgXG4gICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwibGFiZWwgbGFiZWwtcHJpbWFyeVwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS11c2VyXCJ9KSwgXCLCoFwiLCBcbiAgICAgICAgICB0aGlzLnN0YXRlLmluaXRpYWxCYXRjaENvdW50XG4gICAgICAgICksIFwiwqBcIiwgXG4gICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snfX0sIFxuICAgICAgICAgIFwicHJvc3BlY3RzIGluIHRoZSBzYWxlcyBjeWNsZS5cIilcbiAgICAgIClcbiAgICApO1xuICB9XG59KTtcblxudmFyIEVkaXRUZW1wbGF0ZSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0VkaXRUZW1wbGF0ZScsXG4gIC8vIEVkaXQgTW9kZSAtIFRydWVcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBvcHRpb25zID0gW11cbiAgICBmb3IoaT0wO2k8IHRoaXMucHJvcHMudGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBvcHRpb25zLnB1c2goIFJlYWN0LkRPTS5vcHRpb24obnVsbCwgdGhpcy5wcm9wcy50ZW1wbGF0ZXNbaV0ubmFtZSkpXG4gICAgfVxuICAgIHRyYXNoID0gKHRoaXMucHJvcHMuZGF5Q291bnQgPT0gMCkgPyAgUmVhY3QuRE9NLmJ1dHRvbih7b25DbGljazogdGhpcy5yZW1vdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1kZWZhdWx0IGJ0bi14cyBkaXNhYmxlZFwifSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10cmFzaC1vXCJ9KSkgOiBSZWFjdC5ET00uYnV0dG9uKHtvbkNsaWNrOiB0aGlzLnJlbW92ZUZvbGxvd3VwLCBjbGFzc05hbWU6IFwid2luLWJ0biBidG4gYnRuLWRlZmF1bHQgYnRuLXhzXCJ9LCBcIiBcIiwgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10cmFzaC1vXCJ9KSkgXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJmb2xsb3d1cC1wbGFjZW1lbnQgYXJyb3dfYm94XzEgdG1wXzJcIn0sIFxuICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7d2lkdGg6NTUsZGlzcGxheTonaW5saW5lLWJsb2NrJ30sIFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcInRleHQtbXV0ZWRcIn0sIFxuICAgICAgICAgIFwiQ2hvb3NlIDpcIlxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLnNlbGVjdCh7Y2xhc3NOYW1lOiBcImZvcm0tY29udHJvbCBpbnB1dC1zbVwiLCBcbiAgICAgICAgICAgICAgICBpZDogXCJjaG9vc2VUZW1wbGF0ZUZvckZvbGxvd3VwXCIsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJyx3aWR0aDoxMjcsbWFyZ2luUmlnaHQ6NX19LCBcbiAgICAgICAgICBvcHRpb25zXG4gICAgICAgICksIFxuXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe2NsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tc3VjY2VzcyBidG4teHNcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5zYXZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7bWFyZ2luUmlnaHQ6NX19LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWNoZWNrXCJ9KSksIFxuICAgICAgICB0cmFzaFxuICAgICAgKVxuICAgIClcbiAgfSxcblxuICBzYXZlRm9sbG93dXA6IGZ1bmN0aW9uKGUpIHtcbiAgICAvL2dldCB0ZW1wbGF0ZSBmcm9tIGN1cnJlbnRUZW1wbGF0ZVxuICAgIGUucHJldmVudERlZmF1bHQoKVxuICAgIGNob3NlblRlbXBsYXRlID0gJCgnI2Nob29zZVRlbXBsYXRlRm9yRm9sbG93dXAnKS52YWwoKVxuICAgIGNvbnNvbGUubG9nKGNob3NlblRlbXBsYXRlKVxuICAgIGZvcihpPTA7aTwgdGhpcy5wcm9wcy50ZW1wbGF0ZXMubGVuZ3RoOyBpKyspe1xuICAgICAgaWYodGhpcy5wcm9wcy50ZW1wbGF0ZXNbaV0ubmFtZSA9PSBjaG9zZW5UZW1wbGF0ZSl7XG4gICAgICAgIGNob3NlblRlbXBsYXRlID0gdGhpcy5wcm9wcy50ZW1wbGF0ZXNbaV1cbiAgICAgICAgYnJlYWtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS5sb2coY2hvc2VuVGVtcGxhdGUpXG4gICAgXG4gICAgdGhpcy5wcm9wcy5zYXZlRm9sbG93dXAodGhpcy5wcm9wcy5kYXlDb3VudCwgY2hvc2VuVGVtcGxhdGUpXG4gIH0sXG5cbiAgcmVtb3ZlRm9sbG93dXA6IGZ1bmN0aW9uKGRheSkge1xuICAgIHRoaXMucHJvcHMucmVtb3ZlRm9sbG93dXAodGhpcy5wcm9wcy5kYXlDb3VudClcbiAgfSxcbn0pO1xuXG4iXX0=
