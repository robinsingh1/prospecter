(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */
var SendEmailModal = require('./send_email_modal.js.min.js')
var TimelineDayElement = require('./timeline_day_element.js.min.js')

module.exports = React.createClass({displayName: 'exports',
  // FollowupTimeline
  getInitialState: function() {
    initialFollowups = this.props.initialFollowups
    initialFollowups = (initialFollowups) ? initialFollowups : []

    return {
      followups: initialFollowups,
      loading: false,
      currentTemplate:''
    }
  },

  componentDidMount: function() {
    thiss = this;
    $('.day').tooltip({
      placement: 'right',
      title:'+ Add a follow-up'
    })
    // Followups that belong to campaign
     company = JSON.stringify(JSON.parse(localStorage.currentUser).company)
     currentCampaign = {
       '__type': 'Pointer',
       'className':'Campaign',
       'objectId':this.props.currentCampaign.objectId
     }
     currentCampaign = JSON.stringify(currentCampaign)
     //qry = 'where={"company":'+company+',"campaign":'+currentCampaign+'}&include=template'
     qry = 'where={"campaign":'+currentCampaign+'}&include=template'
     //qry = 'where={"campaign":'+currentCampaign+'}'
     $.ajax({
       url:'https://api.parse.com/1/classes/Followup',
       type:'GET',
       headers: appConfig.headers,
       data: qry,
       success: function(res) {
         console.log('followup timeline')
         console.log(res.results)
       },
       error: function(err) {
         console.log('error')
         console.log(err)
       }
     })
  },
  
  render: function() {
    batches =  _.countBy(this.props.prospects, 
                      function(prospect) { return prospect.last_contacted })

    timelineElements = []
    followups = (this.state.followups) ? this.state.followups : []
    console.log(followups)
    for(i=0;i< 31;i++){
      batchCount = (batches[i]) ? batches[i] : 0
      
      addTemplateMode = false; 
      currentTemplate = false;
      elementType = false
      for(ii=0;ii< followups.length; ii++){
        // TODO - Replace with underscore method
        //console.log('FOLLOWUPS ERROR')
        //console.log(followups)
        elementType = i == followups[ii].day
        if(elementType) {
          addTemplateMode = (followups[ii].addTemplateMode) ? true : false
          currentTemplate = followups[ii].template
          break
        }
      }

      timelineElements.push(TimelineDayElement({
                              dayCount: i, 
                              templates: this.props.templates, 
                              currentTemplate: currentTemplate, 
                              batchCount: batchCount, 
                              addTemplateMode: addTemplateMode, 
                              elementType: !elementType, 
                              addFollowup: this.addFollowup, 
                              editFollowup: this.editFollowup, 
                              saveFollowup: this.saveFollowup, 
                              removeFollowup: this.removeFollowup, 
                              setCurrentTemplate: this.setCurrentTemplate}))
    }
    return (
      React.DOM.div(null, 
        React.DOM.div({className: "timeline", 
             style: {height:'100%',backgroundColor:'rgb(90, 107, 119)',
                     width:5,marginTop:-35}}, 
             timelineElements
        ), 
        SendEmailModal({prospects: this.props.prospects, 
                        currentTemplate: this.state.currentTemplate})
      )
    );
  },

  createFollowup: function() {
    //
  },         

  addFollowup: function(day) {
    //console.log('called template edit menu')
    followups = this.state.followups
    followups.push({addTemplateMode: true, day: day})
    this.setState({
      followups: followups
    })
  },

  editFollowup: function(day) {
    // find template set editmode is false
    for(i=0;i< this.state.followups.length; i++){
      if(this.state.followups[i].day == day){
        break
      }
    }

    followups = this.state.followups
    followups[i].addTemplateMode = true
    this.setState({followups: followups})
  },

  saveFollowup: function(day, chosenTemplate) {
    new_followups = this.state.followups
    new_followups[day].addTemplateMode = false
    new_followups[day].template = chosenTemplate

    this.setState({followups: new_followups})

    if(new_followups[day].objectId){
      url = "/"+new_followups[i].objectId; type="PUT"

      data = {template:{
        __type:'Pointer',
        className:'Template',
        objectId: chosenTemplate.objectId
      }}
    } else {
      url = ""; type="POST";

      data = {
        day: day,
        campaign: {
          __type: 'Pointer',
          className:'Campaign',
          objectId: this.props.currentCampaign.objectId
        },
        template: {
          __type: 'Pointer',
          className:'Template',
          objectId:chosenTemplate.objectId,
        }
      }
    }

    thiss = this;
    $.ajax({
      url:'https://api.parse.com/1/classes/Followup',
      type:type,
      data:JSON.stringify(data),
      headers:appConfig.headers,
      success: function(res) {
        
        new_followups[day].objectId = res.objectId
        thiss.setState({followups: new_followups})

        console.log(res)
        $.ajax({
          url:'https://api.parse.com/1/classes/Campaign/'+thiss.props.currentCampaign.objectId,
          type:'PUT',
          data:JSON.stringify({followups: {
            __op: 'AddUnique',
            objects:[{
              __type:'Pointer', 
              className:'Followup',
              objectId:res.objectId
            }]
          }}),
          headers:appConfig.headers,
          success: function() {
          },
          error: function() {
          }
        })
      },
      error: function() {

      },
    })
  },

  removeFollowup: function(day) {
    followups = []
    for(i=0;i< this.state.followups.length;i++)
      if(this.state.followups[i].day != day)
        followups.push(this.state.followups[i])
      
    for(i=0;i< this.state.followups.length;i++)
      if(this.state.followups[i].day == day)
        break
    
    this.setState({followups: followups}) 
    id = this.state.followups[i]

    thiss = this;
    if(id) {
      id = id.objectId
      $.ajax({
        url:'https://api.parse.com/1/classes/Followup/'+id,
        headers:appConfig.headers,
        type:'DELETE',
        success: function(res) {
          console.log(res)
        }
      })

     console.log('REMOVE ARRAY')
      $.ajax({
        url:'https://api.parse.com/1/classes/Campaign/'+thiss.props.currentCampaign.objectId,
        headers:appConfig.headers,
        type:'PUT',
        data: JSON.stringify({
          followups: {
            __op : 'Remove',
            objects: [{
              __type: 'Pointer',
              className: 'Followup',
              objectId: id
            }]
          }
        }),
        success: function(res){
          console.log(res)
        },
        error: function() {
        }
      })
    }
  },

  setCurrentTemplate: function(template) {
    this.setState({currentTemplate: template })
  }
});



},{"./send_email_modal.js.min.js":2,"./timeline_day_element.js.min.js":3}],2:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {
      currentProspect: 0,
    }
  },
  //SendEmailModal
  render: function() {
    //console.log(this.props.currentTemplate)
    prospect = this.props.prospects[this.state.currentProspect]
    prospect = (prospect) ? prospect : {'name':'','email':''}
    //console.log(prospect)
    prospects = []
    for(i=0; i< this.props.prospects.length; i++){
      //console.log(this.props.prospects[i])
      prospects.push(UserPlaceHolder({prospect: this.props.prospects[i]}))
    }
    email = (prospect.email) ? prospect.email.toLowerCase() : ""
    return (
          React.DOM.div({className: "modal fade bs-sendEmail-modal-lg", tabIndex: "-1", role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", id: "sendEmailModal", style: {top:'10px'}}, 
            React.DOM.div({className: "modal-dialog modal-lg"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
        React.DOM.button({type: "button", 
                style: {float:'right'}, 
                className: "btn btn-primary"}, "Send Email"), 
        React.DOM.button({type: "button", style: {marginRight:10, float:'right'}, 
                className: "btn btn-default", 'data-dismiss': "modal"}, "Close"), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-envelope"}), "  Send Email" + ' ' +
                    "  ", 
                    React.DOM.small(null, "("+this.props.prospects.length+")")
                  )
                ), 
                React.DOM.div({className: "modal-body", style: {paddingTop:5}}, 
                  React.DOM.h4(null, "People"), 
                  
                  React.DOM.div({className: ""}, 
                    prospects
                  ), 
                  React.DOM.br(null), 
                  React.DOM.h4({style: {display:'inline-block'}}, "Emails    ", 
                    React.DOM.small(null, '1 of '+this.props.prospects.length)), 
                  "   ", 
                  React.DOM.a({href: "javascript:"}, React.DOM.i({className: "fa fa-arrow-left"})), 
                  "   ", 
                  React.DOM.a({href: "javascript:"}, React.DOM.i({className: "fa fa-arrow-right"})), 

                  React.DOM.div(null, 

React.DOM.ul({className: "list-group email-holder"}, 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "To:  "), 
    prospect.name + " - " + email
  ), 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "Subject:  "), " ", this.props.currentTemplate.subject
  ), 
  React.DOM.li({className: "list-group-item body"})
)
  
                  )

                ), 

      React.DOM.div({className: "modal-footer", style: {display:'none'}}, 
        React.DOM.button({type: "button", 
                className: "btn btn-default", 'data-dismiss': "modal"}, "Close"), 
        React.DOM.button({type: "button", 
                className: "btn btn-primary"}, "Send Email")
      )
              )
            )
          )
    );
  },

  parseTemplate: function(templateBody) {
    first_name = prospect.name.split(' ')[0]
    //hiring_signal = prospect.signals

    signals = (prospect.signals) ? prospect.signals[0] : ""
    templateBody = Mustache.render(templateBody, {
      hiring_signal: signals,
      first_name: prospect.name.split(' ')[0]
    })

    console.log(templateBody)
      
    return templateBody
  },

  componentDidUpdate: function() {
    //console.log(this.props.currentTemplate)
    parsedTemplate = this.parseTemplate(this.props.currentTemplate.body)
    
    //$('.body').html(this.props.currentTemplate.body)
    $('.body').html(parsedTemplate)
  }
});

var UserPlaceHolder = React.createClass({displayName: 'UserPlaceHolder',
  render: function() {
    return (
        React.DOM.div({className: "btn-group", style: {marginRight:5,marginBottom:5}}, 
          React.DOM.div({className: "btn-group"}, 
            React.DOM.button({type: "button", 
                    className: "btn btn-success btn-sm"}, 
                    
              (this.props.prospect) ? this.props.prospect.name : "", 
              "  ", React.DOM.i({className: "fa fa-user"})
            )
          ), 
          React.DOM.button({type: "button", className: "btn btn-success btn-sm"}, 
            React.DOM.i({className: "fa fa-trash-o"})
          )
        )
    )
  }
});

},{}],3:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  // TimelineDayElement
  // TODO
  // - add prospect list progression
  // - add scheduled followup
  //

  addFollowup: function() {
    this.props.addFollowup(this.props.dayCount)
  },

  render: function() {
    batchCount = this.props.batchCount
    batchStage = (batchCount) ? BatchStage({batchCount: this.props.batchCount}) : ""

    if(this.props.addTemplateMode) {
      mode = EditTemplate({addFollowup: this.props.addFollowup, 
                           saveFollowup: this.props.saveFollowup, 
                           removeFollowup: this.props.removeFollowup, 
                           dayCount: this.props.dayCount, 
                           templates: this.props.templates})
    } else {
      mode = TemplateFollowup({currentTemplate: this.props.currentTemplate, 
                               editFollowup: this.props.editFollowup, 
                               dayCount: this.props.dayCount, 
                               removeFollowup: this.props.removeFollowup, 
                               setCurrentTemplate: this.props.setCurrentTemplate})
    }
    mode = (this.props.elementType) ? "" : mode
    addFollowup = (this.props.elementType) ? this.addFollowup : ""

    return (
      React.DOM.div(null, 
        React.DOM.div({onClick: addFollowup, className: "day", 'data-trigger': "manual"}, 
          "D"+this.props.dayCount
        ), 
        batchStage, mode
      )
    )
  },

  setCurrentTemplate: function(template) {
    this.props.setCurrentTemplate(template)
  }
});

var TemplateFollowup = React.createClass({displayName: 'TemplateFollowup',
  // EditMode False

  setCurrentTemplate: function() {
    this.props.setCurrentTemplate(this.props.currentTemplate)
  },

  render: function() {
    return (
      React.DOM.div({className: "followup-placement arrow_box_1 tmp_2"}, 
        React.DOM.h6({style: {width:130,display:'inline-block'}}, 
          React.DOM.i({className: "fa fa-file-text-o"}), "  ", 
          (this.props.currentTemplate) ? this.props.currentTemplate.name : ""
        ), 
        React.DOM.button({className: "win-btn btn btn-success btn-xs", 
                'data-target': ".bs-sendEmail-modal-lg", 
                onClick: this.setCurrentTemplate, 
                'data-toggle': "modal"}, 
          React.DOM.i({className: "fa fa-paper-plane"}), " Send"), " ", 
        React.DOM.button({onClick: this.editFollowup, 
                className: "win-btn btn btn-default btn-xs"}, 
          React.DOM.i({className: "fa fa-pencil"})), " ", 
        React.DOM.button({onClick: this.removeFollowup, 
                className: "win-btn btn btn-default btn-xs"}, 
          React.DOM.i({className: "fa fa-trash-o"}))
      )
    );
  },

  editFollowup: function(e) { 
    e.preventDefault()
    console.log(this.props.dayCount)
    this.props.editFollowup(this.props.dayCount)
  },

  removeFollowup: function() {
    console.log('remove')
    this.props.removeFollowup(this.props.dayCount)
  }
});

var BatchStage = React.createClass({displayName: 'BatchStage',
  // Different Stages of People Added to Prospect List
  render: function() {
    return (
      React.DOM.div({className: "followup-placement arrow_box tmp"}, 
        React.DOM.span({className: "badge"}, 
          this.props.batchCount
        ), " ", 
        React.DOM.h6({style: {display:'inline-block'}}, 
          "prospects in the sales cycle.")
      )
    );
  }
});

var EditTemplate = React.createClass({displayName: 'EditTemplate',
  // Edit Mode - True
  render: function() {
    options = []
    for(i=0;i< this.props.templates.length; i++) {
      options.push( React.DOM.option(null, this.props.templates[i].name))
    }
    return (
      React.DOM.div({className: "followup-placement arrow_box_1 tmp_2"}, 
        React.DOM.h6({style: {width:55,display:'inline-block'}, 
            className: "text-muted"}, 
          "Choose :"
        ), 
        React.DOM.select({className: "form-control input-sm", 
                id: "chooseTemplateForFollowup", 
                style: {display:'inline-block',width:127,marginRight:5}}, 
          options
        ), 

        React.DOM.button({className: "win-btn btn btn-success btn-xs", 
                onClick: this.saveFollowup, 
                style: {marginRight:5}}, 
          React.DOM.i({className: "fa fa-check"})), 
        React.DOM.button({className: "win-btn btn btn-default btn-xs", 
                onClick: this.removeFollowup}, 
          React.DOM.i({className: "fa fa-trash-o"}))
      )
    )
  },

  saveFollowup: function(e) {
    //get template from currentTemplate
    e.preventDefault()
    chosenTemplate = $('#chooseTemplateForFollowup').val()
    console.log(chosenTemplate)
    for(i=0;i< this.props.templates.length; i++){
      if(this.props.templates[i].name == chosenTemplate){
        chosenTemplate = this.props.templates[i]
        break
      }
    }
    console.log(chosenTemplate)
    
    this.props.saveFollowup(this.props.dayCount, chosenTemplate)
  },

  removeFollowup: function(day) {
    this.props.removeFollowup(this.props.dayCount)
  },
});


},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvZm9sbG93dXBfdGltZWxpbmUuanMubWluLmpzIiwiL1VzZXJzL3JvYmluL1Byb2plY3RzL3Byb3NwZWN0ZXIvcHJvc3BlY3Rlci1wYXJzZS9kZXYvYnVpbGQvanMvY29tcG9uZW50cy9zZW5kX2VtYWlsX21vZGFsLmpzLm1pbi5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvdGltZWxpbmVfZGF5X2VsZW1lbnQuanMubWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKX12YXIgZj1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwoZi5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxmLGYuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqIEBqc3ggUmVhY3QuRE9NICovXG52YXIgU2VuZEVtYWlsTW9kYWwgPSByZXF1aXJlKCcuL3NlbmRfZW1haWxfbW9kYWwuanMubWluLmpzJylcbnZhciBUaW1lbGluZURheUVsZW1lbnQgPSByZXF1aXJlKCcuL3RpbWVsaW5lX2RheV9lbGVtZW50LmpzLm1pbi5qcycpXG5cbm1vZHVsZS5leHBvcnRzID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnZXhwb3J0cycsXG4gIC8vIEZvbGxvd3VwVGltZWxpbmVcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICBpbml0aWFsRm9sbG93dXBzID0gdGhpcy5wcm9wcy5pbml0aWFsRm9sbG93dXBzXG4gICAgaW5pdGlhbEZvbGxvd3VwcyA9IChpbml0aWFsRm9sbG93dXBzKSA/IGluaXRpYWxGb2xsb3d1cHMgOiBbXVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZvbGxvd3VwczogaW5pdGlhbEZvbGxvd3VwcyxcbiAgICAgIGxvYWRpbmc6IGZhbHNlLFxuICAgICAgY3VycmVudFRlbXBsYXRlOicnXG4gICAgfVxuICB9LFxuXG4gIGNvbXBvbmVudERpZE1vdW50OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgJCgnLmRheScpLnRvb2x0aXAoe1xuICAgICAgcGxhY2VtZW50OiAncmlnaHQnLFxuICAgICAgdGl0bGU6JysgQWRkIGEgZm9sbG93LXVwJ1xuICAgIH0pXG4gICAgLy8gRm9sbG93dXBzIHRoYXQgYmVsb25nIHRvIGNhbXBhaWduXG4gICAgIGNvbXBhbnkgPSBKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5jdXJyZW50VXNlcikuY29tcGFueSlcbiAgICAgY3VycmVudENhbXBhaWduID0ge1xuICAgICAgICdfX3R5cGUnOiAnUG9pbnRlcicsXG4gICAgICAgJ2NsYXNzTmFtZSc6J0NhbXBhaWduJyxcbiAgICAgICAnb2JqZWN0SWQnOnRoaXMucHJvcHMuY3VycmVudENhbXBhaWduLm9iamVjdElkXG4gICAgIH1cbiAgICAgY3VycmVudENhbXBhaWduID0gSlNPTi5zdHJpbmdpZnkoY3VycmVudENhbXBhaWduKVxuICAgICAvL3FyeSA9ICd3aGVyZT17XCJjb21wYW55XCI6Jytjb21wYW55KycsXCJjYW1wYWlnblwiOicrY3VycmVudENhbXBhaWduKyd9JmluY2x1ZGU9dGVtcGxhdGUnXG4gICAgIHFyeSA9ICd3aGVyZT17XCJjYW1wYWlnblwiOicrY3VycmVudENhbXBhaWduKyd9JmluY2x1ZGU9dGVtcGxhdGUnXG4gICAgIC8vcXJ5ID0gJ3doZXJlPXtcImNhbXBhaWduXCI6JytjdXJyZW50Q2FtcGFpZ24rJ30nXG4gICAgICQuYWpheCh7XG4gICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL0ZvbGxvd3VwJyxcbiAgICAgICB0eXBlOidHRVQnLFxuICAgICAgIGhlYWRlcnM6IGFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgIGRhdGE6IHFyeSxcbiAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKCdmb2xsb3d1cCB0aW1lbGluZScpXG4gICAgICAgICBjb25zb2xlLmxvZyhyZXMucmVzdWx0cylcbiAgICAgICB9LFxuICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvcicpXG4gICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgfVxuICAgICB9KVxuICB9LFxuICBcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICBiYXRjaGVzID0gIF8uY291bnRCeSh0aGlzLnByb3BzLnByb3NwZWN0cywgXG4gICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24ocHJvc3BlY3QpIHsgcmV0dXJuIHByb3NwZWN0Lmxhc3RfY29udGFjdGVkIH0pXG5cbiAgICB0aW1lbGluZUVsZW1lbnRzID0gW11cbiAgICBmb2xsb3d1cHMgPSAodGhpcy5zdGF0ZS5mb2xsb3d1cHMpID8gdGhpcy5zdGF0ZS5mb2xsb3d1cHMgOiBbXVxuICAgIGNvbnNvbGUubG9nKGZvbGxvd3VwcylcbiAgICBmb3IoaT0wO2k8IDMxO2krKyl7XG4gICAgICBiYXRjaENvdW50ID0gKGJhdGNoZXNbaV0pID8gYmF0Y2hlc1tpXSA6IDBcbiAgICAgIFxuICAgICAgYWRkVGVtcGxhdGVNb2RlID0gZmFsc2U7IFxuICAgICAgY3VycmVudFRlbXBsYXRlID0gZmFsc2U7XG4gICAgICBlbGVtZW50VHlwZSA9IGZhbHNlXG4gICAgICBmb3IoaWk9MDtpaTwgZm9sbG93dXBzLmxlbmd0aDsgaWkrKyl7XG4gICAgICAgIC8vIFRPRE8gLSBSZXBsYWNlIHdpdGggdW5kZXJzY29yZSBtZXRob2RcbiAgICAgICAgLy9jb25zb2xlLmxvZygnRk9MTE9XVVBTIEVSUk9SJylcbiAgICAgICAgLy9jb25zb2xlLmxvZyhmb2xsb3d1cHMpXG4gICAgICAgIGVsZW1lbnRUeXBlID0gaSA9PSBmb2xsb3d1cHNbaWldLmRheVxuICAgICAgICBpZihlbGVtZW50VHlwZSkge1xuICAgICAgICAgIGFkZFRlbXBsYXRlTW9kZSA9IChmb2xsb3d1cHNbaWldLmFkZFRlbXBsYXRlTW9kZSkgPyB0cnVlIDogZmFsc2VcbiAgICAgICAgICBjdXJyZW50VGVtcGxhdGUgPSBmb2xsb3d1cHNbaWldLnRlbXBsYXRlXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aW1lbGluZUVsZW1lbnRzLnB1c2goVGltZWxpbmVEYXlFbGVtZW50KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheUNvdW50OiBpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlczogdGhpcy5wcm9wcy50ZW1wbGF0ZXMsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFRlbXBsYXRlOiBjdXJyZW50VGVtcGxhdGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmF0Y2hDb3VudDogYmF0Y2hDb3VudCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRUZW1wbGF0ZU1vZGU6IGFkZFRlbXBsYXRlTW9kZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50VHlwZTogIWVsZW1lbnRUeXBlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEZvbGxvd3VwOiB0aGlzLmFkZEZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRGb2xsb3d1cDogdGhpcy5lZGl0Rm9sbG93dXAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUZvbGxvd3VwOiB0aGlzLnNhdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVGb2xsb3d1cDogdGhpcy5yZW1vdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50VGVtcGxhdGU6IHRoaXMuc2V0Q3VycmVudFRlbXBsYXRlfSkpXG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwidGltZWxpbmVcIiwgXG4gICAgICAgICAgICAgc3R5bGU6IHtoZWlnaHQ6JzEwMCUnLGJhY2tncm91bmRDb2xvcjoncmdiKDkwLCAxMDcsIDExOSknLFxuICAgICAgICAgICAgICAgICAgICAgd2lkdGg6NSxtYXJnaW5Ub3A6LTM1fX0sIFxuICAgICAgICAgICAgIHRpbWVsaW5lRWxlbWVudHNcbiAgICAgICAgKSwgXG4gICAgICAgIFNlbmRFbWFpbE1vZGFsKHtwcm9zcGVjdHM6IHRoaXMucHJvcHMucHJvc3BlY3RzLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRUZW1wbGF0ZTogdGhpcy5zdGF0ZS5jdXJyZW50VGVtcGxhdGV9KVxuICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgY3JlYXRlRm9sbG93dXA6IGZ1bmN0aW9uKCkge1xuICAgIC8vXG4gIH0sICAgICAgICAgXG5cbiAgYWRkRm9sbG93dXA6IGZ1bmN0aW9uKGRheSkge1xuICAgIC8vY29uc29sZS5sb2coJ2NhbGxlZCB0ZW1wbGF0ZSBlZGl0IG1lbnUnKVxuICAgIGZvbGxvd3VwcyA9IHRoaXMuc3RhdGUuZm9sbG93dXBzXG4gICAgZm9sbG93dXBzLnB1c2goe2FkZFRlbXBsYXRlTW9kZTogdHJ1ZSwgZGF5OiBkYXl9KVxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgZm9sbG93dXBzOiBmb2xsb3d1cHNcbiAgICB9KVxuICB9LFxuXG4gIGVkaXRGb2xsb3d1cDogZnVuY3Rpb24oZGF5KSB7XG4gICAgLy8gZmluZCB0ZW1wbGF0ZSBzZXQgZWRpdG1vZGUgaXMgZmFsc2VcbiAgICBmb3IoaT0wO2k8IHRoaXMuc3RhdGUuZm9sbG93dXBzLmxlbmd0aDsgaSsrKXtcbiAgICAgIGlmKHRoaXMuc3RhdGUuZm9sbG93dXBzW2ldLmRheSA9PSBkYXkpe1xuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cblxuICAgIGZvbGxvd3VwcyA9IHRoaXMuc3RhdGUuZm9sbG93dXBzXG4gICAgZm9sbG93dXBzW2ldLmFkZFRlbXBsYXRlTW9kZSA9IHRydWVcbiAgICB0aGlzLnNldFN0YXRlKHtmb2xsb3d1cHM6IGZvbGxvd3Vwc30pXG4gIH0sXG5cbiAgc2F2ZUZvbGxvd3VwOiBmdW5jdGlvbihkYXksIGNob3NlblRlbXBsYXRlKSB7XG4gICAgbmV3X2ZvbGxvd3VwcyA9IHRoaXMuc3RhdGUuZm9sbG93dXBzXG4gICAgbmV3X2ZvbGxvd3Vwc1tkYXldLmFkZFRlbXBsYXRlTW9kZSA9IGZhbHNlXG4gICAgbmV3X2ZvbGxvd3Vwc1tkYXldLnRlbXBsYXRlID0gY2hvc2VuVGVtcGxhdGVcblxuICAgIHRoaXMuc2V0U3RhdGUoe2ZvbGxvd3VwczogbmV3X2ZvbGxvd3Vwc30pXG5cbiAgICBpZihuZXdfZm9sbG93dXBzW2RheV0ub2JqZWN0SWQpe1xuICAgICAgdXJsID0gXCIvXCIrbmV3X2ZvbGxvd3Vwc1tpXS5vYmplY3RJZDsgdHlwZT1cIlBVVFwiXG5cbiAgICAgIGRhdGEgPSB7dGVtcGxhdGU6e1xuICAgICAgICBfX3R5cGU6J1BvaW50ZXInLFxuICAgICAgICBjbGFzc05hbWU6J1RlbXBsYXRlJyxcbiAgICAgICAgb2JqZWN0SWQ6IGNob3NlblRlbXBsYXRlLm9iamVjdElkXG4gICAgICB9fVxuICAgIH0gZWxzZSB7XG4gICAgICB1cmwgPSBcIlwiOyB0eXBlPVwiUE9TVFwiO1xuXG4gICAgICBkYXRhID0ge1xuICAgICAgICBkYXk6IGRheSxcbiAgICAgICAgY2FtcGFpZ246IHtcbiAgICAgICAgICBfX3R5cGU6ICdQb2ludGVyJyxcbiAgICAgICAgICBjbGFzc05hbWU6J0NhbXBhaWduJyxcbiAgICAgICAgICBvYmplY3RJZDogdGhpcy5wcm9wcy5jdXJyZW50Q2FtcGFpZ24ub2JqZWN0SWRcbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGU6IHtcbiAgICAgICAgICBfX3R5cGU6ICdQb2ludGVyJyxcbiAgICAgICAgICBjbGFzc05hbWU6J1RlbXBsYXRlJyxcbiAgICAgICAgICBvYmplY3RJZDpjaG9zZW5UZW1wbGF0ZS5vYmplY3RJZCxcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXNzID0gdGhpcztcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOidodHRwczovL2FwaS5wYXJzZS5jb20vMS9jbGFzc2VzL0ZvbGxvd3VwJyxcbiAgICAgIHR5cGU6dHlwZSxcbiAgICAgIGRhdGE6SlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgIFxuICAgICAgICBuZXdfZm9sbG93dXBzW2RheV0ub2JqZWN0SWQgPSByZXMub2JqZWN0SWRcbiAgICAgICAgdGhpc3Muc2V0U3RhdGUoe2ZvbGxvd3VwczogbmV3X2ZvbGxvd3Vwc30pXG5cbiAgICAgICAgY29uc29sZS5sb2cocmVzKVxuICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9DYW1wYWlnbi8nK3RoaXNzLnByb3BzLmN1cnJlbnRDYW1wYWlnbi5vYmplY3RJZCxcbiAgICAgICAgICB0eXBlOidQVVQnLFxuICAgICAgICAgIGRhdGE6SlNPTi5zdHJpbmdpZnkoe2ZvbGxvd3Vwczoge1xuICAgICAgICAgICAgX19vcDogJ0FkZFVuaXF1ZScsXG4gICAgICAgICAgICBvYmplY3RzOlt7XG4gICAgICAgICAgICAgIF9fdHlwZTonUG9pbnRlcicsIFxuICAgICAgICAgICAgICBjbGFzc05hbWU6J0ZvbGxvd3VwJyxcbiAgICAgICAgICAgICAgb2JqZWN0SWQ6cmVzLm9iamVjdElkXG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH19KSxcbiAgICAgICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG5cbiAgICAgIH0sXG4gICAgfSlcbiAgfSxcblxuICByZW1vdmVGb2xsb3d1cDogZnVuY3Rpb24oZGF5KSB7XG4gICAgZm9sbG93dXBzID0gW11cbiAgICBmb3IoaT0wO2k8IHRoaXMuc3RhdGUuZm9sbG93dXBzLmxlbmd0aDtpKyspXG4gICAgICBpZih0aGlzLnN0YXRlLmZvbGxvd3Vwc1tpXS5kYXkgIT0gZGF5KVxuICAgICAgICBmb2xsb3d1cHMucHVzaCh0aGlzLnN0YXRlLmZvbGxvd3Vwc1tpXSlcbiAgICAgIFxuICAgIGZvcihpPTA7aTwgdGhpcy5zdGF0ZS5mb2xsb3d1cHMubGVuZ3RoO2krKylcbiAgICAgIGlmKHRoaXMuc3RhdGUuZm9sbG93dXBzW2ldLmRheSA9PSBkYXkpXG4gICAgICAgIGJyZWFrXG4gICAgXG4gICAgdGhpcy5zZXRTdGF0ZSh7Zm9sbG93dXBzOiBmb2xsb3d1cHN9KSBcbiAgICBpZCA9IHRoaXMuc3RhdGUuZm9sbG93dXBzW2ldXG5cbiAgICB0aGlzcyA9IHRoaXM7XG4gICAgaWYoaWQpIHtcbiAgICAgIGlkID0gaWQub2JqZWN0SWRcbiAgICAgICQuYWpheCh7XG4gICAgICAgIHVybDonaHR0cHM6Ly9hcGkucGFyc2UuY29tLzEvY2xhc3Nlcy9Gb2xsb3d1cC8nK2lkLFxuICAgICAgICBoZWFkZXJzOmFwcENvbmZpZy5oZWFkZXJzLFxuICAgICAgICB0eXBlOidERUxFVEUnLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgY29uc29sZS5sb2coJ1JFTU9WRSBBUlJBWScpXG4gICAgICAkLmFqYXgoe1xuICAgICAgICB1cmw6J2h0dHBzOi8vYXBpLnBhcnNlLmNvbS8xL2NsYXNzZXMvQ2FtcGFpZ24vJyt0aGlzcy5wcm9wcy5jdXJyZW50Q2FtcGFpZ24ub2JqZWN0SWQsXG4gICAgICAgIGhlYWRlcnM6YXBwQ29uZmlnLmhlYWRlcnMsXG4gICAgICAgIHR5cGU6J1BVVCcsXG4gICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBmb2xsb3d1cHM6IHtcbiAgICAgICAgICAgIF9fb3AgOiAnUmVtb3ZlJyxcbiAgICAgICAgICAgIG9iamVjdHM6IFt7XG4gICAgICAgICAgICAgIF9fdHlwZTogJ1BvaW50ZXInLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6ICdGb2xsb3d1cCcsXG4gICAgICAgICAgICAgIG9iamVjdElkOiBpZFxuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XG4gICAgICAgIH0pLFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpe1xuICAgICAgICAgIGNvbnNvbGUubG9nKHJlcylcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuICBzZXRDdXJyZW50VGVtcGxhdGU6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudFRlbXBsYXRlOiB0ZW1wbGF0ZSB9KVxuICB9XG59KTtcblxuXG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudFByb3NwZWN0OiAwLFxuICAgIH1cbiAgfSxcbiAgLy9TZW5kRW1haWxNb2RhbFxuICByZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vY29uc29sZS5sb2codGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUpXG4gICAgcHJvc3BlY3QgPSB0aGlzLnByb3BzLnByb3NwZWN0c1t0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdF1cbiAgICBwcm9zcGVjdCA9IChwcm9zcGVjdCkgPyBwcm9zcGVjdCA6IHsnbmFtZSc6JycsJ2VtYWlsJzonJ31cbiAgICAvL2NvbnNvbGUubG9nKHByb3NwZWN0KVxuICAgIHByb3NwZWN0cyA9IFtdXG4gICAgZm9yKGk9MDsgaTwgdGhpcy5wcm9wcy5wcm9zcGVjdHMubGVuZ3RoOyBpKyspe1xuICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLnByb3NwZWN0c1tpXSlcbiAgICAgIHByb3NwZWN0cy5wdXNoKFVzZXJQbGFjZUhvbGRlcih7cHJvc3BlY3Q6IHRoaXMucHJvcHMucHJvc3BlY3RzW2ldfSkpXG4gICAgfVxuICAgIGVtYWlsID0gKHByb3NwZWN0LmVtYWlsKSA/IHByb3NwZWN0LmVtYWlsLnRvTG93ZXJDYXNlKCkgOiBcIlwiXG4gICAgcmV0dXJuIChcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwgZmFkZSBicy1zZW5kRW1haWwtbW9kYWwtbGdcIiwgdGFiSW5kZXg6IFwiLTFcIiwgcm9sZTogXCJkaWFsb2dcIiwgJ2FyaWEtbGFiZWxsZWRieSc6IFwibXlTbWFsbE1vZGFsTGFiZWxcIiwgJ2FyaWEtaGlkZGVuJzogXCJ0cnVlXCIsIGlkOiBcInNlbmRFbWFpbE1vZGFsXCIsIHN0eWxlOiB7dG9wOicxMHB4J319LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1kaWFsb2cgbW9kYWwtbGdcIn0sIFxuICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtY29udGVudFwifSwgXG4gICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWhlYWRlclwifSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBjbGFzc05hbWU6IFwiY2xvc2VcIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFJlYWN0LkRPTS5zcGFuKHsnYXJpYS1oaWRkZW4nOiBcInRydWVcIn0sIFwiw5dcIiksIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcInNyLW9ubHlcIn0sIFwiQ2xvc2VcIikpLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtmbG9hdDoncmlnaHQnfSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeVwifSwgXCJTZW5kIEVtYWlsXCIpLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgc3R5bGU6IHttYXJnaW5SaWdodDoxMCwgZmxvYXQ6J3JpZ2h0J30sIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLWRlZmF1bHRcIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFwiQ2xvc2VcIiksIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtjbGFzc05hbWU6IFwibW9kYWwtdGl0bGVcIiwgaWQ6IFwibXlNb2RhbExhYmVsXCJ9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1lbnZlbG9wZVwifSksIFwiIMKgU2VuZCBFbWFpbFwiICsgJyAnICtcbiAgICAgICAgICAgICAgICAgICAgXCLCoMKgXCIsIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc21hbGwobnVsbCwgXCIoXCIrdGhpcy5wcm9wcy5wcm9zcGVjdHMubGVuZ3RoK1wiKVwiKVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1ib2R5XCIsIHN0eWxlOiB7cGFkZGluZ1RvcDo1fX0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KG51bGwsIFwiUGVvcGxlXCIpLCBcbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIlwifSwgXG4gICAgICAgICAgICAgICAgICAgIHByb3NwZWN0c1xuICAgICAgICAgICAgICAgICAgKSwgXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uYnIobnVsbCksIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtzdHlsZToge2Rpc3BsYXk6J2lubGluZS1ibG9jayd9fSwgXCJFbWFpbHMgwqDCoMKgXCIsIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc21hbGwobnVsbCwgJzEgb2YgJyt0aGlzLnByb3BzLnByb3NwZWN0cy5sZW5ndGgpKSwgXG4gICAgICAgICAgICAgICAgICBcIsKgwqDCoFwiLCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCJ9LCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFycm93LWxlZnRcIn0pKSwgXG4gICAgICAgICAgICAgICAgICBcIsKgwqDCoFwiLCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCJ9LCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWFycm93LXJpZ2h0XCJ9KSksIFxuXG4gICAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KG51bGwsIFxuXG5SZWFjdC5ET00udWwoe2NsYXNzTmFtZTogXCJsaXN0LWdyb3VwIGVtYWlsLWhvbGRlclwifSwgXG4gIFJlYWN0LkRPTS5saSh7Y2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAtaXRlbVwifSwgXG4gICAgUmVhY3QuRE9NLmg1KHtzdHlsZToge2Rpc3BsYXk6J2lubGluZS1ibG9jaycsbWFyZ2luVG9wOjAsbWFyZ2luQm90dG9tOjB9fSwgXCJUbzrCoMKgXCIpLCBcbiAgICBwcm9zcGVjdC5uYW1lICsgXCIgLSBcIiArIGVtYWlsXG4gICksIFxuICBSZWFjdC5ET00ubGkoe2NsYXNzTmFtZTogXCJsaXN0LWdyb3VwLWl0ZW1cIn0sIFxuICAgIFJlYWN0LkRPTS5oNSh7c3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snLG1hcmdpblRvcDowLG1hcmdpbkJvdHRvbTowfX0sIFwiU3ViamVjdDrCoMKgXCIpLCBcIiBcIiwgdGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUuc3ViamVjdFxuICApLCBcbiAgUmVhY3QuRE9NLmxpKHtjbGFzc05hbWU6IFwibGlzdC1ncm91cC1pdGVtIGJvZHlcIn0pXG4pXG4gIFxuICAgICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgKSwgXG5cbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1mb290ZXJcIiwgc3R5bGU6IHtkaXNwbGF5Oidub25lJ319LCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdFwiLCAnZGF0YS1kaXNtaXNzJzogXCJtb2RhbFwifSwgXCJDbG9zZVwiKSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLXByaW1hcnlcIn0sIFwiU2VuZCBFbWFpbFwiKVxuICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH0sXG5cbiAgcGFyc2VUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGVCb2R5KSB7XG4gICAgZmlyc3RfbmFtZSA9IHByb3NwZWN0Lm5hbWUuc3BsaXQoJyAnKVswXVxuICAgIC8vaGlyaW5nX3NpZ25hbCA9IHByb3NwZWN0LnNpZ25hbHNcblxuICAgIHNpZ25hbHMgPSAocHJvc3BlY3Quc2lnbmFscykgPyBwcm9zcGVjdC5zaWduYWxzWzBdIDogXCJcIlxuICAgIHRlbXBsYXRlQm9keSA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZUJvZHksIHtcbiAgICAgIGhpcmluZ19zaWduYWw6IHNpZ25hbHMsXG4gICAgICBmaXJzdF9uYW1lOiBwcm9zcGVjdC5uYW1lLnNwbGl0KCcgJylbMF1cbiAgICB9KVxuXG4gICAgY29uc29sZS5sb2codGVtcGxhdGVCb2R5KVxuICAgICAgXG4gICAgcmV0dXJuIHRlbXBsYXRlQm9keVxuICB9LFxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgLy9jb25zb2xlLmxvZyh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZSlcbiAgICBwYXJzZWRUZW1wbGF0ZSA9IHRoaXMucGFyc2VUZW1wbGF0ZSh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5ib2R5KVxuICAgIFxuICAgIC8vJCgnLmJvZHknKS5odG1sKHRoaXMucHJvcHMuY3VycmVudFRlbXBsYXRlLmJvZHkpXG4gICAgJCgnLmJvZHknKS5odG1sKHBhcnNlZFRlbXBsYXRlKVxuICB9XG59KTtcblxudmFyIFVzZXJQbGFjZUhvbGRlciA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1VzZXJQbGFjZUhvbGRlcicsXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImJ0bi1ncm91cFwiLCBzdHlsZToge21hcmdpblJpZ2h0OjUsbWFyZ2luQm90dG9tOjV9fSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImJ0bi1ncm91cFwifSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tc3VjY2VzcyBidG4tc21cIn0sIFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgKHRoaXMucHJvcHMucHJvc3BlY3QpID8gdGhpcy5wcm9wcy5wcm9zcGVjdC5uYW1lIDogXCJcIiwgXG4gICAgICAgICAgICAgIFwiwqDCoFwiLCBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLXVzZXJcIn0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSwgXG4gICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImJ0biBidG4tc3VjY2VzcyBidG4tc21cIn0sIFxuICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS10cmFzaC1vXCJ9KVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgIClcbiAgfVxufSk7XG4iLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgLy8gVGltZWxpbmVEYXlFbGVtZW50XG4gIC8vIFRPRE9cbiAgLy8gLSBhZGQgcHJvc3BlY3QgbGlzdCBwcm9ncmVzc2lvblxuICAvLyAtIGFkZCBzY2hlZHVsZWQgZm9sbG93dXBcbiAgLy9cblxuICBhZGRGb2xsb3d1cDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5hZGRGb2xsb3d1cCh0aGlzLnByb3BzLmRheUNvdW50KVxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgYmF0Y2hDb3VudCA9IHRoaXMucHJvcHMuYmF0Y2hDb3VudFxuICAgIGJhdGNoU3RhZ2UgPSAoYmF0Y2hDb3VudCkgPyBCYXRjaFN0YWdlKHtiYXRjaENvdW50OiB0aGlzLnByb3BzLmJhdGNoQ291bnR9KSA6IFwiXCJcblxuICAgIGlmKHRoaXMucHJvcHMuYWRkVGVtcGxhdGVNb2RlKSB7XG4gICAgICBtb2RlID0gRWRpdFRlbXBsYXRlKHthZGRGb2xsb3d1cDogdGhpcy5wcm9wcy5hZGRGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlRm9sbG93dXA6IHRoaXMucHJvcHMuc2F2ZUZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUZvbGxvd3VwOiB0aGlzLnByb3BzLnJlbW92ZUZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheUNvdW50OiB0aGlzLnByb3BzLmRheUNvdW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlczogdGhpcy5wcm9wcy50ZW1wbGF0ZXN9KVxuICAgIH0gZWxzZSB7XG4gICAgICBtb2RlID0gVGVtcGxhdGVGb2xsb3d1cCh7Y3VycmVudFRlbXBsYXRlOiB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWRpdEZvbGxvd3VwOiB0aGlzLnByb3BzLmVkaXRGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF5Q291bnQ6IHRoaXMucHJvcHMuZGF5Q291bnQsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlbW92ZUZvbGxvd3VwOiB0aGlzLnByb3BzLnJlbW92ZUZvbGxvd3VwLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRDdXJyZW50VGVtcGxhdGU6IHRoaXMucHJvcHMuc2V0Q3VycmVudFRlbXBsYXRlfSlcbiAgICB9XG4gICAgbW9kZSA9ICh0aGlzLnByb3BzLmVsZW1lbnRUeXBlKSA/IFwiXCIgOiBtb2RlXG4gICAgYWRkRm9sbG93dXAgPSAodGhpcy5wcm9wcy5lbGVtZW50VHlwZSkgPyB0aGlzLmFkZEZvbGxvd3VwIDogXCJcIlxuXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYobnVsbCwgXG4gICAgICAgIFJlYWN0LkRPTS5kaXYoe29uQ2xpY2s6IGFkZEZvbGxvd3VwLCBjbGFzc05hbWU6IFwiZGF5XCIsICdkYXRhLXRyaWdnZXInOiBcIm1hbnVhbFwifSwgXG4gICAgICAgICAgXCJEXCIrdGhpcy5wcm9wcy5kYXlDb3VudFxuICAgICAgICApLCBcbiAgICAgICAgYmF0Y2hTdGFnZSwgbW9kZVxuICAgICAgKVxuICAgIClcbiAgfSxcblxuICBzZXRDdXJyZW50VGVtcGxhdGU6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgdGhpcy5wcm9wcy5zZXRDdXJyZW50VGVtcGxhdGUodGVtcGxhdGUpXG4gIH1cbn0pO1xuXG52YXIgVGVtcGxhdGVGb2xsb3d1cCA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ1RlbXBsYXRlRm9sbG93dXAnLFxuICAvLyBFZGl0TW9kZSBGYWxzZVxuXG4gIHNldEN1cnJlbnRUZW1wbGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5zZXRDdXJyZW50VGVtcGxhdGUodGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUpXG4gIH0sXG5cbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImZvbGxvd3VwLXBsYWNlbWVudCBhcnJvd19ib3hfMSB0bXBfMlwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHt3aWR0aDoxMzAsZGlzcGxheTonaW5saW5lLWJsb2NrJ319LCBcbiAgICAgICAgICBSZWFjdC5ET00uaSh7Y2xhc3NOYW1lOiBcImZhIGZhLWZpbGUtdGV4dC1vXCJ9KSwgXCLCoMKgXCIsIFxuICAgICAgICAgICh0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZSkgPyB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5uYW1lIDogXCJcIlxuICAgICAgICApLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7Y2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1zdWNjZXNzIGJ0bi14c1wiLCBcbiAgICAgICAgICAgICAgICAnZGF0YS10YXJnZXQnOiBcIi5icy1zZW5kRW1haWwtbW9kYWwtbGdcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5zZXRDdXJyZW50VGVtcGxhdGUsIFxuICAgICAgICAgICAgICAgICdkYXRhLXRvZ2dsZSc6IFwibW9kYWxcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGFwZXItcGxhbmVcIn0pLCBcIsKgU2VuZFwiKSwgXCLCoFwiLCBcbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7b25DbGljazogdGhpcy5lZGl0Rm9sbG93dXAsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHNcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGVuY2lsXCJ9KSksIFwiwqBcIiwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe29uQ2xpY2s6IHRoaXMucmVtb3ZlRm9sbG93dXAsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHNcIn0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdHJhc2gtb1wifSkpXG4gICAgICApXG4gICAgKTtcbiAgfSxcblxuICBlZGl0Rm9sbG93dXA6IGZ1bmN0aW9uKGUpIHsgXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgY29uc29sZS5sb2codGhpcy5wcm9wcy5kYXlDb3VudClcbiAgICB0aGlzLnByb3BzLmVkaXRGb2xsb3d1cCh0aGlzLnByb3BzLmRheUNvdW50KVxuICB9LFxuXG4gIHJlbW92ZUZvbGxvd3VwOiBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZygncmVtb3ZlJylcbiAgICB0aGlzLnByb3BzLnJlbW92ZUZvbGxvd3VwKHRoaXMucHJvcHMuZGF5Q291bnQpXG4gIH1cbn0pO1xuXG52YXIgQmF0Y2hTdGFnZSA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtkaXNwbGF5TmFtZTogJ0JhdGNoU3RhZ2UnLFxuICAvLyBEaWZmZXJlbnQgU3RhZ2VzIG9mIFBlb3BsZSBBZGRlZCB0byBQcm9zcGVjdCBMaXN0XG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJmb2xsb3d1cC1wbGFjZW1lbnQgYXJyb3dfYm94IHRtcFwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwiYmFkZ2VcIn0sIFxuICAgICAgICAgIHRoaXMucHJvcHMuYmF0Y2hDb3VudFxuICAgICAgICApLCBcIsKgXCIsIFxuICAgICAgICBSZWFjdC5ET00uaDYoe3N0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJ319LCBcbiAgICAgICAgICBcInByb3NwZWN0cyBpbiB0aGUgc2FsZXMgY3ljbGUuXCIpXG4gICAgICApXG4gICAgKTtcbiAgfVxufSk7XG5cbnZhciBFZGl0VGVtcGxhdGUgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdFZGl0VGVtcGxhdGUnLFxuICAvLyBFZGl0IE1vZGUgLSBUcnVlXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgb3B0aW9ucyA9IFtdXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgb3B0aW9ucy5wdXNoKCBSZWFjdC5ET00ub3B0aW9uKG51bGwsIHRoaXMucHJvcHMudGVtcGxhdGVzW2ldLm5hbWUpKVxuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcImZvbGxvd3VwLXBsYWNlbWVudCBhcnJvd19ib3hfMSB0bXBfMlwifSwgXG4gICAgICAgIFJlYWN0LkRPTS5oNih7c3R5bGU6IHt3aWR0aDo1NSxkaXNwbGF5OidpbmxpbmUtYmxvY2snfSwgXG4gICAgICAgICAgICBjbGFzc05hbWU6IFwidGV4dC1tdXRlZFwifSwgXG4gICAgICAgICAgXCJDaG9vc2UgOlwiXG4gICAgICAgICksIFxuICAgICAgICBSZWFjdC5ET00uc2VsZWN0KHtjbGFzc05hbWU6IFwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIsIFxuICAgICAgICAgICAgICAgIGlkOiBcImNob29zZVRlbXBsYXRlRm9yRm9sbG93dXBcIiwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snLHdpZHRoOjEyNyxtYXJnaW5SaWdodDo1fX0sIFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKSwgXG5cbiAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7Y2xhc3NOYW1lOiBcIndpbi1idG4gYnRuIGJ0bi1zdWNjZXNzIGJ0bi14c1wiLCBcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLnNhdmVGb2xsb3d1cCwgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHttYXJnaW5SaWdodDo1fX0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtY2hlY2tcIn0pKSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe2NsYXNzTmFtZTogXCJ3aW4tYnRuIGJ0biBidG4tZGVmYXVsdCBidG4teHNcIiwgXG4gICAgICAgICAgICAgICAgb25DbGljazogdGhpcy5yZW1vdmVGb2xsb3d1cH0sIFxuICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdHJhc2gtb1wifSkpXG4gICAgICApXG4gICAgKVxuICB9LFxuXG4gIHNhdmVGb2xsb3d1cDogZnVuY3Rpb24oZSkge1xuICAgIC8vZ2V0IHRlbXBsYXRlIGZyb20gY3VycmVudFRlbXBsYXRlXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgY2hvc2VuVGVtcGxhdGUgPSAkKCcjY2hvb3NlVGVtcGxhdGVGb3JGb2xsb3d1cCcpLnZhbCgpXG4gICAgY29uc29sZS5sb2coY2hvc2VuVGVtcGxhdGUpXG4gICAgZm9yKGk9MDtpPCB0aGlzLnByb3BzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKyl7XG4gICAgICBpZih0aGlzLnByb3BzLnRlbXBsYXRlc1tpXS5uYW1lID09IGNob3NlblRlbXBsYXRlKXtcbiAgICAgICAgY2hvc2VuVGVtcGxhdGUgPSB0aGlzLnByb3BzLnRlbXBsYXRlc1tpXVxuICAgICAgICBicmVha1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhjaG9zZW5UZW1wbGF0ZSlcbiAgICBcbiAgICB0aGlzLnByb3BzLnNhdmVGb2xsb3d1cCh0aGlzLnByb3BzLmRheUNvdW50LCBjaG9zZW5UZW1wbGF0ZSlcbiAgfSxcblxuICByZW1vdmVGb2xsb3d1cDogZnVuY3Rpb24oZGF5KSB7XG4gICAgdGhpcy5wcm9wcy5yZW1vdmVGb2xsb3d1cCh0aGlzLnByb3BzLmRheUNvdW50KVxuICB9LFxufSk7XG5cbiJdfQ==
