(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
/** @jsx React.DOM */

module.exports = React.createClass({displayName: 'exports',
  getInitialState: function() {
    return {
      currentProspect: 0,
    }
  },

  sendEmails: function() {
    selectedCampaign = this.props.selectedCampaign
    campaign_id = selectedCampaign.objectId
    prospectlist_id = selectedCampaign.prospect_list.objectId
    template_id = this.props.currentTemplate.objectId
    
    $.ajax({
      //url:'https://nameless-retreat-3525.herokuapp.com/send_email',
      url:'http://127.0.0.1:5000/v1/campaign/email',
      data: {
        template : template_id,
        campaign : campaign_id,
        //batch: batch_id
      },
      success: function(res) { console.log(res.results) },
      error: function(err) { console.log(err) }
    })

    /* */
    // Update Followup
    // Persist Followup
    // close modal
  },

  render: function() {
    prospect = this.props.prospects[this.state.currentProspect]
    prospect = (prospect) ? prospect : {'name':'','email':''}

    var thiss = this;
    console.debug('SEND EMAIL BATCH')
    console.debug(this.props.currentBatch)
    newBatch = _.isEqual(this.props.currentBatch, {})
    prospects = (newBatch) ? this.props.newProspects : this.props.prospects
    if(newBatch){
      prospects = _.map(this.props.newProspects, function(prospect) {
          return UserPlaceHolder({prospect: prospect})
      })
    } else {
      prospects = _.map(this.props.prospects, function(prospect) {
        if(_.findWhere(prospect.batches, {objectId: thiss.props.currentBatch}))
          return UserPlaceHolder({prospect: prospect})
      })
    }
    prospects = _.compact(prospects)
    console.debug(prospects)
    console.debug(prospects.length)
    prospectCount = prospects.length
    email = (prospect.email) ? prospect.email : ""
    if(email == "no_email" || email == "") {
      console.log('GUESSING')
      if(prospect.email_guesses) {
        console.log('GUESSING EMAIL')
        guess = _.findWhere(prospect.email_guesses, {tried: false})
        name = _.title(prospect.name.trim())

        vars = {
          first: _.first(name.split(' ')).replace(/\W/g, ''),
          last: _.last(name.split(' ')).replace(/\W/g, ''),
          fi: _.first(name.split(' '))[0].replace(/\W/g, ''),
          li: _.last(name.split(' '))[0].replace(/\W/g, '')
        }
        if(guess){
          console.log(guess.pattern.pattern)
          email = Mustache.render(guess.pattern.pattern, vars)
          email = email+"@"+prospect.domain
        }
      } else {
        console.log('NO GUESSES FOUND')
      }
    }
    email = email.toLowerCase()
    email = email
    return (
      React.DOM.div({className: "modal fade bs-sendEmail-modal-lg", tabIndex: "-1", 
           role: "dialog", 'aria-labelledby': "mySmallModalLabel", 'aria-hidden': "true", 
           id: "sendEmailModal", style: {top:'10px'}}, 
            React.DOM.div({className: "modal-dialog modal-lg"}, 
              React.DOM.div({className: "modal-content"}, 
                React.DOM.div({className: "modal-header"}, 
                  React.DOM.button({type: "button", className: "close", 'data-dismiss': "modal"}, React.DOM.span({'aria-hidden': "true"}, "×"), 
                    React.DOM.span({className: "sr-only"}, "Close")), 
        React.DOM.button({type: "button", 
                onClick: this.sendEmails, 
                style: {float:'right'}, 
                className: "btn btn-primary btn-sm"}, 
                React.DOM.i({className: "fa fa-paper-plane"}), "  Send Email"), 
        React.DOM.button({type: "button", style: {marginRight:10, float:'right'}, 
                className: "btn btn-default btn-sm", 'data-dismiss': "modal"}, "Close"), 
                  React.DOM.h4({className: "modal-title", id: "myModalLabel"}, 
                    React.DOM.i({className: "fa fa-envelope"}), "  Send Email" + ' ' +
                    "  ", 
                    React.DOM.small(null, "("+prospectCount+")")
                  )
                ), 
                React.DOM.div({className: "modal-body", style: {paddingTop:5}}, 
                  React.DOM.h4(null, "People"), 
                  
                  React.DOM.div({className: "prospect-container"}, 
                    prospects
                  ), 
                  React.DOM.br(null), 
                  React.DOM.h4({style: {display:'inline-block'}}, "Emails    ", 
                  React.DOM.a({href: "javascript:", 
              className: (this.state.currentProspect == 0 ) ? "badge btn disabled" : "badge btn", 
                    onClick: this.previousProspect}, React.DOM.i({className: "fa fa-arrow-left"})), "  ", 
                    React.DOM.small(null, (this.state.currentProspect+1)+' of '+prospectCount
                  )), 
                  "   ", 
                  React.DOM.a({href: "javascript:", 
            className: (this.state.currentProspect ==  this.props.prospects.length-1) ? "btn disabled badge" : "btn badge", 
                    onClick: this.nextProspect}, React.DOM.i({className: "fa fa-arrow-right"})), 

                  React.DOM.div(null, 

React.DOM.ul({className: "list-group email-holder", style: {borderTop:'solid 1px #eee'}}, 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "To:  "), 
    
    React.DOM.span({className: "label label-primary"}, email)
  ), 
  React.DOM.li({className: "list-group-item"}, 
    React.DOM.h5({style: {display:'inline-block',marginTop:0,marginBottom:0}}, "Subject:  "), " ", React.DOM.span({className: "label label-primary"}, this.props.currentTemplate.subject)
  ), 
  React.DOM.li({className: "list-group-item body"})
)
  
                  )

                ), 

      React.DOM.div({className: "modal-footer", style: {display:'none'}}, 
        React.DOM.button({type: "button", 
                className: "btn btn-default", 'data-dismiss': "modal"}, "Close"), 
        React.DOM.button({type: "button", 
                className: "btn btn-primary"}, "Send Email")
      )
              )
            )
          )
    );
  },

  previousProspect: function() {
    this.setState({currentProspect: this.state.currentProspect-1 })
  },

  nextProspect: function() {
    this.setState({currentProspect: this.state.currentProspect+1 })
  },

  parseTemplate: function(templateBody) {
    first_name = prospect.name.split(' ')[0]
    //hiring_signal = prospect.signals

    signals = (prospect.signals) ? prospect.signals[0] : ""
    templateBody = Mustache.render(templateBody, {
      hiring_signal: signals,
      first_name: _.title(prospect.name.split(' ')[0])
    })

    //console.log(templateBody)
      
    return templateBody
  },

  componentDidUpdate: function() {
    //console.log(this.props.currentTemplate)
    parsedTemplate = this.parseTemplate(this.props.currentTemplate.body)
    
    //$('.body').html(this.props.currentTemplate.body)
    $('.body').html(parsedTemplate)
  }
});

var UserPlaceHolder = React.createClass({displayName: 'UserPlaceHolder',
  render: function() {
    return (
        React.DOM.div({className: "btn-group", style: {marginRight:5,marginBottom:5}}, 
          React.DOM.div({className: "btn-group"}, 
            React.DOM.button({type: "button", 
                    className: "btn btn-success btn-sm"}, 
              React.DOM.i({className: "fa fa-user"}), "  ", 
              (this.props.prospect) ? _.title(this.props.prospect.name) : ""
            )
          ), 
          React.DOM.button({type: "button", className: "btn btn-success btn-sm"}, 
            React.DOM.i({className: "fa fa-trash-o"})
          )
        )
    )
  }
});

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L25vZGVfbW9kdWxlcy9ndWxwLWJyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsIi9Vc2Vycy9yb2Jpbi9Qcm9qZWN0cy9wcm9zcGVjdGVyL3Byb3NwZWN0ZXItcGFyc2UvZGV2L2J1aWxkL2pzL2NvbXBvbmVudHMvc2VuZF9lbWFpbF9tb2RhbC5qcy5taW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpfXZhciBmPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChmLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGYsZi5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvKiogQGpzeCBSZWFjdC5ET00gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBSZWFjdC5jcmVhdGVDbGFzcyh7ZGlzcGxheU5hbWU6ICdleHBvcnRzJyxcbiAgZ2V0SW5pdGlhbFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudFByb3NwZWN0OiAwLFxuICAgIH1cbiAgfSxcblxuICBzZW5kRW1haWxzOiBmdW5jdGlvbigpIHtcbiAgICBzZWxlY3RlZENhbXBhaWduID0gdGhpcy5wcm9wcy5zZWxlY3RlZENhbXBhaWduXG4gICAgY2FtcGFpZ25faWQgPSBzZWxlY3RlZENhbXBhaWduLm9iamVjdElkXG4gICAgcHJvc3BlY3RsaXN0X2lkID0gc2VsZWN0ZWRDYW1wYWlnbi5wcm9zcGVjdF9saXN0Lm9iamVjdElkXG4gICAgdGVtcGxhdGVfaWQgPSB0aGlzLnByb3BzLmN1cnJlbnRUZW1wbGF0ZS5vYmplY3RJZFxuICAgIFxuICAgICQuYWpheCh7XG4gICAgICAvL3VybDonaHR0cHM6Ly9uYW1lbGVzcy1yZXRyZWF0LTM1MjUuaGVyb2t1YXBwLmNvbS9zZW5kX2VtYWlsJyxcbiAgICAgIHVybDonaHR0cDovLzEyNy4wLjAuMTo1MDAwL3YxL2NhbXBhaWduL2VtYWlsJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdGVtcGxhdGUgOiB0ZW1wbGF0ZV9pZCxcbiAgICAgICAgY2FtcGFpZ24gOiBjYW1wYWlnbl9pZCxcbiAgICAgICAgLy9iYXRjaDogYmF0Y2hfaWRcbiAgICAgIH0sXG4gICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHsgY29uc29sZS5sb2cocmVzLnJlc3VsdHMpIH0sXG4gICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7IGNvbnNvbGUubG9nKGVycikgfVxuICAgIH0pXG5cbiAgICAvKiAqL1xuICAgIC8vIFVwZGF0ZSBGb2xsb3d1cFxuICAgIC8vIFBlcnNpc3QgRm9sbG93dXBcbiAgICAvLyBjbG9zZSBtb2RhbFxuICB9LFxuXG4gIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgcHJvc3BlY3QgPSB0aGlzLnByb3BzLnByb3NwZWN0c1t0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdF1cbiAgICBwcm9zcGVjdCA9IChwcm9zcGVjdCkgPyBwcm9zcGVjdCA6IHsnbmFtZSc6JycsJ2VtYWlsJzonJ31cblxuICAgIHZhciB0aGlzcyA9IHRoaXM7XG4gICAgY29uc29sZS5kZWJ1ZygnU0VORCBFTUFJTCBCQVRDSCcpXG4gICAgY29uc29sZS5kZWJ1Zyh0aGlzLnByb3BzLmN1cnJlbnRCYXRjaClcbiAgICBuZXdCYXRjaCA9IF8uaXNFcXVhbCh0aGlzLnByb3BzLmN1cnJlbnRCYXRjaCwge30pXG4gICAgcHJvc3BlY3RzID0gKG5ld0JhdGNoKSA/IHRoaXMucHJvcHMubmV3UHJvc3BlY3RzIDogdGhpcy5wcm9wcy5wcm9zcGVjdHNcbiAgICBpZihuZXdCYXRjaCl7XG4gICAgICBwcm9zcGVjdHMgPSBfLm1hcCh0aGlzLnByb3BzLm5ld1Byb3NwZWN0cywgZnVuY3Rpb24ocHJvc3BlY3QpIHtcbiAgICAgICAgICByZXR1cm4gVXNlclBsYWNlSG9sZGVyKHtwcm9zcGVjdDogcHJvc3BlY3R9KVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvc3BlY3RzID0gXy5tYXAodGhpcy5wcm9wcy5wcm9zcGVjdHMsIGZ1bmN0aW9uKHByb3NwZWN0KSB7XG4gICAgICAgIGlmKF8uZmluZFdoZXJlKHByb3NwZWN0LmJhdGNoZXMsIHtvYmplY3RJZDogdGhpc3MucHJvcHMuY3VycmVudEJhdGNofSkpXG4gICAgICAgICAgcmV0dXJuIFVzZXJQbGFjZUhvbGRlcih7cHJvc3BlY3Q6IHByb3NwZWN0fSlcbiAgICAgIH0pXG4gICAgfVxuICAgIHByb3NwZWN0cyA9IF8uY29tcGFjdChwcm9zcGVjdHMpXG4gICAgY29uc29sZS5kZWJ1Zyhwcm9zcGVjdHMpXG4gICAgY29uc29sZS5kZWJ1Zyhwcm9zcGVjdHMubGVuZ3RoKVxuICAgIHByb3NwZWN0Q291bnQgPSBwcm9zcGVjdHMubGVuZ3RoXG4gICAgZW1haWwgPSAocHJvc3BlY3QuZW1haWwpID8gcHJvc3BlY3QuZW1haWwgOiBcIlwiXG4gICAgaWYoZW1haWwgPT0gXCJub19lbWFpbFwiIHx8IGVtYWlsID09IFwiXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdHVUVTU0lORycpXG4gICAgICBpZihwcm9zcGVjdC5lbWFpbF9ndWVzc2VzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdHVUVTU0lORyBFTUFJTCcpXG4gICAgICAgIGd1ZXNzID0gXy5maW5kV2hlcmUocHJvc3BlY3QuZW1haWxfZ3Vlc3Nlcywge3RyaWVkOiBmYWxzZX0pXG4gICAgICAgIG5hbWUgPSBfLnRpdGxlKHByb3NwZWN0Lm5hbWUudHJpbSgpKVxuXG4gICAgICAgIHZhcnMgPSB7XG4gICAgICAgICAgZmlyc3Q6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKS5yZXBsYWNlKC9cXFcvZywgJycpLFxuICAgICAgICAgIGxhc3Q6IF8ubGFzdChuYW1lLnNwbGl0KCcgJykpLnJlcGxhY2UoL1xcVy9nLCAnJyksXG4gICAgICAgICAgZmk6IF8uZmlyc3QobmFtZS5zcGxpdCgnICcpKVswXS5yZXBsYWNlKC9cXFcvZywgJycpLFxuICAgICAgICAgIGxpOiBfLmxhc3QobmFtZS5zcGxpdCgnICcpKVswXS5yZXBsYWNlKC9cXFcvZywgJycpXG4gICAgICAgIH1cbiAgICAgICAgaWYoZ3Vlc3Mpe1xuICAgICAgICAgIGNvbnNvbGUubG9nKGd1ZXNzLnBhdHRlcm4ucGF0dGVybilcbiAgICAgICAgICBlbWFpbCA9IE11c3RhY2hlLnJlbmRlcihndWVzcy5wYXR0ZXJuLnBhdHRlcm4sIHZhcnMpXG4gICAgICAgICAgZW1haWwgPSBlbWFpbCtcIkBcIitwcm9zcGVjdC5kb21haW5cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ05PIEdVRVNTRVMgRk9VTkQnKVxuICAgICAgfVxuICAgIH1cbiAgICBlbWFpbCA9IGVtYWlsLnRvTG93ZXJDYXNlKClcbiAgICBlbWFpbCA9IGVtYWlsXG4gICAgcmV0dXJuIChcbiAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbCBmYWRlIGJzLXNlbmRFbWFpbC1tb2RhbC1sZ1wiLCB0YWJJbmRleDogXCItMVwiLCBcbiAgICAgICAgICAgcm9sZTogXCJkaWFsb2dcIiwgJ2FyaWEtbGFiZWxsZWRieSc6IFwibXlTbWFsbE1vZGFsTGFiZWxcIiwgJ2FyaWEtaGlkZGVuJzogXCJ0cnVlXCIsIFxuICAgICAgICAgICBpZDogXCJzZW5kRW1haWxNb2RhbFwiLCBzdHlsZToge3RvcDonMTBweCd9fSwgXG4gICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtZGlhbG9nIG1vZGFsLWxnXCJ9LCBcbiAgICAgICAgICAgICAgUmVhY3QuRE9NLmRpdih7Y2xhc3NOYW1lOiBcIm1vZGFsLWNvbnRlbnRcIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJtb2RhbC1oZWFkZXJcIn0sIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmJ1dHRvbih7dHlwZTogXCJidXR0b25cIiwgY2xhc3NOYW1lOiBcImNsb3NlXCIsICdkYXRhLWRpc21pc3MnOiBcIm1vZGFsXCJ9LCBSZWFjdC5ET00uc3Bhbih7J2FyaWEtaGlkZGVuJzogXCJ0cnVlXCJ9LCBcIsOXXCIpLCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLnNwYW4oe2NsYXNzTmFtZTogXCJzci1vbmx5XCJ9LCBcIkNsb3NlXCIpKSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMuc2VuZEVtYWlscywgXG4gICAgICAgICAgICAgICAgc3R5bGU6IHtmbG9hdDoncmlnaHQnfSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tcHJpbWFyeSBidG4tc21cIn0sIFxuICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtcGFwZXItcGxhbmVcIn0pLCBcIsKgIFNlbmQgRW1haWxcIiksIFxuICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBzdHlsZToge21hcmdpblJpZ2h0OjEwLCBmbG9hdDoncmlnaHQnfSwgXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJ0biBidG4tZGVmYXVsdCBidG4tc21cIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFwiQ2xvc2VcIiksIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmg0KHtjbGFzc05hbWU6IFwibW9kYWwtdGl0bGVcIiwgaWQ6IFwibXlNb2RhbExhYmVsXCJ9LCBcbiAgICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmkoe2NsYXNzTmFtZTogXCJmYSBmYS1lbnZlbG9wZVwifSksIFwiIMKgU2VuZCBFbWFpbFwiICsgJyAnICtcbiAgICAgICAgICAgICAgICAgICAgXCLCoMKgXCIsIFxuICAgICAgICAgICAgICAgICAgICBSZWFjdC5ET00uc21hbGwobnVsbCwgXCIoXCIrcHJvc3BlY3RDb3VudCtcIilcIilcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApLCBcbiAgICAgICAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtYm9keVwiLCBzdHlsZToge3BhZGRpbmdUb3A6NX19LCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5oNChudWxsLCBcIlBlb3BsZVwiKSwgXG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYoe2NsYXNzTmFtZTogXCJwcm9zcGVjdC1jb250YWluZXJcIn0sIFxuICAgICAgICAgICAgICAgICAgICBwcm9zcGVjdHNcbiAgICAgICAgICAgICAgICAgICksIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmJyKG51bGwpLCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5oNCh7c3R5bGU6IHtkaXNwbGF5OidpbmxpbmUtYmxvY2snfX0sIFwiRW1haWxzIMKgwqDCoFwiLCBcbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5hKHtocmVmOiBcImphdmFzY3JpcHQ6XCIsIFxuICAgICAgICAgICAgICBjbGFzc05hbWU6ICh0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdCA9PSAwICkgPyBcImJhZGdlIGJ0biBkaXNhYmxlZFwiIDogXCJiYWRnZSBidG5cIiwgXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHRoaXMucHJldmlvdXNQcm9zcGVjdH0sIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJyb3ctbGVmdFwifSkpLCBcIsKgwqBcIiwgXG4gICAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5zbWFsbChudWxsLCAodGhpcy5zdGF0ZS5jdXJyZW50UHJvc3BlY3QrMSkrJyBvZiAnK3Byb3NwZWN0Q291bnRcbiAgICAgICAgICAgICAgICAgICkpLCBcbiAgICAgICAgICAgICAgICAgIFwiwqDCoMKgXCIsIFxuICAgICAgICAgICAgICAgICAgUmVhY3QuRE9NLmEoe2hyZWY6IFwiamF2YXNjcmlwdDpcIiwgXG4gICAgICAgICAgICBjbGFzc05hbWU6ICh0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdCA9PSAgdGhpcy5wcm9wcy5wcm9zcGVjdHMubGVuZ3RoLTEpID8gXCJidG4gZGlzYWJsZWQgYmFkZ2VcIiA6IFwiYnRuIGJhZGdlXCIsIFxuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrOiB0aGlzLm5leHRQcm9zcGVjdH0sIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtYXJyb3ctcmlnaHRcIn0pKSwgXG5cbiAgICAgICAgICAgICAgICAgIFJlYWN0LkRPTS5kaXYobnVsbCwgXG5cblJlYWN0LkRPTS51bCh7Y2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAgZW1haWwtaG9sZGVyXCIsIHN0eWxlOiB7Ym9yZGVyVG9wOidzb2xpZCAxcHggI2VlZSd9fSwgXG4gIFJlYWN0LkRPTS5saSh7Y2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAtaXRlbVwifSwgXG4gICAgUmVhY3QuRE9NLmg1KHtzdHlsZToge2Rpc3BsYXk6J2lubGluZS1ibG9jaycsbWFyZ2luVG9wOjAsbWFyZ2luQm90dG9tOjB9fSwgXCJUbzrCoMKgXCIpLCBcbiAgICBcbiAgICBSZWFjdC5ET00uc3Bhbih7Y2xhc3NOYW1lOiBcImxhYmVsIGxhYmVsLXByaW1hcnlcIn0sIGVtYWlsKVxuICApLCBcbiAgUmVhY3QuRE9NLmxpKHtjbGFzc05hbWU6IFwibGlzdC1ncm91cC1pdGVtXCJ9LCBcbiAgICBSZWFjdC5ET00uaDUoe3N0eWxlOiB7ZGlzcGxheTonaW5saW5lLWJsb2NrJyxtYXJnaW5Ub3A6MCxtYXJnaW5Cb3R0b206MH19LCBcIlN1YmplY3Q6wqDCoFwiKSwgXCIgXCIsIFJlYWN0LkRPTS5zcGFuKHtjbGFzc05hbWU6IFwibGFiZWwgbGFiZWwtcHJpbWFyeVwifSwgdGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUuc3ViamVjdClcbiAgKSwgXG4gIFJlYWN0LkRPTS5saSh7Y2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAtaXRlbSBib2R5XCJ9KVxuKVxuICBcbiAgICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgICksIFxuXG4gICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwibW9kYWwtZm9vdGVyXCIsIHN0eWxlOiB7ZGlzcGxheTonbm9uZSd9fSwgXG4gICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogXCJidG4gYnRuLWRlZmF1bHRcIiwgJ2RhdGEtZGlzbWlzcyc6IFwibW9kYWxcIn0sIFwiQ2xvc2VcIiksIFxuICAgICAgICBSZWFjdC5ET00uYnV0dG9uKHt0eXBlOiBcImJ1dHRvblwiLCBcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1wcmltYXJ5XCJ9LCBcIlNlbmQgRW1haWxcIilcbiAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICApO1xuICB9LFxuXG4gIHByZXZpb3VzUHJvc3BlY3Q6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe2N1cnJlbnRQcm9zcGVjdDogdGhpcy5zdGF0ZS5jdXJyZW50UHJvc3BlY3QtMSB9KVxuICB9LFxuXG4gIG5leHRQcm9zcGVjdDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7Y3VycmVudFByb3NwZWN0OiB0aGlzLnN0YXRlLmN1cnJlbnRQcm9zcGVjdCsxIH0pXG4gIH0sXG5cbiAgcGFyc2VUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGVCb2R5KSB7XG4gICAgZmlyc3RfbmFtZSA9IHByb3NwZWN0Lm5hbWUuc3BsaXQoJyAnKVswXVxuICAgIC8vaGlyaW5nX3NpZ25hbCA9IHByb3NwZWN0LnNpZ25hbHNcblxuICAgIHNpZ25hbHMgPSAocHJvc3BlY3Quc2lnbmFscykgPyBwcm9zcGVjdC5zaWduYWxzWzBdIDogXCJcIlxuICAgIHRlbXBsYXRlQm9keSA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZUJvZHksIHtcbiAgICAgIGhpcmluZ19zaWduYWw6IHNpZ25hbHMsXG4gICAgICBmaXJzdF9uYW1lOiBfLnRpdGxlKHByb3NwZWN0Lm5hbWUuc3BsaXQoJyAnKVswXSlcbiAgICB9KVxuXG4gICAgLy9jb25zb2xlLmxvZyh0ZW1wbGF0ZUJvZHkpXG4gICAgICBcbiAgICByZXR1cm4gdGVtcGxhdGVCb2R5XG4gIH0sXG5cbiAgY29tcG9uZW50RGlkVXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAvL2NvbnNvbGUubG9nKHRoaXMucHJvcHMuY3VycmVudFRlbXBsYXRlKVxuICAgIHBhcnNlZFRlbXBsYXRlID0gdGhpcy5wYXJzZVRlbXBsYXRlKHRoaXMucHJvcHMuY3VycmVudFRlbXBsYXRlLmJvZHkpXG4gICAgXG4gICAgLy8kKCcuYm9keScpLmh0bWwodGhpcy5wcm9wcy5jdXJyZW50VGVtcGxhdGUuYm9keSlcbiAgICAkKCcuYm9keScpLmh0bWwocGFyc2VkVGVtcGxhdGUpXG4gIH1cbn0pO1xuXG52YXIgVXNlclBsYWNlSG9sZGVyID0gUmVhY3QuY3JlYXRlQ2xhc3Moe2Rpc3BsYXlOYW1lOiAnVXNlclBsYWNlSG9sZGVyJyxcbiAgcmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiYnRuLWdyb3VwXCIsIHN0eWxlOiB7bWFyZ2luUmlnaHQ6NSxtYXJnaW5Cb3R0b206NX19LCBcbiAgICAgICAgICBSZWFjdC5ET00uZGl2KHtjbGFzc05hbWU6IFwiYnRuLWdyb3VwXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIFxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6IFwiYnRuIGJ0bi1zdWNjZXNzIGJ0bi1zbVwifSwgXG4gICAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdXNlclwifSksIFwiwqDCoFwiLCBcbiAgICAgICAgICAgICAgKHRoaXMucHJvcHMucHJvc3BlY3QpID8gXy50aXRsZSh0aGlzLnByb3BzLnByb3NwZWN0Lm5hbWUpIDogXCJcIlxuICAgICAgICAgICAgKVxuICAgICAgICAgICksIFxuICAgICAgICAgIFJlYWN0LkRPTS5idXR0b24oe3R5cGU6IFwiYnV0dG9uXCIsIGNsYXNzTmFtZTogXCJidG4gYnRuLXN1Y2Nlc3MgYnRuLXNtXCJ9LCBcbiAgICAgICAgICAgIFJlYWN0LkRPTS5pKHtjbGFzc05hbWU6IFwiZmEgZmEtdHJhc2gtb1wifSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICApXG4gIH1cbn0pO1xuIl19
